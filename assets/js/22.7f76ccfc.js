(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{941:function(t,e,a){"use strict";a.r(e);var n=a(56),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"oracle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oracle"}},[t._v("#")]),t._v(" Oracle")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#oracle"}},[t._v("Oracle")]),a("ul",[a("li",[a("a",{attrs:{href:"#字符集"}},[t._v("字符集")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-查询oracle-server端的字符集"}},[t._v("1. 查询oracle server端的字符集")])]),a("li",[a("a",{attrs:{href:"#_2-服务端字符集环境"}},[t._v("2. 服务端字符集环境")])]),a("li",[a("a",{attrs:{href:"#_3-会话字符集环境"}},[t._v("3. 会话字符集环境")]),a("ul",[a("li",[a("a",{attrs:{href:"#配置环境变量-nls-lang"}},[t._v("配置环境变量 NLS_LANG")])])])]),a("li",[a("a",{attrs:{href:"#_4-客户端的字符集要求与服务器一致-才能正确显示数据库的非ascii字符。"}},[t._v("4. 客户端的字符集要求与服务器一致，才能正确显示数据库的非Ascii字符。")])]),a("li",[a("a",{attrs:{href:"#修改会话的字符集与数据库的字符集一致"}},[t._v("修改会话的字符集与数据库的字符集一致")])])])]),a("li",[a("a",{attrs:{href:"#客户端"}},[t._v("客户端")]),a("ul",[a("li",[a("a",{attrs:{href:"#列出当前用户下可见的所有表名及权限"}},[t._v("列出当前用户下可见的所有表名及权限")]),a("ul",[a("li",[a("a",{attrs:{href:"#查看当前用户下所有表"}},[t._v("查看当前用户下所有表")])])])])])]),a("li",[a("a",{attrs:{href:"#清除数据释放表空间-收缩表空间"}},[t._v("清除数据释放表空间（收缩表空间）")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-drop表"}},[t._v("1. drop表")])]),a("li",[a("a",{attrs:{href:"#_2-清除表中的数据"}},[t._v("2. 清除表中的数据")])]),a("li",[a("a",{attrs:{href:"#查询表空间信息"}},[t._v("查询表空间信息")])]),a("li",[a("a",{attrs:{href:"#查询用户下的表"}},[t._v("查询用户下的表")])])])]),a("li",[a("a",{attrs:{href:"#迁移数据"}},[t._v("迁移数据")])]),a("li",[a("a",{attrs:{href:"#查询oracle正在执行的sql语句、当前的被锁对象"}},[t._v("查询Oracle正在执行的sql语句、当前的被锁对象")])]),a("li",[a("a",{attrs:{href:"#cmd"}},[t._v("CMD")])]),a("li",[a("a",{attrs:{href:"#用户"}},[t._v("用户")]),a("ul",[a("li",[a("a",{attrs:{href:"#异常"}},[t._v("异常")]),a("ul",[a("li",[a("a",{attrs:{href:"#ora-01940-无法删除当前连接的用户"}},[t._v("ORA-01940: 无法删除当前连接的用户")])])])])])]),a("li",[a("a",{attrs:{href:"#表空间"}},[t._v("表空间")]),a("ul",[a("li",[a("a",{attrs:{href:"#实操"}},[t._v("实操")])]),a("li",[a("a",{attrs:{href:"#ora-01653-unable-to-extend-table-jszx-tmp-t-cviter-emission-info-2-by-128-in-tablespace-jszxspace-def"}},[t._v("ORA-01653: unable to extend table JSZX.TMPTCVITEREMISSIONINFO2 by 128 in tablespace JSZXSPACEDEF")])])])]),a("li",[a("a",{attrs:{href:"#表结构"}},[t._v("表结构")])]),a("li",[a("a",{attrs:{href:"#版本查看"}},[t._v("版本查看")]),a("ul",[a("li",[a("a",{attrs:{href:"#版本差异"}},[t._v("版本差异")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-wm-concat"}},[t._v("1. wm_concat")])])])])])]),a("li",[a("a",{attrs:{href:"#package"}},[t._v("package")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建包"}},[t._v("创建包")])]),a("li",[a("a",{attrs:{href:"#创建包体"}},[t._v("创建包体")])]),a("li",[a("a",{attrs:{href:"#删除包、包体"}},[t._v("删除包、包体")])]),a("li",[a("a",{attrs:{href:"#调用"}},[t._v("调用")])]),a("li",[a("a",{attrs:{href:"#demo"}},[t._v("demo")]),a("ul",[a("li",[a("a",{attrs:{href:"#ora-06508"}},[t._v("ORA-06508")]),a("ul",[a("li",[a("a",{attrs:{href:"#解决"}},[t._v("解决")])])])])])])])]),a("li",[a("a",{attrs:{href:"#job"}},[t._v("job")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建job"}},[t._v("创建job")])]),a("li",[a("a",{attrs:{href:"#查看运行的job"}},[t._v("查看运行的job")])]),a("li",[a("a",{attrs:{href:"#停止运行的job"}},[t._v("停止运行的job")])]),a("li",[a("a",{attrs:{href:"#启动job"}},[t._v("启动job")])]),a("li",[a("a",{attrs:{href:"#删除job"}},[t._v("删除job")])])])]),a("li",[a("a",{attrs:{href:"#约束"}},[t._v("约束")]),a("ul",[a("li",[a("a",{attrs:{href:"#主键"}},[t._v("主键")])]),a("li",[a("a",{attrs:{href:"#唯一性"}},[t._v("唯一性")])]),a("li",[a("a",{attrs:{href:"#约束"}},[t._v("约束")])])])]),a("li",[a("a",{attrs:{href:"#字符集"}},[t._v("字符集")])]),a("li",[a("a",{attrs:{href:"#连接数"}},[t._v("连接数")])]),a("li",[a("a",{attrs:{href:"#修改数据库dba密码"}},[t._v("修改数据库DBA密码")]),a("ul",[a("li",[a("a",{attrs:{href:"#修改用户密码过期日期"}},[t._v("修改用户密码过期日期")])])])]),a("li",[a("a",{attrs:{href:"#db-link"}},[t._v("DB Link")]),a("ul",[a("li",[a("a",{attrs:{href:"#oracle-dblink连接数过多"}},[t._v("Oracle DBLink连接数过多")])]),a("li",[a("a",{attrs:{href:"#查看"}},[t._v("查看")])]),a("li",[a("a",{attrs:{href:"#创建"}},[t._v("创建")])]),a("li",[a("a",{attrs:{href:"#删除"}},[t._v("删除")])]),a("li",[a("a",{attrs:{href:"#查看表"}},[t._v("查看表")])])])]),a("li",[a("a",{attrs:{href:"#同义词"}},[t._v("同义词")]),a("ul",[a("li",[a("a",{attrs:{href:"#查看"}},[t._v("查看")])]),a("li",[a("a",{attrs:{href:"#创建"}},[t._v("创建")])]),a("li",[a("a",{attrs:{href:"#删除"}},[t._v("删除")])]),a("li",[a("a",{attrs:{href:"#验证"}},[t._v("验证")])])])]),a("li",[a("a",{attrs:{href:"#表"}},[t._v("表")]),a("ul",[a("li",[a("a",{attrs:{href:"#union"}},[t._v("UNION")])]),a("li",[a("a",{attrs:{href:"#删除"}},[t._v("删除")])]),a("li",[a("a",{attrs:{href:"#备份表数据"}},[t._v("备份表数据")])]),a("li",[a("a",{attrs:{href:"#索引"}},[t._v("索引")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建"}},[t._v("创建")])]),a("li",[a("a",{attrs:{href:"#查询"}},[t._v("查询")])])])]),a("li",[a("a",{attrs:{href:"#删除"}},[t._v("删除")])]),a("li",[a("a",{attrs:{href:"#字段"}},[t._v("字段")]),a("ul",[a("li",[a("a",{attrs:{href:"#默认值"}},[t._v("默认值")])]),a("li",[a("a",{attrs:{href:"#可为空-非空切换"}},[t._v("可为空/非空切换")])]),a("li",[a("a",{attrs:{href:"#数据类型"}},[t._v("数据类型")]),a("ul",[a("li",[a("a",{attrs:{href:"#date和timestamp区别"}},[t._v("DATE和TIMESTAMP区别")]),a("ul",[a("li",[a("a",{attrs:{href:"#date"}},[t._v("DATE")])]),a("li",[a("a",{attrs:{href:"#timestamp"}},[t._v("TIMESTAMP")])])])])])])])])])]),a("li",[a("a",{attrs:{href:"#分区表"}},[t._v("分区表")]),a("ul",[a("li",[a("a",{attrs:{href:"#查询指定表下面的所有分区"}},[t._v("查询指定表下面的所有分区")])]),a("li",[a("a",{attrs:{href:"#删除分区表分区数据"}},[t._v("删除分区表分区数据")])]),a("li",[a("a",{attrs:{href:"#查询指定分区的数据"}},[t._v("查询指定分区的数据")])]),a("li",[a("a",{attrs:{href:"#创建表同时创建分区"}},[t._v("创建表同时创建分区")])]),a("li",[a("a",{attrs:{href:"#修改表分区"}},[t._v("修改表分区")])]),a("li",[a("a",{attrs:{href:"#相关问题"}},[t._v("相关问题")]),a("ul",[a("li",[a("a",{attrs:{href:"#ora-14400-inserted-partition-key-does-not-map-to-any-partition"}},[t._v("ORA-14400: inserted partition key does not map to any partition")])])])])])]),a("li",[a("a",{attrs:{href:"#存储过程"}},[t._v("存储过程")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建"}},[t._v("创建")])]),a("li",[a("a",{attrs:{href:"#查看"}},[t._v("查看")])]),a("li",[a("a",{attrs:{href:"#执行"}},[t._v("执行")])]),a("li",[a("a",{attrs:{href:"#删除"}},[t._v("删除")])]),a("li",[a("a",{attrs:{href:"#测试"}},[t._v("测试")])]),a("li",[a("a",{attrs:{href:"#异常日志"}},[t._v("异常日志")])])])]),a("li",[a("a",{attrs:{href:"#函数"}},[t._v("函数")]),a("ul",[a("li",[a("a",{attrs:{href:"#内置"}},[t._v("内置")]),a("ul",[a("li",[a("a",{attrs:{href:"#price-revision-truck"}},[t._v("pricerevisiontruck")])]),a("li",[a("a",{attrs:{href:"#nvl-nvl2"}},[t._v("NVL NVL2")])])])]),a("li",[a("a",{attrs:{href:"#自定义"}},[t._v("自定义")])])])]),a("li",[a("a",{attrs:{href:"#序列"}},[t._v("序列")])]),a("li",[a("a",{attrs:{href:"#触发器"}},[t._v("触发器")]),a("ul",[a("li",[a("a",{attrs:{href:"#查询"}},[t._v("查询")])]),a("li",[a("a",{attrs:{href:"#主键自增"}},[t._v("主键自增")])]),a("li",[a("a",{attrs:{href:"#数据表同步"}},[t._v("数据表同步")])])])]),a("li",[a("a",{attrs:{href:"#问题汇总"}},[t._v("问题汇总")]),a("ul",[a("li",[a("a",{attrs:{href:"#超时-分布式事务处理等待锁"}},[t._v("超时: 分布式事务处理等待锁")])]),a("li",[a("a",{attrs:{href:"#_1-ora-12547-tns-lost-contact"}},[t._v("1. ORA-12547:TNS:lost contact")])])])]),a("li",[a("a",{attrs:{href:"#练习"}},[t._v("练习")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建表"}},[t._v("创建表")])]),a("li",[a("a",{attrs:{href:"#组织"}},[t._v("组织")])]),a("li",[a("a",{attrs:{href:"#分组"}},[t._v("分组")])])])]),a("li",[a("a",{attrs:{href:"#整库备份还原"}},[t._v("整库备份还原")]),a("ul",[a("li",[a("a",{attrs:{href:"#备份-exp"}},[t._v("备份 exp")]),a("ul",[a("li",[a("a",{attrs:{href:"#异常"}},[t._v("异常")])]),a("li",[a("a",{attrs:{href:"#空表"}},[t._v("空表")])]),a("li",[a("a",{attrs:{href:"#help"}},[t._v("help")])])])]),a("li",[a("a",{attrs:{href:"#导入还原-imp"}},[t._v("导入还原 imp")]),a("ul",[a("li",[a("a",{attrs:{href:"#异常"}},[t._v("异常")])])])]),a("li",[a("a",{attrs:{href:"#乱码"}},[t._v("乱码")]),a("ul",[a("li",[a("a",{attrs:{href:"#修改字符集"}},[t._v("修改字符集")]),a("ul",[a("li",[a("a",{attrs:{href:"#修改服务器字符集"}},[t._v("修改服务器字符集")]),a("ul",[a("li",[a("a",{attrs:{href:"#问题-exp-00091-exporting-questionable-statistics"}},[t._v("问题 EXP-00091: Exporting questionable statistics.")])])])]),a("li",[a("a",{attrs:{href:"#修改本地库字符集"}},[t._v("修改本地库字符集")])])])])])])])])])])])]),a("p"),t._v(" "),a("h2",{attrs:{id:"字符集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符集"}},[t._v("#")]),t._v(" 字符集")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/qq_43455948/article/details/98969497",target:"_blank",rel:"noopener noreferrer"}},[t._v("ORACLE数据库字符集"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"_1-查询oracle-server端的字符集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查询oracle-server端的字符集"}},[t._v("#")]),t._v(" 1. 查询oracle server端的字符集")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select userenv('language') from dual;\n----数据库服务器字符集\nselect * from nls_database_parameters;\n--查询dmp文件的字符集 查看第2第3个字节的内容，如0354，然后用以下SQL查出它对应的字符集\nselect nls_charset_name(to_number('0354','xxxx')) from dual;\n")])])]),a("h3",{attrs:{id:"_2-服务端字符集环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务端字符集环境"}},[t._v("#")]),t._v(" 2. 服务端字符集环境")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from nls_instance_parameters;\n")])])]),a("h3",{attrs:{id:"_3-会话字符集环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-会话字符集环境"}},[t._v("#")]),t._v(" 3. 会话字符集环境")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from nls_session_parameters;\n\n   \tPARAMETER\tVALUE\n1\tNLS_LANGUAGE\tAMERICAN\n2\tNLS_TERRITORY\tAMERICA\n3\tNLS_CURRENCY\t$\n4\tNLS_ISO_CURRENCY\tAMERICA\n5\tNLS_NUMERIC_CHARACTERS\t.,\n6\tNLS_CALENDAR\tGREGORIAN\n7\tNLS_DATE_FORMAT\tDD-MON-RR\n8\tNLS_DATE_LANGUAGE\tAMERICAN\n9\tNLS_SORT\tBINARY\n10\tNLS_TIME_FORMAT\tHH.MI.SSXFF AM\n11\tNLS_TIMESTAMP_FORMAT\tDD-MON-RR HH.MI.SSXFF AM\n12\tNLS_TIME_TZ_FORMAT\tHH.MI.SSXFF AM TZR\n13\tNLS_TIMESTAMP_TZ_FORMAT\tDD-MON-RR HH.MI.SSXFF AM TZR\n14\tNLS_DUAL_CURRENCY\t$\n15\tNLS_COMP\tBINARY\n16\tNLS_LENGTH_SEMANTICS\tBYTE\n17\tNLS_NCHAR_CONV_EXCP\tFALSE\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("insert into sys_dept values(100,  0,   '0',          '智能发运科技',   0, '智能发运', '15888888888', 'ry@qq.com', '0', '0', 'admin', TO_DATE('2018-03-16 11-33-00', 'YYYY-MM-DD HH24:MI:SS'), 'ry', TO_DATE('2018-03-16 11-33-00', 'YYYY-MM-DD HH24:MI:SS'));\nORA-12899: value too large for column \"TXJIS\".\"SYS_DEPT\".\"DEPT_NAME\" (actual: 36, maximum: 30)\n")])])]),a("h4",{attrs:{id:"配置环境变量-nls-lang"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置环境变量-nls-lang"}},[t._v("#")]),t._v(" 配置环境变量 NLS_LANG")]),t._v(" "),a("ul",[a("li",[t._v("SIMPLIFIED CHINESE_CHINA.ZHS16GBK")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("   \tPARAMETER\tVALUE\n1\tNLS_LANGUAGE\tSIMPLIFIED CHINESE\n2\tNLS_TERRITORY\tCHINA\n3\tNLS_CURRENCY\t￥\n4\tNLS_ISO_CURRENCY\tCHINA\n5\tNLS_NUMERIC_CHARACTERS\t.,\n6\tNLS_CALENDAR\tGREGORIAN\n7\tNLS_DATE_FORMAT\tDD-MON-RR\n8\tNLS_DATE_LANGUAGE\tSIMPLIFIED CHINESE\n9\tNLS_SORT\tBINARY\n10\tNLS_TIME_FORMAT\tHH.MI.SSXFF AM\n11\tNLS_TIMESTAMP_FORMAT\tDD-MON-RR HH.MI.SSXFF AM\n12\tNLS_TIME_TZ_FORMAT\tHH.MI.SSXFF AM TZR\n13\tNLS_TIMESTAMP_TZ_FORMAT\tDD-MON-RR HH.MI.SSXFF AM TZR\n14\tNLS_DUAL_CURRENCY\t￥\n15\tNLS_COMP\tBINARY\n16\tNLS_LENGTH_SEMANTICS\tBYTE\n17\tNLS_NCHAR_CONV_EXCP\tFALSE\n")])])]),a("ul",[a("li",[t._v("AMERICAN_AMERICA.AL32UTF8")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("   \tPARAMETER\tVALUE\n1\tNLS_LANGUAGE\tAMERICAN\n2\tNLS_TERRITORY\tAMERICA\n3\tNLS_CURRENCY\t$\n4\tNLS_ISO_CURRENCY\tAMERICA\n5\tNLS_NUMERIC_CHARACTERS\t.,\n6\tNLS_CALENDAR\tGREGORIAN\n7\tNLS_DATE_FORMAT\tDD-MON-RR\n8\tNLS_DATE_LANGUAGE\tAMERICAN\n9\tNLS_SORT\tBINARY\n10\tNLS_TIME_FORMAT\tHH.MI.SSXFF AM\n11\tNLS_TIMESTAMP_FORMAT\tDD-MON-RR HH.MI.SSXFF AM\n12\tNLS_TIME_TZ_FORMAT\tHH.MI.SSXFF AM TZR\n13\tNLS_TIMESTAMP_TZ_FORMAT\tDD-MON-RR HH.MI.SSXFF AM TZR\n14\tNLS_DUAL_CURRENCY\t$\n15\tNLS_COMP\tBINARY\n16\tNLS_LENGTH_SEMANTICS\tBYTE\n17\tNLS_NCHAR_CONV_EXCP\tFALSE\n")])])]),a("h3",{attrs:{id:"_4-客户端的字符集要求与服务器一致-才能正确显示数据库的非ascii字符。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-客户端的字符集要求与服务器一致-才能正确显示数据库的非ascii字符。"}},[t._v("#")]),t._v(" 4. 客户端的字符集要求与服务器一致，才能正确显示数据库的非Ascii字符。")]),t._v(" "),a("h3",{attrs:{id:"修改会话的字符集与数据库的字符集一致"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改会话的字符集与数据库的字符集一致"}},[t._v("#")]),t._v(" 修改会话的字符集与数据库的字符集一致")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/reaperhero/p/10242865.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oracle 客户端 NLS_LANG 的设置"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--AMERICAN_AMERICA.AL32UTF8\nselect * from nls_database_parameters;\n--数据库的字符集\n   \tPARAMETER\tVALUE\n1\tNLS_LANGUAGE\tAMERICAN\t--\n2\tNLS_TERRITORY\tAMERICA\t\t--\n3\tNLS_CURRENCY\t$\n4\tNLS_ISO_CURRENCY\tAMERICA\n5\tNLS_NUMERIC_CHARACTERS\t.,\n6\tNLS_CHARACTERSET\tAL32UTF8\t--\n7\tNLS_CALENDAR\tGREGORIAN\n8\tNLS_DATE_FORMAT\tDD-MON-RR\n9\tNLS_DATE_LANGUAGE\tAMERICAN\n10\tNLS_SORT\tBINARY\n11\tNLS_TIME_FORMAT\tHH.MI.SSXFF AM\n12\tNLS_TIMESTAMP_FORMAT\tDD-MON-RR HH.MI.SSXFF AM\n13\tNLS_TIME_TZ_FORMAT\tHH.MI.SSXFF AM TZR\n14\tNLS_TIMESTAMP_TZ_FORMAT\tDD-MON-RR HH.MI.SSXFF AM TZR\n15\tNLS_DUAL_CURRENCY\t$\n16\tNLS_COMP\tBINARY\n17\tNLS_LENGTH_SEMANTICS\tBYTE\n18\tNLS_NCHAR_CONV_EXCP\tFALSE\n19\tNLS_NCHAR_CHARACTERSET\tAL16UTF16\n20\tNLS_RDBMS_VERSION\t11.2.0.1.0\n\n\n- SIMPLIFIED CHINESE_CHINA.AL32UTF8\n")])])]),a("blockquote",[a("p",[t._v("注：客户端的字符集是在没有设置NLS_LANG环境变量时，会话默认的字符集")])]),t._v(" "),a("h2",{attrs:{id:"客户端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端"}},[t._v("#")]),t._v(" 客户端")]),t._v(" "),a("h3",{attrs:{id:"列出当前用户下可见的所有表名及权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列出当前用户下可见的所有表名及权限"}},[t._v("#")]),t._v(" 列出当前用户下可见的所有表名及权限")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/csh602583095/article/details/31760781",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oracle:列出当前用户下可见的所有表名及权限…"),a("OutboundLink")],1)])]),t._v(" "),a("h4",{attrs:{id:"查看当前用户下所有表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看当前用户下所有表"}},[t._v("#")]),t._v(" 查看当前用户下所有表")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from tab;\n--用户自己拥有的表\nselect table_name from user_tables;\n--所有其他可以访问的表\nselect table_name from all_tables;\n--有DBA角色的用户所拥有的表\nselect table_name from dba_tables;\n")])])]),a("h2",{attrs:{id:"清除数据释放表空间-收缩表空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#清除数据释放表空间-收缩表空间"}},[t._v("#")]),t._v(" 清除数据释放表空间（收缩表空间）")]),t._v(" "),a("ul",[a("li",[t._v("https://blog.csdn.net/xtdhqdhq/article/details/45691227")])]),t._v(" "),a("h3",{attrs:{id:"_1-drop表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-drop表"}},[t._v("#")]),t._v(" 1. drop表")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--查看回收站\nselect object_name, original_name, operation, type from user_recyclebin;\n----不放入回收站，彻底删除表\ndrop table T_CVITER_EMISSION_INFO purge;\n--清除回收站里的信息\n----清除指定表\npurge table T_CVITER_EMISSION_INFO;\n----清除当前用户的回收站\npurge recyclebin;\n----清除所有用户的回收站\n--purge dba_recyclebin;\n")])])]),a("h3",{attrs:{id:"_2-清除表中的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-清除表中的数据"}},[t._v("#")]),t._v(" 2. 清除表中的数据")]),t._v(" "),a("ul",[a("li",[t._v("delete与truncate的区别\n"),a("ul",[a("li",[t._v("delete：会产生rollback，如果删除大数据量的表速度会很慢，同时会占用很多的rollback segments。")]),t._v(" "),a("li",[t._v("truncate：是DDL操作，不产生rollback，速度快。")])])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("清空表中数据\nTRUNCATE TABLE T_CVITER_EMISSION_INFO;\nDELETE FROM T_CVITER_EMISSION_INFO;\n")])])]),a("h3",{attrs:{id:"查询表空间信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询表空间信息"}},[t._v("#")]),t._v(" 查询表空间信息")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("----查询各表在存储空间的使用分情况\n--JSZX T_CVITER_OBD_INFO\nSELECT TABLESPACE_NAME,\n       TO_CHAR(SUM(BYTES) / (1024 * 1024), '999G999D999') CNT_MB\n  FROM DBA_EXTENTS\n WHERE OWNER = '&OWNER'\n   AND SEGMENT_NAME = '&TABLE_NAME'\n   AND SEGMENT_TYPE LIKE 'TABLE%'\n GROUP BY TABLESPACE_NAME;\n\n----查询存储空间情况\nSELECT TABLESPACE_NAME, SUM(BYTES)/1024/1024 FROM DBA_SEGMENTS GROUP BY TABLESPACE_NAME;\n")])])]),a("h3",{attrs:{id:"查询用户下的表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询用户下的表"}},[t._v("#")]),t._v(" 查询用户下的表")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--当前用户所拥有的表\nSELECT * FROM USER_TABLES;\nSELECT * FROM DBA_TABLES;\n")])])]),a("h2",{attrs:{id:"迁移数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#迁移数据"}},[t._v("#")]),t._v(" 迁移数据")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--创建DBLINKS\nINSERT INTO T_B_EQUIPMENT_INFO SELECT * FROM T_B_EQUIPMENT_INFO@DBLINK_TEMP_MIGRATE WHERE SBBH='330118_SQ_LZGJL4V45KX005065';\n")])])]),a("h2",{attrs:{id:"查询oracle正在执行的sql语句、当前的被锁对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询oracle正在执行的sql语句、当前的被锁对象"}},[t._v("#")]),t._v(" 查询Oracle正在执行的sql语句、当前的被锁对象")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--查询Oracle正在执行的sql语句及执行该语句的用户\nSELECT b.sid oracleID,  \n       b.username 登录Oracle用户名,  \n       b.serial#,  \n       spid 操作系统ID,  \n       paddr,  \n       sql_text 正在执行的SQL,  \n       b.machine 计算机名  \nFROM v$process a, v$session b, v$sqlarea c  \nWHERE a.addr = b.paddr  \n   AND b.sql_hash_value = c.hash_value;\n\n--查看正在执行sql的发起者的发放程序\nSELECT OSUSER 电脑登录身份,  \n       PROGRAM 发起请求的程序,  \n       USERNAME 登录系统的用户名,  \n       SCHEMANAME,  \n       B.Cpu_Time 花费cpu的时间,  \n       STATUS,  \n       B.SQL_TEXT 执行的sql  \nFROM V$SESSION A  \nLEFT JOIN V$SQL B ON A.SQL_ADDRESS = B.ADDRESS  \n                   AND A.SQL_HASH_VALUE = B.HASH_VALUE\n--WHERE B.Cpu_Time IS NOT NULL               \nORDER BY b.cpu_time DESC;\n\n--查出oracle当前的被锁对象\nSELECT l.session_id sid,  \n       s.serial#,  \n       l.locked_mode 锁模式,  \n       l.oracle_username 登录用户,  \n       l.os_user_name 登录机器用户名,  \n       s.machine 机器名,  \n       s.terminal 终端用户名,  \n       o.object_name 被锁对象名,  \n       s.logon_time 登录数据库时间  \nFROM v$locked_object l, all_objects o, v$session s  \nWHERE l.object_id = o.object_id  \n   AND l.session_id = s.sid  \nORDER BY sid, s.serial#; \n\n--kill掉当前的锁对象可以为\n--alter system kill session 'sid,s.serial#';\n")])])]),a("h2",{attrs:{id:"cmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cmd"}},[t._v("#")]),t._v(" CMD")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("C:\\Users\\Administrator>sqlplus /nolog\n\nSQL*Plus: Release 11.2.0.1.0 Production on 星期三 10月 2 17:25:06 2019\n\nCopyright (c) 1982, 2010, Oracle.  All rights reserved.\n\nSQL> conn /as sysdba\n已连接。\nSQL> create user epesd identified by epesd;\n\n用户已创建。\n\nSQL> grant connect,resource,dba to epesd;\n\n授权成功。\n\nSQL Plus\nselect count(*) from v$process;\n")])])]),a("h2",{attrs:{id:"用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用户"}},[t._v("#")]),t._v(" 用户")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--加了cascade就可以把用户连带的数据全部删掉\ndrop user epesd cascade;\ncreate user epesd identified by epesd;\ngrant connect,resource,dba to epesd;\n")])])]),a("h3",{attrs:{id:"异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常"}},[t._v("#")]),t._v(" 异常")]),t._v(" "),a("h4",{attrs:{id:"ora-01940-无法删除当前连接的用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ora-01940-无法删除当前连接的用户"}},[t._v("#")]),t._v(" ORA-01940: 无法删除当前连接的用户")]),t._v(" "),a("blockquote",[a("p",[t._v("drop user epesd cascade; ORA-01940:cannot drop a user that is currently connected")])]),t._v(" "),a("ol",[a("li",[t._v("查看用户的连接状况")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select username,sid,serial#,paddr from v$session where username='EPESD';\n--\tUSERNAME\tSID\tSERIAL#\tPADDR\n--1\tEPESD\t1153\t149\t000007FFC85BFC98\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("找到要删除用户的sid,和serial，并删除")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("alter system kill session '1153,149';\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("删除用户")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select saddr,sid,serial#,paddr,username,status from v$session where username is not null;\ndrop user epesd cascade;\n")])])]),a("h2",{attrs:{id:"表空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表空间"}},[t._v("#")]),t._v(" 表空间")]),t._v(" "),a("h3",{attrs:{id:"实操"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实操"}},[t._v("#")]),t._v(" 实操")]),t._v(" "),a("ul",[a("li",[t._v("查询表空间方式一")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('SELECT UPPER(F.TABLESPACE_NAME) "表空间名", \n　　D.TOT_GROOTTE_MB "表空间大小(M)", \n　　D.TOT_GROOTTE_MB - F.TOTAL_BYTES "已使用空间(M)", \n　　TO_CHAR(ROUND((D.TOT_GROOTTE_MB - F.TOTAL_BYTES) / D.TOT_GROOTTE_MB * 100, \n　　2), \n　　\'990.99\') "使用比", \n　　F.TOTAL_BYTES "空闲空间(M)", \n　　F.MAX_BYTES "最大块(M)" \n　　FROM (SELECT TABLESPACE_NAME, \n　　ROUND(SUM(BYTES) / (1024 * 1024), 2) TOTAL_BYTES, \n　　ROUND(MAX(BYTES) / (1024 * 1024), 2) MAX_BYTES \n　　FROM SYS.DBA_FREE_SPACE \n　　GROUP BY TABLESPACE_NAME) F, \n　　(SELECT DD.TABLESPACE_NAME, \n　　ROUND(SUM(DD.BYTES) / (1024 * 1024), 2) TOT_GROOTTE_MB \n　　FROM SYS.DBA_DATA_FILES DD \n　　GROUP BY DD.TABLESPACE_NAME) D \n　　WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME \n　　ORDER BY 4 DESC;\n')])])]),a("ul",[a("li",[t._v("查询表空间方式二")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from v$tablespace\nselect * from dba_data_files\n\n扩展表空间\nalter database datafile '/data/soft/oratbs/part01.dbf' resize 10G;\n\n\n\n")])])]),a("ul",[a("li",[t._v("表结构相关TBS_PART表空间\n"),a("ul",[a("li",[t._v("第一种方式没查到，后边又能查到了")])])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  partition T_ALARM_202008 values less than (TO_DATE(' 2020-09-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))\n    tablespace TBS_PART\n    pctfree 10\n    initrans 1\n    maxtrans 255\n    storage\n    (\n      initial 5024K\n      next 1M\n      minextents 1\n      maxextents unlimited\n    ),\n\n")])])]),a("h3",{attrs:{id:"ora-01653-unable-to-extend-table-jszx-tmp-t-cviter-emission-info-2-by-128-in-tablespace-jszxspace-def"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ora-01653-unable-to-extend-table-jszx-tmp-t-cviter-emission-info-2-by-128-in-tablespace-jszxspace-def"}},[t._v("#")]),t._v(" ORA-01653: unable to extend table JSZX.TMP_T_CVITER_EMISSION_INFO_2 by 128 in tablespace JSZXSPACE_DEF")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--0、表对应的表空间\nSELECT * FROM DBA_TABLES WHERE TABLE_NAME like '%T_B_EQUIPMENT_INFO%';\nSELECT * FROM TABS WHERE TABLE_NAME = 'T_B_EQUIPMENT_INFO';\n\n--D:\\ORACLE11\\APP\\ADMINISTRATOR\\ORADATA\\SQZTC\\JSZXSPACE_DEF.DBF\n\n--1、查看表空间使用情况\nSELECT T.TABLESPACE_NAME,D.FILE_NAME,\nD.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS\nFROM DBA_TABLESPACES T,DBA_DATA_FILES D\nWHERE T.TABLESPACE_NAME =D.TABLESPACE_NAME \n-- and T.TABLESPACE_NAME='JSZXSPACE_DEF'\nORDER BY TABLESPACE_NAME,FILE_NAME;\n\n--1、查看表空间USERS使用情况\nSELECT T.TABLESPACE_NAME,D.FILE_NAME,\nD.AUTOEXTENSIBLE,D.BYTES,D.MAXBYTES,D.STATUS\nFROM DBA_TABLESPACES T,DBA_DATA_FILES D\nWHERE T.TABLESPACE_NAME =D.TABLESPACE_NAME \n--and T.TABLESPACE_NAME='USERS'\nORDER BY TABLESPACE_NAME,FILE_NAME;\n\n--2、修改表空间为自动增长\nALTER DATABASE \n    DATAFILE 'D:\\ORACLE11\\APP\\ADMINISTRATOR\\ORADATA\\SQZTC\\JSZXSPACE_DEF.DBF' AUTOEXTEND \n    ON NEXT 500M MAXSIZE UNLIMITED;\n    \n--3、自动增长还是不行，可能是数据库文件满了【注意：DBF文件在windows平台32g就不能用了】，就增加几个数据库文件 \nALTER TABLESPACE JSZXSPACE_DEF ADD DATAFILE 'D:\\ORACLE11\\APP\\ADMINISTRATOR\\ORADATA\\SQZTC\\JSZXSPACE_DEF02.DBF' SIZE 1G AUTOEXTEND ON NEXT 1G MAXSIZE 30g;\n")])])]),a("h2",{attrs:{id:"表结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表结构"}},[t._v("#")]),t._v(" 表结构")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\nSELECT * FROM T_B_EQUIPMENT_INFO;\nUPDATE T_B_EQUIPMENT_INFO T SET T.UPDATE_TIME=SYSDATE,T.ISAUTH= 2 WHERE T.SBBH IN('330118SQAAAGGGGGGGGSSSSSS');\n\n--新增字段\nalter table T_B_EQUIPMENT_INFO add (UPDATE_TIME1 DATE default SYSDATE);\n--删除字段\nALTER TABLE T_B_EQUIPMENT_INFO DROP COLUMN UPDATE_TIME1;\n")])])]),a("h2",{attrs:{id:"版本查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本查看"}},[t._v("#")]),t._v(" 版本查看")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from v$version;\nselect banner from sys.v_$version;\n")])])]),a("h3",{attrs:{id:"版本差异"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本差异"}},[t._v("#")]),t._v(" 版本差异")]),t._v(" "),a("h4",{attrs:{id:"_1-wm-concat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-wm-concat"}},[t._v("#")]),t._v(" 1. wm_concat")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wm_concat union 联合使用中保存 ORA-00932: inconsistent datatypes: expected - got CLOB\n\nOracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nchar\n\nOracle Database 11g Enterprise Edition Release 11.2.0.3.0 - 64bit Production\nCLOB\n\n解决 TO_CHAR(wm_concat)\n")])])]),a("h2",{attrs:{id:"package"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#package"}},[t._v("#")]),t._v(" package")]),t._v(" "),a("h3",{attrs:{id:"创建包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建包"}},[t._v("#")]),t._v(" 创建包")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE OR REPLACE PACKAGE tosin_pack AS\n v_globalvar NUMBER := 1;\n PROCEDURE updatevar;\nEND tosin_pack;\n")])])]),a("h3",{attrs:{id:"创建包体"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建包体"}},[t._v("#")]),t._v(" 创建包体")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE OR REPLACE PACKAGE BODY tosin_pack AS\n PROCEDURE updatevar IS\n BEGIN\n   v_globalvar := 7;\n END updatevar;\nEND tosin_pack;\n")])])]),a("h3",{attrs:{id:"删除包、包体"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除包、包体"}},[t._v("#")]),t._v(" 删除包、包体")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DROP PACKAGE tosin_pack;\n")])])]),a("h3",{attrs:{id:"调用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用"}},[t._v("#")]),t._v(" 调用")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("BEGIN\ntosin_pack.updatevar;\nEND;\n")])])]),a("h3",{attrs:{id:"demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[t._v("#")]),t._v(" demo")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--1--创建包\nCREATE OR REPLACE PACKAGE tosin_pack AS\n v_globalvar NUMBER := 1;\n PROCEDURE updatevar;\nEND tosin_pack;\n--1--创建包体\nCREATE OR REPLACE PACKAGE BODY tosin_pack AS\n PROCEDURE updatevar IS\n BEGIN\n   v_globalvar := 7;\n END updatevar;\nEND tosin_pack;\n\n--1--调用 --2--调用 \nBEGIN\ntosin_pack.updatevar;\nEND;\n\n--1--修改包体\nCREATE OR REPLACE PACKAGE BODY tosin_pack AS\n PROCEDURE updatevar IS\n   vv NUMBER;\n   xx NUMBER;\n BEGIN\n   v_globalvar := 8;\n END updatevar;\nEND tosin_pack;\n\n")])])]),a("h4",{attrs:{id:"ora-06508"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ora-06508"}},[t._v("#")]),t._v(" ORA-06508")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('--2--调用\nORA-04068: existing state of packages has been discarded\nORA-04061: existing state of package body "ZTCBOS.TOSIN_PACK" has been invalidated\nORA-04065: not executed, altered or dropped package body "ZTCBOS.TOSIN_PACK"\nORA-06508: PL/SQL: could not find program unit being called: "ZTCBOS.TOSIN_PACK"\nORA-06512: at line 2\n')])])]),a("h5",{attrs:{id:"解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[t._v("#")]),t._v(" 解决")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--1--修改包，问题解决\n--出错原因\n对于全局变量，每一个session会生成一个本地copy，如果程序重新编译的话，就会因程序里原变量找不到而丢弃该变量，继而导致这个错误。\n在一个会话中调用程序包package时，会生成package中全局变量的副本，如果在另一个会话中对此package进行编译就会使前一个会话中的副本失效，故而产生错误\n")])])]),a("h2",{attrs:{id:"job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#job"}},[t._v("#")]),t._v(" job")]),t._v(" "),a("ul",[a("li",[t._v("TosinJia/项目/车贷通/消息-车辆档案-超时锁车.sql")])]),t._v(" "),a("h3",{attrs:{id:"创建job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建job"}},[t._v("#")]),t._v(" 创建job")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--【3、创建定时任务job（暂定每10分钟执行一次）】\ndeclare  lockcar_job_really number; \nbegin \ndbms_job.submit(lockcar_job_really,'pro_lockcartask_isovertime;',sysdate,'sysdate+10/1440'); \ncommit; \nend;\n")])])]),a("h3",{attrs:{id:"查看运行的job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看运行的job"}},[t._v("#")]),t._v(" 查看运行的job")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://note.youdao.com/yws/api/personal/file/WEB6f201c1ac1478f0532df4b55257650cb?method=getImage&version=23760&cstk=Sl-a4fhx",alt:"image"}})]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from sys.user_jobs;\n\n--DBMS_Jobs 23 ->右键->View->View SQL\nbegin\n  sys.dbms_job.submit(job => :job,\n                      what => 'pro_lockcartask_isovertime;',\n                      next_date => to_date('29-05-2019 08:44:47', 'dd-mm-yyyy hh24:mi:ss'),\n                      interval => 'sysdate+10/1440');\n  commit;\nend;\n/\n--demo1\nbegin\n  sys.dbms_job.submit(job => :job,\n                      what => 'pro_del_alarm_currentday;',\n                      next_date => to_date('30-05-2019', 'dd-mm-yyyy'),\n                      interval => 'TRUNC(SYSDATE + 1)');\n  commit;\nend;\n/\n--demo1->create\ndeclare  del_alarm_currentday_job number; \nbegin \ndbms_job.submit(del_alarm_currentday_job,'pro_del_alarm_currentday;',sysdate,'TRUNC(SYSDATE + 1)'); \ncommit; \nend;\n--更正\ndeclare del_alarm_currentday_job number; \nbegin \ndbms_job.submit(del_alarm_currentday_job,'pro_del_alarm_currentday;',TRUNC(SYSDATE + 1),'TRUNC(SYSDATE + 1)'); \ncommit; \nend;\n\n\n-- 数据\ninsert into sys.user_jobs (JOB, LOG_USER, PRIV_USER, SCHEMA_USER, LAST_DATE, LAST_SEC, THIS_DATE, THIS_SEC, NEXT_DATE, NEXT_SEC, TOTAL_TIME, BROKEN, INTERVAL, FAILURES, WHAT, NLS_ENV, MISC_ENV, INSTANCE)\nvalues (23, 'TXJBOS', 'TXJBOS', 'TXJBOS', to_date('29-05-2019 08:24:45', 'dd-mm-yyyy hh24:mi:ss'), '08:24:45', null, null, to_date('29-05-2019 08:34:45', 'dd-mm-yyyy hh24:mi:ss'), '08:34:45', 515035, 'N', 'sysdate+10/1440', 0, 'pro_lockcartask_isovertime;', 'NLS_LANGUAGE=''AMERICAN'' NLS_TERRITORY=''AMERICA'' NLS_CURRENCY=''$'' NLS_ISO_CURRENCY=''AMERICA'' NLS_NUMERIC_CHARACTERS=''.,'' NLS_DATE_FORMAT=''DD-MON-RR'' NLS_DATE_LANGUAGE=''AMERICAN'' NLS_SORT=''BINARY''', '0102000200000000', 0);\n")])])]),a("h3",{attrs:{id:"停止运行的job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止运行的job"}},[t._v("#")]),t._v(" 停止运行的job")]),t._v(" "),a("ul",[a("li",[t._v("broken字段 N")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("begin \ndbms_job.broken(23,true); \ncommit; \nend;\n")])])]),a("h3",{attrs:{id:"启动job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动job"}},[t._v("#")]),t._v(" 启动job")]),t._v(" "),a("ul",[a("li",[t._v("broken字段 Y")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("begin\n  dbms_job.run(23);\n  commit;\nend;\n")])])]),a("h3",{attrs:{id:"删除job"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除job"}},[t._v("#")]),t._v(" 删除job")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("begin\n  dbms_job.remove(23);\n  commit;\nend;\n")])])]),a("h2",{attrs:{id:"约束"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#约束"}},[t._v("#")]),t._v(" 约束")]),t._v(" "),a("h3",{attrs:{id:"主键"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主键"}},[t._v("#")]),t._v(" 主键")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE TABLE TOSIN_EQUIPMENT_INFO AS SELECT * FROM T_B_EQUIPMENT_INFO WHERE SBBH='330118_SQ_LZGJL4V45KX005065';\nSELECT * FROM TOSIN_EQUIPMENT_INFO;\n----https://www.cnblogs.com/Richardzhu/p/3470929.html\n--主键\nALTER TABLE TOSIN_EQUIPMENT_INFO ADD CONSTRAINT PK_TOSIN_EQUIPMENT_INFO PRIMARY KEY(SBBH);\n----重命名主键\nALTER TABLE TOSIN_EQUIPMENT_INFO RENAME CONSTRAINT PK_TOSIN_EQUIPMENT_INFO TO PK_TOSIN_EQUIPMENT_INFO_ID;\n----禁用主键\nALTER TABLE TOSIN_EQUIPMENT_INFO DISABLE PRIMARY KEY;\n----启用主键\nALTER TABLE TOSIN_EQUIPMENT_INFO ENABLE PRIMARY KEY;\n\nSELECT * FROM user_cons_columns WHERE TABLE_NAME='TOSIN_EQUIPMENT_INFO';\nSELECT * FROM user_indexes WHERE TABLE_NAME='TOSIN_EQUIPMENT_INFO';\nSELECT * FROM user_constraints WHERE TABLE_NAME='TOSIN_EQUIPMENT_INFO';\n")])])]),a("h3",{attrs:{id:"唯一性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#唯一性"}},[t._v("#")]),t._v(" 唯一性")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--唯一性约束的创建\nALTER TABLE TOSIN_EQUIPMENT_INFO ADD CONSTRAINT UNQ_TOSIN_EQUIPMENT_INFO UNIQUE(CLSBHM);\n----重命名\nALTER TABLE TOSIN_EQUIPMENT_INFO RENAME CONSTRAINT UNQ_TOSIN_EQUIPMENT_INFO TO UNQ_TOSIN_EQUIPMENT_CLSBHM;\n")])])]),a("h3",{attrs:{id:"约束-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#约束-2"}},[t._v("#")]),t._v(" 约束")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('ALTER TABLE "TXJ"."kpi_interview" ADD CONSTRAINT "SYS_C0016442" CHECK ("interview_at" IS NOT NULL) NOT DEFERRABLE INITIALLY IMMEDIATE NORELY VALIDATE;\nALTER TABLE "kpi_interview" DROP CONSTRAINT SYS_C0016442;\n')])])]),a("h2",{attrs:{id:"字符集-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符集-2"}},[t._v("#")]),t._v(" 字符集")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select userenv('language') from dual;\n")])])]),a("h2",{attrs:{id:"连接数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接数"}},[t._v("#")]),t._v(" 连接数")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--数据库允许的最大连接数\nselect value from v$parameter where name = 'processes';\n--当前的连接数\nselect count(*) from v$process;\n--修改数据库允许的最大连接数：\n--alter system set processes = 1000 scope = spfile;\n\n--查看数据库当前会话的连接数\nselect count(*) from v$session;\n--查看数据库的并发连接数：\nselect count(*) from v$session where status='ACTIVE';\n--查看当前数据库建立的会话情况：\nselect sid,serial#,username,program,machine,status from v$session;\n\n")])])]),a("h2",{attrs:{id:"修改数据库dba密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改数据库dba密码"}},[t._v("#")]),t._v(" 修改数据库DBA密码")]),t._v(" "),a("ul",[a("li",[t._v("方式一")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("PS C:\\Users\\Administrator> sqlplus\n\nSQL*Plus: Release 11.2.0.1.0 Production on 星期五 10月 16 11:35:39 2020\n\nCopyright (c) 1982, 2010, Oracle.  All rights reserved.\n\n请输入用户名:  epesd\n输入口令:\nERROR:\nORA-28001: the password has expired\n\n\n更改 epesd 的口令\n新口令:\n重新键入新口令:\n口令已更改\n\n连接到:\nOracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n\nSQL>\n")])])]),a("ul",[a("li",[t._v("方式二")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sqlplus /nolog\nconnect / as sysdba\nalter user sys identified by sys;\n")])])]),a("h3",{attrs:{id:"修改用户密码过期日期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改用户密码过期日期"}},[t._v("#")]),t._v(" 修改用户密码过期日期")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("----system 123456 txjiov 172.16.88.162/orcl\n--在密码将要过期或已经过期时可通过 语句进行修改密码，密码修改后该用户可正常连接数据库\nALTER USER TXJIOV IDENTIFIED BY TXJIOV;\n\n--查看用户;用户的PROIFLE是哪个，一般是DEFAULT;到期日期\nSELECT USERNAME, PROFILE, EXPIRY_DATE FROM DBA_USERS;\n--查看指定概要文件的密码有效期设置\nSELECT * FROM DBA_PROFILES s WHERE s.profile='DEFAULT' AND s.RESOURCE_NAME='PASSWORD_LIFE_TIME';\n--将密码有效期有默认的180修改成 无限制，修改之后不需要重启动数据库，会立即生效\nALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME UNLIMITED;\n--将密码有效期设置为指定天数\nALTER PROFILE DEFAULT LIMIT PASSWORD_LIFE_TIME 365;\n\n--解锁普通用户\nalter user TXJIOV account unlock;\nalter user txjiov account unlock;\n--修改普通用户密码，密码以英文字母开头\nalter user TXJIOV identified by TXJIOV;\nalter user txjiov identified by txjiov;\n")])])]),a("h2",{attrs:{id:"db-link"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#db-link"}},[t._v("#")]),t._v(" DB Link")]),t._v(" "),a("h3",{attrs:{id:"oracle-dblink连接数过多"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oracle-dblink连接数过多"}},[t._v("#")]),t._v(" Oracle DBLink连接数过多")]),t._v(" "),a("ul",[a("li",[t._v("https://www.cnblogs.com/ebs-blog/p/6484973.html")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Microsoft Windows [版本 6.1.7601]\n版权所有 (c) 2009 Microsoft Corporation。保留所有权利。\n\nC:\\Users\\Administrator>sqlplus /nolog\n\nSQL*Plus: Release 11.2.0.1.0 Production on 星期六 11月 30 10:10:38 2019\n\nCopyright (c) 1982, 2010, Oracle.  All rights reserved.\n\nSQL> conn /as sysdba\n已连接。\nSQL> show parameter open_links\n\nNAME                                 TYPE\n------------------------------------ ----------------------\nVALUE\n------------------------------\nopen_links                           integer\n4\nopen_links_per_instance              integer\n4\nSQL> alter system set open_links=50 scope=spfile;\n\n系统已更改。\n\nSQL> alter system set open_links_per_instance=50 scope=spfile;\n\n系统已更改。\n\nSQL> show parameter open_links;\n\nNAME                                 TYPE\n------------------------------------ ----------------------\nVALUE\n------------------------------\nopen_links                           integer\n4\nopen_links_per_instance              integer\n4\nSQL> shutdown immediate\n数据库已经关闭。\n已经卸载数据库。\nORACLE 例程已经关闭。\nSQL> startup\nORACLE 例程已经启动。\n\nTotal System Global Area 3423965184 bytes\nFixed Size                  2180544 bytes\nVariable Size            2667579968 bytes\nDatabase Buffers          738197504 bytes\nRedo Buffers               16007168 bytes\n数据库装载完毕。\n数据库已经打开。\nSQL> show parameter open_links\n\nNAME                                 TYPE\n------------------------------------ ----------------------\nVALUE\n------------------------------\nopen_links                           integer\n50\nopen_links_per_instance              integer\n50\n")])])]),a("ul",[a("li",[t._v("SQL*Plus")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("http://www.cnblogs.com/ebs-blog/p/6484973.html\n\nSQL*Plus: Release 11.2.0.1.0 Production on 星期四 12月 20 12:18:32 2018\n\nCopyright (c) 1982, 2010, Oracle.  All rights reserved.\n\n请输入用户名:  root\n输入口令:\nERROR:\nORA-01017: invalid username/password; logon denied\n\n\n请输入用户名:  TXJBOS\n输入口令:\n\n连接到:\nOracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n\nSQL> show parameter open_links\n\nNAME                                 TYPE\n------------------------------------ ----------------------\nVALUE\n------------------------------\nopen_links                           integer\n4\nopen_links_per_instance              integer\n4\nSQL>\n")])])]),a("ul",[a("li",[t._v("plsql")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("alter system set open_links=50 scope=spfile;\nalter system set open_links_per_instance=50 scope=spfile;\n")])])]),a("ul",[a("li",[a("p",[t._v("重启服务\n"),a("img",{attrs:{src:"https://note.youdao.com/yws/api/personal/file/WEBcd1a027a1aa84dd7488f0828fb969cad?method=getImage&version=14198&cstk=HuVtfC-k",alt:"ORACLE-RESTART-SERVICE"}})])]),t._v(" "),a("li",[a("p",[t._v("SQL*Plus")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SQL*Plus: Release 11.2.0.1.0 Production on 星期四 12月 20 12:18:32 2018\n\nCopyright (c) 1982, 2010, Oracle.  All rights reserved.\n\n请输入用户名:  root\n输入口令:\nERROR:\nORA-01017: invalid username/password; logon denied\n\n\n请输入用户名:  TXJBOS\n输入口令:\n\n连接到:\nOracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n\nSQL> show parameter open_links\n\nNAME                                 TYPE\n------------------------------------ ----------------------\nVALUE\n------------------------------\nopen_links                           integer\n4\nopen_links_per_instance              integer\n4\nSQL>\n")])])]),a("h3",{attrs:{id:"查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看"}},[t._v("#")]),t._v(" 查看")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("select owner,object_name from dba_objects where object_type='DATABASE LINK';\nselect * from dba_db_links;\n")])])]),a("h3",{attrs:{id:"创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[t._v("#")]),t._v(" 创建")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("    create public database link DBLINK_IDC\n    connect to USER_NAME identified by USER_PWD\n    using '(DESCRIPTION =(ADDRESS_LIST =(ADDRESS =(PROTOCOL = TCP)(HOST = IP_ADDRESS)(PORT = 1521)))(CONNECT_DATA =(SERVICE_NAME = innetdb)))';\n    \n    --HgMonitoring区分大小写\n    create public database link DBLINK_GATEWAY\n    connect to HgMonitoring identified by HgMonitoring\n    using '(DESCRIPTION =(ADDRESS_LIST=(ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.9.13)(PORT = 1521))(ADDRESS = (PROTOCOL = TCP)(HOST = 172.16.9.14)(PORT = 1521))(LOAD_BALANCE= YES)(FAILOVER = ON))(CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = innetdb)(FAILOVER_MODE=(TYPE = session)(METHOD = preconnect)(RETRIES = 180)(DELAY = 5))))';\n")])])]),a("h3",{attrs:{id:"删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("drop public database link LINK_TXJ1_HGMONITORING;\n")])])]),a("h3",{attrs:{id:"查看表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看表"}},[t._v("#")]),t._v(" 查看表")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("SELECT * FROM T_B_CAR_INFO@DBLINK_IDC;\n")])])]),a("h2",{attrs:{id:"同义词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同义词"}},[t._v("#")]),t._v(" 同义词")]),t._v(" "),a("h3",{attrs:{id:"查看-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-2"}},[t._v("#")]),t._v(" 查看")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("select * from dba_synonyms WHERE OWNER='TXJBOS';\n")])])]),a("h3",{attrs:{id:"创建-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-2"}},[t._v("#")]),t._v(" 创建")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("create synonym CONFIG_DEV_INFO for CONFIG_DEV_INFO@LINK_TXJ1_HGMONITORING;\ncreate or replace synonym TOSIN_T_IMEI_RECORD for T_IMEI_RECORD@LINK_TXJ1_HGMONITORING;\n")])])]),a("h3",{attrs:{id:"删除-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除-2"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("drop synonym CONFIG_DEV_INFO;\n")])])]),a("h3",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[t._v("#")]),t._v(" 验证")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("SELECT * FROM CONFIG_DEV_INFO;\n")])])]),a("h2",{attrs:{id:"表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表"}},[t._v("#")]),t._v(" 表")]),t._v(" "),a("h3",{attrs:{id:"union"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#union"}},[t._v("#")]),t._v(" UNION")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE OR REPLACE VIEW VIEW_LOCK_INFO_LOG AS\n  SELECT lg.TERMINAL_ID, lg.OPERATE_TYPE, lg.CREATE_TIME, lg.TASK_TIME, u.USER_NAME USER_NAME FROM T_B_LOCK_INFO_LOG lg LEFT JOIN t_b_user u on (lg.USER_ID=u.ID) WHERE lg.OPERATE_TYPE IN(2, 3)\nUNION\n  SELECT lg.TERMINAL_ID, lg.OPERATE_TYPE, lg.CREATE_TIME, lg.TASK_TIME, '2.0系统'||nvl2(u.USER_NAME, ':'||u.USER_NAME, '') USER_NAME FROM T_B_LOCK_INFO_LOG@DBLINK_2 lg LEFT JOIN t_b_user@DBLINK_2 u on (lg.USER_ID=u.ID) WHERE lg.OPERATE_TYPE=2 OR  lg.OPERATE_TYPE=3\nUNION\n  SELECT TERMINALID TERMINAL_ID, CASE  WHEN OPERATIONMSG='锁车' THEN 2 WHEN OPERATIONMSG='解锁' THEN 3 END  OPERATE_TYPE, OPERATIONTIME CREATE_TIME, null TASK_TIME, '1.0系统'||nvl2(OPERATORNAME, ':'||OPERATORNAME, '') USER_NAME FROM T_B_USER_OPERATION@DBLINK_1 lg WHERE OPERATIONMSG ='锁车' OR OPERATIONMSG ='解锁'\nUNION\n  SELECT TERMINALID TERMINAL_ID, CASE WHEN OPE_TYPE=3 THEN 2 WHEN OPE_TYPE=4 THEN 3 END OPERATE_TYPE, ISSUED_TIME CREATE_TIME, TO_DATE(FNISH_TIME, 'yyyy-mm-dd hh24:mi:ss') TASK_TIME, '售后系统'||nvl2(OPE_USER, ':'||OPE_USER, '') USER_NAME FROM t_b_lockcar_ope_log@DBLINK_3 WHERE OPE_TYPE=3 OR OPE_TYPE=4;\n\n")])])]),a("h3",{attrs:{id:"删除-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除-3"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("TRUNCATE TABLE TEMP_TOSIN_EVENT_LOG;\n--分区也会删除\nDROP TABLE TEMP_TOSIN_EVENT_LOG;\n")])])]),a("h3",{attrs:{id:"备份表数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份表数据"}},[t._v("#")]),t._v(" 备份表数据")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE TABLE TEMP_EVENT_LOG AS SELECT * FROM TEMP_TOSIN_EVENT_LOG;\n")])])]),a("h3",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("h4",{attrs:{id:"创建-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-3"}},[t._v("#")]),t._v(" 创建")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE INDEX TTEL_EVENT_TIME ON TEMP_TOSIN_EVENT_LOG(EVENT_TIME);\n")])])]),a("h4",{attrs:{id:"查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[t._v("#")]),t._v(" 查询")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT TABLE_NAME, CONSTRAINT_NAME, CONSTRAINT_TYPE\n  FROM USER_CONSTRAINTS\n WHERE TABLE_NAME = 'T_O_EVENT_LOG';\nSELECT TABLE_NAME, CONSTRAINT_NAME, CONSTRAINT_TYPE\n  FROM DBA_CONSTRAINTS\n WHERE TABLE_NAME = 'T_O_EVENT_LOG';\n\nSELECT * FROM USER_INDEXES WHERE TABLE_NAME = 'T_O_EVENT_LOG';\nSELECT * FROM ALL_INDEXES WHERE TABLE_NAME = 'TEMP_TOSIN_EVENT_LOG';\n")])])]),a("h3",{attrs:{id:"删除-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除-4"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DROP INDEX TTEL_EVENT_TIME;\n")])])]),a("h3",{attrs:{id:"字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字段"}},[t._v("#")]),t._v(" 字段")]),t._v(" "),a("h4",{attrs:{id:"默认值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认值"}},[t._v("#")]),t._v(" 默认值")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('ALTER TABLE "kpi_interview" MODIFY "interview_at" CHAR(10) DEFAULT NULL;\n')])])]),a("h4",{attrs:{id:"可为空-非空切换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可为空-非空切换"}},[t._v("#")]),t._v(" 可为空/非空切换")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-- 将字段修改为非空 重复执行 SQL 错误 [1442] [72000]: ORA-01442: 要修改为 NOT NULL 的列已经是 NOT NULL\nALTER TABLE \"kpi_interview\" MODIFY \"interview_at\" CHAR(10) NOT NULL;\n-- 将字段修改为可为空 重复执行 SQL 错误 [1451] [72000]: ORA-01451: 要修改为 NULL 的列无法修改为 NULL\nALTER TABLE \"kpi_interview\" MODIFY \"interview_at\" CHAR(10) NULL;\n-- 不会修改 非空/可为空状态\nALTER TABLE \"kpi_interview\" MODIFY \"interview_at\" CHAR(10);\n\n-- 注意：查询结果中，字段非空是 ‘N’，可为空是 ‘Y’\nSELECT \n  a.TABLE_NAME 表名, \n  a.COLUMN_NAME 列名, \n  a.DATA_TYPE 数据类型, \n  a.DATA_LENGTH 长度, \n--  a.NULLABLE 非空, \n  (CASE WHEN a.NULLABLE = 'N' THEN '非空' ELSE '可为空' END) 非空,\n  a.DATA_DEFAULT, \n  b.COMMENTS 注释\nFROM user_tab_columns a\nLEFT JOIN user_col_comments b ON a.TABLE_NAME = b.TABLE_NAME AND a.COLUMN_NAME = b.COLUMN_NAME\nWHERE a.TABLE_NAME = 'kpi_interview' AND a.COLUMN_NAME='interview_at'\nORDER BY a.COLUMN_ID\n\nSELECT \n  a.OWNER 模式,\n  a.TABLE_NAME 表名, \n  a.COLUMN_NAME 列名, \n  a.DATA_TYPE 数据类型, \n  a.DATA_LENGTH 长度, \n--  a.NULLABLE 非空, \n  (CASE WHEN a.NULLABLE = 'N' THEN '非空' ELSE '可为空' END) 非空,  \n  a.DATA_DEFAULT,  \n  a.DATA_DEFAULT, \n  b.COMMENTS 注释\nFROM all_tab_columns a\nLEFT JOIN all_col_comments b ON a.OWNER = b.OWNER AND a.TABLE_NAME = b.TABLE_NAME AND a.COLUMN_NAME = b.COLUMN_NAME\nWHERE a.OWNER = 'TXJ' AND a.TABLE_NAME = 'kpi_interview' AND a.COLUMN_NAME='interview_at'\nORDER BY a.TABLE_NAME, a.COLUMN_ID\n")])])]),a("h4",{attrs:{id:"数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据类型"}},[t._v("#")]),t._v(" 数据类型")]),t._v(" "),a("h5",{attrs:{id:"date和timestamp区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#date和timestamp区别"}},[t._v("#")]),t._v(" DATE和TIMESTAMP区别")]),t._v(" "),a("h6",{attrs:{id:"date"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#date"}},[t._v("#")]),t._v(" DATE")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--系统日期和时间\nSELECT sysdate FROM DUAL;\n--DATE->CHAR\nSELECT TO_CHAR(sysdate,'yyyy-mm-dd hh24:mi:ss') FROM DUAL;\n--DATE->TIMESTAMP\nselect TO_TIMESTAMP(TO_CHAR(sysdate,'yyyy-mm-dd hh24:mi:ss'),'yyyy-mm-dd hh24:mi:ss') from dual;\n--DATE差值\nselect TO_DATE('2020-08-10 09:48:28','yyyy-mm-dd hh24:mi:ss')-sysdate from dual;\n")])])]),a("h6",{attrs:{id:"timestamp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timestamp"}},[t._v("#")]),t._v(" TIMESTAMP")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--系统日期和时间\nSELECT systimestamp FROM DUAL;\n--TIMESTAMP->CHAR\nSELECT TO_CHAR(systimestamp,'yyyy-mm-dd hh24:mi:ss') FROM DUAL;\n--TIMESTAMP->DATE\nselect to_date(TO_CHAR(systimestamp,'yyyy-mm-dd hh24:mi:ss'),'yyyy-mm-dd hh24:mi:ss') from dual;\n--TIMESTAMP差值\nselect TO_TIMESTAMP('2020-08-10 09:48:28','yyyy-mm-dd hh24:mi:ss')-systimestamp from dual;\n")])])]),a("ul",[a("li",[t._v("显示乱码，尚未解决")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--systimestamp 显示乱码\n--查询数据库服务器端字符集编码 SIMPLIFIED CHINESE_CHINA.AL32UTF8\nselect userenv('language') from dual;\n\n--环境变量\nNLS_LANG SIMPLIFIED CHINESE_CHINA.AL32UTF8\nNLS_TIMESTAMP_FORMAT YYYY-MM-DD HH24:MI:SS:FF6\n")])])]),a("h2",{attrs:{id:"分区表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分区表"}},[t._v("#")]),t._v(" 分区表")]),t._v(" "),a("h3",{attrs:{id:"查询指定表下面的所有分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询指定表下面的所有分区"}},[t._v("#")]),t._v(" 查询指定表下面的所有分区")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" USER_SEGMENTS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" SEGMENT_TYPE"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TABLE PARTITION'")]),t._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("AND")]),t._v(" SEGMENT_NAME"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'TEMP_TOSIN_EVENT_LOG'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"删除分区表分区数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除分区表分区数据"}},[t._v("#")]),t._v(" 删除分区表分区数据")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--全删除")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" tableName "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DROP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PARTITION")]),t._v(" partionName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--清数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" tableName "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TRUNCATE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PARTITION")]),t._v(" partionName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n")])])]),a("h3",{attrs:{id:"查询指定分区的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询指定分区的数据"}},[t._v("#")]),t._v(" 查询指定分区的数据")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT * FROM TEMP_TOSIN_EVENT_LOG PARTITION(PAR20151101);\n")])])]),a("h3",{attrs:{id:"创建表同时创建分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建表同时创建分区"}},[t._v("#")]),t._v(" 创建表同时创建分区")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE TABLE TEMP_TOSIN_EVENT_LOG\nPARTITION BY RANGE(EVENT_TIME)(\n\tPARTITION PAR20150701 VALUES LESS THAN (TO_DATE('2015-07-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')),\n\tPARTITION PAR20150801 VALUES LESS THAN (TO_DATE('2015-08-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')),\n\tPARTITION PAR20150901 VALUES LESS THAN (TO_DATE('2015-09-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')),\n\tPARTITION PARMAX VALUES LESS THAN (MAXVALUE)\n) AS SELECT * FROM TEMP_EVENT_LOG;\n")])])]),a("h3",{attrs:{id:"修改表分区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改表分区"}},[t._v("#")]),t._v(" 修改表分区")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--ORA-14080: partition cannot be split along the specified high bound 上限\n--ORA-14012: resulting partition name conflicts with that of an existing partition 分区名存在\nALTER TABLE TEMP_TOSIN_EVENT_LOG SPLIT PARTITION PARMAX AT (TO_DATE('2015-12-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')) INTO (PARTITION PAR20151201, PARTITION PARMAX) UPDATE GLOBAL INDEXES;\n")])])]),a("h3",{attrs:{id:"相关问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关问题"}},[t._v("#")]),t._v(" 相关问题")]),t._v(" "),a("h4",{attrs:{id:"ora-14400-inserted-partition-key-does-not-map-to-any-partition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ora-14400-inserted-partition-key-does-not-map-to-any-partition"}},[t._v("#")]),t._v(" ORA-14400: inserted partition key does not map to any partition")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/lc547913923/article/details/78730823",target:"_blank",rel:"noopener noreferrer"}},[t._v("ORA-14400: 插入的分区关键字未映射到任何分区"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--1.确定该表是否已经添加了表分区\nselect partition_name,high_value from user_tab_partitions t where table_name='T_O_DEV_STATICS';\n--2.查询表分区绑定的字段名称\nselect * from user_part_key_columns t where name='T_O_DEV_STATICS';\n--3.查看当前表分区的具体情况\nselect * from user_tab_partitions t where table_name='T_O_DEV_STATICS';\n--SELECT * FROM USER_SEGMENTS WHERE  1=1  AND SEGMENT_TYPE='TABLE PARTITION' AND SEGMENT_NAME='T_O_DEV_STATICS';\n--4.查询表分区绑定的字段的最大值。注：此处的table_name应为当前表对应的原始库中的源表。\nselect max(CLCT_DATE) from T_O_DEV_STATICS t;\n--5.将查询到的表分区绑定字段的最大值插入到当前表中进行测试，发现报错。\ninsert into T_O_DEV_STATICS(id, terminal_id, CLCT_DATE, OVER_SPEED_NUM_1, OVER_SPEED_NUM_2,\t OVER_SPEED_NUM_3, OVER_SPEED_NUM_4,  OVER_SPEED_NUM_5, OVER_SPEED_NUM_6, OVER_SPEED_NUM_7, SPEED_UP_NUM, SPEED_DOWN_NUM, OVER_IDLE_NUM,  OUT_GREEN_ZONE_NUM, FATIGUE_NUM, COASTING_NUM, MILEAGE) values (SEQ_T_O_DEV_STATICS.nextval, '1805020686',20200101,0,0,0,1,2,0,0,0,0,1921,11127,0,0,281.2000122070313);\n--6.经过以上环节确定源表中出现错误数据，并且由于错误数据的时间跨度大于当前分区的范围，导致ORA-14400错误的出现，但是由于该数据必须保留，因此对表分区进行扩展。\n\n--7.扩展当前表分区以保证范围大于绑定字段的最大值。\nalter table T_O_EVENT_LOG add  partition T_EVENT_202001 values less than (TO_DATE(' 2020-02-01 00:00:00', 'SYYYY-MM-DD HH24:MI:SS', 'NLS_CALENDAR=GREGORIAN'))\n    tablespace TBS_EVENT_PART\n    pctfree 10\n    initrans 1\n    maxtrans 255\n    storage\n    (\n      initial 5024K\n      next 1M\n      minextents 1\n      maxextents unlimited\n    );\nalter table T_O_RUN_CHART split partition PMAXVALUE at(20200101) into (partition P202001, partition PMAXVALUE);\n\n--8.结束。再次使用kettle进行抽取时顺利抽取。\n")])])]),a("h2",{attrs:{id:"存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储过程"}},[t._v("#")]),t._v(" 存储过程")]),t._v(" "),a("h3",{attrs:{id:"创建-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-4"}},[t._v("#")]),t._v(" 创建")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("CREATE OR REPLACE\nPROCEDURE TOSINCREATEPARTITION\nAS\n\tdt varchar2(200);\n\tsumNumber number;\n\ttoDate date;\n\tpartitionName varchar(50);\n\tcreateSqlText varchar(300);\nBEGIN\n\t--定义游标\n\tDECLARE CURSOR myCursor IS SELECT TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm') DT, COUNT(1) FROM TEMP_TOSIN_EVENT_LOG TEL GROUP BY TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm') ORDER BY TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm');\n\tBEGIN\n\t\tOPEN myCursor;\n\t\tLOOP\n\t\t\tFETCH myCursor INTO dt, sumNumber;\n\t\t\tEXIT WHEN myCursor%NOTFOUND;\n\t\t\tif(dt is not null)\n\t\t\tthen\n\t\t\t\ttoDate:=TO_DATE(dt, 'yyyy-mm');\n\t\t\t\ttoDate:=ADD_MONTHS(toDate, 1);\n\t\t\t\tif(toDate > TO_DATE('2015-12-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss') and \n\t\t\t\t\ttoDate < TO_DATE('2018-01-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss'))\n\t\t\t\tthen\n\t\t\t\t\tpartitionName:=TO_CHAR(toDate, 'yyyymmdd');\n\t\t\t\t\tcreateSqlText:='ALTER TABLE TEMP_TOSIN_EVENT_LOG SPLIT PARTITION PARMAX AT (TO_DATE('''||TO_CHAR(toDate, 'yyyy-mm-dd hh24:mi:ss')||''', ''yyyy-mm-dd hh24:mi:ss'')) INTO (PARTITION PAR'||partitionName||', PARTITION PARMAX) UPDATE GLOBAL INDEXES';\n\t\t\t\t\tDBMS_OUTPUT.put_line (createSqlText);\n\t\t\t\t\texecute immediate createSqlText;\n\t\t\t\tend if;\n\n\t\t\tend if;\n\t\tEND LOOP;\n\t\tCLOSE myCursor;\n\tEND;\nEND TOSINCREATEPARTITION;\n")])])]),a("h3",{attrs:{id:"查看-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-3"}},[t._v("#")]),t._v(" 查看")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT *\n    FROM user_source\n   WHERE NAME = upper('TosinCreatePartition')\nORDER BY line;\n--其中Procedure Name为存储过程名字，需要全部用大写英文。\n")])])]),a("h3",{attrs:{id:"执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行"}},[t._v("#")]),t._v(" 执行")]),t._v(" "),a("ul",[a("li",[t._v("Navicat ->DB->登录名->Functions->存储过程->Execute Function")])]),t._v(" "),a("h3",{attrs:{id:"删除-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除-5"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DROP PROCEDURE TOSINCREATEPARTITION;\n")])])]),a("h3",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),a("ul",[a("li",[t._v("截图：PL/SQL->Procedures->存储过程->Test")])]),t._v(" "),a("h3",{attrs:{id:"异常日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常日志"}},[t._v("#")]),t._v(" 异常日志")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--记录存储过程异常日志\ncreate table DEBUG_PROC_SYS_LOG\n(\n    S_TIME            VARCHAR2(32) not null,\n    S_LEVEL            VARCHAR2(32),\n    S_PROCNAME        VARCHAR2(64),\n    S_MSG            VARCHAR2(4000),\n    S_ADVICE        VARCHAR2(1024)\n);\n-- Add comments to the table \ncomment on table DEBUG_PROC_SYS_LOG\n  is '存储过程日志表';\n-- Add comments to the columns \ncomment on column DEBUG_PROC_SYS_LOG.S_TIME\n  is '操作时间';\n-- Add comments to the columns \ncomment on column DEBUG_PROC_SYS_LOG.S_LEVEL\n  is '操作级别';\n-- Add comments to the columns \ncomment on column DEBUG_PROC_SYS_LOG.S_PROCNAME\n  is '执行存储过程名称';\n-- Add comments to the columns \ncomment on column DEBUG_PROC_SYS_LOG.S_MSG\n  is '错误信息';\n-- Add comments to the columns \ncomment on column DEBUG_PROC_SYS_LOG.S_ADVICE\n  is '建议信息';\n\nalter table DEBUG_PROC_SYS_LOG add DEFAULTTIME date default sysdate;\n\nSELECT * FROM DEBUG_PROC_SYS_LOG ORDER BY S_TIME DESC;\n\n\ncreate or replace procedure TEST_UpdateSMSState(AState number, ATerminalID varchar2, ASeqID number) is\n  nCount number;\n  lcount number;\n  -- 操作时间\n  str_time   varchar2(32);\n  -- 操作级别\n  str_level  varchar2(32);\n  -- 执行存储过程名称\n  p_procname varchar2(1024);\n  -- 错误信息，或者记录信息\n  p_msg      varchar2(1024);\n  -- 建议信息\n  p_advice   varchar2(1024);  \n  \n  errorException exception; --申明异常\n  errorCode number; --异常代号\n  errorMsg varchar2(1000); --异常信息  \nbegin\n  p_procname := 'TEST_UpdateSMSState';\n  str_time := to_char(SYSDATE, 'yyyy-mm-dd hh24:mi:ss');\n  INSERT INTO DEBUG_PROC_SYS_LOG (s_time, s_procname, s_msg) VALUES (str_time, p_procname, ATerminalID || '-SEQID-' || ASeqID || '-STATE-' || AState);\n  SELECT (AState/ASeqID) into nCount FROM DUAL;\n  INSERT INTO DEBUG_PROC_SYS_LOG (s_time, s_procname, s_msg) VALUES (str_time, p_procname, 'SELECT T_B_Message_Month'||'-NCOUNT-' || nCount);\n\n  exception\n    when errorException then\n      errorCode := SQLCODE;\n      errorMsg := SUBSTR(SQLERRM, 1, 200);\t\n      INSERT INTO DEBUG_PROC_SYS_LOG (s_time, s_procname, s_msg) VALUES (str_time, p_procname, errorCode||'+'||errorMsg);\n    when others then\n      errorCode := SQLCODE;\n      errorMsg := SUBSTR(SQLERRM, 1, 200);\t\n      INSERT INTO DEBUG_PROC_SYS_LOG (s_time, s_procname, s_msg) VALUES (str_time, p_procname, errorCode||'+'||errorMsg);\nend TEST_UpdateSMSState;   \n")])])]),a("h2",{attrs:{id:"函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[t._v("#")]),t._v(" 函数")]),t._v(" "),a("h3",{attrs:{id:"内置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内置"}},[t._v("#")]),t._v(" 内置")]),t._v(" "),a("h4",{attrs:{id:"price-revision-truck"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#price-revision-truck"}},[t._v("#")]),t._v(" price_revision_truck")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/Huay_Li/article/details/82914161",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oracle 行转列 pivot函数基本用法"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('SELECT * FROM\n\t(\n\tSELECT\n\t\tT3."work_number" "wn",\n\t\tT3."property_value",\n\t\tT2."name"\n\tFROM\n\t\t"profile_property" t2\n\tINNER JOIN "profile_property_value" t3 ON\n\t\tT2."id" = T3."property_id") pivot (max("property_value") FOR "name" IN (\'入党转正时间\' "入党转正时间", \'入党预备时间\' "入党预备时间", \'入学时间\' "入学时间", \'入职日期\' "入职日期", \'出生时间\' "出生时间", \'劳动合同编号\' "劳动合同编号", \'合同到期日一\' "合同到期日一", \'合同到期日二\' "合同到期日二", \'合同起始日一\' "合同起始日一", \'合同起始日二\' "合同起始日二", \'婚否\' "婚否", \'学位\' "学位", \'学历\' "学历", \'孩子姓名一\' "孩子姓名一", \'孩子姓名三\' "孩子姓名三", \'孩子姓名二\' "孩子姓名二", \'孩子性别一\' "孩子性别一", \'孩子性别三\' "孩子性别三", \'孩子性别二\' "孩子性别二", \'孩子身份证号一\' "孩子身份证号一", \'孩子身份证号三\' "孩子身份证号三", \'孩子身份证号二\' "孩子身份证号二", \'工作单位\' "工作单位", \'工作地点\' "工作地点", \'工作所在地\' "工作所在地", \'工龄\' "工龄", \'年龄\' "年龄", \'应急电话\' "应急电话", \'开始上班时间\' "开始上班时间", \'性别\' "性别", \'户口性质\' "户口性质", \'户口所在地\' "户口所在地", \'所学专业\' "所学专业", \'政治面貌\' "政治面貌", \'是否签订一\' "是否签订一", \'是否签订二\' "是否签订二", \'是否转正\' "是否转正", \'本人联系电话\' "本人联系电话", \'本企业工龄\' "本企业工龄", \'毕业时间\' "毕业时间", \'毕业院校\' "毕业院校", \'民族\' "民族", \'现居住地址\' "现居住地址", \'用工性质\' "用工性质", \'直属上级\' "直属上级", \'社保类型\' "社保类型", \'社保缴纳地\' "社保缴纳地", \'籍贯\' "籍贯", \'紧急联系人\' "紧急联系人", \'职务\' "职务", \'职称/资格\' "职称/资格", \'试用期到期日\' "试用期到期日", \'身份证号码\' "身份证号码", \'配偶姓名\' "配偶姓名", \'配偶身份证号\' "配偶身份证号", \'集团细分岗位类别\' "集团细分岗位类别") )\n')])])]),a("h4",{attrs:{id:"nvl-nvl2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nvl-nvl2"}},[t._v("#")]),t._v(" NVL NVL2")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/hyang0/p/10633820.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("oracle nvl2函数"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select nvl2(1, sysdate-(sysdate-1/24/60), sysdate), nvl2(null,sysdate-(sysdate-1/24/60), sysdate) from dual;\nselect nvl('1', 'A'), nvl(null, sysdate) from dual;\n")])])]),a("h3",{attrs:{id:"自定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义"}},[t._v("#")]),t._v(" 自定义")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--1 Row 类型\nCREATE OR REPLACE TYPE ty_row_str_split as object (strValue VARCHAR2 (4000));\n--2 Table 类型\nCREATE OR REPLACE TYPE ty_tbl_str_split IS TABLE OF ty_row_str_split;\n--3 创建函数\n------------------------------\n--  拆分字符串函数  --\n------------------------------\n--p_str 目标字符串\n--p_delimiter 分隔符\n--返回以一个一维数组\nCREATE OR REPLACE FUNCTION fn_split(p_str       IN VARCHAR2,\n                                    p_delimiter IN VARCHAR2)\n  RETURN ty_tbl_str_split IS\n  j         INT := 0;\n  i         INT := 1;\n  len       INT := 0;\n  len1      INT := 0;\n  str       VARCHAR2(4000);\n  str_split ty_tbl_str_split := ty_tbl_str_split();\nBEGIN\n  len  := LENGTH(p_str);\n  len1 := LENGTH(p_delimiter);\n\n  WHILE j < len LOOP\n    j := INSTR(p_str, p_delimiter, i);\n  \n    IF j = 0 THEN\n      j   := len;\n      str := SUBSTR(p_str, i);\n      str_split.EXTEND;\n      str_split(str_split.COUNT) := ty_row_str_split(strValue => str);\n    \n      IF i >= len THEN\n        EXIT;\n      END IF;\n    ELSE\n      str := SUBSTR(p_str, i, j - i);\n      i   := j + len1;\n      str_split.EXTEND;\n      str_split(str_split.COUNT) := ty_row_str_split(strValue => str);\n    END IF;\n  END LOOP;\n\n  RETURN str_split;\nEND fn_split;\n--测试\nselect to_char(strvalue) as Value from table(fn_split('aa,bb,cc',','));\n\n------------------------------\n--  解析JSON字符串  --\n------------------------------\n--p_jsonstr json字符串\n--p_key 键\n--返回p_key对应的值\nCREATE OR REPLACE FUNCTION fn_parsejson(p_jsonstr varchar2, p_key varchar2)\n  RETURN VARCHAR2 IS\n  rtnVal    VARCHAR2(50);\n  i         NUMBER(2);\n  jsonkey   VARCHAR2(50);\n  jsonvalue VARCHAR2(50);\n  JSON      VARCHAR2(1000);\nBEGIN\n  IF p_jsonstr IS NOT NULL THEN\n    JSON := REPLACE(p_jsonstr, '{', '');\n    JSON := REPLACE(JSON, '}', '');\n    JSON := REPLACE(JSON, '\"', '');\n    FOR temprow IN (SELECT strvalue AS VALUE FROM TABLE(fn_split(JSON, ','))) LOOP\n      IF temprow.VALUE IS NOT NULL THEN\n        i         := 0;\n        jsonkey   := '';\n        jsonvalue := '';\n        FOR tem2 IN (SELECT strvalue AS VALUE\n                       FROM TABLE(fn_split(temprow.value, ':'))) LOOP\n          IF i = 0 THEN\n            jsonkey := tem2.VALUE;\n          END IF;\n          IF i = 1 THEN\n            jsonvalue := tem2.VALUE;\n          END IF;\n        \n          i := i + 1;\n        END LOOP;\n      \n        IF (jsonkey = p_key) THEN\n          rtnVal := jsonvalue;\n        END IF;\n      END IF;\n    END LOOP;\n  END IF;\n\n  RETURN rtnVal;\nEND fn_parsejson;\n\nSELECT fn_parsejson('{\"carVin\":\"12345678\",\"simNo\": \"18710461528\", \"carColor\": 1, \"lockStateEx\": 1}','simNo') FROM DUAL;\n\n\n")])])]),a("h2",{attrs:{id:"序列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#序列"}},[t._v("#")]),t._v(" 序列")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("DROP SEQUENCE SEQ_TOSIN_SYNCHRONIZE;\n\nCREATE SEQUENCE SEQ_TOSIN_SYNCHRONIZE\nMINVALUE 1\nMAXVALUE 999999999999999999999999\nSTART WITH 1\nINCREMENT BY 1\nNOCACHE;\n\nSELECT SEQ_TOSIN_SYNCHRONIZE.NEXTVAL FROM DUAL;\n--修改这个序列的increment，然后做一次select，然后再把increment 修改回来：\nalter sequence SEQ_TOSIN_SYNCHRONIZE increment by 10000;\nSELECT SEQ_TOSIN_SYNCHRONIZE.NEXTVAL FROM DUAL;\nalter sequence SEQ_TOSIN_SYNCHRONIZE increment by 1;\n\n--ora-080200 先执行 SELECT SEQ_T_B_COMPANY.nextval FROM DUAL;\nSELECT SEQ_T_B_COMPANY.currval FROM DUAL;\nSELECT SEQ_T_B_COMPANY.nextval FROM DUAL;\n")])])]),a("h2",{attrs:{id:"触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#触发器"}},[t._v("#")]),t._v(" 触发器")]),t._v(" "),a("h3",{attrs:{id:"查询-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询-2"}},[t._v("#")]),t._v(" 查询")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select * from all_triggers WHERE table_name = 'TASK_INFORMATION_III';\n")])])]),a("h3",{attrs:{id:"主键自增"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主键自增"}},[t._v("#")]),t._v(" 主键自增")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/jjkang_/article/details/81538073",target:"_blank",rel:"noopener noreferrer"}},[t._v("oracle触发器实现主键自增"),a("OutboundLink")],1)])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("create table test_pk_autoincrement_table(id int primary key,age int,name varchar2(32));\n\nCREATE SEQUENCE test_seq_pk_ai_table\nMINVALUE 1\nSTART WITH 1\nINCREMENT BY 1\nNOCACHE;\n\ncreate trigger test_trg_pk_ai_table before insert on test_pk_autoincrement_table for each row\nbegin\n    select test_seq_pk_ai_table.nextval into :new.id from dual;\nend;\n\ninsert into test_pk_autoincrement_table(age, name) values(21,'name1');\n\nselect * from test_pk_autoincrement_table;\n")])])]),a("h3",{attrs:{id:"数据表同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据表同步"}},[t._v("#")]),t._v(" 数据表同步")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--建表\nDROP TABLE Tosin_Synchronize_Info;\nDROP TABLE Tosin_Synchronize_Info_1;\n\nCREATE TABLE Tosin_Synchronize_Info (\n  ID         INTEGER     primary key,\n  UserName   VARCHAR(30),\n  PassWord   VARCHAR(20),\n  CreateDate DATE,\n  Status     INTEGER\n);\n--           备份数据\nCREATE TABLE TOSIN_SYNCHRONIZE_INFO_1 AS SELECT * FROM TOSIN_SYNCHRONIZE_INFO;\n\n--创建触发器\ncreate or replace trigger TOSIN_SYNCHRONIZE_TG after insert or update or delete\non TOSIN_SYNCHRONIZE_INFO for each row\ndeclare\n    integrity_error exception;\n    errno            integer;\n    errmsg           char(200);\n    dummy            integer;\n    found            boolean;\n    \nbegin\nif inserting then\n    insert into TOSIN_SYNCHRONIZE_INFO_1(ID,UserName,PassWord,CreateDate,Status) values(:NEW.ID,:NEW.UserName,:NEW.PassWord,:new.CreateDate,:NEW.Status);\nelsif updating then \n    update TOSIN_SYNCHRONIZE_INFO_1 set ID=:NEW.ID,UserName=:NEW.UserName,PassWord=:NEW.PassWord,Status=:NEW.Status where id=:OLD.id;    \nelsif deleting then\n    delete from TOSIN_SYNCHRONIZE_INFO_1 where id=:OLD.id;\nend if;\nexception\n    when integrity_error then\n       raise_application_error(errno, errmsg);\nend;\n\n--测试\ninsert into Tosin_Synchronize_Info(ID,UserName,PassWord,CreateDate,Status)values(1,'xier','222',to_date('2008-10-11','yyyy-mm-dd'),1);\nupdate Tosin_Synchronize_Info u set u.status=3,u.username='xier' where u.id=1;\ndelete from Tosin_Synchronize_Info u where u.id=1;\n\nSELECT * FROM TOSIN_SYNCHRONIZE_INFO;\nSELECT * FROM TOSIN_SYNCHRONIZE_INFO_1;\n")])])]),a("ul",[a("li",[t._v("Test Window")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-- Created on 2019/3/7 by TOSINJIA \ndeclare \n  -- Local variables here\n  i integer;\nbegin\n  -- Test statements here\n  update Tosin_Synchronize_Info u set u.status=3,u.username='xier' where u.id=1;\n  COMMIT;\nend;\n")])])]),a("h2",{attrs:{id:"问题汇总"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题汇总"}},[t._v("#")]),t._v(" 问题汇总")]),t._v(" "),a("h3",{attrs:{id:"超时-分布式事务处理等待锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#超时-分布式事务处理等待锁"}},[t._v("#")]),t._v(" 超时: 分布式事务处理等待锁")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("### Error updating database.  Cause: java.sql.SQLException: ORA-02049: 超时: 分布式事务处理等待锁\n\n### The error may exist in URL [jar:file:/D:/txjis-services/datadocking/txjis-datadocking-1.0.1-SNAPSHOT.jar!/BOOT-INF/classes!/mapper/mapper3/VehicleMapper.xml]\n### The error may involve com.txj.xtzc.txjisdatadocking.db.db3.dao.ITxjisVehicleMapper.mergeVehicle-Inline\n### The error occurred while setting parameters\n### SQL: MERGE INTO t_vehicle v USING(                         SELECT               ?  VEHICLE_NUM,               ?  VIN,              null CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,              null DATA_NUMBER,               ?  SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,              null CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,               ?  SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,               ?  CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,              null SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,               ?  CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,              null SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,              null CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,               ?  SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,              null CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,               ?  SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,               ?  CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,              null SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,               ?  CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,              null SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,              null CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,               ?  SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,              null CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,               ?  DATA_NUMBER,               ?  SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL          UNION ALL              SELECT               ?  VEHICLE_NUM,               ?  VIN,              null CLASS_CODE,              null MODEL_POWER,              null ENGINE_NO,              null  ENGINE_TYPE,              null HAS_ENGINE_CERT,              null BULLETIN_MODEL_CODE,              null  DESIGIN_MODEL_CODE,              null PRODUCT_SERIES,              null  MODEL_CODE,              null DATA_NUMBER,               ?  SHIPPING_STATUS,              null BELONG_CLASS,              null AGENCY_ID             FROM DUAL                    ) TMP         ON(TMP.VEHICLE_NUM = v.VEHICLE_NUM)         WHEN MATCHED THEN         UPDATE          SET v.vin =NVL(tmp.vin,v.vin),                     v.CLASS_CODE = NVL(tmp.CLASS_CODE,v.CLASS_CODE),                     v.MODEL_POWER = NVL(tmp.MODEL_POWER,v.MODEL_POWER),                     v.ENGINE_TYPE = NVL(tmp.ENGINE_TYPE,v.ENGINE_TYPE),                     v.ENGINE_NO = NVL(tmp.ENGINE_NO,v.ENGINE_NO),                     v.HAS_ENGINE_CERT = NVL(tmp.HAS_ENGINE_CERT,v.HAS_ENGINE_CERT),                     v.BULLETIN_MODEL_CODE = NVL(tmp.BULLETIN_MODEL_CODE,v.BULLETIN_MODEL_CODE),                     v.DESIGIN_MODEL_CODE = NVL(tmp.DESIGIN_MODEL_CODE,v.DESIGIN_MODEL_CODE),                     v.PRODUCT_SERIES = NVL(tmp.PRODUCT_SERIES,v.PRODUCT_SERIES),                     v.MODEL_CODE = NVL(tmp.MODEL_CODE,v.MODEL_CODE),                     v.DATA_NUMBER = NVL(tmp.DATA_NUMBER,v.DATA_NUMBER),                     v.SHIPPING_STATUS = NVL(tmp.SHIPPING_STATUS,v.SHIPPING_STATUS) ,                     v.BELONG_CLASS = NVL(tmp.BELONG_CLASS,v.BELONG_CLASS) ,                     v.AGENCY_ID = NVL(tmp.AGENCY_ID,v.AGENCY_ID),                     v.LAST_CHANGE_TIME = sysdate          WHEN NOT MATCHED THEN         INSERT          ( id,             vehicle_num,             vin,             class_code,             model_power,             engine_type,             engine_no,             has_engine_cert,             bulletin_model_code,             desigin_model_code,             product_series,             model_code,             data_number,             shipping_status,             platform_type,             BELONG_CLASS,             AGENCY_ID,             create_time,             last_change_time )           VALUES( seq_t_vehicle.nextval,             tmp.VEHICLE_NUM,             tmp.VIN,             tmp.CLASS_CODE ,             tmp.MODEL_POWER ,             tmp.ENGINE_TYPE,             tmp.ENGINE_NO  ,             tmp.HAS_ENGINE_CERT ,             tmp.BULLETIN_MODEL_CODE ,             tmp.DESIGIN_MODEL_CODE,             tmp.PRODUCT_SERIES ,             tmp.MODEL_CODE,             tmp.DATA_NUMBER,             tmp.SHIPPING_STATUS,             1,             tmp.BELONG_CLASS,             tmp.AGENCY_ID,             sysdate,             sysdate )\n### Cause: java.sql.SQLException: ORA-02049: 超时: 分布式事务处理等待锁\n\n; bad SQL grammar []; nested exception is java.sql.SQLException: ORA-02049: 超时: 分布式事务处理等待锁\n")])])]),a("h3",{attrs:{id:"_1-ora-12547-tns-lost-contact"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ora-12547-tns-lost-contact"}},[t._v("#")]),t._v(" 1. ORA-12547:TNS:lost contact")]),t._v(" "),a("ol",[a("li",[t._v("D:\\oracle11\\app\\Administrator\\product\\11.2.0\\dbhome_1\\NETWORK\\ADMIN\\listener.ora")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("      (ADDRESS = (PROTOCOL = TCP)(HOST = HangZhouDiBiao)(PORT = 1521))\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("\\app\\Administrator\\diag\\tnslsnr\\CheDaiDb-P\\listener\\trace\\listener.log 超过4个G")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-- 转义字符\nSelect 'test' || '''' from dual;\nSelect 'test ''' from dual;\n\nSELECT * FROM T_O_EVENT_LOG;\nSELECT COUNT(*) FROM T_O_EVENT_LOG;\n\nCREATE TABLE TEMP_EVENT_LOG AS SELECT * FROM T_O_EVENT_LOG;\nSELECT COUNT(*) FROM TEMP_EVENT_LOG;\n\n\n--模拟元数据表\nCREATE TABLE TEMP_TOSIN_EVENT_LOG AS SELECT * FROM T_O_EVENT_LOG;\n--数据备份到临时表\nCREATE TABLE TEMP_EVENT_LOG AS SELECT * FROM TEMP_TOSIN_EVENT_LOG;\n--检查数据一致性\nSELECT COUNT(*) FROM TEMP_TOSIN_EVENT_LOG;\nSELECT COUNT(*) FROM TEMP_EVENT_LOG;\n\n--删除表\nTRUNCATE TABLE TEMP_TOSIN_EVENT_LOG;\n\t--删除表分区也会删除\nDROP TABLE TEMP_TOSIN_EVENT_LOG;\n\t--查询指定表下面的所有分区\nSELECT * FROM USER_SEGMENTS WHERE \n\t1=1 \n\tAND SEGMENT_TYPE='TABLE PARTITION' \n\tAND SEGMENT_NAME='TEMP_TOSIN_EVENT_LOG';\n\t--分区表删除分区数据\n\t\t--全删除\n--ALTER TABLE tableName DROP PARTITION partionName;  \n\t\t--清数据\n--ALTER TABLE tableName TRUNCATE PARTITION partionName;  \n\n\t--查询指定分区的数据\nSELECT * FROM TEMP_TOSIN_EVENT_LOG PARTITION(PAR20151101);\t--34551\n\n--创建表同时创建分区\nCREATE TABLE TEMP_TOSIN_EVENT_LOG\nPARTITION BY RANGE(EVENT_TIME)(\n\tPARTITION PAR20150701 VALUES LESS THAN (TO_DATE('2015-07-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')),\n\tPARTITION PAR20150801 VALUES LESS THAN (TO_DATE('2015-08-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')),\n\tPARTITION PAR20150901 VALUES LESS THAN (TO_DATE('2015-09-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')),\n\tPARTITION PARMAX VALUES LESS THAN (MAXVALUE)\n) AS SELECT * FROM TEMP_EVENT_LOG;\n\nSELECT * FROM TEMP_TOSIN_EVENT_LOG WHERE EVENT_TIME = TO_DATE('2015-08-01 09:53:51', 'yyyy-mm-dd hh24:mi:ss');\n\n\nSELECT TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm') DT, COUNT(1) FROM TEMP_EVENT_LOG TEL GROUP BY TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm') ORDER BY TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm');\n\n--ORA-14080: partition cannot be split along the specified high bound 上限\n--ORA-14012: resulting partition name conflicts with that of an existing partition 分区名存在\nALTER TABLE TEMP_TOSIN_EVENT_LOG SPLIT PARTITION PARMAX AT (TO_DATE('2015-12-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss')) INTO (PARTITION PAR20151201, PARTITION PARMAX) UPDATE GLOBAL INDEXES;\n\n\n\n---ORA-01652: unable to extend temp segment by 8192 in tablespace USERS\n--CREATE TABLE TEMP_EVENT_LOG_BAK AS SELECT * FROM T_O_EVENT_LOG;\n--SELECT COUNT(1) FROM TEMP_EVENT_LOG_BAK;\n\n\n\n--创建\nCREATE OR REPLACE\nPROCEDURE TOSINCREATEPARTITION\nAS\n\tdt varchar2(200);\n\tsumNumber number;\n\ttoDate date;\n\tpartitionName varchar(50);\n\tcreateSqlText varchar(300);\nBEGIN\n\t--定义游标\n\tDECLARE CURSOR myCursor IS SELECT TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm') DT, COUNT(1) FROM TEMP_TOSIN_EVENT_LOG TEL GROUP BY TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm') ORDER BY TO_CHAR(TEL.EVENT_TIME, 'yyyy-mm');\n\tBEGIN\n\t\tOPEN myCursor;\n\t\tLOOP\n\t\t\tFETCH myCursor INTO dt, sumNumber;\n\t\t\tEXIT WHEN myCursor%NOTFOUND;\n\t\t\tif(dt is not null)\n\t\t\tthen\n\t\t\t\ttoDate:=TO_DATE(dt, 'yyyy-mm');\n\t\t\t\ttoDate:=ADD_MONTHS(toDate, 1);\n\t\t\t\tif(toDate > TO_DATE('2015-12-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss') and \n\t\t\t\t\ttoDate < TO_DATE('2018-01-01 00:00:00', 'yyyy-mm-dd hh24:mi:ss'))\n\t\t\t\tthen\n\t\t\t\t\tpartitionName:=TO_CHAR(toDate, 'yyyymmdd');\n\t\t\t\t\tcreateSqlText:='ALTER TABLE TEMP_TOSIN_EVENT_LOG SPLIT PARTITION PARMAX AT (TO_DATE('''||TO_CHAR(toDate, 'yyyy-mm-dd hh24:mi:ss')||''', ''yyyy-mm-dd hh24:mi:ss'')) INTO (PARTITION PAR'||partitionName||', PARTITION PARMAX) UPDATE GLOBAL INDEXES';\n\t\t\t\t\tDBMS_OUTPUT.put_line (createSqlText);\n\t\t\t\t\texecute immediate createSqlText;\n\t\t\t\tend if;\n\n\t\t\tend if;\n\t\tEND LOOP;\n\t\tCLOSE myCursor;\n\tEND;\nEND TOSINCREATEPARTITION;\n\n--查看存储过程\nSELECT *\n    FROM user_source\n   WHERE NAME = upper('TosinCreatePartition')\nORDER BY line;--其中Procedure Name为存储过程名字，需要全部用大写英文。\n\n--删除存储过程\nDROP PROCEDURE TOSINCREATEPARTITION;\n\n\n--效率测试\nSELECT * FROM TEMP_EVENT_LOG WHERE EVENT_TIME = TO_DATE('2015-07-28 09:37:47', 'yyyy-mm-dd hh24:mi:ss');\nSELECT * FROM TEMP_TOSIN_EVENT_LOG WHERE EVENT_TIME = TO_DATE('2015-07-28 09:37:47', 'yyyy-mm-dd hh24:mi:ss');\nSELECT * FROM TEMP_TOSIN_EVENT_LOG PARTITION(PAR20150801) WHERE EVENT_TIME = TO_DATE('2015-07-28 09:37:47', 'yyyy-mm-dd hh24:mi:ss');\n\n\t--\nSELECT COUNT(*) FROM TEMP_EVENT_LOG;\nSELECT COUNT(*) FROM TEMP_TOSIN_EVENT_LOG;\n\nSELECT * FROM TEMP_EVENT_LOG WHERE EVENT_TIME > TO_DATE('2015-07-02 09:37:47', 'yyyy-mm-dd hh24:mi:ss') AND EVENT_TIME < TO_DATE('2015-07-04 09:37:47', 'yyyy-mm-dd hh24:mi:ss');\nSELECT * FROM TEMP_TOSIN_EVENT_LOG WHERE EVENT_TIME > TO_DATE('2015-07-02 09:37:47', 'yyyy-mm-dd hh24:mi:ss') AND EVENT_TIME < TO_DATE('2015-07-04 09:37:47', 'yyyy-mm-dd hh24:mi:ss');\n\n\n\nSELECT COUNT(*) FROM T_O_EVENT_LOG WHERE EVENT_TIME > TO_DATE('2015-08-02 09:37:47', 'yyyy-mm-dd hh24:mi:ss') AND EVENT_TIME < TO_DATE('2015-08-04 09:37:47', 'yyyy-mm-dd hh24:mi:ss');\nSELECT COUNT(*) FROM TEMP_EVENT_LOG WHERE EVENT_TIME > TO_DATE('2015-08-02 09:37:47', 'yyyy-mm-dd hh24:mi:ss') AND EVENT_TIME < TO_DATE('2015-08-04 09:37:47', 'yyyy-mm-dd hh24:mi:ss');\nSELECT COUNT(*) FROM TEMP_TOSIN_EVENT_LOG WHERE EVENT_TIME > TO_DATE('2015-08-02 09:37:47', 'yyyy-mm-dd hh24:mi:ss') AND EVENT_TIME < TO_DATE('2015-08-04 09:37:47', 'yyyy-mm-dd hh24:mi:ss');  \nSELECT COUNT(*) FROM TEMP_TOSIN_EVENT_LOG PARTITION(PAR20150801) WHERE EVENT_TIME > TO_DATE('2015-08-02 09:37:47', 'yyyy-mm-dd hh24:mi:ss') AND EVENT_TIME < TO_DATE('2015-08-04 09:37:47', 'yyyy-mm-dd hh24:mi:ss');  \n\n\n--创建索引\ncreate index TEL_EVENT_TIME on TEMP_EVENT_LOG(EVENT_TIME);\nCREATE INDEX TTEL_EVENT_TIME ON TEMP_TOSIN_EVENT_LOG(EVENT_TIME);\n\n\n--查看索引\nSELECT TABLE_NAME, CONSTRAINT_NAME, CONSTRAINT_TYPE\n  FROM USER_CONSTRAINTS\n WHERE TABLE_NAME = 'T_O_EVENT_LOG';\nSELECT TABLE_NAME, CONSTRAINT_NAME, CONSTRAINT_TYPE\n  FROM DBA_CONSTRAINTS\n WHERE TABLE_NAME = 'T_O_EVENT_LOG';\n\nSELECT * FROM USER_INDEXES WHERE TABLE_NAME = 'T_O_EVENT_LOG';\nSELECT * FROM ALL_INDEXES WHERE TABLE_NAME = 'TEMP_TOSIN_EVENT_LOG';\n\nSELECT * FROM T_O_EVENT_LOG L WHERE 1=1 AND L.EVENT_TIME BETWEEN \nTO_DATE('2015-07-02 09:37:47', 'YYYY-MM-DD HH24:MI:SS') AND TO_DATE('2015-07-04 09:37:47', 'YYYY-MM-DD HH24:MI:SS')\n AND L.LNG !=-1 AND L.LAT !=-1\n\n\n\n")])])]),a("h2",{attrs:{id:"练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#练习"}},[t._v("#")]),t._v(" 练习")]),t._v(" "),a("h3",{attrs:{id:"创建表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建表"}},[t._v("#")]),t._v(" 创建表")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("--.71/innetdb HgMonitoring\n\n--网关数据库任务表修改\nALTER TABLE TASK_INFORMATION_III ADD API_TASK_ID VARCHAR2(30);\n--ALTER TABLE TASK_INFORMATION_III DROP COLUMN API_TASK_UPDATETIME;\nALTER TABLE TASK_INFORMATION_III ADD API_TASK_SENDTIME DATE;\nALTER TABLE TASK_INFORMATION_III ADD API_TASKSTATE_UPDATETIME\n\nCOMMENT ON COLUMN TASK_INFORMATION_III.API_TASK_ID IS '调用技术中心API接口，返回的TASKID';\nCOMMENT ON COLUMN TASK_INFORMATION_III.API_TASK_SENDTIME IS '调用技术中心API接口时间';\nCOMMENT ON COLUMN TASK_INFORMATION_III.API_TASKSTATE_UPDATETIME IS '技术中心任务状态回调更新状态时的时间';\n\n\n--技术中心API任务信息记录\n--DROP TABLE API_TASK;\nCREATE TABLE API_TASK(\n       AUTO_INCR_ID NUMBER NOT NULL PRIMARY KEY,\n       ID VARCHAR2(30),\n       STATE_CODE VARCHAR(10),\n       GEN_TIME NUMBER,\n       SERVER_TIME NUMBER,\n       TIME DATE DEFAULT SYSDATE\n);\n\nCOMMENT ON TABLE API_TASK IS '技术中心API任务信息';\nCOMMENT ON COLUMN API_TASK.AUTO_INCR_ID IS '自增序列';\nCOMMENT ON COLUMN API_TASK.ID IS '任务ID';\nCOMMENT ON COLUMN API_TASK.STATE_CODE IS '任务状态编码';\nCOMMENT ON COLUMN API_TASK.GEN_TIME IS '终端任务状态变更时间';\nCOMMENT ON COLUMN API_TASK.SERVER_TIME IS '技术中心API接口服务器时间';\nCOMMENT ON COLUMN API_TASK.TIME IS '本条数据生成时间';\n\n--DROP SEQUENCE SEQ_API_TASK;\nCREATE SEQUENCE SEQ_API_TASK\nMINVALUE 1\nMAXVALUE 999999999999999999999999\nSTART WITH 1\nINCREMENT BY 1\nNOCACHE;\n\n--SELECT SEQ_API_TASK.NEXTVAL FROM DUAL;\n--DROP TRIGGER TRI_API_TASK;\nCREATE OR REPLACE TRIGGER TRI_API_TASK\n  BEFORE INSERT ON API_TASK --触发条件：当向表执行插入操作时触发此触发器\n  FOR EACH ROW --对每一行都检测是否触发\nBEGIN\n  --触发器开始\n  --触发器主题内容，即触发后执行的动作，在此是取得序列的下一个值插入到表中的自增字段中\n  SELECT SEQ_API_TASK.NEXTVAL INTO :NEW.AUTO_INCR_ID FROM DUAL;\nEND;\n\nINSERT INTO API_TASK(ID, STATE_CODE, GEN_TIME, SERVER_TIME) VALUES ('1150424012120170712T0924175827', '2', 1542769127254, 1542769127254);\n--DELETE FROM API_TASK WHERE AUTO_INCR_ID=1;\nSELECT * FROM API_TASK;\n")])])]),a("h3",{attrs:{id:"组织"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组织"}},[t._v("#")]),t._v(" 组织")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT * FROM T_B_COMPANY;\n\n\nSELECT * FROM T_B_COMPANY \nSELECT * FROM T_B_COMPANY \n       WHERE \n       --PARENT_ID=0;\n       PARENT_ID IS NULL\n       ID=95;\n--Oracle树查询(查询所有子节点，父节点等等) https://blog.csdn.net/qiange520/article/details/50515317\n\n--3.查找一个节点的所有 直属子节点（所有后代）。\nSELECT ID, NAME, PARENT_ID FROM T_B_COMPANY START WITH ID = 95 CONNECT BY PARENT_ID = PRIOR ID;\n--5.查找一个节点的所有直属父节点（祖宗）。注意的是这个查询出来的结果的顺序是先列出子类节点再列出父类节点，姑且认为是个倒序吧\nSELECT ID, NAME, PARENT_ID FROM T_B_COMPANY START WITH ID = 95 CONNECT BY PRIOR PARENT_ID = ID;\n\n\n--10.名称要列出名称全部路径。\n--从顶部开始\nSELECT ID, NAME, PARENT_ID, SYS_CONNECT_BY_PATH(NAME, '_') FROM T_B_COMPANY START WITH PARENT_ID=0 CONNECT BY PARENT_ID = PRIOR ID;\nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FROM T_B_COMPANY START WITH PARENT_ID=0 CONNECT BY PARENT_ID = PRIOR ID;\nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FROM T_B_COMPANY WHERE ID=11135 START WITH PARENT_ID=0 CONNECT BY PARENT_ID = PRIOR ID\n--从当前节点开始\nSELECT ID, NAME, SYS_CONNECT_BY_PATH (NAME, '/') FROM T_B_COMPANY START WITH ID = 56830484 CONNECT BY PRIOR PARENT_ID = ID;\n\n--省市县样例\nSELECT ID, NAME, FULL_NAME, FULL_ID\n  FROM (SELECT ID,\n               LABEL_CN NAME,\n               REPLACE(SYS_CONNECT_BY_PATH(LABEL_CN, '_'), '_', '') FULL_NAME,\n               SUBSTR(SYS_CONNECT_BY_PATH(ID, '_'), 2) FULL_ID\n          FROM T_DISTRICT\n         START WITH PARENT_ID = 10000046\n        CONNECT BY PARENT_ID = PRIOR ID)\n WHERE FULL_NAME like '新疆维吾尔自治区哈密地区哈密市';\n\n\n\nSELECT NAME, SYS_CONNECT_BY_PATH (NAME, '_') FROM T_B_COMPANY START WITH PARENT_ID=0  CONNECT BY  PARENT_ID = PRIOR ID;\n\n\nSELECT ID, NAME, PARENT_ID FROM T_B_COMPANY;\n\nSELECT * FROM T_B_COMPANY WHERE ID=56830484;\n\nSELECT * FROM T_B_COMPANY START WITH ID=56830484 CONNECT BY PRIOR PARENT_ID = ID;\nSELECT  ID, NAME, SYS_CONNECT_BY_PATH (NAME, '_') FROM T_B_COMPANY START WITH ID=56830484 CONNECT BY PRIOR PARENT_ID = ID;\nSELECT  ID, NAME, SYS_CONNECT_BY_PATH (NAME, '_') FROM T_B_COMPANY START WITH ID=56830484 CONNECT BY PARENT_ID = PRIOR ID;\n\nSELECT      SYS_CONNECT_BY_PATH (NAME, '/')   \n           FROM T_B_COMPANY   \n          WHERE ID = 56830484   \n    START WITH PARENT_ID = 0\n    CONNECT BY ID = PRIOR PARENT_ID;\n    \nSELECT SYS_CONNECT_BY_PATH (NAME, '/')   \n          FROM T_B_COMPANY   \n    START WITH ID = 56830484   \n     CONNECT BY PRIOR PARENT_ID = ID;      \n    \n\n\n\n\n\n-----------------\nSELECT * FROM T_B_ORG WHERE 1=1\n--       AND PARENT_ID IS NULL\n--       AND PARENT_ID = -1;\n       AND PARENT_ID<-1;\n       \n       \n       \n       \nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FROM T_B_COMPANY START WITH PARENT_ID=0 CONNECT BY PARENT_ID = PRIOR ID;       \nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FULL_NAME FROM T_B_COMPANY START WITH PARENT_ID=0 CONNECT BY PARENT_ID = PRIOR ID;\n\nWITH ORG AS(\nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FULL_NAME FROM T_B_COMPANY START WITH PARENT_ID=0 CONNECT BY PARENT_ID = PRIOR ID\n)\nSELECT * FROM ORG WHERE FULL_NAME like '%陕重汽_德银租赁_济宁晟翔汽车销售服务有限公司%';\nSELECT * FROM ORG WHERE FULL_NAME like '%济宁晟翔汽车销售服务有限公司%';\n\nSELECT FULL_NAME, COUNT(*) FROM ORG GROUP BY FULL_NAME;\n\nSELECT * FROM T_B_COMPANY WHERE NAME LIKE '陕西华昊德汽车销售服务有限公司';\n\n\n\n\n\nSELECT * FROM T_B_ORG@DBLINK_1;\nSELECT * FROM T_B_CAR_INFO;\nSELECT * FROM T_B_CAR_INFO@DBLINK_1;\n\n\n--1.0非德银的车贷车的组织ID\nselect vin_code,org_id from t_b_car_info@dblink_1 \nwhere vin_code in\n(\n  select *  from cartemp\n)\n  --1.0 VIN, ORG FULLPATH\n\nWITH ORG AS(  \nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FULL_PATH FROM CARORG START WITH PARENT_ID=-1 CONNECT BY PARENT_ID = PRIOR ID\n),\nCAR AS(\nselect vin_code,org_id from t_b_car_info@dblink_1 \nwhere vin_code in\n(\n  select *  from cartemp\n)\n)\n\n--SELECT * FROM CAR WHERE CAR.vin_code='GX031515';\nSELECT CAR.VIN_CODE, ORG.FULL_PATH FROM CAR LEFT JOIN ORG ON CAR.ORG_ID=ORG.ID;\n\n\n--1.0组织机构临时表\nSELECT * FROM CARORG;\n\nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FROM CARORG START WITH PARENT_ID=-1 CONNECT BY PARENT_ID = PRIOR ID;\n\nSELECT ID, NAME, PARENT_ID, SUBSTR(SYS_CONNECT_BY_PATH(NAME, '_'), 2) FROM CARORG WHERE ID IN(\nSELECT ORG_ID FROM TEMP_TOSIN_ORG_1\n) START WITH PARENT_ID=-1 CONNECT BY PARENT_ID = PRIOR ID;\n\n\n\n--创建临时表 \nCREATE TABLE TEMP_TOSIN_ORG_1 AS SELECT * FROM (\nselect DISTINCT ORG_ID from t_b_car_info@dblink_1 \nwhere vin_code in\n(\n  select *  from cartemp\n)\n);\nSELECT * FROM TEMP_TOSIN_ORG_1;\n\n\n\n--\nSELECT * FROM user_role_org_vehicle_dingdan@Dblink_2;\n\n\n")])])]),a("h3",{attrs:{id:"分组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分组"}},[t._v("#")]),t._v(" 分组")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SELECT *  \n--DELETE\nFROM T_B_CAR_TERMINAL WHERE ID IN(\n\n--需要删除的IDSTART\nselect ID from\n--select * from\n(\nselect t.*, row_number() over (partition by TERMINAL_ID order by ID DESC) rn ,count(*) over (partition by TERMINAL_ID) nums from (\n  --重复数据START\n  SELECT ID, TERMINAL_ID FROM T_B_CAR_TERMINAL WHERE TERMINAL_ID IN(\n  SELECT TERMINAL_ID FROM (\n  SELECT CAR_ID, TERMINAL_ID, TERMINAL_INSTALL_DATE, TERMINAL_UNINSTALL_DATE, DESCB, \n  HISTORY_PULSE, TERMINAL_TYPE, TERMINAL_LOCATION_SOURCE, IS_AUTO_PLAY, LAST_UPDATE_BY, TERMINAL_ID12, COUNT(1)\n   FROM T_B_CAR_TERMINAL GROUP BY CAR_ID, TERMINAL_ID, TERMINAL_INSTALL_DATE, TERMINAL_UNINSTALL_DATE, DESCB, \n  HISTORY_PULSE, TERMINAL_TYPE, TERMINAL_LOCATION_SOURCE, IS_AUTO_PLAY, LAST_UPDATE_BY, TERMINAL_ID12 HAVING COUNT(1)>1\n  ))\n  --重复数据END\n) t\n)\nwhere rn != 1\n--需要删除的IDEND\n\n);\n")])])]),a("ul",[a("li",[t._v("国六、国五 VIN，终端号，插入时间\n"),a("ol",[a("li",[t._v("VIN 终端号有重复的")]),t._v(" "),a("li",[t._v("按VIN 终端号去重后，VIN有重复或终端号有重复的")])])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("WITH T1 AS(\nSELECT FIELD1 VIN, FIELD2 TER, FIELD3 TYPE, FIELD10 INSERT_DATE FROM TEMP_TS_20210523 \n WHERE 1=1\n--FIELD3 IS NULL --国六\n--FIELD3=1 --国五\n),\nT2 AS(\nSELECT DISTINCT VIN, TER FROM T1\n)\n--按VIN，TER去重后，TER有重复的数据\n--SELECT TER, COUNT(TER) FROM T2 GROUP BY TER HAVING COUNT(TER) > 1\n--按VIN，TER去重后，VIN有重复的数据\n--SELECT VIN, COUNT(VIN) FROM T2 GROUP BY VIN HAVING COUNT(VIN) > 1\n--VIN、TER重复的数据 取第一条数据\nSELECT *\n  FROM (SELECT ROW_NUMBER() OVER(PARTITION BY VIN, TER ORDER BY INSERT_DATE DESC) rn,\n               T1.*\n          FROM T1\n         WHERE VIN IN (SELECT VIN FROM T2 GROUP BY VIN HAVING COUNT(VIN) = 1)\n           AND TER IN(SELECT TER  FROM T2 GROUP BY TER HAVING COUNT(TER) = 1)\n           --AND TER NOT IN(SELECT TER  FROM T2 GROUP BY TER HAVING COUNT(TER) > 1)\n         ORDER BY VIN)\n WHERE rn = 1\n\n\nCREATE Table TEMP_TS_20210523\n(\n  FIELD1       VARCHAR2(2000),\n  FIELD2       VARCHAR2(2000),\n  FIELD3       VARCHAR2(2000),\n  FIELD4       VARCHAR2(2000),\n  FIELD5       VARCHAR2(2000),\n  FIELD6       VARCHAR2(2000),\n  FIELD7       VARCHAR2(2000),\n  FIELD8       VARCHAR2(2000),\n  FIELD9       VARCHAR2(2000),\n  FIELD10       DATE\n);\n")])])]),a("h2",{attrs:{id:"整库备份还原"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整库备份还原"}},[t._v("#")]),t._v(" 整库备份还原")]),t._v(" "),a("blockquote",[a("p",[t._v("备注：执行导出导入命令的机器要安装oracle客户端。")])]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://blog.csdn.net/yztezhl/article/details/80451046",target:"_blank",rel:"noopener noreferrer"}},[t._v("oracle 备份与还原"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://blog.csdn.net/qq_34967770/article/details/105983053",target:"_blank",rel:"noopener noreferrer"}},[t._v("oracle数据库备份与还原完整版"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[t._v("Docker安装Oracle环境")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[oracle@3c0ae5a124fe ~]$ vi .bash_profile\n...\nPATH=$PATH:$HOME/bin\n\nexport PATH\nORACLE_BASE=/home/oracle/app/oracle;export ORACLE_BASE\nORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_2;export ORACLE_HOME\nORACLE_SID=helowin;export ORACLE_SID\nORACLE_TERM=xterm;export ORACLE_TERM\nPATH=/usr/sbin:$PATH; export PATH\nPATH=$ORACLE_HOME/bin:$PATH; export PATH\nLD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib; export LD_LIBRARY_PATH\nCLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib;\nexport CLASSPATH\nexport ORACLE_HOME\nexport PATH\n[oracle@3c0ae5a124fe ~]$ source .bash_profile \n")])])]),a("h3",{attrs:{id:"备份-exp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份-exp"}},[t._v("#")]),t._v(" 备份 exp")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[oracle@3c0ae5a124fe ~]$ exp 'TXJ/pm2022@10.1.180.77/pman' owner=TXJ file=/home/oracle/backup/TXJ2022070402.dmp buffer=10240 \n\\\nExport: Release 11.2.0.1.0 - Production on һ 7 11:24:38 2022\n\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\n\n\nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\nExport done in ZHS16GBK character set and AL16UTF16 NCHAR character set\n\nAbout to export specified users ...\n. exporting pre-schema procedural objects and actions\n. exporting foreign function library names for user TXJ \n. exporting PUBLIC type synonyms\n. exporting private type synonyms\n. exporting object type definitions for user TXJ \nAbout to export TXJ's objects ...\n. exporting database links\n. exporting sequence numbers\n. exporting cluster definitions\n. about to export TXJ's tables via Conventional Path ...\n. . exporting table                        article          0 rows exported\n. . exporting table               article_category          0 rows exported\n. . exporting table                     attachment        153 rows exported\n. . exporting table            goal_cor_item_month          0 rows exported\n. . exporting table             goal_cor_item_year         11 rows exported\n. . exporting table          goal_cor_measure_year         33 rows exported\n. . exporting table                goal_item_month       3476 rows exported\n. . exporting table                 goal_item_year        518 rows exported\n. . exporting table              goal_measure_temp          0 rows exported\n. . exporting table              goal_measure_year        525 rows exported\n. . exporting table                       integral          0 rows exported\n. . exporting table                            job          0 rows exported\n. . exporting table                        kpi_cor          0 rows exported\n. . exporting table                  kpi_interview        448 rows exported\n. . exporting table                            log          8 rows exported\n. . exporting table                   measure_data          0 rows exported\n. . exporting table        measure_data_attendance          0 rows exported\n. . exporting table             measure_data_queue          0 rows exported\n. . exporting table           measure_data_special       1368 rows exported\n. . exporting table                    measure_lib        284 rows exported\n. . exporting table                        message       4353 rows exported\n. . exporting table                   organization         90 rows exported\n. . exporting table              organization_user          0 rows exported\n. . exporting table                     permission         98 rows exported\n. . exporting table                        profile         99 rows exported\n. . exporting table               profile_property         56 rows exported\n. . exporting table         profile_property_value       5544 rows exported\n. . exporting table                           role         10 rows exported\n. . exporting table                role_permission        747 rows exported\n. . exporting table                      role_user          0 rows exported\n. . exporting table                  transfer_post          0 rows exported\n. . exporting table                  user_relation         81 rows exported\n. exporting synonyms\n. exporting views\n. exporting stored procedures\n. exporting operators\n. exporting referential integrity constraints\n. exporting triggers\n. exporting indextypes\n. exporting bitmap, functional and extensible indexes\n. exporting posttables actions\n. exporting materialized views\n. exporting snapshot logs\n. exporting job queues\n. exporting refresh groups and children\n. exporting dimensions\n. exporting post-schema procedural objects and actions\n. exporting statistics\nExport terminated successfully without warnings.\n\n")])])]),a("h4",{attrs:{id:"异常-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常-2"}},[t._v("#")]),t._v(" 异常")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[oracle@3c0ae5a124fe ~]$ exp 'TXJ/pm2022@10.1.180.77/pman' owner=TXJ file=/home/oracle/backup/TXJ2022070401.dmp buffer=10240 full=y\n\nExport: Release 11.2.0.1.0 - Production on Mon Jul 4 10:25:49 2022\n\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\n\n\nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\nEXP-00026: conflicting modes specified\nEXP-00000: Export terminated unsuccessfully\n")])])]),a("h4",{attrs:{id:"空表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#空表"}},[t._v("#")]),t._v(" 空表")]),t._v(" "),a("blockquote",[a("p",[t._v("是因为在oracle11G中有新特性，当表无数据时，不分配segment，以节省空间。而使用exp命令时，无segment的表不会被导出。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select 'alter table '||table_name||' allocate extent;' from user_tables where num_rows=0;\nselect 'alter table \"'||table_name||'\" allocate extent;' from user_tables where num_rows=0;\nalter table \"article\" allocate extent;\n\n\n--4、查询其分配的segment\nselect segment_name,sum(bytes)/1024/1024 from user_extents group by segment_name;\n---- 查看那些表没有分配查询其分配的segment\nSELECT\n\ttable_name\nFROM\n\t(\n\tSELECT\n\t\ttable_name\n\tFROM\n\t\tuser_tables\n\tWHERE\n\t\tnum_rows = 0) tb_null\nWHERE\n\tNOT EXISTS (\n\tSELECT\n\t\tsegment_name\n\tFROM\n\t\tuser_extents tb_not_null\n\tWHERE\n\t\ttb_null.table_name = tb_not_null.segment_name\n\tGROUP BY\n\t\tsegment_name);\n")])])]),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/isme-zjh/p/11389690.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Oracle空表的分配segment"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/wang263334857/article/details/40781541",target:"_blank",rel:"noopener noreferrer"}},[t._v("oracle用exp命令导出数据时，有些表无法导出"),a("OutboundLink")],1)])]),t._v(" "),a("h4",{attrs:{id:"help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#help"}},[t._v("#")]),t._v(" help")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[oracle@3c0ae5a124fe ~]$ exp -?    \ntemplate                IAS Template to be used\nsilent          silent: display banner information, default is N\nmetrics         metrics: display performance information, default is N\nuserid          user/password to connect to oracle: no default\nrecordlength            record length of file: optional, default is system dependent\nbuffer          array fetch buffer size: default is EXUAFCH (4096)\nfile            export file names: format is (file1, file2...) default is EXPDAT.DMP\nfull            export entire database: default is N\ngrants          export grants option: default is Y\nrows            export rows option: default is Y\ncompress                compact extents option: default is Y\ntrace           trace option: enable sql_trace and timed_stat, default is N\nresumable               enable resumable session : default is N\nresumable_timeout               resumable_timeout: wait time for resumable\nresumable_name          resumable string: SQL statements to be resumable\nowner           users to export: format is '(user1, user2, .., userN)'\ntables          tables to export: format is '(table1, table2, ..., tableN)'\nparfile         parameter file: name of file that contains parameter specifications\nindexes         export indexes option: default is Y\ninctype         incremental export option: (incremental, cumulative or complete)\nrecord          option to record incremental/cumulative export: default is Y\nconstraints             export table constraints option: default is Y\nconsistent              provide read-consistency for the entire export: default is N\nhelp            help: display descriptions on export parameters, default is N\nlog             log export messages to specified file\nstatistics              analyze option: (estimate, cumulative, none)\nfeedback                feedback in rows default is EXUFDB\ndirect          direct path option: default is N\npoint_in_time_recover           point-in-time recover option: default is N\ntts_full_check          TTS perform strict test for objects in recovery set: default is N\ntablespaces             tablespaces to transport or recover: format is '(ts1, ts2, ..., tsN)'\nquery           query used to select a subset of rows for a table\nfilesize                file size: the size of export dump files\nvolsize         volume size: the size of each volume\ntransport_tablespace            transportable tablespace option: default is N\ntriggers                export triggers option: default is Y\nimpparfile              file to create as paramfile for IMP for transportable tablespaces\nfile_format             format of export file names\nflashback_time          database time to be used for flashback export: no default\nflashback_scn           system change number to be used for flashback export: no default\nobject_consistent               Provides consistency for registered objects during execution of procedureal callback: default is N\n\nExport: Release 11.2.0.1.0 - Production on Mon Jul 4 09:37:56 2022\n\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\n")])])]),a("h3",{attrs:{id:"导入还原-imp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入还原-imp"}},[t._v("#")]),t._v(" 导入还原 imp")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[oracle@3c0ae5a124fe ~]$ sqlplus /nolog\n\nSQL*Plus: Release 11.2.0.1.0 Production on Mon Jul 4 10:37:30 2022\n\nCopyright (c) 1982, 2009, Oracle.  All rights reserved.\n\nSQL> conn /as sysdba\nConnected.\nSQL> ^Z^Z      \nSQL> drop user DYJX cascade;\ndrop user DYJX cascade\n*\nERROR at line 1:\nORA-01940: cannot drop a user that is currently connected\n\n\nSQL> drop user DYJX cascade;\n\nUser dropped.\n\nSQL> create user DYJX identified by 123456;\n\nUser created.\n\nSQL> grant connect,resource,dba to DYJX;\n\nGrant succeeded.\n")])])]),a("ul",[a("li",[t._v("imp")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[oracle@3c0ae5a124fe ~]$ imp \'root/123456@127.0.0.1/helowin\' fromuser=TXJ touser=DYJX file=/home/oracle/backup/TXJ2022070402.dmp  log=/home/oracle/backup/TXJ2022070402.log ignore=y;  \n\nImport: Release 11.2.0.1.0 - Production on һ 7 11:44:15 2022\n\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\n\n\nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n\nExport file created by EXPORT:V11.02.00 via conventional path\n\nWarning: the objects were exported by TXJ, not by you\n\nimport done in ZHS16GBK character set and AL16UTF16 NCHAR character set\n. importing TXJ\'s objects into DYJX\n. . importing table                      "article"          0 rows imported\n. . importing table             "article_category"          0 rows imported\n. . importing table                   "attachment"        153 rows imported\n. . importing table          "goal_cor_item_month"          0 rows imported\n. . importing table           "goal_cor_item_year"         11 rows imported\n. . importing table        "goal_cor_measure_year"         33 rows imported\n. . importing table              "goal_item_month"       3476 rows imported\n. . importing table               "goal_item_year"        518 rows imported\n. . importing table            "goal_measure_temp"          0 rows imported\n. . importing table            "goal_measure_year"        525 rows imported                                                                                                                                   \n. . importing table                     "integral"          0 rows imported\n. . importing table                          "job"          0 rows imported\n. . importing table                      "kpi_cor"          0 rows imported\n. . importing table                "kpi_interview"        448 rows imported\n. . importing table                          "log"          8 rows imported\n. . importing table                 "measure_data"          0 rows imported\n. . importing table      "measure_data_attendance"          0 rows imported\n. . importing table           "measure_data_queue"          0 rows imported\n. . importing table         "measure_data_special"       1368 rows imported\n. . importing table                  "measure_lib"        284 rows imported\n. . importing table                      "message"       4353 rows imported\n. . importing table                 "organization"         90 rows imported\n. . importing table            "organization_user"          0 rows imported\n. . importing table                   "permission"         98 rows imported\n. . importing table                      "profile"         99 rows imported\n. . importing table             "profile_property"         56 rows imported\n. . importing table       "profile_property_value"       5544 rows imported\n. . importing table                         "role"         10 rows imported\n. . importing table              "role_permission"        747 rows imported\n. . importing table                    "role_user"          0 rows imported\n. . importing table                "transfer_post"          0 rows imported\n. . importing table                "user_relation"         81 rows imported\nAbout to enable constraints...\nImport terminated successfully without warnings.\n\n')])])]),a("h4",{attrs:{id:"异常-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常-3"}},[t._v("#")]),t._v(" 异常")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[oracle@e63af26799ac ~]$ imp \'DYJX/123456@127.0.0.1/helowin\' fromuser=TXJ touser=DYJX file=/home/oracle/backup/TXJ20220726-P.dmp  log=/home/oracle/backup/TXJ20220726-P.log ignore=y;  \n\nImport: Release 11.2.0.1.0 - Production on 星期二 7月 26 16:08:51 2022\n\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\n\n\nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n\nExport file created by EXPORT:V11.02.00 via conventional path\n\nWarning: the objects were exported by TXJ, not by you\n\nimport done in AL32UTF8 character set and AL16UTF16 NCHAR character set\n. . importing table              "_kpi_attendance"          0 rows imported\n. . importing table         "_profile_bak20201111"          0 rows imported\nIMP-00017: following statement failed with ORACLE error 959:\n "CREATE TABLE "article" ("id" NUMBER NOT NULL ENABLE, "category_id" NUMBER N"\n "OT NULL ENABLE, "title" VARCHAR2(255 CHAR) NOT NULL ENABLE, "content" CLOB "\n "NOT NULL ENABLE, "user_id" NUMBER NOT NULL ENABLE, "created_at" DATE NOT NU"\n "LL ENABLE, "updated_at" DATE NOT NULL ENABLE, "deleted_at" DATE)  PCTFREE 1"\n "0 PCTUSED 40 INITRANS 1 MAXTRANS 255 STORAGE(INITIAL 131072 NEXT 1048576 MI"\n "NEXTENTS 1 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT) TABLESPACE "T"\n "XJ" LOGGING NOCOMPRESS LOB ("content") STORE AS BASICFILE  (TABLESPACE "TXJ"\n "" ENABLE STORAGE IN ROW CHUNK 8192 RETENTION  NOCACHE LOGGING  STORAGE(INIT"\n "IAL 65536 NEXT 1048576 MINEXTENTS 1 FREELISTS 1 FREELIST GROUPS 1 BUFFER_PO"\n "OL DEFAULT))"\nIMP-00003: ORACLE error 959 encountered\nORA-00959: 表空间 \'TXJ\' 不存在\n. . importing table             "article_category"          0 rows imported\n. . importing table                   "attachment"        148 rows imported\n. . importing table          "goal_cor_item_month"          0 rows imported\n. . importing table           "goal_cor_item_year"         11 rows imported\n. . importing table        "goal_cor_measure_year"         33 rows imported\n. . importing table              "goal_item_month"       4084 rows imported\n. . importing table               "goal_item_year"        518 rows imported\n. . importing table            "goal_measure_temp"          0 rows imported\n. . importing table            "goal_measure_year"        528 rows imported\n. . importing table                     "integral"          0 rows imported\n. . importing table                          "job"          0 rows imported\n. . importing table                      "kpi_cor"          0 rows imported\nIMP-00017: following statement failed with ORACLE error 959:\n "CREATE TABLE "kpi_interview" ("id" NUMBER NOT NULL ENABLE, "year" NUMBER NO"\n "T NULL ENABLE, "month" NUMBER NOT NULL ENABLE, "work_number" VARCHAR2(50 CH"\n "AR) NOT NULL ENABLE, "org_name" VARCHAR2(255 CHAR), "job_name" VARCHAR2(255"\n " CHAR), "leader_work_number" VARCHAR2(50 CHAR), "interview_at" CHAR(10), "p"\n "lace" VARCHAR2(255), "type" NUMBER, "con_result" CHAR(1 CHAR), "con_highlig"\n "ht" VARCHAR2(4000 CHAR), "con_work_need_up" VARCHAR2(4000 CHAR), "con_agree"\n "ment" NUMBER, "con_plan" VARCHAR2(4000 CHAR), "con_help" VARCHAR2(4000 CHAR"\n "), "status" NUMBER NOT NULL ENABLE, "status_description" VARCHAR2(1000 CHAR"\n "), "leader_confirmed_date" DATE, "created_at" DATE NOT NULL ENABLE, "update"\n "d_at" DATE NOT NULL ENABLE, "deleted_at" DATE, "transfer_mark" VARCHAR2(4) "\n "NOT NULL ENABLE, "con_description" CLOB)  PCTFREE 10 PCTUSED 40 INITRANS 1 "\n "MAXTRANS 255 STORAGE(INITIAL 655360 NEXT 1048576 MINEXTENTS 1 FREELISTS 1 F"\n "REELIST GROUPS 1 BUFFER_POOL DEFAULT) TABLESPACE "TXJ" LOGGING NOCOMPRESS L"\n "OB ("con_description") STORE AS BASICFILE  (TABLESPACE "TXJ" ENABLE STORAGE"\n " IN ROW CHUNK 8192 RETENTION  NOCACHE LOGGING  STORAGE(INITIAL 65536 NEXT 1"\n "048576 MINEXTENTS 1 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT))"\nIMP-00003: ORACLE error 959 encountered\nORA-00959: 表空间 \'TXJ\' 不存在\nIMP-00017: following statement failed with ORACLE error 959:\n "CREATE TABLE "kpi_interview_bak220701" ("id" NUMBER NOT NULL ENABLE, "year""\n " NUMBER NOT NULL ENABLE, "month" NUMBER NOT NULL ENABLE, "work_number" VARC"\n "HAR2(50 CHAR) NOT NULL ENABLE, "org_name" VARCHAR2(255 CHAR), "job_name" VA"\n "RCHAR2(255 CHAR), "leader_work_number" VARCHAR2(50 CHAR), "interview_at" CH"\n "AR(10 CHAR) NOT NULL ENABLE, "place" VARCHAR2(255 CHAR) NOT NULL ENABLE, "t"\n "ype" NUMBER NOT NULL ENABLE, "con_result" CHAR(1 CHAR), "con_highlight" VAR"\n "CHAR2(4000 CHAR), "con_work_need_up" VARCHAR2(4000 CHAR), "con_agreement" N"\n "UMBER, "con_plan" VARCHAR2(4000 CHAR), "con_help" VARCHAR2(4000 CHAR), "sta"\n "tus" NUMBER NOT NULL ENABLE, "status_description" VARCHAR2(1000 CHAR), "lea"\n "der_confirmed_date" DATE, "created_at" DATE NOT NULL ENABLE, "updated_at" D"\n "ATE NOT NULL ENABLE, "deleted_at" DATE, "transfer_mark" VARCHAR2(4) NOT NUL"\n "L ENABLE, "con_description" CLOB)  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRAN"\n "S 255 STORAGE(INITIAL 589824 NEXT 1048576 MINEXTENTS 1 FREELISTS 1 FREELIST"\n " GROUPS 1 BUFFER_POOL DEFAULT) TABLESPACE "TXJ" LOGGING NOCOMPRESS LOB ("co"\n "n_description") STORE AS BASICFILE  (TABLESPACE "TXJ" ENABLE STORAGE IN ROW"\n " CHUNK 8192 PCTVERSION 10 NOCACHE LOGGING  STORAGE(INITIAL 65536 NEXT 10485"\n "76 MINEXTENTS 1 FREELISTS 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT))"\nIMP-00003: ORACLE error 959 encountered\nORA-00959: 表空间 \'TXJ\' 不存在\nIMP-00017: following statement failed with ORACLE error 959:\n "CREATE TABLE "log" ("id" NUMBER NOT NULL ENABLE, "ip" VARCHAR2(255 CHAR) NO"\n "T NULL ENABLE, "module" VARCHAR2(4000 CHAR) NOT NULL ENABLE, "action" VARCH"\n "AR2(255 CHAR) NOT NULL ENABLE, "description" CLOB NOT NULL ENABLE, "created"\n "_at" DATE NOT NULL ENABLE, "updated_at" DATE NOT NULL ENABLE, "work_number""\n " VARCHAR2(50))  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 STORAGE(INITI"\n "AL 14680064 NEXT 1048576 MINEXTENTS 1 FREELISTS 1 FREELIST GROUPS 1 BUFFER_"\n "POOL DEFAULT) TABLESPACE "TXJ" LOGGING NOCOMPRESS LOB ("description") STORE"\n " AS BASICFILE  (TABLESPACE "TXJ" ENABLE STORAGE IN ROW CHUNK 8192 RETENTION"\n "  NOCACHE LOGGING  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 FREELIST"\n "S 1 FREELIST GROUPS 1 BUFFER_POOL DEFAULT))"\nIMP-00003: ORACLE error 959 encountered\nORA-00959: 表空间 \'TXJ\' 不存在\n. . importing table                 "measure_data"          0 rows imported\n. . importing table      "measure_data_attendance"          0 rows imported\n. . importing table           "measure_data_queue"          0 rows imported\n. . importing table         "measure_data_special"       1811 rows imported\n. . importing table                  "measure_lib"        285 rows imported\n. . importing table                      "message"       4988 rows imported\n. . importing table                 "organization"         90 rows imported\n. . importing table            "organization_user"          0 rows imported\n. . importing table                   "permission"         98 rows imported\n. . importing table                      "profile"         99 rows imported\n. . importing table             "profile_property"         56 rows imported\n. . importing table       "profile_property_value"       5544 rows imported\n. . importing table                         "role"         10 rows imported\n. . importing table              "role_permission"        747 rows imported\n. . importing table                    "role_user"          0 rows imported\n. . importing table                "transfer_post"          0 rows imported\n. . importing table                "user_relation"         80 rows imported\nAbout to enable constraints...\nImport terminated successfully with warnings.\n')])])]),a("ul",[a("li",[t._v("解决问题")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("SQL> drop user TXJ cascade;                                                                                                                                              \nUser dropped.\nSQL> drop user DYJX cascade;\nUser dropped.\n[oracle@e63af26799ac ~]$ mkdir -p /home/oracle/oradata/DYJX\nSQL> create tablespace DYJX logging datafile'/home/oracle/oradata/DYJX/DYJX.dbf' size 1024m autoextend on next 100m maxsize 10240m extent management local;\nTablespace created.\nSQL> create user DYJX identified by 123456 default tablespace DYJX;\nUser created.\nSQL> grant connect,resource,dba to DYJX;\nGrant succeeded.\n\ncreate table test1\n (id number(8),\n  work clob\n  )\n LOB (work) STORE AS\n     (\n   TABLESPACE DYJX\n   STORAGE (\n            INITIAL 10M\n            NEXT 10M\n                   )\n     NOCACHE NOLOGGING\n            );\nSELECT * FROM test1;\nINSERT INTO test1 VALUES(1, '123');\n\n[oracle@e63af26799ac ~]$ imp 'system/system@127.0.0.1/helowin' fromuser=TXJ touser=DYJX file=/home/oracle/backup/TXJ20220726-P.dmp  log=/home/oracle/backup/TXJ20220726-P.log ignore=y;\n")])])]),a("h3",{attrs:{id:"乱码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#乱码"}},[t._v("#")]),t._v(" 乱码")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("-- TEST   SIMPLIFIED CHINESE_CHINA.ZHS16GBK\n-- 本地库 SIMPLIFIED CHINESE_CHINA.AL32UTF8\nselect userenv('language') from dual;\n")])])]),a("h4",{attrs:{id:"修改字符集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改字符集"}},[t._v("#")]),t._v(" 修改字符集")]),t._v(" "),a("h5",{attrs:{id:"修改服务器字符集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改服务器字符集"}},[t._v("#")]),t._v(" 修改服务器字符集")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[oracle@3c0ae5a124fe ~]$ vi .bash_profile \n...\nexport NLS_LANG="SIMPLIFIED CHINESE_CHINA.ZHS16GBK"\n[oracle@3c0ae5a124fe ~]$ source .bash_profile \n\n[oracle@3c0ae5a124fe ~]$ echo $NLS_LANG\nSIMPLIFIED CHINESE_CHINA.ZHS16GBK\n')])])]),a("h6",{attrs:{id:"问题-exp-00091-exporting-questionable-statistics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题-exp-00091-exporting-questionable-statistics"}},[t._v("#")]),t._v(" 问题 EXP-00091: Exporting questionable statistics.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[oracle@e63af26799ac ~]$ exp 'TXJ/pm2022@10.1.180.77/pman' owner=TXJ file=/home/oracle/backup/TXJ20220726-T.dmp buffer=10240      \n\nExport: Release 11.2.0.1.0 - Production on Tue Jul 26 14:33:03 2022\n\nCopyright (c) 1982, 2009, Oracle and/or its affiliates.  All rights reserved.\n\n\nConnected to: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\nExport done in US7ASCII character set and AL16UTF16 NCHAR character set\nserver uses ZHS16GBK character set (possible charset conversion)\n\nAbout to export specified users ...\n. exporting pre-schema procedural objects and actions\n. exporting foreign function library names for user TXJ \n. exporting PUBLIC type synonyms\n. exporting private type synonyms\n. exporting object type definitions for user TXJ \nAbout to export TXJ's objects ...\n. exporting database links\n. exporting sequence numbers\n. exporting cluster definitions\n. about to export TXJ's tables via Conventional Path ...\n. . exporting table                        article          0 rows exported\nEXP-00091: Exporting questionable statistics.\n\n")])])]),a("ul",[a("li",[t._v("分析解决")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("TEST SIMPLIFIED CHINESE_CHINA.ZHS16GBK\nLOCAL SIMPLIFIED CHINESE_CHINA.AL32UTF8\n[oracle@e63af26799ac ~]$ export NLS_LANG=\"SIMPLIFIED CHINESE_CHINA.ZHS16GBK\"\n\n[oracle@e63af26799ac ~]$ vi .bash_profile\n[oracle@e63af26799ac ~]$ source .bash_profile \n[oracle@e63af26799ac ~]$ echo $NLS_LANG              \nSIMPLIFIED CHINESE_CHINA.ZHS16GBK\n\n-- 数据库字符集并未改变\nselect userenv('language') from dual;\nSIMPLIFIED CHINESE_CHINA.AL32UTF8\n")])])]),a("h5",{attrs:{id:"修改本地库字符集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改本地库字符集"}},[t._v("#")]),t._v(" 修改本地库字符集")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[oracle@3c0ae5a124fe ~]$ sqlplus /nolog\n\nSQL*Plus: Release 11.2.0.1.0 Production on һ 7 11:38:18 2022\n\nCopyright (c) 1982, 2009, Oracle.  All rights reserved.\n\nSQL> conn /as sysdba\nConnected.\nSQL> shutdown immediate\nDatabase closed.\nDatabase dismounted.\nORACLE instance shut down.\nSQL> STARTUP MOUNT\nORACLE instance started.\n\nTotal System Global Area 1603411968 bytes\nFixed Size                  2213776 bytes\nVariable Size             738199664 bytes\nDatabase Buffers          855638016 bytes\nRedo Buffers                7360512 bytes\nDatabase mounted.\nSQL> ALTER SYSTEM ENABLE RESTRICTED SESSION;\n\nSystem altered.\n\nSQL> ALTER SYSTEM SET JOB_QUEUE_PROCESSES=0;\n\nSystem altered.\n\nSQL> ALTER SYSTEM SET AQ_TM_PROCESSES=0;\n\nSystem altered.\n\nSQL> ALTER DATABASE OPEN;\n\nDatabase altered.\n\nSQL> ALTER DATABASE CHARACTER SET ZHS16GBK;\nALTER DATABASE CHARACTER SET ZHS16GBK\n*\nERROR at line 1:\nORA-12712: Ϊ\n若出现上面的错误，使用下面的办法进行修改，使用INTERNAL_USE可以跳过超集的检查：\n\nSQL> ALTER DATABASE CHARACTER SET INTERNAL_USE ZHS16GBK;\n\nDatabase altered.\n\nSQL> SHUTDOWN IMMEDIATE;\nDatabase closed.\nDatabase dismounted.\nORACLE instance shut down.\nSQL> STARTUP\nORACLE instance started.\n\nTotal System Global Area 1603411968 bytes\nFixed Size                  2213776 bytes\nVariable Size             738199664 bytes\nDatabase Buffers          855638016 bytes\nRedo Buffers                7360512 bytes\nDatabase mounted.\nDatabase opened.\n")])])]),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/shouhuxiancheng/article/details/82769040",target:"_blank",rel:"noopener noreferrer"}},[t._v("ORACLE如何修改字符集"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=s.exports}}]);