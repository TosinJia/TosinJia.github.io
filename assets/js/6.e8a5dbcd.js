(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{509:function(e,r,n){e.exports=n.p+"assets/img/docker-swarm-join_cluster.99bfce61.jpg"},510:function(e,r,n){e.exports=n.p+"assets/img/docker-swarm-nodes.ea66d63c.jpg"},511:function(e,r,n){e.exports=n.p+"assets/img/docker-swarm-Services_and_Tasks.a002d7e1.jpg"},512:function(e,r,n){e.exports=n.p+"assets/img/docker-swarm-Replicated_and_global_services.443ba9e4.jpg"},513:function(e,r,n){e.exports=n.p+"assets/img/docker-swarm-workflow.84d5a3cb.jpg"},514:function(e,r,n){e.exports=n.p+"assets/img/docker-swarm-overlay.2a030652.jpg"},515:function(e,r,n){e.exports=n.p+"assets/img/docker-compose_redis-cluster.de05e428.jpg"},516:function(e,r,n){e.exports=n.p+"assets/img/docker-bridge.fd1b94e9.jpg"},517:function(e,r,n){e.exports=n.p+"assets/img/docker-host.4d48fda5.jpg"},518:function(e,r,n){e.exports=n.p+"assets/img/docker-container.2d0d24ca.jpg"},964:function(e,r,n){"use strict";n.r(r);var a=n(56),t=Object(a.a)({},(function(){var e=this,r=e.$createElement,a=e._self._c||r;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[e._v("#")]),e._v(" Docker")]),e._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#docker"}},[e._v("Docker")]),a("ul",[a("li",[a("a",{attrs:{href:"#参考"}},[e._v("参考")]),a("ul",[a("li",[a("a",{attrs:{href:"#docker-hub"}},[e._v("Docker Hub")])])])]),a("li",[a("a",{attrs:{href:"#常见问题"}},[e._v("常见问题")]),a("ul",[a("li",[a("a",{attrs:{href:"#修改对外暴露的端口"}},[e._v("修改对外暴露的端口")])]),a("li",[a("a",{attrs:{href:"#bash-ping-command-not-found"}},[e._v("bash: ping: command not found")])])])]),a("li",[a("a",{attrs:{href:"#docker-toolbox"}},[e._v("Docker Toolbox")])]),a("li",[a("a",{attrs:{href:"#常用命令及参数"}},[e._v("常用命令及参数")]),a("ul",[a("li",[a("a",{attrs:{href:"#docker-镜像命令"}},[e._v("docker 镜像命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#检索"}},[e._v("检索")])]),a("li",[a("a",{attrs:{href:"#下载"}},[e._v("下载")])]),a("li",[a("a",{attrs:{href:"#列表"}},[e._v("列表")])]),a("li",[a("a",{attrs:{href:"#删除"}},[e._v("删除")])])])]),a("li",[a("a",{attrs:{href:"#docker-容器命令"}},[e._v("docker 容器命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#基本操作"}},[e._v("基本操作")])]),a("li",[a("a",{attrs:{href:"#列表"}},[e._v("列表")])]),a("li",[a("a",{attrs:{href:"#停止、启动"}},[e._v("停止、启动")])]),a("li",[a("a",{attrs:{href:"#端口映射-p"}},[e._v("端口映射\t-p")])]),a("li",[a("a",{attrs:{href:"#删除"}},[e._v("删除")])]),a("li",[a("a",{attrs:{href:"#日志"}},[e._v("日志")])]),a("li",[a("a",{attrs:{href:"#登录"}},[e._v("登录")])])])])])]),a("li",[a("a",{attrs:{href:"#demo"}},[e._v("demo")]),a("ul",[a("li",[a("a",{attrs:{href:"#安装docker"}},[e._v("安装docker")]),a("ul",[a("li",[a("a",{attrs:{href:"#centos7使用阿里yum源安装docker"}},[e._v("CentOS7使用阿里yum源安装Docker")])])])]),a("li",[a("a",{attrs:{href:"#oracle"}},[e._v("oracle")])]),a("li",[a("a",{attrs:{href:"#mysql"}},[e._v("mysql")])])])]),a("li",[a("a",{attrs:{href:"#docker入门到精通"}},[e._v("Docker入门到精通")]),a("ul",[a("li",[a("a",{attrs:{href:"#docker-swarm-集群环境搭建及弹性服务部署"}},[e._v("Docker Swarm 集群环境搭建及弹性服务部署")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-集群搭建"}},[e._v("1.0  集群搭建")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-1-环境准备"}},[e._v("1.1  环境准备")])]),a("li",[a("a",{attrs:{href:"#_1-2-机器分布"}},[e._v("1.2  机器分布")])]),a("li",[a("a",{attrs:{href:"#_1-3-创建集群"}},[e._v("1.3  创建集群")])]),a("li",[a("a",{attrs:{href:"#_1-4-加入集群"}},[e._v("1.4  加入集群")]),a("ul",[a("li",[a("a",{attrs:{href:"#manager"}},[e._v("Manager")])]),a("li",[a("a",{attrs:{href:"#workder"}},[e._v("Workder")])])])]),a("li",[a("a",{attrs:{href:"#_1-5-查看集群信息"}},[e._v("1.5  查看集群信息")])]),a("li",[a("a",{attrs:{href:"#_1-6-查看集群节点"}},[e._v("1.6  查看集群节点")])]),a("li",[a("a",{attrs:{href:"#_1-7-删除节点"}},[e._v("1.7  删除节点")]),a("ul",[a("li",[a("a",{attrs:{href:"#manager"}},[e._v("Manager")])]),a("li",[a("a",{attrs:{href:"#worker"}},[e._v("Worker")])])])])])]),a("li",[a("a",{attrs:{href:"#_2-0-服务部署"}},[e._v("2.0  服务部署")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-创建服务"}},[e._v("2.1  创建服务")])]),a("li",[a("a",{attrs:{href:"#_2-2-查看服务"}},[e._v("2.2  查看服务")])]),a("li",[a("a",{attrs:{href:"#_2-3-调用服务"}},[e._v("2.3  调用服务")])]),a("li",[a("a",{attrs:{href:"#_2-4-弹性服务"}},[e._v("2.4  弹性服务")])]),a("li",[a("a",{attrs:{href:"#_2-5-删除服务"}},[e._v("2.5  删除服务")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-滚动更新及回滚"}},[e._v("3.0  滚动更新及回滚")])]),a("li",[a("a",{attrs:{href:"#_4-0-常用命令"}},[e._v("4.0  常用命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#_4-1-docker-swarm-help"}},[e._v("4.1  docker swarm [--help]")])]),a("li",[a("a",{attrs:{href:"#_4-2-docker-node-help"}},[e._v("4.2  docker node [--help]")])]),a("li",[a("a",{attrs:{href:"#_4-3-docker-service-help"}},[e._v("4.3  docker service [--help]")])])])]),a("li",[a("a",{attrs:{href:"#_5-0-参考资料"}},[e._v("5.0  参考资料")])])])]),a("li",[a("a",{attrs:{href:"#docker-swarm-集群管理利器核心概念扫盲"}},[e._v("Docker Swarm 集群管理利器核心概念扫盲")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-swarm-简介"}},[e._v("1.0 Swarm 简介")])]),a("li",[a("a",{attrs:{href:"#_2-0-swarm-核心概念"}},[e._v("2.0 Swarm 核心概念")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-swarm"}},[e._v("2.1  Swarm")])]),a("li",[a("a",{attrs:{href:"#_2-2-nodes"}},[e._v("2.2  Nodes")])]),a("li",[a("a",{attrs:{href:"#_2-3-services-and-tasks"}},[e._v("2.3  Services and Tasks")])]),a("li",[a("a",{attrs:{href:"#_2-4-replicated-and-global-services"}},[e._v("2.4  Replicated and global services")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-swarm-工作流程"}},[e._v("3.0  Swarm 工作流程")])]),a("li",[a("a",{attrs:{href:"#_4-0-overlay-网络"}},[e._v("4.0  Overlay 网络")])]),a("li",[a("a",{attrs:{href:"#_5-0-参考资料"}},[e._v("5.0  参考资料")])])])]),a("li",[a("a",{attrs:{href:"#docker-compose-搭建-redis-cluster-集群环境"}},[e._v("Docker Compose 搭建 Redis Cluster 集群环境")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-环境"}},[e._v("1.0  环境")])]),a("li",[a("a",{attrs:{href:"#_2-0-搭建"}},[e._v("2.0  搭建")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-编写-redis-配置文件"}},[e._v("2.1  编写 Redis 配置文件")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建目录及文件"}},[e._v("创建目录及文件")])]),a("li",[a("a",{attrs:{href:"#编写配置文件"}},[e._v("编写配置文件")])])])]),a("li",[a("a",{attrs:{href:"#_2-2-编写-docker-compose-模板文件"}},[e._v("2.2  编写 Docker Compose 模板文件")])]),a("li",[a("a",{attrs:{href:"#_2-3-创建并启动所有服务容器"}},[e._v("2.3  创建并启动所有服务容器")])]),a("li",[a("a",{attrs:{href:"#_2-4-创建-redis-cluster-集群"}},[e._v("2.4  创建 Redis Cluster 集群")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-查看集群状态"}},[e._v("3.0  查看集群状态")]),a("ul",[a("li",[a("a",{attrs:{href:"#_3-1-检查集群状态"}},[e._v("3.1  检查集群状态")])]),a("li",[a("a",{attrs:{href:"#_3-2-查看集群信息和节点信息"}},[e._v("3.2  查看集群信息和节点信息")])]),a("li",[a("a",{attrs:{href:"#_3-3-set-get"}},[e._v("3.3  SET/GET")])])])]),a("li",[a("a",{attrs:{href:"#_4-0-客户端连接"}},[e._v("4.0  客户端连接")])])])]),a("li",[a("a",{attrs:{href:"#_13-docker-容器编排利器-docker-compose"}},[e._v("13 Docker 容器编排利器 Docker Compose")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-compose-简介"}},[e._v("1.0  Compose 简介")])]),a("li",[a("a",{attrs:{href:"#_2-0-compose-安装"}},[e._v("2.0  Compose 安装")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-下载"}},[e._v("2.1  下载")])]),a("li",[a("a",{attrs:{href:"#_2-2-授权"}},[e._v("2.2  授权")])]),a("li",[a("a",{attrs:{href:"#_2-3-测试"}},[e._v("2.3  测试")])]),a("li",[a("a",{attrs:{href:"#_2-4-卸载"}},[e._v("2.4  卸载")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-docker-compose-yml-文件详解"}},[e._v("3.0  docker-compose.yml 文件详解")]),a("ul",[a("li",[a("a",{attrs:{href:"#_3-1-概念"}},[e._v("3.1  概念")])]),a("li",[a("a",{attrs:{href:"#_3-2-案例"}},[e._v("3.2  案例")])]),a("li",[a("a",{attrs:{href:"#_3-3-version"}},[e._v("3.3  version")])]),a("li",[a("a",{attrs:{href:"#_3-4-services"}},[e._v("3.4  services")]),a("ul",[a("li",[a("a",{attrs:{href:"#image"}},[e._v("image")])]),a("li",[a("a",{attrs:{href:"#build"}},[e._v("build")])]),a("li",[a("a",{attrs:{href:"#context"}},[e._v("context")])]),a("li",[a("a",{attrs:{href:"#dockerfile"}},[e._v("dockerfile")])]),a("li",[a("a",{attrs:{href:"#container-name"}},[e._v("container_name")])]),a("li",[a("a",{attrs:{href:"#关于序号"}},[e._v("关于序号")])]),a("li",[a("a",{attrs:{href:"#depends-on"}},[e._v("depends_on")])]),a("li",[a("a",{attrs:{href:"#ports"}},[e._v("ports")])]),a("li",[a("a",{attrs:{href:"#expose"}},[e._v("expose")])]),a("li",[a("a",{attrs:{href:"#restart"}},[e._v("restart")])]),a("li",[a("a",{attrs:{href:"#environment"}},[e._v("environment")])]),a("li",[a("a",{attrs:{href:"#env-file"}},[e._v("env_file")])]),a("li",[a("a",{attrs:{href:"#command"}},[e._v("command")])]),a("li",[a("a",{attrs:{href:"#volumes"}},[e._v("volumes")])]),a("li",[a("a",{attrs:{href:"#network-mode"}},[e._v("network_mode")])]),a("li",[a("a",{attrs:{href:"#networks"}},[e._v("networks")])]),a("li",[a("a",{attrs:{href:"#aliases"}},[e._v("aliases")])]),a("li",[a("a",{attrs:{href:"#links"}},[e._v("links")])])])]),a("li",[a("a",{attrs:{href:"#_3-5-volumes"}},[e._v("3.5  volumes")])]),a("li",[a("a",{attrs:{href:"#_3-6-networks"}},[e._v("3.6  networks")])])])]),a("li",[a("a",{attrs:{href:"#_4-0-compose-常用命令"}},[e._v("4.0  Compose 常用命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#_4-1-help"}},[e._v("4.1  help")])]),a("li",[a("a",{attrs:{href:"#_4-2-config"}},[e._v("4.2  config")])]),a("li",[a("a",{attrs:{href:"#_4-3-pull"}},[e._v("4.3  pull")])]),a("li",[a("a",{attrs:{href:"#_4-4-up"}},[e._v("4.4  up")])]),a("li",[a("a",{attrs:{href:"#_4-5-logs"}},[e._v("4.5  logs")])]),a("li",[a("a",{attrs:{href:"#_4-6-ps"}},[e._v("4.6  ps")])]),a("li",[a("a",{attrs:{href:"#_4-7-run"}},[e._v("4.7  run")])]),a("li",[a("a",{attrs:{href:"#_4-8-exec"}},[e._v("4.8  exec")])]),a("li",[a("a",{attrs:{href:"#_4-9-pause"}},[e._v("4.9  pause")])]),a("li",[a("a",{attrs:{href:"#_4-10-unpause"}},[e._v("4.10  unpause")])]),a("li",[a("a",{attrs:{href:"#_4-11-restart"}},[e._v("4.11  restart")])]),a("li",[a("a",{attrs:{href:"#_4-12-start"}},[e._v("4.12  start")])]),a("li",[a("a",{attrs:{href:"#_4-13-stop"}},[e._v("4.13  stop")])]),a("li",[a("a",{attrs:{href:"#_4-14-kill"}},[e._v("4.14  kill")])]),a("li",[a("a",{attrs:{href:"#_4-15-rm"}},[e._v("4.15  rm")])]),a("li",[a("a",{attrs:{href:"#_4-16-down"}},[e._v("4.16  down")])]),a("li",[a("a",{attrs:{href:"#_4-17-create"}},[e._v("4.17  create")])]),a("li",[a("a",{attrs:{href:"#_4-18-scale"}},[e._v("4.18  scale")])]),a("li",[a("a",{attrs:{href:"#_4-19-images"}},[e._v("4.19  images")])]),a("li",[a("a",{attrs:{href:"#_4-20-port"}},[e._v("4.20  port")])]),a("li",[a("a",{attrs:{href:"#_4-21-top"}},[e._v("4.21  top")])])])]),a("li",[a("a",{attrs:{href:"#_5-0-总结"}},[e._v("5.0  总结")])]),a("li",[a("a",{attrs:{href:"#_6-0-参考资料"}},[e._v("6.0  参考资料")])]),a("li",[a("a",{attrs:{href:"#参考资料"}},[e._v("参考资料")])])])]),a("li",[a("a",{attrs:{href:"#docker-搭建-redis-cluster-集群环境"}},[e._v("Docker 搭建 Redis Cluster 集群环境")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-环境"}},[e._v("1.0  环境")])]),a("li",[a("a",{attrs:{href:"#_2-0-搭建"}},[e._v("2.0  搭建")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-编写-redis-配置文件"}},[e._v("2.1  编写 Redis 配置文件")])]),a("li",[a("a",{attrs:{href:"#_2-2-创建-redis-容器"}},[e._v("2.2  创建 Redis 容器")])]),a("li",[a("a",{attrs:{href:"#_2-3-创建-redis-cluster-集群"}},[e._v("2.3  创建 Redis Cluster 集群")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-查看集群状态"}},[e._v("3.0  查看集群状态")]),a("ul",[a("li",[a("a",{attrs:{href:"#_3-1-检查集群状态"}},[e._v("3.1  检查集群状态")])]),a("li",[a("a",{attrs:{href:"#_3-2-查看集群信息和节点信息"}},[e._v("3.2  查看集群信息和节点信息")])]),a("li",[a("a",{attrs:{href:"#_3-3-set-get"}},[e._v("3.3  SET/GET")])])])]),a("li",[a("a",{attrs:{href:"#_4-0-客户端连接"}},[e._v("4.0  客户端连接")])])])]),a("li",[a("a",{attrs:{href:"#_11-docker-网络模式详解及容器间网络通信"}},[e._v("11 Docker 网络模式详解及容器间网络通信")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-默认网络"}},[e._v("1.0  默认网络")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-1-bridge-网络模式"}},[e._v("1.1  bridge 网络模式")])]),a("li",[a("a",{attrs:{href:"#_1-2-host-网络模式"}},[e._v("1.2  host 网络模式")])]),a("li",[a("a",{attrs:{href:"#_1-3-none-网络模式"}},[e._v("1.3  none 网络模式")])]),a("li",[a("a",{attrs:{href:"#_1-4-container-网络模式"}},[e._v("1.4  container 网络模式")])]),a("li",[a("a",{attrs:{href:"#_1-5-link"}},[e._v("1.5  link")])])])]),a("li",[a("a",{attrs:{href:"#_2-0-自定义网络"}},[e._v("2.0  自定义网络")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-创建网络"}},[e._v("2.1  创建网络")])]),a("li",[a("a",{attrs:{href:"#_2-2-连接网络"}},[e._v("2.2  连接网络")])]),a("li",[a("a",{attrs:{href:"#_2-3-断开网络"}},[e._v("2.3  断开网络")])]),a("li",[a("a",{attrs:{href:"#_2-4-移除网络"}},[e._v("2.4  移除网络")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-容器间网络通信"}},[e._v("3.0  容器间网络通信")])])])]),a("li",[a("a",{attrs:{href:"#_10-docker-私有镜像仓库的搭建及认证"}},[e._v("10 Docker 私有镜像仓库的搭建及认证")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-拉取私有仓库镜像"}},[e._v("1.0 拉取私有仓库镜像")])]),a("li",[a("a",{attrs:{href:"#_2-0-修改配置"}},[e._v("2.0 修改配置")])]),a("li",[a("a",{attrs:{href:"#_3-0-创建私有仓库容器"}},[e._v("3.0 创建私有仓库容器")])]),a("li",[a("a",{attrs:{href:"#_4-0-推送镜像至私有仓库"}},[e._v("4.0 推送镜像至私有仓库")])]),a("li",[a("a",{attrs:{href:"#_5-0-配置私有仓库认证"}},[e._v("5.0 配置私有仓库认证")]),a("ul",[a("li",[a("a",{attrs:{href:"#_5-1-生成自签名证书"}},[e._v("5.1  生成自签名证书")])]),a("li",[a("a",{attrs:{href:"#_5-2-生成鉴权密码文件"}},[e._v("5.2  生成鉴权密码文件")])]),a("li",[a("a",{attrs:{href:"#_5-3-创建私有仓库容器"}},[e._v("5.3  创建私有仓库容器")])]),a("li",[a("a",{attrs:{href:"#_5-4-推送镜像至私有仓库失败"}},[e._v("5.4  推送镜像至私有仓库失败")])]),a("li",[a("a",{attrs:{href:"#_5-5-登录账号"}},[e._v("5.5  登录账号")])]),a("li",[a("a",{attrs:{href:"#_5-6-推送镜像至私有仓库成功"}},[e._v("5.6  推送镜像至私有仓库成功")])]),a("li",[a("a",{attrs:{href:"#_5-7-退出账号"}},[e._v("5.7  退出账号")])])])])])]),a("li",[a("a",{attrs:{href:"#_9-dockerhub-镜像仓库的使用"}},[e._v("9 DockerHub 镜像仓库的使用")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-注册账户"}},[e._v("1.0 注册账户")])]),a("li",[a("a",{attrs:{href:"#_2-0-登录账户"}},[e._v("2.0 登录账户")])]),a("li",[a("a",{attrs:{href:"#_3-0-推送镜像至仓库"}},[e._v("3.0 推送镜像至仓库")])]),a("li",[a("a",{attrs:{href:"#_4-0-查看仓库"}},[e._v("4.0 查看仓库")])]),a("li",[a("a",{attrs:{href:"#_5-0-拉取镜像"}},[e._v("5.0 拉取镜像")])]),a("li",[a("a",{attrs:{href:"#_6-0-退出账号"}},[e._v("6.0 退出账号")])])])]),a("li",[a("a",{attrs:{href:"#docker-镜像的备份恢复迁移"}},[e._v("Docker 镜像的备份恢复迁移")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-镜像备份"}},[e._v("1.0  镜像备份")])]),a("li",[a("a",{attrs:{href:"#_2-0-镜像恢复"}},[e._v("2.0  镜像恢复")])]),a("li",[a("a",{attrs:{href:"#_3-0-镜像迁移"}},[e._v("3.0  镜像迁移")])])])]),a("li",[a("a",{attrs:{href:"#七-docker-镜像构建之-dockerfile"}},[e._v("七 Docker 镜像构建之 Dockerfile")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-dockerfile-常用指令"}},[e._v("1.0  Dockerfile 常用指令")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-1-from"}},[e._v("1.1  FROM")])]),a("li",[a("a",{attrs:{href:"#_1-2-maintainer-deprecated"}},[e._v("~~1.2  MAINTAINER(deprecated)~~")])]),a("li",[a("a",{attrs:{href:"#_1-3-label"}},[e._v("1.3  LABEL")])]),a("li",[a("a",{attrs:{href:"#_1-4-run"}},[e._v("1.4  RUN")])]),a("li",[a("a",{attrs:{href:"#_1-5-add"}},[e._v("1.5  ADD")])]),a("li",[a("a",{attrs:{href:"#_1-6-copy"}},[e._v("1.6  COPY")])]),a("li",[a("a",{attrs:{href:"#_1-7-expose"}},[e._v("1.7  EXPOSE")])]),a("li",[a("a",{attrs:{href:"#_1-8-env"}},[e._v("1.8  ENV")])]),a("li",[a("a",{attrs:{href:"#_1-9-cmd"}},[e._v("1.9  CMD")])]),a("li",[a("a",{attrs:{href:"#_1-10-entrypoint"}},[e._v("1.10  ENTRYPOINT")])]),a("li",[a("a",{attrs:{href:"#_1-11-workdir"}},[e._v("1.11  WORKDIR")])]),a("li",[a("a",{attrs:{href:"#_1-12-volume"}},[e._v("1.12  VOLUME")])])])]),a("li",[a("a",{attrs:{href:"#_2-0-构建镜像"}},[e._v("2.0  构建镜像")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-关于-理解"}},[e._v("2.1  关于 . 理解")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-dockerfile-实践"}},[e._v("3.0  Dockerfile 实践")]),a("ul",[a("li",[a("a",{attrs:{href:"#java服务"}},[e._v("java服务")])])])]),a("li",[a("a",{attrs:{href:"#_4-0-镜像构建历史"}},[e._v("4.0  镜像构建历史")])]),a("li",[a("a",{attrs:{href:"#_5-0-使用构建的镜像创建容器"}},[e._v("5.0  使用构建的镜像创建容器")])])])]),a("li",[a("a",{attrs:{href:"#六-docker-镜像构建之-docker-commit"}},[e._v("六 Docker 镜像构建之 docker commit")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-创建容器"}},[e._v("1.0  创建容器")])]),a("li",[a("a",{attrs:{href:"#_2-0-拷贝资源"}},[e._v("2.0  拷贝资源")])]),a("li",[a("a",{attrs:{href:"#_3-0-安装资源"}},[e._v("3.0  安装资源")])]),a("li",[a("a",{attrs:{href:"#_4-0-构建镜像"}},[e._v("4.0  构建镜像")])]),a("li",[a("a",{attrs:{href:"#_5-0-使用构建的镜像创建容器"}},[e._v("5.0  使用构建的镜像创建容器")])])])]),a("li",[a("a",{attrs:{href:"#五-docker-之常见应用部署"}},[e._v("五 Docker 之常见应用部署")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-tomcat"}},[e._v("1.0  Tomcat")])]),a("li",[a("a",{attrs:{href:"#_2-0-nginx"}},[e._v("2.0  Nginx")])]),a("li",[a("a",{attrs:{href:"#_3-0-mysql"}},[e._v("3.0  MySQL")]),a("ul",[a("li",[a("a",{attrs:{href:"#修改配置"}},[e._v("修改配置")])]),a("li",[a("a",{attrs:{href:"#创建容器2"}},[e._v("创建容器2")])])])]),a("li",[a("a",{attrs:{href:"#_4-0-redis"}},[e._v("4.0  Redis")]),a("ul",[a("li",[a("a",{attrs:{href:"#方式一"}},[e._v("方式一")])]),a("li",[a("a",{attrs:{href:"#方式二"}},[e._v("方式二")])])])]),a("li",[a("a",{attrs:{href:"#_5-0-mongodb"}},[e._v("5.0  MongoDB")]),a("ul",[a("li",[a("a",{attrs:{href:"#mongo-4-4"}},[e._v("mongo:4.4")])]),a("li",[a("a",{attrs:{href:"#mongodb-compass"}},[e._v("MongoDB Compass")])])])]),a("li",[a("a",{attrs:{href:"#_6-0-elasticsearch"}},[e._v("6.0  Elasticsearch")])]),a("li",[a("a",{attrs:{href:"#_7-0-solr"}},[e._v("7.0  Solr")])]),a("li",[a("a",{attrs:{href:"#_8-0-rabbitmq"}},[e._v("8.0  RabbitMQ")]),a("ul",[a("li",[a("a",{attrs:{href:"#rabbitmq-3-management"}},[e._v("rabbitmq:3-management")])])])]),a("li",[a("a",{attrs:{href:"#gitlab"}},[e._v("GitLab")]),a("ul",[a("li",[a("a",{attrs:{href:"#gitlab-gitlab-ce"}},[e._v("gitlab/gitlab-ce")])]),a("li",[a("a",{attrs:{href:"#gitlab-gitlab-ee"}},[e._v("gitlab/gitlab-ee")]),a("ul",[a("li",[a("a",{attrs:{href:"#默认密码"}},[e._v("默认密码")])]),a("li",[a("a",{attrs:{href:"#头像问题"}},[e._v("头像问题")])]),a("li",[a("a",{attrs:{href:"#升级"}},[e._v("升级")])])])])])]),a("li",[a("a",{attrs:{href:"#wiznote"}},[e._v("wiznote")])]),a("li",[a("a",{attrs:{href:"#leanote"}},[e._v("leanote")])]),a("li",[a("a",{attrs:{href:"#oracle"}},[e._v("oracle")])]),a("li",[a("a",{attrs:{href:"#zabbix"}},[e._v("Zabbix")]),a("ul",[a("li",[a("a",{attrs:{href:"#简介"}},[e._v("简介")])]),a("li",[a("a",{attrs:{href:"#方式二"}},[e._v("方式二")]),a("ul",[a("li",[a("a",{attrs:{href:"#下载镜像"}},[e._v("下载镜像")])]),a("li",[a("a",{attrs:{href:"#运行镜像"}},[e._v("运行镜像")])]),a("li",[a("a",{attrs:{href:"#通过docker-compose一键安装zabbix"}},[e._v("通过docker-compose一键安装zabbix")])])])]),a("li",[a("a",{attrs:{href:"#方式一"}},[e._v("方式一")]),a("ul",[a("li",[a("a",{attrs:{href:"#下载镜像"}},[e._v("下载镜像")])]),a("li",[a("a",{attrs:{href:"#运行镜像"}},[e._v("运行镜像")])])])])])]),a("li",[a("a",{attrs:{href:"#minio"}},[e._v("MinIO")])]),a("li",[a("a",{attrs:{href:"#fastdfs"}},[e._v("FastDFS")]),a("ul",[a("li",[a("a",{attrs:{href:"#参考"}},[e._v("参考")])]),a("li",[a("a",{attrs:{href:"#环境"}},[e._v("环境")])]),a("li",[a("a",{attrs:{href:"#安装"}},[e._v("安装")]),a("ul",[a("li",[a("a",{attrs:{href:"#虚拟主机"}},[e._v("虚拟主机")])]),a("li",[a("a",{attrs:{href:"#进入storage容器"}},[e._v("进入storage容器")])]),a("li",[a("a",{attrs:{href:"#虚拟主机"}},[e._v("虚拟主机")])]),a("li",[a("a",{attrs:{href:"#代码验证"}},[e._v("代码验证")])]),a("li",[a("a",{attrs:{href:"#问题处理"}},[e._v("问题处理")])])])]),a("li",[a("a",{attrs:{href:"#卸载"}},[e._v("卸载")])])])]),a("li",[a("a",{attrs:{href:"#maven私服"}},[e._v("Maven私服")])])])]),a("li",[a("a",{attrs:{href:"#四-docker-最常用的镜像命令和容器命令"}},[e._v("四 Docker 最常用的镜像命令和容器命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-镜像相关命令"}},[e._v("1 镜像相关命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-1-查看镜像"}},[e._v("1.1 查看镜像")])]),a("li",[a("a",{attrs:{href:"#_1-2-搜索镜像"}},[e._v("1.2 搜索镜像")])]),a("li",[a("a",{attrs:{href:"#_1-3-拉取镜像"}},[e._v("1.3 拉取镜像")])]),a("li",[a("a",{attrs:{href:"#_1-4-删除镜像"}},[e._v("1.4 删除镜像")])])])]),a("li",[a("a",{attrs:{href:"#_2-容器相关命令"}},[e._v("2 容器相关命令")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-1-查看容器"}},[e._v("2.1 查看容器")]),a("ul",[a("li",[a("a",{attrs:{href:"#查看正在运行的容器"}},[e._v("查看正在运行的容器")])]),a("li",[a("a",{attrs:{href:"#查看停止的容器"}},[e._v("查看停止的容器")])]),a("li",[a("a",{attrs:{href:"#查看所有容器-包括运行和停止"}},[e._v("查看所有容器（包括运行和停止）")])]),a("li",[a("a",{attrs:{href:"#查看最后一次运行的容器"}},[e._v("查看最后一次运行的容器")])])])]),a("li",[a("a",{attrs:{href:"#_2-2-创建与启动容器"}},[e._v("2.2 创建与启动容器")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建并进入容器"}},[e._v("创建并进入容器")])]),a("li",[a("a",{attrs:{href:"#守护式方式创建容器"}},[e._v("守护式方式创建容器")])])])]),a("li",[a("a",{attrs:{href:"#_2-3-停止与启动容器"}},[e._v("2.3 停止与启动容器")])]),a("li",[a("a",{attrs:{href:"#_2-4-文件拷贝"}},[e._v("2.4 文件拷贝")])]),a("li",[a("a",{attrs:{href:"#_2-5-目录挂载-容器数据卷操作"}},[e._v("2.5 目录挂载（容器数据卷操作）")]),a("ul",[a("li",[a("a",{attrs:{href:"#匿名挂载"}},[e._v("匿名挂载")])]),a("li",[a("a",{attrs:{href:"#具名挂载"}},[e._v("具名挂载")])]),a("li",[a("a",{attrs:{href:"#指定目录挂载"}},[e._v("指定目录挂载")])]),a("li",[a("a",{attrs:{href:"#查看目录挂载关系"}},[e._v("查看目录挂载关系")])]),a("li",[a("a",{attrs:{href:"#只读-读写"}},[e._v("只读/读写")])]),a("li",[a("a",{attrs:{href:"#volumes-from-继承"}},[e._v("volumes-from（继承）")])])])]),a("li",[a("a",{attrs:{href:"#_2-6-查看容器-ip-地址"}},[e._v("2.6 查看容器 IP 地址")])]),a("li",[a("a",{attrs:{href:"#_2-7-删除容器"}},[e._v("2.7 删除容器")])])])])])]),a("li",[a("a",{attrs:{href:"#二-docker-架构及工作原理"}},[e._v("二 Docker 架构及工作原理")]),a("ul",[a("li",[a("a",{attrs:{href:"#_5-0-镜像分层"}},[e._v("5.0 镜像分层")])]),a("li",[a("a",{attrs:{href:"#_7-0-注册中心"}},[e._v("7.0 注册中心")])])])]),a("li",[a("a",{attrs:{href:"#三-docker-安装及配置镜像加速"}},[e._v("三 Docker 安装及配置镜像加速")]),a("ul",[a("li",[a("a",{attrs:{href:"#_1-0-docker-版本"}},[e._v("1.0 Docker 版本")])]),a("li",[a("a",{attrs:{href:"#_2-0-在-centos-上安装-docker-引擎"}},[e._v("2.0 在 CentOS 上安装 Docker 引擎")]),a("ul",[a("li",[a("a",{attrs:{href:"#_2-5-docker的启动与停止"}},[e._v("2.5 Docker的启动与停止")])]),a("li",[a("a",{attrs:{href:"#_2-6-安装验证"}},[e._v("2.6 安装验证")])])])]),a("li",[a("a",{attrs:{href:"#_3-0-配置镜像加速"}},[e._v("3.0 配置镜像加速")])]),a("li",[a("a",{attrs:{href:"#_4-0-hello-world"}},[e._v("4.0 hello-world")])])])]),a("li",[a("a",{attrs:{href:"#修改docker默认镜像和容器存储位置"}},[e._v("修改Docker默认镜像和容器存储位置")])])])])])])])]),a("p"),e._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("https://www.docker.com/")]),e._v(" "),a("ul",[a("li",[e._v("https://docs.docker.com/\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker (base command)"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("https://docs.docker.com/engine/reference/commandline/cli/")]),e._v(" "),a("li",[e._v("https://docs.docker.com/engine/reference/commandline/run/")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/update/",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker update"),a("OutboundLink")],1)])])])])]),e._v(" "),a("li",[a("p",[e._v("中文参考")]),e._v(" "),a("ul",[a("li",[e._v("http://www.runoob.com/docker/docker-command-manual.html")])])]),e._v(" "),a("li",[a("p",[e._v("Docker Toolbox")]),e._v(" "),a("ul",[a("li",[e._v("https://www.docker.com/products/docker-toolbox")])])])]),e._v(" "),a("h3",{attrs:{id:"docker-hub"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub"}},[e._v("#")]),e._v(" Docker Hub")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("https://docs.docker.com/reference/")])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Hub"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://hub.docker.com/_/centos",target:"_blank",rel:"noopener noreferrer"}},[e._v("centos"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("https://hub.docker.com/_/nginx")]),e._v(" "),a("li",[e._v("https://hub.docker.com/_/redis")]),e._v(" "),a("li",[e._v("https://hub.docker.com/_/tomcat")]),e._v(" "),a("li",[e._v("https://hub.docker.com/_/mysql")]),e._v(" "),a("li",[e._v("https://hub.docker.com/_/rabbitmq")]),e._v(" "),a("li",[e._v("云笔记\n"),a("ul",[a("li",[e._v("https://hub.docker.com/r/wiznote/wizserver")]),e._v(" "),a("li",[e._v("https://hub.docker.com/r/leanote/leanote")])])])])])]),e._v(" "),a("h2",{attrs:{id:"常见问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[e._v("#")]),e._v(" 常见问题")]),e._v(" "),a("h3",{attrs:{id:"修改对外暴露的端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改对外暴露的端口"}},[e._v("#")]),e._v(" 修改对外暴露的端口")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_43865008/article/details/122111611",target:"_blank",rel:"noopener noreferrer"}},[e._v("教你如何修改运行中的docker容器的端口映射的三种方式"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@SystemFramework ~]# docker run -di --name iredis-u -p 6379:6379 -p 6378:6379 -p 6377:6379 redis\nb0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e\n[root@SystemFramework ~]# docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                                                                                                                             NAMES\nb0d6ad82ddb6   redis     "docker-entrypoint.s…"   5 seconds ago   Up 3 seconds   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp, 0.0.0.0:6377->6379/tcp, 0.0.0.0:6378->6379/tcp, :::6377->6379/tcp, :::6378->6379/tcp   iredis-u\n[root@SystemFramework ~]# docker inspect iredis-u\n[\n    {\n        "Id": "b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e",\n        "Created": "2022-07-26T03:52:19.941484646Z",\n        "Path": "docker-entrypoint.sh",\n        "Args": [\n            "redis-server"\n        ],\n        "State": {\n            "Status": "running",\n            "Running": true,\n            "Paused": false,\n            "Restarting": false,\n            "OOMKilled": false,\n            "Dead": false,\n            "Pid": 3143,\n            "ExitCode": 0,\n            "Error": "",\n            "StartedAt": "2022-07-26T03:52:20.671954015Z",\n            "FinishedAt": "0001-01-01T00:00:00Z"\n        },\n        "Image": "sha256:7614ae9453d1d87e740a2056257a6de7135c84037c367e1fffa92ae922784631",\n        "ResolvConfPath": "/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/resolv.conf",\n        "HostnamePath": "/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/hostname",\n        "HostsPath": "/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/hosts",\n        "LogPath": "/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e-json.log",\n        "Name": "/iredis-u",\n        "RestartCount": 0,\n        "Driver": "overlay2",\n        "Platform": "linux",\n        "MountLabel": "",\n        "ProcessLabel": "",\n        "AppArmorProfile": "",\n        "ExecIDs": null,\n        "HostConfig": {\n            "Binds": null,\n            "ContainerIDFile": "",\n            "LogConfig": {\n                "Type": "json-file",\n                "Config": {}\n            },\n            "NetworkMode": "default",\n            "PortBindings": {\n                "6379/tcp": [\n                    {\n                        "HostIp": "",\n                        "HostPort": "6379"\n                    },\n                    {\n                        "HostIp": "",\n                        "HostPort": "6378"\n                    },\n                    {\n                        "HostIp": "",\n                        "HostPort": "6377"\n                    }\n                ]\n            },\n            "RestartPolicy": {\n                "Name": "no",\n                "MaximumRetryCount": 0\n            },\n            "AutoRemove": false,\n            "VolumeDriver": "",\n            "VolumesFrom": null,\n            "CapAdd": null,\n            "CapDrop": null,\n            "CgroupnsMode": "host",\n            "Dns": [],\n            "DnsOptions": [],\n            "DnsSearch": [],\n            "ExtraHosts": null,\n            "GroupAdd": null,\n            "IpcMode": "private",\n            "Cgroup": "",\n            "Links": null,\n            "OomScoreAdj": 0,\n            "PidMode": "",\n            "Privileged": false,\n            "PublishAllPorts": false,\n            "ReadonlyRootfs": false,\n            "SecurityOpt": null,\n            "UTSMode": "",\n            "UsernsMode": "",\n            "ShmSize": 67108864,\n            "Runtime": "runc",\n            "ConsoleSize": [\n                0,\n                0\n            ],\n            "Isolation": "",\n            "CpuShares": 0,\n            "Memory": 0,\n            "NanoCpus": 0,\n            "CgroupParent": "",\n            "BlkioWeight": 0,\n            "BlkioWeightDevice": [],\n            "BlkioDeviceReadBps": null,\n            "BlkioDeviceWriteBps": null,\n            "BlkioDeviceReadIOps": null,\n            "BlkioDeviceWriteIOps": null,\n            "CpuPeriod": 0,\n            "CpuQuota": 0,\n            "CpuRealtimePeriod": 0,\n            "CpuRealtimeRuntime": 0,\n            "CpusetCpus": "",\n            "CpusetMems": "",\n            "Devices": [],\n            "DeviceCgroupRules": null,\n            "DeviceRequests": null,\n            "KernelMemory": 0,\n            "KernelMemoryTCP": 0,\n            "MemoryReservation": 0,\n            "MemorySwap": 0,\n            "MemorySwappiness": null,\n            "OomKillDisable": false,\n            "PidsLimit": null,\n            "Ulimits": null,\n            "CpuCount": 0,\n            "CpuPercent": 0,\n            "IOMaximumIOps": 0,\n            "IOMaximumBandwidth": 0,\n            "MaskedPaths": [\n                "/proc/asound",\n                "/proc/acpi",\n                "/proc/kcore",\n                "/proc/keys",\n                "/proc/latency_stats",\n                "/proc/timer_list",\n                "/proc/timer_stats",\n                "/proc/sched_debug",\n                "/proc/scsi",\n                "/sys/firmware"\n            ],\n            "ReadonlyPaths": [\n                "/proc/bus",\n                "/proc/fs",\n                "/proc/irq",\n                "/proc/sys",\n                "/proc/sysrq-trigger"\n            ]\n        },\n        "GraphDriver": {\n            "Data": {\n                "LowerDir": "/var/lib/docker/overlay2/87b89f733306a673e4084c60ab9d77f6521920157b4e0c644f2042385017eb7f-init/diff:/var/lib/docker/overlay2/d38475fe4fff0efa6a742393d15657b15412b38c364d983b6ab93f87d6d0c17d/diff:/var/lib/docker/overlay2/e212a716fdfe0c61f323cf56da4270c57a7a35a4cd88d9c36fcc4dd7530ed546/diff:/var/lib/docker/overlay2/5bfa01d84a5b825a25dc5388852aba37143f5879fd1795b741bad3c35473d6de/diff:/var/lib/docker/overlay2/c9f70de67f3844264bf87fa249c74a3aefc1f1b48e539db465a5beb05b8035e3/diff:/var/lib/docker/overlay2/088897e90c21f9b7cdb3d22a4029f0d7191a95d39bc2278c4ea4c46e569ee906/diff:/var/lib/docker/overlay2/7ae25d5fd9fdc240277757acaf80374de4c240c13d01fcb5fd2f2818eaea5a18/diff",\n                "MergedDir": "/var/lib/docker/overlay2/87b89f733306a673e4084c60ab9d77f6521920157b4e0c644f2042385017eb7f/merged",\n                "UpperDir": "/var/lib/docker/overlay2/87b89f733306a673e4084c60ab9d77f6521920157b4e0c644f2042385017eb7f/diff",\n                "WorkDir": "/var/lib/docker/overlay2/87b89f733306a673e4084c60ab9d77f6521920157b4e0c644f2042385017eb7f/work"\n            },\n            "Name": "overlay2"\n        },\n        "Mounts": [\n            {\n                "Type": "volume",\n                "Name": "c43062a61838c8d1000078d4c31a61797176cc8f69e4539d9822b370f53365f2",\n                "Source": "/var/lib/docker/volumes/c43062a61838c8d1000078d4c31a61797176cc8f69e4539d9822b370f53365f2/_data",\n                "Destination": "/data",\n                "Driver": "local",\n                "Mode": "",\n                "RW": true,\n                "Propagation": ""\n            }\n        ],\n        "Config": {\n            "Hostname": "b0d6ad82ddb6",\n            "Domainname": "",\n            "User": "",\n            "AttachStdin": false,\n            "AttachStdout": false,\n            "AttachStderr": false,\n            "ExposedPorts": {\n                "6379/tcp": {}\n            },\n            "Tty": false,\n            "OpenStdin": true,\n            "StdinOnce": false,\n            "Env": [\n                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",\n                "GOSU_VERSION=1.12",\n                "REDIS_VERSION=6.2.6",\n                "REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.2.6.tar.gz",\n                "REDIS_DOWNLOAD_SHA=5b2b8b7a50111ef395bf1c1d5be11e6e167ac018125055daa8b5c2317ae131ab"\n            ],\n            "Cmd": [\n                "redis-server"\n            ],\n            "Image": "redis",\n            "Volumes": {\n                "/data": {}\n            },\n            "WorkingDir": "/data",\n            "Entrypoint": [\n                "docker-entrypoint.sh"\n            ],\n            "OnBuild": null,\n            "Labels": {}\n        },\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "cb83cead9ad5721437c468c8179a8cf0c5bce1beb5fd09657a61252441ae7af5",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {\n                "6379/tcp": [\n                    {\n                        "HostIp": "0.0.0.0",\n                        "HostPort": "6377"\n                    },\n                    {\n                        "HostIp": "::",\n                        "HostPort": "6377"\n                    },\n                    {\n                        "HostIp": "0.0.0.0",\n                        "HostPort": "6378"\n                    },\n                    {\n                        "HostIp": "::",\n                        "HostPort": "6378"\n                    },\n                    {\n                        "HostIp": "0.0.0.0",\n                        "HostPort": "6379"\n                    },\n                    {\n                        "HostIp": "::",\n                        "HostPort": "6379"\n                    }\n                ]\n            },\n            "SandboxKey": "/var/run/docker/netns/cb83cead9ad5",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "aef0598eeaf2f2a4529672dc20213b2031e59271ee8f1faba292ed3982302963",\n            "Gateway": "172.17.0.1",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "172.17.0.2",\n            "IPPrefixLen": 16,\n            "IPv6Gateway": "",\n            "MacAddress": "02:42:ac:11:00:02",\n            "Networks": {\n                "bridge": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": null,\n                    "NetworkID": "7052d835be54442fdeb155f62f8d43b9252c322ef552c87f62abf9c40c028a25",\n                    "EndpointID": "aef0598eeaf2f2a4529672dc20213b2031e59271ee8f1faba292ed3982302963",\n                    "Gateway": "172.17.0.1",\n                    "IPAddress": "172.17.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:11:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n    }\n]\n[root@SystemFramework ~]# cd /var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e \n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cp config.v2.json config.v2.json.bak\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cp hostconfig.json hostconfig.json.bak\n# 容器启动停止状态 对应的 config.v2.json 不一样， hostconfig.json 一样。\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cat config.v2.json\n{"StreamConfig":{},"State":{"Running":true,"Paused":false,"Restarting":false,"OOMKilled":false,"RemovalInProgress":false,"Dead":false,"Pid":3143,"ExitCode":0,"Error":"","StartedAt":"2022-07-26T03:52:20.671954015Z","FinishedAt":"0001-01-01T00:00:00Z","Health":null},"ID":"b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e","Created":"2022-07-26T03:52:19.941484646Z","Managed":false,"Path":"docker-entrypoint.sh","Args":["redis-server"],"Config":{"Hostname":"b0d6ad82ddb6","Domainname":"","User":"","AttachStdin":false,"AttachStdout":false,"AttachStderr":false,"ExposedPorts":{"6379/tcp":{}},"Tty":false,"OpenStdin":true,"StdinOnce":false,"Env":["PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin","GOSU_VERSION=1.12","REDIS_VERSION=6.2.6","REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.2.6.tar.gz","REDIS_DOWNLOAD_SHA=5b2b8b7a50111ef395bf1c1d5be11e6e167ac018125055daa8b5c2317ae131ab"],"Cmd":["redis-server"],"Image":"redis","Volumes":{"/data":{}},"WorkingDir":"/data","Entrypoint":["docker-entrypoint.sh"],"OnBuild":null,"Labels":{}},"Image":"sha256:7614ae9453d1d87e740a2056257a6de7135c84037c367e1fffa92ae922784631","NetworkSettings":{"Bridge":"","SandboxID":"cb83cead9ad5721437c468c8179a8cf0c5bce1beb5fd09657a61252441ae7af5","HairpinMode":false,"LinkLocalIPv6Address":"","LinkLocalIPv6PrefixLen":0,"Networks":{"bridge":{"IPAMConfig":null,"Links":null,"Aliases":null,"NetworkID":"7052d835be54442fdeb155f62f8d43b9252c322ef552c87f62abf9c40c028a25","EndpointID":"aef0598eeaf2f2a4529672dc20213b2031e59271ee8f1faba292ed3982302963","Gateway":"172.17.0.1","IPAddress":"172.17.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"MacAddress":"02:42:ac:11:00:02","DriverOpts":null,"IPAMOperational":false}},"Service":null,"Ports":{"6379/tcp":[{"HostIp":"0.0.0.0","HostPort":"6377"},{"HostIp":"::","HostPort":"6377"},{"HostIp":"0.0.0.0","HostPort":"6378"},{"HostIp":"::","HostPort":"6378"},{"HostIp":"0.0.0.0","HostPort":"6379"},{"HostIp":"::","HostPort":"6379"}]},"SandboxKey":"/var/run/docker/netns/cb83cead9ad5","SecondaryIPAddresses":null,"SecondaryIPv6Addresses":null,"IsAnonymousEndpoint":false,"HasSwarmEndpoint":false},"LogPath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e-json.log","Name":"/iredis-u","Driver":"overlay2","OS":"linux","MountLabel":"","ProcessLabel":"","RestartCount":0,"HasBeenStartedBefore":true,"HasBeenManuallyStopped":false,"MountPoints":{"/data":{"Source":"","Destination":"/data","RW":true,"Name":"c43062a61838c8d1000078d4c31a61797176cc8f69e4539d9822b370f53365f2","Driver":"local","Type":"volume","ID":"9c184a7c23ec7c2c8c96a17847aee3114352f0f3f0a9dcecf1683c222202c255","Spec":{},"SkipMountpointCreation":false}},"SecretReferences":null,"ConfigReferences":null,"AppArmorProfile":"","HostnamePath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/hostname","HostsPath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/hosts","ShmPath":"","ResolvConfPath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/resolv.conf","SeccompProfile":"","NoNewPrivileges":false,"LocalLogCacheMeta":{"HaveNotifyEnabled":false}}\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cat hostconfig.json\n{"Binds":null,"ContainerIDFile":"","LogConfig":{"Type":"json-file","Config":{}},"NetworkMode":"default","PortBindings":{"6379/tcp":[{"HostIp":"","HostPort":"6379"},{"HostIp":"","HostPort":"6378"},{"HostIp":"","HostPort":"6377"}]},"RestartPolicy":{"Name":"no","MaximumRetryCount":0},"AutoRemove":false,"VolumeDriver":"","VolumesFrom":null,"CapAdd":null,"CapDrop":null,"CgroupnsMode":"host","Dns":[],"DnsOptions":[],"DnsSearch":[],"ExtraHosts":null,"GroupAdd":null,"IpcMode":"private","Cgroup":"","Links":null,"OomScoreAdj":0,"PidMode":"","Privileged":false,"PublishAllPorts":false,"ReadonlyRootfs":false,"SecurityOpt":null,"UTSMode":"","UsernsMode":"","ShmSize":67108864,"Runtime":"runc","ConsoleSize":[0,0],"Isolation":"","CpuShares":0,"Memory":0,"NanoCpus":0,"CgroupParent":"","BlkioWeight":0,"BlkioWeightDevice":[],"BlkioDeviceReadBps":null,"BlkioDeviceWriteBps":null,"BlkioDeviceReadIOps":null,"BlkioDeviceWriteIOps":null,"CpuPeriod":0,"CpuQuota":0,"CpuRealtimePeriod":0,"CpuRealtimeRuntime":0,"CpusetCpus":"","CpusetMems":"","Devices":[],"DeviceCgroupRules":null,"DeviceRequests":null,"KernelMemory":0,"KernelMemoryTCP":0,"MemoryReservation":0,"MemorySwap":0,"MemorySwappiness":null,"OomKillDisable":false,"PidsLimit":null,"Ulimits":null,"CpuCount":0,"CpuPercent":0,"IOMaximumIOps":0,"IOMaximumBandwidth":0,"MaskedPaths":["/proc/asound","/proc/acpi","/proc/kcore","/proc/keys","/proc/latency_stats","/proc/timer_list","/proc/timer_stats","/proc/sched_debug","/proc/scsi","/sys/firmware"],"ReadonlyPaths":["/proc/bus","/proc/fs","/proc/irq","/proc/sys","/proc/sysrq-trigger"]}\n\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                                                                                                             NAMES\nb0d6ad82ddb6   redis     "docker-entrypoint.s…"   46 minutes ago   Up 46 minutes   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp, 0.0.0.0:6377->6379/tcp, 0.0.0.0:6378->6379/tcp, :::6377->6379/tcp, :::6378->6379/tcp   iredis-u\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# docker stop iredis-u\niredis-u\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cat config.v2.json\n{"StreamConfig":{},"State":{"Running":false,"Paused":false,"Restarting":false,"OOMKilled":false,"RemovalInProgress":false,"Dead":false,"Pid":0,"ExitCode":0,"Error":"","StartedAt":"2022-07-26T03:52:20.671954015Z","FinishedAt":"2022-07-26T04:39:29.352881379Z","Health":null},"ID":"b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e","Created":"2022-07-26T03:52:19.941484646Z","Managed":false,"Path":"docker-entrypoint.sh","Args":["redis-server"],"Config":{"Hostname":"b0d6ad82ddb6","Domainname":"","User":"","AttachStdin":false,"AttachStdout":false,"AttachStderr":false,"ExposedPorts":{"6379/tcp":{}},"Tty":false,"OpenStdin":true,"StdinOnce":false,"Env":["PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin","GOSU_VERSION=1.12","REDIS_VERSION=6.2.6","REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.2.6.tar.gz","REDIS_DOWNLOAD_SHA=5b2b8b7a50111ef395bf1c1d5be11e6e167ac018125055daa8b5c2317ae131ab"],"Cmd":["redis-server"],"Image":"redis","Volumes":{"/data":{}},"WorkingDir":"/data","Entrypoint":["docker-entrypoint.sh"],"OnBuild":null,"Labels":{}},"Image":"sha256:7614ae9453d1d87e740a2056257a6de7135c84037c367e1fffa92ae922784631","NetworkSettings":{"Bridge":"","SandboxID":"cb83cead9ad5721437c468c8179a8cf0c5bce1beb5fd09657a61252441ae7af5","HairpinMode":false,"LinkLocalIPv6Address":"","LinkLocalIPv6PrefixLen":0,"Networks":{"bridge":{"IPAMConfig":null,"Links":null,"Aliases":null,"NetworkID":"7052d835be54442fdeb155f62f8d43b9252c322ef552c87f62abf9c40c028a25","EndpointID":"","Gateway":"","IPAddress":"","IPPrefixLen":0,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"MacAddress":"","DriverOpts":null,"IPAMOperational":false}},"Service":null,"Ports":null,"SandboxKey":"/var/run/docker/netns/cb83cead9ad5","SecondaryIPAddresses":null,"SecondaryIPv6Addresses":null,"IsAnonymousEndpoint":false,"HasSwarmEndpoint":false},"LogPath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e-json.log","Name":"/iredis-u","Driver":"overlay2","OS":"linux","MountLabel":"","ProcessLabel":"","RestartCount":0,"HasBeenStartedBefore":true,"HasBeenManuallyStopped":true,"MountPoints":{"/data":{"Source":"","Destination":"/data","RW":true,"Name":"c43062a61838c8d1000078d4c31a61797176cc8f69e4539d9822b370f53365f2","Driver":"local","Type":"volume","Spec":{},"SkipMountpointCreation":false}},"SecretReferences":null,"ConfigReferences":null,"AppArmorProfile":"","HostnamePath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/hostname","HostsPath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/hosts","ShmPath":"","ResolvConfPath":"/var/lib/docker/containers/b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e/resolv.conf","SeccompProfile":"","NoNewPrivileges":false,"LocalLogCacheMeta":{"HaveNotifyEnabled":false}}\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cat hostconfig.json\n{"Binds":null,"ContainerIDFile":"","LogConfig":{"Type":"json-file","Config":{}},"NetworkMode":"default","PortBindings":{"6379/tcp":[{"HostIp":"","HostPort":"6379"},{"HostIp":"","HostPort":"6378"},{"HostIp":"","HostPort":"6377"}]},"RestartPolicy":{"Name":"no","MaximumRetryCount":0},"AutoRemove":false,"VolumeDriver":"","VolumesFrom":null,"CapAdd":null,"CapDrop":null,"CgroupnsMode":"host","Dns":[],"DnsOptions":[],"DnsSearch":[],"ExtraHosts":null,"GroupAdd":null,"IpcMode":"private","Cgroup":"","Links":null,"OomScoreAdj":0,"PidMode":"","Privileged":false,"PublishAllPorts":false,"ReadonlyRootfs":false,"SecurityOpt":null,"UTSMode":"","UsernsMode":"","ShmSize":67108864,"Runtime":"runc","ConsoleSize":[0,0],"Isolation":"","CpuShares":0,"Memory":0,"NanoCpus":0,"CgroupParent":"","BlkioWeight":0,"BlkioWeightDevice":[],"BlkioDeviceReadBps":null,"BlkioDeviceWriteBps":null,"BlkioDeviceReadIOps":null,"BlkioDeviceWriteIOps":null,"CpuPeriod":0,"CpuQuota":0,"CpuRealtimePeriod":0,"CpuRealtimeRuntime":0,"CpusetCpus":"","CpusetMems":"","Devices":[],"DeviceCgroupRules":null,"DeviceRequests":null,"KernelMemory":0,"KernelMemoryTCP":0,"MemoryReservation":0,"MemorySwap":0,"MemorySwappiness":null,"OomKillDisable":false,"PidsLimit":null,"Ulimits":null,"CpuCount":0,"CpuPercent":0,"IOMaximumIOps":0,"IOMaximumBandwidth":0,"MaskedPaths":["/proc/asound","/proc/acpi","/proc/kcore","/proc/keys","/proc/latency_stats","/proc/timer_list","/proc/timer_stats","/proc/sched_debug","/proc/scsi","/sys/firmware"],"ReadonlyPaths":["/proc/bus","/proc/fs","/proc/irq","/proc/sys","/proc/sysrq-trigger"]}\n\n# 首先关闭docker服务\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# systemctl stop docker.socket\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# docker ps\nCannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?\n## 文件配置同 以上容器停止后的 配置一样\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cat config.v2.json\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# cat hostconfig.json  \n\n# 修改主机配置 \n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# vim hostconfig.json\n# 修改 ,{"HostIp":"","HostPort":"6377"} 为 ,{"HostIp":"","HostPort":"6376"}\n\n[root@SystemFramework b0d6ad82ddb6eb06ff17c60e5b794342ac805e4af9415c35cd79db7589310a3e]# docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS          PORTS                                                                                                                             NAMES\nb0d6ad82ddb6   redis     "docker-entrypoint.s…"   2 hours ago   Up 16 seconds   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp, 0.0.0.0:6376->6379/tcp, 0.0.0.0:6378->6379/tcp, :::6376->6379/tcp, :::6378->6379/tcp   iredis-u\n')])])]),a("h3",{attrs:{id:"bash-ping-command-not-found"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bash-ping-command-not-found"}},[e._v("#")]),e._v(" bash: ping: command not found")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("apt-get update\napt-get install iputils-ping\n")])])]),a("h2",{attrs:{id:"docker-toolbox"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-toolbox"}},[e._v("#")]),e._v(" Docker Toolbox")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("C:\\Users\\TosinJia\\.docker\\machine\\cache\n")])])]),a("h2",{attrs:{id:"常用命令及参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用命令及参数"}},[e._v("#")]),e._v(" 常用命令及参数")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker -v\n")])])]),a("h3",{attrs:{id:"docker-镜像命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像命令"}},[e._v("#")]),e._v(" docker 镜像命令")]),e._v(" "),a("h4",{attrs:{id:"检索"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检索"}},[e._v("#")]),e._v(" 检索")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker search 镜像名\n")])])]),a("h4",{attrs:{id:"下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[e._v("#")]),e._v(" 下载")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker pull 镜像名\n")])])]),a("h4",{attrs:{id:"列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列表"}},[e._v("#")]),e._v(" 列表")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker images\n")])])]),a("h4",{attrs:{id:"删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[e._v("#")]),e._v(" 删除")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker rmi image-id\ndocker rmi $(docker images -q)\n")])])]),a("h3",{attrs:{id:"docker-容器命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-容器命令"}},[e._v("#")]),e._v(" docker 容器命令")]),e._v(" "),a("h4",{attrs:{id:"基本操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本操作"}},[e._v("#")]),e._v(" 基本操作")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker run --name container-name -d image-name\n")])])]),a("h4",{attrs:{id:"列表-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列表-2"}},[e._v("#")]),e._v(" 列表")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker ps\n-a\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker -H tcp://172.16.88.80:2376 ps\n\n")])])]),a("h4",{attrs:{id:"停止、启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#停止、启动"}},[e._v("#")]),e._v(" 停止、启动")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker stop container-name/conainer-id\ndocker start container-name/conainer-id\n")])])]),a("h4",{attrs:{id:"端口映射-p"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口映射-p"}},[e._v("#")]),e._v(" 端口映射\t-p")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker run -d -p 6378:6379 --name port-redis redis\n")])])]),a("h4",{attrs:{id:"删除-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除-2"}},[e._v("#")]),e._v(" 删除")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker rm container-id\ndocker rm $(docker ps -a -q)\n")])])]),a("h4",{attrs:{id:"日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[e._v("#")]),e._v(" 日志")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker logs container-name/conainer-id\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@huoefa yy-tms]#  docker logs -f -t --since="2023-04-17" --until="2023-04-19" --tail=10 tms\n[root@huoefa yy-tms]# docker logs --help\n\nUsage:\tdocker logs [OPTIONS] CONTAINER\n\nFetch the logs of a container\n\nOptions:\n      --details        Show extra details provided to logs\n  -f, --follow         Follow log output\n      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)\n      --tail string    Number of lines to show from the end of the logs (default "all")\n  -t, --timestamps     Show timestamps\n      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)\n\n')])])]),a("h4",{attrs:{id:"登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[e._v("#")]),e._v(" 登录")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker exec -it container-name/conainer-id bash\n")])])]),a("h2",{attrs:{id:"demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[e._v("#")]),e._v(" demo")]),e._v(" "),a("h3",{attrs:{id:"安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[e._v("#")]),e._v(" 安装docker")]),e._v(" "),a("h4",{attrs:{id:"centos7使用阿里yum源安装docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos7使用阿里yum源安装docker"}},[e._v("#")]),e._v(" CentOS7使用阿里yum源安装Docker")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 1. 安装环境\n## 1.1 查看CentOS版本\n[root@etc ~]# cat /etc/os-release \nNAME="CentOS Linux"\nVERSION="7 (Core)"\nID="centos"\nID_LIKE="rhel fedora"\nVERSION_ID="7"\nPRETTY_NAME="CentOS Linux 7 (Core)"\nANSI_COLOR="0;31"\nCPE_NAME="cpe:/o:centos:centos:7"\nHOME_URL="https://www.centos.org/"\nBUG_REPORT_URL="https://bugs.centos.org/"\n\nCENTOS_MANTISBT_PROJECT="CentOS-7"\nCENTOS_MANTISBT_PROJECT_VERSION="7"\nREDHAT_SUPPORT_PRODUCT="centos"\nREDHAT_SUPPORT_PRODUCT_VERSION="7"\n## 1.2. CentOS 7安装docker要求系统为64位、系统内核版本为 3.10 以上\n[root@etc ~]# uname -r\n3.10.0-1160.el7.x86_64\n# 2. yum安装\n## 2.1 查看是否已安装docker列表\n[root@etc ~]# yum list installed | grep docker\nRepodata is over 2 weeks old. Install yum-cron? Or run: yum makecache fast\n# step 1: 安装必要的一些系统工具\n[root@etc ~]# yum install -y yum-utils device-mapper-persistent-data lvm2\n# Step 2: 添加软件源信息 阿里yum源\n[root@etc ~]# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nLoaded plugins: fastestmirror\nadding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\ngrabbing file http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo\nrepo saved to /etc/yum.repos.d/docker-ce.repo\n# Step 3: 更新并安装 Docker-CE\n# 把服务器的包信息下载到本地缓存起来\n[root@etc ~]# yum makecache fast\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.163.com\n * extras: mirrors.aliyun.com\n * updates: mirror.lzu.edu.cn\nbase                                                                                                                | 3.6 kB  00:00:00     \ndocker-ce-stable                                                                                                    | 3.5 kB  00:00:00     \nextras                                                                                                              | 2.9 kB  00:00:00     \nupdates                                                                                                             | 2.9 kB  00:00:00     \n(1/2): docker-ce-stable/7/x86_64/primary_db                                                                         |  63 kB  00:00:00     \n(2/2): docker-ce-stable/7/x86_64/updateinfo                                                                         |   55 B  00:00:00     \nMetadata Cache Created\n# 安装最新版本的Docker CE（社区版）\n[root@etc ~]# yum -y install docker-ce\n\n# Step 4: 开启Docker服务\n[root@etc ~]# service docker start\nRedirecting to /bin/systemctl start docker.service\n# 设置开机启动\n[root@etc ~]# chkconfig docker on\nNote: Forwarding request to \'systemctl enable docker.service\'.\nCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.\n[root@etc ~]# service docker status\nRedirecting to /bin/systemctl status docker.service\n● docker.service - Docker Application Container Engine\n   Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)\n   Active: active (running) since Thu 2021-09-30 22:13:17 CST; 8min ago\n     Docs: https://docs.docker.com\n Main PID: 1654 (dockerd)\n   CGroup: /system.slice/docker.service\n           └─1654 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock\n\nSep 30 22:13:15 etc dockerd[1654]: time="2021-09-30T22:13:15.729088409+08:00" level=info msg="scheme \\"unix\\" not registered, fa...ule=grpc\nSep 30 22:13:15 etc dockerd[1654]: time="2021-09-30T22:13:15.729107841+08:00" level=info msg="ccResolverWrapper: sending update ...ule=grpc\nSep 30 22:13:15 etc dockerd[1654]: time="2021-09-30T22:13:15.729117462+08:00" level=info msg="ClientConn switching balancer to \\...ule=grpc\nSep 30 22:13:15 etc dockerd[1654]: time="2021-09-30T22:13:15.925794568+08:00" level=info msg="Loading containers: start."\nSep 30 22:13:16 etc dockerd[1654]: time="2021-09-30T22:13:16.261949927+08:00" level=info msg="Default bridge (docker0) is assign...address"\nSep 30 22:13:16 etc dockerd[1654]: time="2021-09-30T22:13:16.583209008+08:00" level=info msg="Loading containers: done."\nSep 30 22:13:17 etc dockerd[1654]: time="2021-09-30T22:13:17.224288589+08:00" level=info msg="Docker daemon" commit=75249d8 grap...=20.10.8\nSep 30 22:13:17 etc dockerd[1654]: time="2021-09-30T22:13:17.315505234+08:00" level=info msg="Daemon has completed initialization"\nSep 30 22:13:17 etc systemd[1]: Started Docker Application Container Engine.\nSep 30 22:13:17 etc dockerd[1654]: time="2021-09-30T22:13:17.659581210+08:00" level=info msg="API listen on /var/run/docker.sock"\nHint: Some lines were ellipsized, use -l to show in full.\n# 配置镜像加速器\n[root@etc ~]# ll /etc/docker/\ntotal 4\n-rw-------. 1 root root 244 Sep 30 22:13 key.json\n[root@etc ~]# tee /etc/docker/daemon.json <<-\'EOF\'\n> {\n>   "registry-mirrors": ["https://gwvjjhq5.mirror.aliyuncs.com"]\n> }\n> EOF\n{\n  "registry-mirrors": ["https://gwvjjhq5.mirror.aliyuncs.com"]\n}\n[root@etc ~]# cat /etc/docker/daemon.json \n{\n  "registry-mirrors": ["https://gwvjjhq5.mirror.aliyuncs.com"]\n}\n[root@etc ~]# systemctl daemon-reload\n[root@etc ~]# systemctl restart docker\n\n# 3. 安装验证\n## 查看docker版本信息 有Client和Server两部分表示docker安装启动都成功了\n[root@etc ~]# docker version\nClient: Docker Engine - Community\n Version:           20.10.8\n API version:       1.41\n Go version:        go1.16.6\n Git commit:        3967b7d\n Built:             Fri Jul 30 19:55:49 2021\n OS/Arch:           linux/amd64\n Context:           default\n Experimental:      true\n\nServer: Docker Engine - Community\n Engine:\n  Version:          20.10.8\n  API version:      1.41 (minimum version 1.12)\n  Go version:       go1.16.6\n  Git commit:       75249d8\n  Built:            Fri Jul 30 19:54:13 2021\n  OS/Arch:          linux/amd64\n  Experimental:     false\n containerd:\n  Version:          1.4.9\n  GitCommit:        e25210fe30a0a703442421b0f60afac609f950a3\n runc:\n  Version:          1.0.1\n  GitCommit:        v1.0.1-0-g4144b63\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0\n## 查看docker版本\n[root@etc ~]# docker --version\nDocker version 20.10.8, build 3967b7d\n\n[root@etc ~]# yum list installed | grep docker\ncontainerd.io.x86_64                 1.4.9-3.1.el7                  @docker-ce-stable\ndocker-ce.x86_64                     3:20.10.8-3.el7                @docker-ce-stable\ndocker-ce-cli.x86_64                 1:20.10.8-3.el7                @docker-ce-stable\ndocker-ce-rootless-extras.x86_64     20.10.8-3.el7                  @docker-ce-stable\ndocker-scan-plugin.x86_64            0.8.0-3.el7                    @docker-ce-stable\n\n## 通过运行hello-world镜像验证安装是否正确\n[root@etc ~]# docker run hello-world\nUnable to find image \'hello-world:latest\' locally\nlatest: Pulling from library/hello-world\n2db29710123e: Pull complete \nDigest: sha256:393b81f0ea5a98a7335d7ad44be96fe76ca8eb2eaa76950eb8c989ebf2b78ec0\nStatus: Downloaded newer image for hello-world:latest\n\nHello from Docker!\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n 1. The Docker client contacted the Docker daemon.\n 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.\n    (amd64)\n 3. The Docker daemon created a new container from that image which runs the\n    executable that produces the output you are currently reading.\n 4. The Docker daemon streamed that output to the Docker client, which sent it\n    to your terminal.\n\nTo try something more ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu bash\n\nShare images, automate workflows, and more with a free Docker ID:\n https://hub.docker.com/\n\nFor more examples and ideas, visit:\n https://docs.docker.com/get-started/\n\n[root@etc ~]# docker images hello-world\n### 来自于哪个仓库\t标签（镜像的发行版本）\t\tID（唯一）\t创建时间\t大小\nREPOSITORY    TAG       IMAGE ID       CREATED      SIZE\nhello-world   latest    feb5d9fea6a5   6 days ago   13.3kB\n\n# 4. 彻底卸载\nyum remove docker docker-common docker-selinux docker-engine\n')])])]),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/kingsonfu/p/11576797.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("linux 安装docker"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/yjlch1016/p/8969751.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CentOS7使用阿里yum源安装Docker"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors",target:"_blank",rel:"noopener noreferrer"}},[e._v("阿里云容器镜像服务"),a("OutboundLink")],1),e._v(" "),a("ul",[a("li",[e._v("https://developer.aliyun.com/article/110806")])])])]),e._v(" "),a("h3",{attrs:{id:"oracle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oracle"}},[e._v("#")]),e._v(" oracle")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker run -d -p 9090:8080 -p 1521:1521 --name ioracle wnameless/oracle-xe-11g\n")])])]),a("blockquote",[a("ul",[a("li",[e._v("vm端口转发规则")]),e._v(" "),a("li",[e._v("oracle TCP 0.0.0.0 1521  1521")])])]),e._v(" "),a("h3",{attrs:{id:"mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[e._v("#")]),e._v(" mysql")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("docker run -p 3306:3306 --name imysql5.6 -e MYSQL_ROOT_PASSWORD=root -d mysql:5.6\n")])])]),a("h2",{attrs:{id:"docker入门到精通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker入门到精通"}},[e._v("#")]),e._v(" Docker入门到精通")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.bilibili.com/video/BV1844y167D1",target:"_blank",rel:"noopener noreferrer"}},[e._v("2021最新Docker入门到精通视频"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/tag/Docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("笔记"),a("OutboundLink")],1)])]),e._v(" "),a("h3",{attrs:{id:"docker-swarm-集群环境搭建及弹性服务部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm-集群环境搭建及弹性服务部署"}},[e._v("#")]),e._v(" Docker Swarm 集群环境搭建及弹性服务部署")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker16.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Swarm 集群环境搭建及弹性服务部署"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("从零开始，搭建 Docker Swarm 集群环境，并通过 Swarm 实现服务的弹性部署，滚动更新服务及回滚服务等功能。")])])]),e._v(" "),a("h4",{attrs:{id:"_1-0-集群搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-集群搭建"}},[e._v("#")]),e._v(" 1.0  集群搭建")]),e._v(" "),a("h5",{attrs:{id:"_1-1-环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-环境准备"}},[e._v("#")]),e._v(" 1.1  环境准备")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@CentOS-7 ~]# rpm -q centos-release\ncentos-release-7-9.2009.0.el7.centos.x86_64\n\n[root@CentOS-7 ~]# curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun\n[root@CentOS-7 ~]# docker -v\nDocker version 20.10.16, build aa7e414\n[root@CentOS-7 ~]# systemctl start docker      \n[root@CentOS-7 ~]# docker ps\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n[root@CentOS-7 ~]# systemctl enable docker\nCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.\n\n[root@CentOS-7 ~]# systemctl stop firewalld  \n[root@CentOS-7 ~]# systemctl disable firewalld\nRemoved symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.\nRemoved symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.\n")])])]),a("ul",[a("li",[e._v("五台安装了 Docker 的 CentOS 机器，版本为："),a("code",[e._v("CentOS 7.9.2009")])]),e._v(" "),a("li",[e._v("Docker Engine 1.12+（最低要求 1.12，本文使用 20.10.16）")]),e._v(" "),a("li",[e._v("防火墙开启以下端口或者关闭防火墙：\n"),a("ul",[a("li",[e._v("TCP 端口 2377，用于集群管理通信；")]),e._v(" "),a("li",[e._v("TCP 和 UDP 端口 7946，用于节点之间通信；")]),e._v(" "),a("li",[e._v("UDP 端口 4789，用于覆盖网络。")])])])]),e._v(" "),a("h5",{attrs:{id:"_1-2-机器分布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-机器分布"}},[e._v("#")]),e._v(" 1.2  机器分布")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("角色")]),e._v(" "),a("th",[e._v("IP")]),e._v(" "),a("th",[e._v("HOSTNAME")]),e._v(" "),a("th",[e._v("Docker 版本")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("Manager")]),e._v(" "),a("td",[e._v("192.168.217.3")]),e._v(" "),a("td",[e._v("manager1")]),e._v(" "),a("td",[e._v("20.10.16")])]),e._v(" "),a("tr",[a("td",[e._v("Manager")]),e._v(" "),a("td",[e._v("192.168.217.4")]),e._v(" "),a("td",[e._v("manager2")]),e._v(" "),a("td",[e._v("20.10.16")])]),e._v(" "),a("tr",[a("td",[e._v("Manager")]),e._v(" "),a("td",[e._v("192.168.217.5")]),e._v(" "),a("td",[e._v("manager3")]),e._v(" "),a("td",[e._v("20.10.16")])]),e._v(" "),a("tr",[a("td",[e._v("Worker")]),e._v(" "),a("td",[e._v("192.168.217.6")]),e._v(" "),a("td",[e._v("worker1")]),e._v(" "),a("td",[e._v("20.10.16")])]),e._v(" "),a("tr",[a("td",[e._v("Worker")]),e._v(" "),a("td",[e._v("192.168.217.7")]),e._v(" "),a("td",[e._v("worker2")]),e._v(" "),a("td",[e._v("20.10.16")])])])]),e._v(" "),a("ul",[a("li",[e._v("可以通过 "),a("code",[e._v("hostname 主机名")]),e._v(" 修改机器的主机名（立即生效，重启后失效）；")]),e._v(" "),a("li",[e._v("或者 "),a("code",[e._v("hostnamectl set-hostname")]),e._v(" 主机名 修改机器的主机名（立即生效，重启也生效）；")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@CentOS-7 ~]# hostnamectl set-hostname manager1\n\n[root@CentOS-7 ~]# vi /etc/hostname  \nmanager2\n\n[root@manager1 ~]# vim /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.168.217.3 manager1\n192.168.217.4 manager2\n192.168.217.5 manager3\n192.168.217.6 worker1\n192.168.217.7 worker2\n[root@manager1 ~]# scp /etc/hosts manager2:/etc/\n[root@manager1 ~]# scp /etc/hosts manager3:/etc/\n[root@manager1 ~]# scp /etc/hosts worker1:/etc/\n[root@manager1 ~]# scp /etc/hosts worker2:/etc/\n")])])]),a("h5",{attrs:{id:"_1-3-创建集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-创建集群"}},[e._v("#")]),e._v(" 1.3  创建集群")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("在任意节点下通过 "),a("code",[e._v("docker swarm init")]),e._v(" 命令创建一个新的 Swarm 集群并加入，且该节点会默认成为 Manager 节点。根据我们预先定义的角色，在 3 ~ 5 的任意一台机器上运行该命令即可。")])]),e._v(" "),a("li",[a("p",[e._v("通常，第一个加入集群的管理节点将成为 "),a("code",[e._v("Leader")]),e._v("，后来加入的管理节点都是 "),a("code",[e._v("Reachable")]),e._v("。当前的 Leader 如果挂掉，所有的 Reachable 将重新选举一个新的 Leader。")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker swarm init --advertise-addr 192.168.217.3\nSwarm initialized: current node (98t1cewaejvrla26icbs8wkdb) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-5eif2nhmirc844crj7qhumqhxjqg1vk1b965i8zm7nfw78het6-3gv2ifs7lhohg23853np8ksp5 192.168.217.3:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n")])])]),a("h5",{attrs:{id:"_1-4-加入集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-加入集群"}},[e._v("#")]),e._v(" 1.4  加入集群")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Docker 中内置的集群模式自带了公钥基础设施(PKI)系统，使得安全部署容器变得简单。集群中的节点使用传输层安全协议(TLS)对集群中其他节点的通信进行身份验证、授权和加密。")])]),e._v(" "),a("li",[a("p",[e._v("默认情况下，通过 "),a("code",[e._v("docker swarm init")]),e._v(" 命令创建一个新的 Swarm 集群时，Manager 节点会生成新的根证书颁发机构（CA）和密钥对，用于保护与加入群集的其他节点之间的通信安全。")])]),e._v(" "),a("li",[a("p",[e._v("Manager 节点会生成两个令牌，供其他节点加入集群时使用：一个 Worker 令牌，一个 Manager 令牌。每个令牌都包括根 CA 证书的摘要和随机生成的密钥。当节点加入群集时，加入的节点使用摘要来验证来自远程管理节点的根 CA 证书。远程管理节点使用密钥来确保加入的节点是批准的节点。")])])]),e._v(" "),a("p",[a("img",{attrs:{src:n(509),alt:"docker-swarm-join_cluster"}})]),e._v(" "),a("h6",{attrs:{id:"manager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manager"}},[e._v("#")]),e._v(" Manager")]),e._v(" "),a("ul",[a("li",[e._v("若要向该集群添加 Manager 节点，管理节点先运行 "),a("code",[e._v("docker swarm join-token manager")]),e._v(" 命令查看管理节点的令牌信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker swarm join-token manager\nTo add a manager to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-5eif2nhmirc844crj7qhumqhxjqg1vk1b965i8zm7nfw78het6-a1p0ydpttswtfjhwo0afxa9mg 192.168.217.3:2377\n")])])]),a("ul",[a("li",[e._v("然后在其他节点上运行 "),a("code",[e._v("docker swarm join")]),e._v(" 并携带令牌参数加入 Swarm 集群，该节点角色为 Manager。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 时间同步 Error response from daemon: error while validating Root CA Certificate: x509: certificate has expired or is not yet valid: current time 2022-05-14T12:02:19+08:00 is before 2022-05-14T11:23:00Z\n[root@manager2 ~]# docker swarm join --token SWMTKN-1-5eif2nhmirc844crj7qhumqhxjqg1vk1b965i8zm7nfw78het6-a1p0ydpttswtfjhwo0afxa9mg 192.168.217.3:2377\nThis node joined a swarm as a manager.\n[root@manager3 ~]# docker swarm join --token SWMTKN-1-5eif2nhmirc844crj7qhumqhxjqg1vk1b965i8zm7nfw78het6-a1p0ydpttswtfjhwo0afxa9mg 192.168.217.3:2377\nThis node joined a swarm as a manager.\n")])])]),a("h6",{attrs:{id:"workder"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#workder"}},[e._v("#")]),e._v(" Workder")]),e._v(" "),a("ul",[a("li",[e._v("通过创建集群时返回的结果可以得知，要向这个集群添加一个 Worker 节点，运行下图中的命令即可。或者管理节点先运行 "),a("code",[e._v("docker swarm join-token worker")]),e._v(" 命令查看工作节点的令牌信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker swarm join-token worker\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-5eif2nhmirc844crj7qhumqhxjqg1vk1b965i8zm7nfw78het6-3gv2ifs7lhohg23853np8ksp5 192.168.217.3:2377\n")])])]),a("ul",[a("li",[e._v("然后在其他节点上运行 "),a("code",[e._v("docker swarm join")]),e._v(" 并携带令牌参数加入 Swarm 集群，该节点角色为 Worker。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@worker1 ~]# docker swarm join --token SWMTKN-1-5eif2nhmirc844crj7qhumqhxjqg1vk1b965i8zm7nfw78het6-3gv2ifs7lhohg23853np8ksp5 192.168.217.3:2377\nThis node joined a swarm as a worker.\n[root@worker2 ~]# docker swarm join --token SWMTKN-1-5eif2nhmirc844crj7qhumqhxjqg1vk1b965i8zm7nfw78het6-3gv2ifs7lhohg23853np8ksp5 192.168.217.3:2377\nThis node joined a swarm as a worker.\n")])])]),a("h5",{attrs:{id:"_1-5-查看集群信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-查看集群信息"}},[e._v("#")]),e._v(" 1.5  查看集群信息")]),e._v(" "),a("ul",[a("li",[e._v("在任意 Manager 节点中运行 "),a("code",[e._v("docker info")]),e._v(" 可以查看当前集群的信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker info\nClient:\n Context:    default\n Debug Mode: false\n Plugins:\n  app: Docker App (Docker Inc., v0.9.1-beta3)\n  buildx: Docker Buildx (Docker Inc., v0.8.2-docker)\n  compose: Docker Compose (Docker Inc., v2.5.0)\n  scan: Docker Scan (Docker Inc., v0.17.0)\n\nServer:\n Containers: 0\n  Running: 0\n  Paused: 0\n  Stopped: 0\n Images: 0\n Server Version: 20.10.16\n Storage Driver: overlay2\n  Backing Filesystem: xfs\n  Supports d_type: true\n  Native Overlay Diff: true\n  userxattr: false\n Logging Driver: json-file\n Cgroup Driver: cgroupfs\n Cgroup Version: 1\n Plugins:\n  Volume: local\n  Network: bridge host ipvlan macvlan null overlay\n  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog\n Swarm: active\n  NodeID: 98t1cewaejvrla26icbs8wkdb\n  Is Manager: true\n  ClusterID: pib1uii03yznnm8kghtj54wxw\n  Managers: 3\n  Nodes: 5\n  Default Address Pool: 10.0.0.0/8  \n  SubnetSize: 24\n  Data Path Port: 4789\n  Orchestration:\n   Task History Retention Limit: 5\n  Raft:\n   Snapshot Interval: 10000\n   Number of Old Snapshots to Retain: 0\n   Heartbeat Tick: 1\n   Election Tick: 10\n  Dispatcher:\n   Heartbeat Period: 5 seconds\n  CA Configuration:\n   Expiry Duration: 3 months\n   Force Rotate: 0\n  Autolock Managers: false\n  Root Rotation In Progress: false\n  Node Address: 192.168.217.3\n  Manager Addresses:\n   192.168.217.3:2377\n   192.168.217.4:2377\n   192.168.217.5:2377\n Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc\n Default Runtime: runc\n Init Binary: docker-init\n containerd version: 212e8b6fa2f44b9c21b2798135fc6fb7c53efc16\n runc version: v1.1.1-0-g52de29d\n init version: de40ad0\n Security Options:\n  seccomp\n   Profile: default\n Kernel Version: 3.10.0-1160.el7.x86_64\n Operating System: CentOS Linux 7 (Core)\n OSType: linux\n Architecture: x86_64\n CPUs: 1\n Total Memory: 487MiB\n Name: manager1\n ID: CYUE:3XZO:5ZX7:DSHH:P5Z7:MRKI:5YF3:YTQZ:NLFN:ZQ74:7IU3:MD42\n Docker Root Dir: /var/lib/docker\n Debug Mode: false\n Registry: https://index.docker.io/v1/\n Labels:\n Experimental: false\n Insecure Registries:\n  127.0.0.0/8\n Live Restore Enabled: false\n\nWARNING: bridge-nf-call-ip6tables is disabled\n")])])]),a("h5",{attrs:{id:"_1-6-查看集群节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-查看集群节点"}},[e._v("#")]),e._v(" 1.6  查看集群节点")]),e._v(" "),a("ul",[a("li",[e._v("在任意 Manager 节点中运行 "),a("code",[e._v("docker node ls")]),e._v(" 可以查看当前集群节点信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\n98t1cewaejvrla26icbs8wkdb *   manager1   Ready     Active         Leader           20.10.16\nng7q78fk4vhixxbzhe1xtm0fd     manager2   Ready     Active         Reachable        20.10.16\na03apmtv3pemia3612vzwszys     manager3   Ready     Active         Reachable        20.10.16\nx4m3q557wj79iul8ivtxz122k     worker1    Ready     Active                          20.10.16\ntjwdrzb1y7pcs6wrfso0qgexf     worker2    Ready     Active                          20.10.16\n")])])]),a("blockquote",[a("p",[e._v("* 代表当前节点，现在的环境为 3 个管理节点构成 1 主 2 从，以及 2 个工作节点。")])]),e._v(" "),a("ul",[a("li",[e._v("节点 "),a("code",[e._v("MANAGER STATUS")]),e._v(" 说明：表示节点是属于 Manager 还是 Worker，没有值则属于 Worker 节点。\n"),a("ul",[a("li",[a("code",[e._v("Leader")]),e._v("：该节点是管理节点中的主节点，负责该集群的集群管理和编排决策；")]),e._v(" "),a("li",[a("code",[e._v("Reachable")]),e._v("：该节点是管理节点中的从节点，如果 Leader 节点不可用，该节点有资格被选为新的 Leader；")]),e._v(" "),a("li",[a("code",[e._v("Unavailable")]),e._v("：该管理节点已不能与其他管理节点通信。如果管理节点不可用，应该将新的管理节点加入群集，或者将工作节点升级为管理节点。")])])]),e._v(" "),a("li",[e._v("节点 "),a("code",[e._v("AVAILABILITY")]),e._v(" 说明：表示调度程序是否可以将任务分配给该节点。\n"),a("ul",[a("li",[a("code",[e._v("Active")]),e._v("：调度程序可以将任务分配给该节点；")]),e._v(" "),a("li",[a("code",[e._v("Pause")]),e._v("：调度程序不会将新任务分配给该节点，但现有任务仍可以运行；")]),e._v(" "),a("li",[a("code",[e._v("Drain")]),e._v("：调度程序不会将新任务分配给该节点，并且会关闭该节点所有现有任务，并将它们调度在可用的节点上。")])])])]),e._v(" "),a("h5",{attrs:{id:"_1-7-删除节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-删除节点"}},[e._v("#")]),e._v(" 1.7  删除节点")]),e._v(" "),a("h6",{attrs:{id:"manager-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manager-2"}},[e._v("#")]),e._v(" Manager")]),e._v(" "),a("ol",[a("li",[e._v("删除节点之前需要先将该节点的 "),a("code",[e._v("AVAILABILITY")]),e._v(" 改为 "),a("code",[e._v("Drain")]),e._v("。其目的是为了将该节点的服务迁移到其他可用节点上，确保服务正常。最好检查一下容器迁移情况，确保这一步已经处理完成再继续往下。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager3 ~]# docker node update --availability drain a03apmtv3pemia3612vzwszys\na03apmtv3pemia3612vzwszys\n[root@manager3 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\na03apmtv3pemia3612vzwszys *   manager3   Ready     Drain          Reachable        20.10.16\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("然后，将该 Manager 节点进行降级处理，降级为 Worker 节点。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager3 ~]# docker node demote a03apmtv3pemia3612vzwszys\nManager a03apmtv3pemia3612vzwszys demoted in the swarm.\n[root@manager3 ~]# docker node ls\nError response from daemon: This node is not a swarm manager. Worker nodes can't be used to view or modify cluster state. Please run this command on a manager node or promote the current node to a manager.\n[root@manager1 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\na03apmtv3pemia3612vzwszys     manager3   Ready     Drain                           20.10.16\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("然后，在已经降级为 Worker 的节点中运行以下命令，离开集群。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager3 ~]# docker swarm leave\nNode left the swarm.\n[root@manager1 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\na03apmtv3pemia3612vzwszys     manager3   Down      Drain                           20.10.16\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("最后，在管理节点中对刚才离开的节点进行删除。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker node rm a03apmtv3pemia3612vzwszys\na03apmtv3pemia3612vzwszys\n[root@manager1 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\n98t1cewaejvrla26icbs8wkdb *   manager1   Ready     Active         Leader           20.10.16\nng7q78fk4vhixxbzhe1xtm0fd     manager2   Ready     Active         Reachable        20.10.16\nx4m3q557wj79iul8ivtxz122k     worker1    Ready     Active                          20.10.16\ntjwdrzb1y7pcs6wrfso0qgexf     worker2    Ready     Active                          20.10.16\n")])])]),a("h6",{attrs:{id:"worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#worker"}},[e._v("#")]),e._v(" Worker")]),e._v(" "),a("ol",[a("li",[e._v("删除节点之前需要先将该节点的 "),a("code",[e._v("AVAILABILITY")]),e._v(" 改为 "),a("code",[e._v("Drain")]),e._v("。其目的是为了将该节点的服务迁移到其他可用节点上，确保服务正常。最好检查一下容器迁移情况，确保这一步已经处理完成再继续往下。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker node update --availability drain tjwdrzb1y7pcs6wrfso0qgexf\ntjwdrzb1y7pcs6wrfso0qgexf\n[root@manager1 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\ntjwdrzb1y7pcs6wrfso0qgexf     worker2    Ready     Drain                           20.10.16\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("然后，在准备删除的 Worker 节点中运行以下命令，离开集群。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@worker2 ~]# docker swarm leave\nNode left the swarm.\n[root@manager1 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\ntjwdrzb1y7pcs6wrfso0qgexf     worker2    Down      Drain                           20.10.16\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("最后，在管理节点中对刚才离开的节点进行删除。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker node rm tjwdrzb1y7pcs6wrfso0qgexf\ntjwdrzb1y7pcs6wrfso0qgexf\n[root@manager1 ~]# docker node ls\nID                            HOSTNAME   STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION\n98t1cewaejvrla26icbs8wkdb *   manager1   Ready     Active         Leader           20.10.16\nng7q78fk4vhixxbzhe1xtm0fd     manager2   Ready     Active         Reachable        20.10.16\nx4m3q557wj79iul8ivtxz122k     worker1    Ready     Active                          20.10.16\n")])])]),a("h4",{attrs:{id:"_2-0-服务部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-服务部署"}},[e._v("#")]),e._v(" 2.0  服务部署")]),e._v(" "),a("blockquote",[a("p",[e._v("注意：跟集群管理有关的任何操作，都是在 Manager 节点上操作的。")])]),e._v(" "),a("h5",{attrs:{id:"_2-1-创建服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-创建服务"}},[e._v("#")]),e._v(" 2.1  创建服务")]),e._v(" "),a("ul",[a("li",[e._v("下面这个案例，使用 nginx 镜像创建了一个名为 mynginx 的服务，该服务会被随机指派给一个工作节点运行。\n"),a("ul",[a("li",[a("code",[e._v("docker service create")]),e._v("：创建服务；")]),e._v(" "),a("li",[a("code",[e._v("--replicas")]),e._v("：指定一个服务有几个实例运行；")]),e._v(" "),a("li",[a("code",[e._v("--name")]),e._v("：服务名称。")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service create --replicas 1 --name mynginx -p 80:80 nginx\n9eritgac3v7qp987gbmk06ldo\noverall progress: 1 out of 1 tasks \n1/1: running   [==================================================>] \nverify: Service converged \n")])])]),a("h5",{attrs:{id:"_2-2-查看服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-查看服务"}},[e._v("#")]),e._v(" 2.2  查看服务")]),e._v(" "),a("ul",[a("li",[e._v("可以通过 "),a("code",[e._v("docker service ls")]),e._v(" 查看运行的服务。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service ls\nID             NAME      MODE         REPLICAS   IMAGE          PORTS\n9eritgac3v7q   mynginx   replicated   1/1        nginx:latest   *:80->80/tcp\n")])])]),a("ul",[a("li",[e._v("可以通过 "),a("code",[e._v("docker service inspect 服务名称|服务ID")]),e._v(" 查看服务的详细信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager1 ~]# docker service inspect mynginx\n[\n    {\n        "ID": "9eritgac3v7qp987gbmk06ldo",\n        "Version": {\n            "Index": 59\n        },\n        "CreatedAt": "2022-05-14T12:41:23.106966446Z",\n        "UpdatedAt": "2022-05-14T12:41:23.138059604Z",\n        "Spec": {\n            "Name": "mynginx",\n            "Labels": {},\n            "TaskTemplate": {\n                "ContainerSpec": {\n                    "Image": "nginx:latest@sha256:2c72b42c3679c1c819d46296c4e79e69b2616fa28bea92e61d358980e18c9751",\n                    "Init": false,\n                    "StopGracePeriod": 10000000000,\n                    "DNSConfig": {},\n                    "Isolation": "default"\n                },\n                "Resources": {\n                    "Limits": {},\n                    "Reservations": {}\n                },\n                "RestartPolicy": {\n                    "Condition": "any",\n                    "Delay": 5000000000,\n                    "MaxAttempts": 0\n                },\n                "Placement": {\n                    "Platforms": [\n                        {\n                            "Architecture": "amd64",\n                            "OS": "linux"\n                        },\n                        {\n                            "OS": "linux"\n                        },\n                        {\n                            "OS": "linux"\n                        },\n                        {\n                            "Architecture": "arm64",\n                            "OS": "linux"\n                        },\n                        {\n                            "Architecture": "386",\n                            "OS": "linux"\n                        },\n                        {\n                            "Architecture": "mips64le",\n                            "OS": "linux"\n                        },\n                        {\n                            "Architecture": "ppc64le",\n                            "OS": "linux"\n                        },\n                        {\n                            "Architecture": "s390x",\n                            "OS": "linux"\n                        }\n                    ]\n                },\n                "ForceUpdate": 0,\n                "Runtime": "container"\n            },\n            "Mode": {\n                "Replicated": {\n                    "Replicas": 1\n                }\n            },\n            "UpdateConfig": {\n                "Parallelism": 1,\n                "FailureAction": "pause",\n                "Monitor": 5000000000,\n                "MaxFailureRatio": 0,\n                "Order": "stop-first"\n            },\n            "RollbackConfig": {\n                "Parallelism": 1,\n                "FailureAction": "pause",\n                "Monitor": 5000000000,\n                "MaxFailureRatio": 0,\n                "Order": "stop-first"\n            },\n            "EndpointSpec": {\n                "Mode": "vip",\n                "Ports": [\n                    {\n                        "Protocol": "tcp",\n                        "TargetPort": 80,\n                        "PublishedPort": 80,\n                        "PublishMode": "ingress"\n                    }\n                ]\n            }\n        },\n        "Endpoint": {\n            "Spec": {\n                "Mode": "vip",\n                "Ports": [\n                    {\n                        "Protocol": "tcp",\n                        "TargetPort": 80,\n                        "PublishedPort": 80,\n                        "PublishMode": "ingress"\n                    }\n                ]\n            },\n            "Ports": [\n                {\n                    "Protocol": "tcp",\n                    "TargetPort": 80,\n                    "PublishedPort": 80,\n                    "PublishMode": "ingress"\n                }\n            ],\n            "VirtualIPs": [\n                {\n                    "NetworkID": "xuhllxuf5o7rcw74t1odqewbq",\n                    "Addr": "10.0.0.9/24"\n                }\n            ]\n        }\n    }\n]\n')])])]),a("ul",[a("li",[e._v("可以通过 "),a("code",[e._v("docker service logs 服务名称|服务ID")]),e._v(" 查看服务日志。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service logs mynginx\nmynginx.1.4wt9m2b2khos@manager1    | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n")])])]),a("ul",[a("li",[e._v("可以通过 "),a("code",[e._v("docker service ps 服务名称|服务ID")]),e._v(" 查看服务运行在哪些节点上。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service ps mynginx\nID             NAME        IMAGE          NODE       DESIRED STATE   CURRENT STATE           ERROR     PORTS\n4wt9m2b2khos   mynginx.1   nginx:latest   manager1   Running         Running 5 minutes ago             \n")])])]),a("ul",[a("li",[e._v("在对应的任务节点上运行 "),a("code",[e._v("docker ps")]),e._v(" 可以查看该服务对应容器的相关信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS     NAMES\n1f54c0fd4ccc   nginx:latest   "/docker-entrypoint.…"   6 minutes ago   Up 6 minutes   80/tcp    mynginx.1.4wt9m2b2khoso73xuzcxxusv1\n')])])]),a("h5",{attrs:{id:"_2-3-调用服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-调用服务"}},[e._v("#")]),e._v(" 2.3  调用服务")]),e._v(" "),a("ul",[a("li",[e._v("接下来我们测试一下服务是否能被正常访问，并且该集群下任意节点的 IP 地址都要能访问到该服务才行。")]),e._v(" "),a("li",[e._v("测试结果：5 台机器均可正常访问到该服务。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager1 ~]# curl http://192.168.217.3\n[root@manager1 ~]# curl http://192.168.217.4\n[root@manager1 ~]# curl http://192.168.217.5\n[root@manager1 ~]# curl http://192.168.217.6\n[root@manager1 ~]# curl http://192.168.217.7\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\nhtml { color-scheme: light dark; }\nbody { width: 35em; margin: 0 auto;\nfont-family: Tahoma, Verdana, Arial, sans-serif; }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href="http://nginx.org/">nginx.org</a>.<br/>\nCommercial support is available at\n<a href="http://nginx.com/">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n')])])]),a("h5",{attrs:{id:"_2-4-弹性服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-弹性服务"}},[e._v("#")]),e._v(" 2.4  弹性服务")]),e._v(" "),a("ul",[a("li",[e._v("将 service 部署到集群以后，可以通过命令弹性扩缩容 service 中的容器数量。在 service 中运行的容器被称为 task（任务）。")]),e._v(" "),a("li",[e._v("通过 "),a("code",[e._v("docker service scale 服务名称|服务ID=n")]),e._v(" 可以将 service 运行的任务扩缩容为 n 个。")]),e._v(" "),a("li",[e._v("通过 "),a("code",[e._v("docker service update --replicas n 服务名称|服务ID")]),e._v(" 也可以达到扩缩容的效果。")]),e._v(" "),a("li",[e._v("将 mynginx service 运行的任务扩展为 5 个：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service scale mynginx=5\nmynginx scaled to 5\noverall progress: 5 out of 5 tasks \n1/5: running   [==================================================>] \n2/5: running   [==================================================>] \n3/5: running   [==================================================>] \n4/5: running   [==================================================>] \n5/5: running   [==================================================>] \nverify: Service converged \n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker service ps 服务名称|服务ID")]),e._v(" 查看服务运行在哪些节点上。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service ps mynginx    \nID             NAME        IMAGE          NODE       DESIRED STATE   CURRENT STATE                ERROR     PORTS\n4wt9m2b2khos   mynginx.1   nginx:latest   manager1   Running         Running 16 minutes ago                 \n0mo1srz65n6j   mynginx.2   nginx:latest   worker1    Running         Running about a minute ago             \n7vjifeyye1ki   mynginx.3   nginx:latest   worker2    Running         Running about a minute ago             \ns89qdssfw1xy   mynginx.4   nginx:latest   manager2   Running         Running about a minute ago             \nt65wugi3abpt   mynginx.5   nginx:latest   manager3   Running         Running about a minute ago             \n")])])]),a("ul",[a("li",[e._v("我们再来一波缩容的操作，命令如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service update --replicas 3 mynginx\nmynginx\noverall progress: 3 out of 3 tasks \n1/3: running   [==================================================>] \n2/3: running   [==================================================>] \n3/3: running   [==================================================>] \nverify: Service converged \n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker service ps 服务名称|服务ID")]),e._v(" 查看服务运行在哪些节点上。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service ps mynginx\nID             NAME        IMAGE          NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS\n4wt9m2b2khos   mynginx.1   nginx:latest   manager1   Running         Running 18 minutes ago             \n0mo1srz65n6j   mynginx.2   nginx:latest   worker1    Running         Running 3 minutes ago              \n7vjifeyye1ki   mynginx.3   nginx:latest   worker2    Running         Running 3 minutes ago              \n")])])]),a("ul",[a("li",[e._v("在 Swarm 集群模式下真正意义实现了所谓的"),a("strong",[e._v("弹性服务")]),e._v("，动态扩缩容一行命令搞定，简单、便捷、强大。")])]),e._v(" "),a("h5",{attrs:{id:"_2-5-删除服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-删除服务"}},[e._v("#")]),e._v(" 2.5  删除服务")]),e._v(" "),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker service rm 服务名称|服务ID")]),e._v(" 即可删除服务。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service ls\nID             NAME      MODE         REPLICAS   IMAGE          PORTS\n9eritgac3v7q   mynginx   replicated   3/3        nginx:latest   *:80->80/tcp\n[root@manager1 ~]# docker service rm mynginx\nmynginx\n[root@manager1 ~]# docker service ls\nID        NAME      MODE      REPLICAS   IMAGE     PORTS\n")])])]),a("h4",{attrs:{id:"_3-0-滚动更新及回滚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-滚动更新及回滚"}},[e._v("#")]),e._v(" 3.0  滚动更新及回滚")]),e._v(" "),a("ul",[a("li",[e._v("以下案例将演示 Redis 版本如何滚动升级至更高版本再回滚至上一次的操作。")]),e._v(" "),a("li",[e._v("首先，创建 5 个 Redis 服务副本，版本为 5，详细命令如下：\n"),a("ul",[a("li",[a("code",[e._v("--update-delay")]),e._v("：定义滚动更新的时间间隔；")]),e._v(" "),a("li",[a("code",[e._v("--update-parallelism")]),e._v("：定义并行更新的副本数量，默认为 1；")]),e._v(" "),a("li",[a("code",[e._v("--update-failure-action")]),e._v("：定义容器启动失败之后所执行的动作；")]),e._v(" "),a("li",[a("code",[e._v("--rollback-monitor")]),e._v("：定义回滚的监控时间；")]),e._v(" "),a("li",[a("code",[e._v("--rollback-parallelism")]),e._v("：定义并行回滚的副本数量；")]),e._v(" "),a("li",[a("code",[e._v("--rollback-max-failure-ratio")]),e._v("：任务失败回滚比率，超过该比率执行回滚操作，0.2 表示 20%。")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service create --replicas 5 --name myredis --update-delay 10s --update-parallelism 2 --update-failure-action continue --rollback-monitor 20s --rollback-parallelism 2 --rollback-max-failure-ratio 0.2 redis:5j3jlu2t8ccd3uoj7e1tf0qcab\noverall progress: 5 out of 5 tasks \n1/5: running   [==================================================>] \n2/5: running   [==================================================>] \n3/5: running   [==================================================>] \n4/5: running   [==================================================>] \n5/5: running   [==================================================>] \nverify: Service converged \n[root@manager1 ~]# docker service ls\nID             NAME      MODE         REPLICAS   IMAGE     PORTS\nj3jlu2t8ccd3   myredis   replicated   5/5        redis:5   \n[root@manager1 ~]# docker service ps myredis\nID             NAME        IMAGE     NODE       DESIRED STATE   CURRENT STATE            ERROR     PORTS\nhlgkun8nrpb4   myredis.1   redis:5   worker2    Running         Running 59 seconds ago             \nmzzr3tpn9y6b   myredis.2   redis:5   manager1   Running         Running 59 seconds ago             \nxtvwqwgsi504   myredis.3   redis:5   manager2   Running         Running 59 seconds ago             \n09y4tc7p8fys   myredis.4   redis:5   manager3   Running         Running 59 seconds ago             \nk71umcm3gq3f   myredis.5   redis:5   worker1    Running         Running 59 seconds ago \n")])])]),a("ul",[a("li",[e._v("然后通过以下命令实现服务的滚动更新。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker service update --image redis:6 myredis\nmyredis\noverall progress: 5 out of 5 tasks \n1/5: running   [==================================================>] \n2/5: running   [==================================================>] \n3/5: running   [==================================================>] \n4/5: running   [==================================================>] \n5/5: running   [==================================================>] \nverify: Service converged \n[root@manager1 ~]# docker service ps myredis\nID             NAME            IMAGE     NODE       DESIRED STATE   CURRENT STATE                 ERROR     PORTS\nip8u5w5aqclv   myredis.1       redis:6   worker1    Running         Running about a minute ago              \nhlgkun8nrpb4    \\_ myredis.1   redis:5   worker2    Shutdown        Shutdown about a minute ago             \n870n295yfigv   myredis.2       redis:6   manager1   Running         Running about a minute ago              \nmzzr3tpn9y6b    \\_ myredis.2   redis:5   manager1   Shutdown        Shutdown about a minute ago             \nrrots5gmu1al   myredis.3       redis:6   manager2   Running         Running about a minute ago              \nxtvwqwgsi504    \\_ myredis.3   redis:5   manager2   Shutdown        Shutdown about a minute ago             \nlsf10n5aa17z   myredis.4       redis:6   manager3   Running         Running 49 seconds ago                  \n09y4tc7p8fys    \\_ myredis.4   redis:5   manager3   Shutdown        Shutdown 59 seconds ago                 \nzntzu5lz135r   myredis.5       redis:6   worker2    Running         Running about a minute ago              \nk71umcm3gq3f    \\_ myredis.5   redis:5   worker1    Shutdown        Shutdown about a minute ago             \n")])])]),a("ul",[a("li",[e._v("回滚服务，只能回滚到上一次操作的状态，并不能连续回滚到指定操作。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager1 ~]# docker service update --rollback myredis\nmyredis\nrollback: manually requested rollback \noverall progress: rolling back update: 5 out of 5 tasks \n1/5: running   [>                                                  ] \n2/5: running   [>                                                  ] \n3/5: running   [>                                                  ] \n4/5: running   [>                                                  ] \n5/5: running   [>                                                  ] \nverify: Service converged \n[root@manager1 ~]# docker service ps myredis\nID             NAME            IMAGE     NODE       DESIRED STATE   CURRENT STATE             ERROR     PORTS\nlwdv0892dain   myredis.1       redis:5   worker1    Running         Running 16 seconds ago              \nip8u5w5aqclv    \\_ myredis.1   redis:6   worker1    Shutdown        Shutdown 16 seconds ago             \nhlgkun8nrpb4    \\_ myredis.1   redis:5   worker2    Shutdown        Shutdown 3 minutes ago              \n052guq61n5g7   myredis.2       redis:5   manager3   Running         Running 18 seconds ago              \n870n295yfigv    \\_ myredis.2   redis:6   manager1   Shutdown        Shutdown 19 seconds ago             \nmzzr3tpn9y6b    \\_ myredis.2   redis:5   manager1   Shutdown        Shutdown 3 minutes ago              \n7khmefsyg2jg   myredis.3       redis:5   manager2   Running         Running 13 seconds ago              \nrrots5gmu1al    \\_ myredis.3   redis:6   manager2   Shutdown        Shutdown 14 seconds ago             \nxtvwqwgsi504    \\_ myredis.3   redis:5   manager2   Shutdown        Shutdown 3 minutes ago              \nulldlv06lxqu   myredis.4       redis:5   manager1   Running         Running 17 seconds ago              \nlsf10n5aa17z    \\_ myredis.4   redis:6   manager3   Shutdown        Shutdown 19 seconds ago             \n09y4tc7p8fys    \\_ myredis.4   redis:5   manager3   Shutdown        Shutdown 2 minutes ago              \n5sck4bpkjvct   myredis.5       redis:5   worker2    Running         Running 15 seconds ago              \nzntzu5lz135r    \\_ myredis.5   redis:6   worker2    Shutdown        Shutdown 16 seconds ago             \nk71umcm3gq3f    \\_ myredis.5   redis:5   worker1    Shutdown        Shutdown 3 minutes ago              \n[root@manager1 ~]# docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS      NAMES\n531f6551df0e   redis:5   "docker-entrypoint.s…"   53 seconds ago   Up 51 seconds   6379/tcp   myredis.4.ulldlv06lxqukhnlnvzf2imxd\n[root@manager1 ~]# docker ps -a\nCONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS                          PORTS      NAMES\n531f6551df0e   redis:5   "docker-entrypoint.s…"   About a minute ago   Up About a minute               6379/tcp   myredis.4.ulldlv06lxqukhnlnvzf2imxd\n48048b4caacd   redis:6   "docker-entrypoint.s…"   4 minutes ago        Exited (0) About a minute ago              myredis.2.870n295yfigvjzctob5vcn209\n6c04e41fc606   redis:5   "docker-entrypoint.s…"   7 minutes ago        Exited (0) 4 minutes ago                   myredis.2.mzzr3tpn9y6bupvln32nq9qos\n[root@manager1 ~]# docker images\nREPOSITORY   TAG       IMAGE ID       CREATED      SIZE\nredis        <none>    972767e7d959   2 days ago   110MB\nredis        <none>    aa41c0869d44   2 days ago   113MB\n')])])]),a("h4",{attrs:{id:"_4-0-常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-常用命令"}},[e._v("#")]),e._v(" 4.0  常用命令")]),e._v(" "),a("h5",{attrs:{id:"_4-1-docker-swarm-help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-docker-swarm-help"}},[e._v("#")]),e._v(" 4.1  docker swarm [--help]")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("命令")]),e._v(" "),a("th",[e._v("说明")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("docker swarm init")]),e._v(" "),a("td",[e._v("初始化集群")])]),e._v(" "),a("tr",[a("td",[e._v("docker swarm join-token worker")]),e._v(" "),a("td",[e._v("查看工作节点的 token")])]),e._v(" "),a("tr",[a("td",[e._v("docker swarm join-token manager")]),e._v(" "),a("td",[e._v("查看管理节点的 token")])]),e._v(" "),a("tr",[a("td",[e._v("docker swarm join")]),e._v(" "),a("td",[e._v("加入集群")])])])]),e._v(" "),a("h5",{attrs:{id:"_4-2-docker-node-help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-docker-node-help"}},[e._v("#")]),e._v(" 4.2  docker node [--help]")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("命令")]),e._v(" "),a("th",[e._v("说明")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("docker node ls")]),e._v(" "),a("td",[e._v("查看集群所有节点")])]),e._v(" "),a("tr",[a("td",[e._v("docker node ps")]),e._v(" "),a("td",[e._v("查看当前节点所有任务")])]),e._v(" "),a("tr",[a("td",[e._v("docker node rm 节点名称|节点ID")]),e._v(" "),a("td",[e._v("删除节点（"),a("code",[e._v("-f")]),e._v("强制删除）")])]),e._v(" "),a("tr",[a("td",[e._v("docker node inspect 节点名称|节点ID")]),e._v(" "),a("td",[e._v("查看节点详情")])]),e._v(" "),a("tr",[a("td",[e._v("docker node demote 节点名称|节点ID")]),e._v(" "),a("td",[e._v("节点降级，由管理节点降级为工作节点")])]),e._v(" "),a("tr",[a("td",[e._v("docker node promote 节点名称|节点ID")]),e._v(" "),a("td",[e._v("节点升级，由工作节点升级为管理节点")])]),e._v(" "),a("tr",[a("td",[e._v("docker node update 节点名称|节点ID")]),e._v(" "),a("td",[e._v("更新节点")])])])]),e._v(" "),a("h5",{attrs:{id:"_4-3-docker-service-help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-docker-service-help"}},[e._v("#")]),e._v(" 4.3  docker service [--help]")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("命令")]),e._v(" "),a("th",[e._v("说明")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("docker service create")]),e._v(" "),a("td",[e._v("创建服务")])]),e._v(" "),a("tr",[a("td",[e._v("docker service ls")]),e._v(" "),a("td",[e._v("查看所有服务")])]),e._v(" "),a("tr",[a("td",[e._v("docker service ps 服务名称|服务ID")]),e._v(" "),a("td",[e._v("查看服务运行在哪些节点上")])]),e._v(" "),a("tr",[a("td",[e._v("docker service inspect 服务名称|服务ID")]),e._v(" "),a("td",[e._v("查看服务详情")])]),e._v(" "),a("tr",[a("td",[e._v("docker service logs 服务名称|服务ID")]),e._v(" "),a("td",[e._v("查看服务日志")])]),e._v(" "),a("tr",[a("td",[e._v("docker service rm 服务名称|服务ID")]),e._v(" "),a("td",[e._v("删除服务（"),a("code",[e._v("-f")]),e._v("强制删除）")])]),e._v(" "),a("tr",[a("td",[e._v("docker service scale 服务名称|服务ID=n")]),e._v(" "),a("td",[e._v("设置服务数量")])]),e._v(" "),a("tr",[a("td",[e._v("docker service update 服务名称|服务ID")]),e._v(" "),a("td",[e._v("更新服务")])])])]),e._v(" "),a("h4",{attrs:{id:"_5-0-参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-参考资料"}},[e._v("#")]),e._v(" 5.0  参考资料")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/swarm-tutorial/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/swarm-tutorial/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/swarm-mode/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/swarm-mode/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/how-swarm-mode-works/pki/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/how-swarm-mode-works/pki/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/join-nodes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/join-nodes/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/swarm-tutorial/rolling-update/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/swarm-tutorial/rolling-update/"),a("OutboundLink")],1)])]),e._v(" "),a("h3",{attrs:{id:"docker-swarm-集群管理利器核心概念扫盲"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-swarm-集群管理利器核心概念扫盲"}},[e._v("#")]),e._v(" Docker Swarm 集群管理利器核心概念扫盲")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker15.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Swarm 集群管理利器核心概念扫盲"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_1-0-swarm-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-swarm-简介"}},[e._v("#")]),e._v(" 1.0 Swarm 简介")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Docker Swarm 是 Docker 官方推出的容器集群管理工具，基于 Go 语言实现。代码开源在："),a("a",{attrs:{href:"https://github.com/docker/swarm",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/docker/swarm"),a("OutboundLink")],1),e._v(" 使用它可以将多个 Docker 主机封装为单个大型的虚拟 Docker 主机，快速打造一套容器云平台。")])]),e._v(" "),a("li",[a("p",[e._v("Docker Swarm 是生产环境中运行 Docker 应用程序最简单的方法。作为容器集群管理器，Swarm 最大的优势之一就是 100% 支持标准的 Docker API。各种基于标准 API 的工具比如 Compose、docker-py、各种管理软件，甚至 Docker 本身等都可以很容易的与 Swarm 进行集成。大大方便了用户将原先基于单节点的系统移植到 Swarm 上，同时 Swarm 内置了对 Docker 网络插件的支持，用户可以很容易地部署跨主机的容器集群服务。")])]),e._v(" "),a("li",[a("p",[e._v("Docker Swarm 和 Docker Compose 一样，都是 Docker 官方容器编排工具，但不同的是，"),a("strong",[e._v("Docker Compose 是一个在单个服务器或主机上创建多个容器的工具")]),e._v("，而 "),a("strong",[e._v("Docker Swarm 则可以在多个服务器或主机上创建容器集群服务")]),e._v("，对于微服务的部署，显然 Docker Swarm 会更加适合。")])])]),e._v(" "),a("h4",{attrs:{id:"_2-0-swarm-核心概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-swarm-核心概念"}},[e._v("#")]),e._v(" 2.0 Swarm 核心概念")]),e._v(" "),a("h5",{attrs:{id:"_2-1-swarm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-swarm"}},[e._v("#")]),e._v(" 2.1  Swarm")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Docker Engine 1.12 引入了 Swarm 模式，一个 Swarm 由多个 Docker 主机组成，它们以 Swarm 集群模式运行。Swarm 集群由 "),a("strong",[e._v("Manager 节点")]),e._v("（管理者角色，管理成员和委托任务）和 "),a("strong",[e._v("Worker 节点")]),e._v("（工作者角色，运行 Swarm 服务）组成。这些 Docker 主机有些是 Manager 节点，有些是 Worker 节点，或者同时扮演这两种角色。")])]),e._v(" "),a("li",[a("p",[e._v("Swarm 创建服务时，需要指定要使用的镜像、在运行的容器中执行的命令、定义其副本的数量、可用的网络和数据卷、将服务公开给外部的端口等等。与独立容器相比，群集服务的主要优势之一是，你可以修改服务的配置，包括它所连接的网络和数据卷等，而不需要手动重启服务。还有就是，如果一个 Worker Node 不可用了，Docker 会调度不可用 Node 的 Task 任务到其他 Nodes 上。")])])]),e._v(" "),a("h5",{attrs:{id:"_2-2-nodes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-nodes"}},[e._v("#")]),e._v(" 2.2  Nodes")]),e._v(" "),a("ul",[a("li",[e._v("Swarm 集群由 "),a("code",[e._v("Manager 节点")]),e._v("（管理者角色，管理成员和委托任务）和 "),a("code",[e._v("Worker 节点")]),e._v("（工作者角色，运行 Swarm 服务）组成。一个节点就是 Swarm 集群中的一个实例，也就是一个 Docker 主机。你可以运行一个或多个节点在单台物理机或云服务器上，但是生产环境上，典型的部署方式是：Docker 节点交叉分布式部署在多台物理机或云主机上。节点名称默认为机器的 "),a("code",[e._v("hostname")]),e._v("。\n"),a("ul",[a("li",[a("code",[e._v("Manager")]),e._v("：负责整个集群的管理工作包括集群配置、服务管理、容器编排等所有跟集群有关的工作，它会选举出一个 leader 来指挥编排任务；")]),e._v(" "),a("li",[a("code",[e._v("Worker")]),e._v("：工作节点接收和执行从管理节点分派的任务（Tasks）运行在相应的服务（Services）上。\n"),a("img",{attrs:{src:n(510),alt:"docker-swarm-nodes"}})])])])]),e._v(" "),a("h5",{attrs:{id:"_2-3-services-and-tasks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-services-and-tasks"}},[e._v("#")]),e._v(" 2.3  Services and Tasks")]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("服务")]),e._v("（Service）是一个抽象的概念，是对要在管理节点或工作节点上执行的"),a("strong",[e._v("任务的定义")]),e._v("。它是集群系统的中心结构，是用户与集群交互的主要根源。Swarm 创建服务时，可以为服务定义以下信息：")]),e._v(" "),a("ul",[a("li",[e._v("服务名称；")]),e._v(" "),a("li",[e._v("使用哪个镜像来创建容器；")]),e._v(" "),a("li",[e._v("要运行多少个副本；")]),e._v(" "),a("li",[e._v("服务的容器要连接到哪个网络上；")]),e._v(" "),a("li",[e._v("要映射哪些端口。\n"),a("img",{attrs:{src:n(511),alt:"docker-swarm-Services_and_Tasks"}})])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("任务")]),e._v("（Task）包括"),a("strong",[e._v("一个 Docker 容器")]),e._v("和"),a("strong",[e._v("在容器中运行的命令")]),e._v("。任务是一个集群的最小单元，任务与容器是一对一的关系。管理节点根据服务规模中设置的副本数量将任务分配给工作节点。一旦任务被分配到一个节点，便无法移动到另一个节点。它只能在分配的节点上运行或失败。")])])]),e._v(" "),a("h5",{attrs:{id:"_2-4-replicated-and-global-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-replicated-and-global-services"}},[e._v("#")]),e._v(" 2.4  Replicated and global services")]),e._v(" "),a("ul",[a("li",[e._v("Swarm 不只是提供了优秀的高可用性，同时也提供了节点的"),a("strong",[e._v("弹性扩容和缩容")]),e._v("的功能。可以通过以下两种类型的 Services 部署实现：\n"),a("ul",[a("li",[a("strong",[e._v("Replicated Services")]),e._v("：当服务需要动态扩缩容时，只需通过 "),a("code",[e._v("scale")]),e._v(" 参数或者 "),a("code",[e._v("--replicas n")]),e._v(" 参数指定运行相同任务的数量，即可复制出新的副本，将一系列复制任务分发至各节点当中，这种操作便称之为"),a("strong",[e._v("副本服务")]),e._v("（Replicate）。")]),e._v(" "),a("li",[a("strong",[e._v("Global Services")]),e._v("：我们也可以通过 "),a("code",[e._v("--mode global")]),e._v(" 参数将服务分发至全部节点之上，这种操作我们称之为"),a("strong",[e._v("全局服务")]),e._v("（Global）。在每个节点上运行一个相同的任务，不需要预先指定任务的数量，每增加一个节点到 Swarm 中，协调器就会创建一个任务，然后调度器把任务分配给新节点。")])])]),e._v(" "),a("li",[e._v("下图用黄色表示拥有三个副本服务 Replicated Service，用灰色表示拥有一个全局服务 Global Service。")])]),e._v(" "),a("p",[a("img",{attrs:{src:n(512),alt:"docker-swarm-Replicated_and_global_services"}})]),e._v(" "),a("h4",{attrs:{id:"_3-0-swarm-工作流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-swarm-工作流程"}},[e._v("#")]),e._v(" 3.0  Swarm 工作流程")]),e._v(" "),a("p",[a("img",{attrs:{src:n(513),alt:"docker-swarm-workflow"}})]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Swarm Manager：")]),e._v(" "),a("ol",[a("li",[e._v("API：接受命令并创建 service 对象（创建对象）")]),e._v(" "),a("li",[e._v("orchestrator：为 service 对象创建的 task 进行编排工作（服务编排）")]),e._v(" "),a("li",[e._v("allocater：为各个 task 分配 IP 地址（分配 IP）")]),e._v(" "),a("li",[e._v("dispatcher：将 task 分发到 nodes（分发任务）")]),e._v(" "),a("li",[e._v("scheduler：安排一个 worker 节点运行 task（运行任务）")])])]),e._v(" "),a("li",[a("p",[e._v("Worker Node：")]),e._v(" "),a("ol",[a("li",[e._v("worker：连接到调度器，检查分配的 task（检查任务）")]),e._v(" "),a("li",[e._v("executor：执行分配给 worker 节点的 task（执行任务）")])])])]),e._v(" "),a("h4",{attrs:{id:"_4-0-overlay-网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-overlay-网络"}},[e._v("#")]),e._v(" 4.0  Overlay 网络")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("关于 Docker 的网络我们在《Docker 网络模式详解及容器间网络通信》中已经给大家详细讲解过。不过，Docker Swarm 集群模式下却默认使用的是 Overlay 网络（覆盖网络），这里简单介绍一下什么是 Overlay 网络。")])]),e._v(" "),a("li",[a("p",[e._v("Overlay 网络其实并不是一门新技术，它是指构建在另一个网络上的计算机网络，这是一种网络虚拟化技术的形式，近年来云计算虚拟化技术的演进促进了网络虚拟化技术的应用。所以 Overlay 网络就是建立在另一个计算机网络之上的虚拟网络，它是不能独立出现的，Overlay 底层依赖的网络就是 Underlay 网络。")])]),e._v(" "),a("li",[a("p",[e._v("Underlay 网络是专门用来承载用户 IP 流量的基础架构层，它与 Overlay 网络之间的关系有点类似物理机和虚拟机。Underlay 网络和物理机都是真正存在的实体，它们分别对应着真实存在的网络设备和计算设备，而 Overlay 网络和虚拟机都是依托在下层实体的基础之上，使用软件虚拟出来的层级。\n"),a("img",{attrs:{src:n(514),alt:"docker-swarm-overlay"}})])]),e._v(" "),a("li",[a("p",[e._v("在 Docker 版本 1.12 以后 "),a("strong",[e._v("Swarm 模式原生已支持覆盖网络")]),e._v("（Overlay Network），只要是这个覆盖网络内的容器，不管在不在同一个宿主机上都能相互通信，即跨主机通信。不同覆盖网络内的容器之间是相互隔离的（相互 ping 不通）。")])]),e._v(" "),a("li",[a("p",[e._v("Overlay 网络是目前主流的容器跨节点数据传输和路由方案。当然，容器在跨主机进行通信的时候，除了可以使用 overlay 网络模式进行通信之外，还可以使用 host 网络模式，直接使用物理机的 IP 地址就可以进行通信。")])])]),e._v(" "),a("h4",{attrs:{id:"_5-0-参考资料-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-参考资料-2"}},[e._v("#")]),e._v(" 5.0  参考资料")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/key-concepts/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/key-concepts/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/swarm-tutorial/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/swarm-tutorial/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/how-swarm-mode-works/nodes/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/how-swarm-mode-works/nodes/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/"),a("OutboundLink")],1)])]),e._v(" "),a("h3",{attrs:{id:"docker-compose-搭建-redis-cluster-集群环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-搭建-redis-cluster-集群环境"}},[e._v("#")]),e._v(" Docker Compose 搭建 Redis Cluster 集群环境")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker14.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Compose 搭建 Redis Cluster 集群环境"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("在前文《Docker 搭建 Redis Cluster 集群环境》中我已经教过大家如何搭建了，本文使用 Docker Compose 再带大家搭建一遍，其目的主要是为了让大家感受 Docker Compose 所带来的便捷之处。")])]),e._v(" "),a("li",[a("p",[e._v("按照 Redis 官网："),a("a",{attrs:{href:"https://redis.io/topics/cluster-tutorial",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://redis.io/topics/cluster-tutorial"),a("OutboundLink")],1),e._v(" 的提示，为了使 Docker 与 Redis Cluster 兼容，您需要使用 Docker 的 "),a("code",[e._v("host")]),e._v(" 网络模式。")]),e._v(" "),a("ul",[a("li",[e._v("https://redis.io/docs/manual/scaling/#redis-cluster-and-docker")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("host")]),e._v(" 网络模式需要在创建容器时通过参数 "),a("code",[e._v("--net host")]),e._v(" 或者 "),a("code",[e._v("--network host")]),e._v(" 指定，"),a("code",[e._v("host")]),e._v(" 网络模式可以让"),a("code",[e._v("容器共享宿主机网络栈")]),e._v("，容器将不会虚拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口。")])]),e._v(" "),a("li",[a("p",[e._v("关于 Docker 网络模式更多的内容请阅读《Docker 网络模式详解及容器间网络通信》。")])])]),e._v(" "),a("h4",{attrs:{id:"_1-0-环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-环境"}},[e._v("#")]),e._v(" 1.0  环境")]),e._v(" "),a("ul",[a("li",[e._v("同 《Docker 搭建 Redis Cluster 集群环境》\n"),a("ul",[a("li",[e._v("192.168.56.106 Docker")]),e._v(" "),a("li",[e._v("192.168.56.107 SystemFramework")])])])]),e._v(" "),a("h4",{attrs:{id:"_2-0-搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-搭建"}},[e._v("#")]),e._v(" 2.0  搭建")]),e._v(" "),a("ul",[a("li",[e._v("整体搭建步骤主要分为以下几步：\n"),a("ol",[a("li",[e._v("下载 Redis 镜像（其实这步可以省略，因为创建容器时，如果本地镜像不存在，就会去远程拉取）；")]),e._v(" "),a("li",[e._v("编写 Redis 配置文件；")]),e._v(" "),a("li",[e._v("编写 Docker Compose 模板文件；")]),e._v(" "),a("li",[e._v("创建并启动所有服务容器；")]),e._v(" "),a("li",[e._v("创建 Redis Cluster 集群。")])])])]),e._v(" "),a("h5",{attrs:{id:"_2-1-编写-redis-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-编写-redis-配置文件"}},[e._v("#")]),e._v(" 2.1  编写 Redis 配置文件")]),e._v(" "),a("h6",{attrs:{id:"创建目录及文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录及文件"}},[e._v("#")]),e._v(" 创建目录及文件")]),e._v(" "),a("ul",[a("li",[e._v("分别在 192.168.56.106 和 192.168.56.107 两台机器上执行以下操作。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 创建目录\n[root@ ~]# mkdir -p /usr/local/docker-redis/redis-cluster\n# 切换至指定目录\n[root@ ~]# cd /usr/local/docker-redis/redis-cluster\n# 编写 redis-cluster.tmpl 文件\n[root@ redis-cluster]# touch redis-cluster.tmpl\n")])])]),a("h6",{attrs:{id:"编写配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写配置文件"}},[e._v("#")]),e._v(" 编写配置文件")]),e._v(" "),a("ul",[a("li",[e._v("192.168.56.106(192.168.56.107) 机器的 redis-cluster.tmpl 文件内容如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("port ${PORT}\nrequirepass 1234\nmasterauth 1234\nprotected-mode no\ndaemonize no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 15000\ncluster-announce-ip 192.168.56.xxx\ncluster-announce-port ${PORT}\ncluster-announce-bus-port 1${PORT}\n")])])]),a("ul",[a("li",[a("code",[e._v("port")]),e._v("：节点端口；")]),e._v(" "),a("li",[a("code",[e._v("requirepass")]),e._v("：添加访问认证；")]),e._v(" "),a("li",[a("code",[e._v("masterauth")]),e._v("：如果主节点开启了访问认证，从节点访问主节点需要认证；")]),e._v(" "),a("li",[a("code",[e._v("protected-mode")]),e._v("：保护模式，默认值 yes，即开启。开启保护模式以后，需配置 bind ip 或者设置访问密码；关闭保护模式，外部网络可以直接访问；")]),e._v(" "),a("li",[a("code",[e._v("daemonize")]),e._v("：是否以守护线程的方式启动（后台启动），默认 no；")]),e._v(" "),a("li",[a("code",[e._v("appendonly")]),e._v("：是否开启 AOF 持久化模式，默认 no；")]),e._v(" "),a("li",[a("code",[e._v("cluster-enabled")]),e._v("：是否开启集群模式，默认 no；")]),e._v(" "),a("li",[a("code",[e._v("cluster-config-file")]),e._v("：集群节点信息文件；")]),e._v(" "),a("li",[a("code",[e._v("cluster-node-timeout")]),e._v("：集群节点连接超时时间；")]),e._v(" "),a("li",[a("code",[e._v("cluster-announce-ip")]),e._v("：集群节点 IP，填写宿主机的 IP；")]),e._v(" "),a("li",[a("code",[e._v("cluster-announce-port")]),e._v("：集群节点映射端口；")]),e._v(" "),a("li",[a("code",[e._v("cluster-announce-bus-port")]),e._v("：集群节点总线端口。")])]),e._v(" "),a("blockquote",[a("p",[e._v("每个 Redis 集群节点都需要打开两个 TCP 连接。一个用于为客户端提供服务的正常 Redis TCP 端口，例如 6379。还有一个基于 6379 端口加 10000 的端口，比如 16379。")])]),e._v(" "),a("blockquote",[a("p",[e._v("第二个端口用于集群总线，这是一个使用二进制协议的节点到节点通信通道。节点使用集群总线进行故障检测、配置更新、故障转移授权等等。客户端永远不要尝试与集群总线端口通信，与正常的 Redis 命令端口通信即可，但是请确保防火墙中的这两个端口都已经打开，否则 Redis 集群节点将无法通信。")])]),e._v(" "),a("ul",[a("li",[e._v("在 "),a("code",[e._v("192.168.56.106")]),e._v(" 机器的 "),a("code",[e._v("redis-cluster")]),e._v(" 目录下执行以下命令：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('for port in `seq 6371 6373`; do\n  echo "port is $port .";\n  mkdir -p ${port}/conf && PORT=${port} envsubst < redis-cluster.tmpl > ${port}/conf/redis.conf && mkdir -p ${port}/data;\ndone\n')])])]),a("ul",[a("li",[e._v("在 "),a("code",[e._v("192.168.56.107")]),e._v(" 机器的 "),a("code",[e._v("redis-cluster")]),e._v(" 目录下执行以下命令：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('for port in `seq 6374 6376`; do \\\n  echo "port is $port .";\\\n  mkdir -p ${port}/conf \\\n  && PORT=${port} envsubst < redis-cluster.tmpl > ${port}/conf/redis.conf \\\n  && mkdir -p ${port}/data; \\\ndone\n')])])]),a("blockquote",[a("p",[e._v("上面两段 shell for 语句，意思就是循环创建 6371 ~ 6376 相关的目录及文件。")])]),e._v(" "),a("ul",[a("li",[e._v("在 192.168.56.106(192.168.56.107)  机器执行查看命令结果如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker redis-cluster]# tree /usr/local/docker-redis/redis-cluster\n/usr/local/docker-redis/redis-cluster\n├── 6371\n│   ├── conf\n│   │   └── redis.conf\n│   └── data\n├── 6372\n│   ├── conf\n│   │   └── redis.conf\n│   └── data\n├── 6373\n│   ├── conf\n│   │   └── redis.conf\n│   └── data\n└── redis-cluster.tmpl\n\n9 directories, 4 files\n# 每个节点的配置文件详细信息。\n# [root@Docker redis-cluster]# cat /usr/local/docker-redis/redis-cluster/637[1-3]/conf/redis.conf  \n[root@Docker redis-cluster]# cat /usr/local/docker-redis/redis-cluster/637{1..3}/conf/redis.conf\nport 6371\nrequirepass 1234\nmasterauth 1234\nprotected-mode no\ndaemonize no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 15000\ncluster-announce-ip 192.168.56.106\ncluster-announce-port 6371\ncluster-announce-bus-port 16371\nport 6372\nrequirepass 1234\nmasterauth 1234\nprotected-mode no\ndaemonize no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 15000\ncluster-announce-ip 192.168.56.106\ncluster-announce-port 6372\ncluster-announce-bus-port 16372\nport 6373\nrequirepass 1234\nmasterauth 1234\nprotected-mode no\ndaemonize no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 15000\ncluster-announce-ip 192.168.56.106\ncluster-announce-port 6373\ncluster-announce-bus-port 16373\n\n[root@SystemFramework redis-cluster]# tree /usr/local/docker-redis/redis-cluster\n/usr/local/docker-redis/redis-cluster\n├── 6374\n│   ├── conf\n│   │   └── redis.conf\n│   └── data\n├── 6375\n│   ├── conf\n│   │   └── redis.conf\n│   └── data\n├── 6376\n│   ├── conf\n│   │   └── redis.conf\n│   └── data\n└── redis-cluster.tmpl\n\n9 directories, 4 files\n# 每个节点的配置文件详细信息。\n[root@SystemFramework redis-cluster]# cat /usr/local/docker-redis/redis-cluster/637{4..6}/conf/redis.conf   \nport 6374\nrequirepass 1234\nmasterauth 1234\nprotected-mode no\ndaemonize no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 15000\ncluster-announce-ip 192.168.56.107\ncluster-announce-port 6374\ncluster-announce-bus-port 16374\nport 6375\nrequirepass 1234\nmasterauth 1234\nprotected-mode no\ndaemonize no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 15000\ncluster-announce-ip 192.168.56.107\ncluster-announce-port 6375\ncluster-announce-bus-port 16375\nport 6376\nrequirepass 1234\nmasterauth 1234\nprotected-mode no\ndaemonize no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 15000\ncluster-announce-ip 192.168.56.107\ncluster-announce-port 6376\ncluster-announce-bus-port 16376\n")])])]),a("h5",{attrs:{id:"_2-2-编写-docker-compose-模板文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-编写-docker-compose-模板文件"}},[e._v("#")]),e._v(" 2.2  编写 Docker Compose 模板文件")]),e._v(" "),a("ul",[a("li",[e._v("在 "),a("code",[e._v("192.168.56.106")]),e._v(" 机器的 "),a("code",[e._v("/usr/local/docker-redis")]),e._v(" 目录下创建 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件并编辑。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 描述 Compose 文件的版本信息\nversion: "3.8"\n\n# 定义服务，可以多个\nservices:\n    redis-6371: # 服务名称\n        image: redis # 创建容器时所需的镜像\n        container_name: redis-6371 # 容器名称\n        restart: always # 容器总是重新启动\n        network_mode: "host" # host 网络模式\n        volumes: # 数据卷，目录挂载\n            - /usr/local/docker-redis/redis-cluster/6371/conf/redis.conf:/usr/local/etc/redis/redis.conf\n            - /usr/local/docker-redis/redis-cluster/6371/data:/data\n        command: redis-server /usr/local/etc/redis/redis.conf # 覆盖容器启动后默认执行的命令\n\n    redis-6372:\n        image: redis\n        container_name: redis-6372\n        network_mode: "host"\n        volumes:\n            - /usr/local/docker-redis/redis-cluster/6372/conf/redis.conf:/usr/local/etc/redis/redis.conf\n            - /usr/local/docker-redis/redis-cluster/6372/data:/data\n        command: redis-server /usr/local/etc/redis/redis.conf\n\n    redis-6373:\n        image: redis\n        container_name: redis-6373\n        network_mode: "host"\n        volumes:\n            - /usr/local/docker-redis/redis-cluster/6373/conf/redis.conf:/usr/local/etc/redis/redis.conf\n            - /usr/local/docker-redis/redis-cluster/6373/data:/data\n        command: redis-server /usr/local/etc/redis/redis.conf\n')])])]),a("ul",[a("li",[e._v("在 "),a("code",[e._v("192.168.56.107")]),e._v(" 机器的 "),a("code",[e._v("/usr/local/docker-redis")]),e._v(" 目录下创建 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件并编辑。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 描述 Compose 文件的版本信息\nversion: "3.8"\n\n# 定义服务，可以多个\nservices:\n    redis-6374: # 服务名称\n        image: redis # 创建容器时所需的镜像\n        container_name: redis-6374 # 容器名称\n        restart: always # 容器总是重新启动\n        network_mode: "host" # host 网络模式\n        volumes: # 数据卷，目录挂载\n            - /usr/local/docker-redis/redis-cluster/6374/conf/redis.conf:/usr/local/etc/redis/redis.conf\n            - /usr/local/docker-redis/redis-cluster/6374/data:/data\n        command: redis-server /usr/local/etc/redis/redis.conf # 覆盖容器启动后默认执行的命令\n\n    redis-6375:\n        image: redis\n        container_name: redis-6375\n        network_mode: "host"\n        volumes:\n            - /usr/local/docker-redis/redis-cluster/6375/conf/redis.conf:/usr/local/etc/redis/redis.conf\n            - /usr/local/docker-redis/redis-cluster/6375/data:/data\n        command: redis-server /usr/local/etc/redis/redis.conf\n\n    redis-6376:\n        image: redis\n        container_name: redis-6376\n        network_mode: "host"\n        volumes:\n            - /usr/local/docker-redis/redis-cluster/6376/conf/redis.conf:/usr/local/etc/redis/redis.conf\n            - /usr/local/docker-redis/redis-cluster/6376/data:/data\n        command: redis-server /usr/local/etc/redis/redis.conf\n')])])]),a("h5",{attrs:{id:"_2-3-创建并启动所有服务容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-创建并启动所有服务容器"}},[e._v("#")]),e._v(" 2.3  创建并启动所有服务容器")]),e._v(" "),a("ul",[a("li",[e._v("分别在 "),a("code",[e._v("192.168.56.106")]),e._v(" 和 "),a("code",[e._v("192.168.56.107")]),e._v(" 机器的 "),a("code",[e._v("/usr/local/docker-redis")]),e._v(" 目录下执行以下命令：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker redis-cluster]# docker-compose up -d\nCreating redis-6372 ... done\nCreating redis-6371 ... done\nCreating redis-6373 ... done\n[root@Docker redis-cluster]# docker-compose ps\n   Name                 Command               State   Ports\n-----------------------------------------------------------\nredis-6371   docker-entrypoint.sh redis ...   Up           \nredis-6372   docker-entrypoint.sh redis ...   Up           \nredis-6373   docker-entrypoint.sh redis ...   Up\n\n[root@SystemFramework redis-cluster]# docker-compose up -d\nCreating redis-6374 ... done\nCreating redis-6375 ... done\nCreating redis-6376 ... done\n[root@SystemFramework redis-cluster]# docker-compose ps\n   Name                 Command               State   Ports\n-----------------------------------------------------------\nredis-6374   docker-entrypoint.sh redis ...   Up           \nredis-6375   docker-entrypoint.sh redis ...   Up           \nredis-6376   docker-entrypoint.sh redis ...   Up\n")])])]),a("h5",{attrs:{id:"_2-4-创建-redis-cluster-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-创建-redis-cluster-集群"}},[e._v("#")]),e._v(" 2.4  创建 Redis Cluster 集群")]),e._v(" "),a("ul",[a("li",[e._v("请先确保你的两台机器可以互相通信，然后随便进入一个容器节点，并进入 "),a("code",[e._v("/usr/local/bin/")]),e._v(" 目录：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 进入容器\n[root@Docker redis-cluster]# docker-compose exec redis-6371 bash\n# 切换至指定目录\nroot@Docker:/data# cd /usr/local/bin/\n")])])]),a("ul",[a("li",[e._v("接下来我们就可以通过以下命令实现 Redis Cluster 集群的创建。出现选择提示信息，输入 yes，结果如下所示，集群创建成功如下：\n"),a("ol",[a("li",[e._v("关闭两台机器防火墙 "),a("code",[e._v("systemctl stop firewalld")])])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("root@Docker:/usr/local/bin# redis-cli -a 1234 --cluster create 192.168.56.106:6371 192.168.56.106:6372 192.168.56.106:6373 192.168.56.107:6374 192.168.56.107:6375 192.168.56.107:6376 --cluster-replicas 1\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n>>> Performing hash slots allocation on 6 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nAdding replica 192.168.56.107:6376 to 192.168.56.106:6371\nAdding replica 192.168.56.106:6373 to 192.168.56.107:6374\nAdding replica 192.168.56.107:6375 to 192.168.56.106:6372\nM: 908cef996b9759912ce2ff18eb6388618177ff95 192.168.56.106:6371\n   slots:[0-5460] (5461 slots) master\nM: 363710c4657b85add9aa38982b0cf475917cda2e 192.168.56.106:6372\n   slots:[10923-16383] (5461 slots) master\nS: b2157db1aa59644c62a3006c6388d6a256eb5ef4 192.168.56.106:6373\n   replicates 85bd9a592cd33351d348b8390f74764e8f6622e7\nM: 85bd9a592cd33351d348b8390f74764e8f6622e7 192.168.56.107:6374\n   slots:[5461-10922] (5462 slots) master\nS: d620e4bf67eb0c152944ebeb51b7cb8e96942dd3 192.168.56.107:6375\n   replicates 363710c4657b85add9aa38982b0cf475917cda2e\nS: 43e3cedfb93dbd312adb08bc41e717fc3baf08ad 192.168.56.107:6376\n   replicates 908cef996b9759912ce2ff18eb6388618177ff95\nCan I set the above configuration? (type 'yes' to accept): yes\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n# 两台机器防火墙未关闭，此时会一直等待\n>>> Performing Cluster Check (using node 192.168.56.106:6371)\nM: 908cef996b9759912ce2ff18eb6388618177ff95 192.168.56.106:6371\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: 43e3cedfb93dbd312adb08bc41e717fc3baf08ad 192.168.56.107:6376\n   slots: (0 slots) slave\n   replicates 908cef996b9759912ce2ff18eb6388618177ff95\nS: d620e4bf67eb0c152944ebeb51b7cb8e96942dd3 192.168.56.107:6375\n   slots: (0 slots) slave\n   replicates 363710c4657b85add9aa38982b0cf475917cda2e\nS: b2157db1aa59644c62a3006c6388d6a256eb5ef4 192.168.56.106:6373\n   slots: (0 slots) slave\n   replicates 85bd9a592cd33351d348b8390f74764e8f6622e7\nM: 363710c4657b85add9aa38982b0cf475917cda2e 192.168.56.106:6372\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nM: 85bd9a592cd33351d348b8390f74764e8f6622e7 192.168.56.107:6374\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n")])])]),a("ul",[a("li",[e._v("至此一个高可用的 Redis Cluster 集群搭建完成，如下图所示，该集群中包含 6 个 Redis 节点，3 主 3 从。三个主节点会分配槽，处理客户端的命令请求，而从节点可用在主节点故障后，顶替主节点。\n"),a("img",{attrs:{src:n(515),alt:"docker-compose_redis-cluster"}})])]),e._v(" "),a("h4",{attrs:{id:"_3-0-查看集群状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-查看集群状态"}},[e._v("#")]),e._v(" 3.0  查看集群状态")]),e._v(" "),a("ul",[a("li",[e._v("我们先进入容器，然后通过一些集群常用的命令查看一下集群的状态。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 进入容器\n[root@Docker redis-cluster]# docker-compose exec redis-6371 bash\n# 切换至指定目录\nroot@Docker:/data# cd /usr/local/bin/\n")])])]),a("h5",{attrs:{id:"_3-1-检查集群状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-检查集群状态"}},[e._v("#")]),e._v(" 3.1  检查集群状态")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("root@Docker:/usr/local/bin# redis-cli -a 1234 --cluster check 192.168.56.107:6375\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n192.168.56.106:6371 (908cef99...) -> 0 keys | 5461 slots | 1 slaves.\n192.168.56.106:6372 (363710c4...) -> 0 keys | 5461 slots | 1 slaves.\n192.168.56.107:6374 (85bd9a59...) -> 0 keys | 5462 slots | 1 slaves.\n[OK] 0 keys in 3 masters.\n0.00 keys per slot on average.\n>>> Performing Cluster Check (using node 192.168.56.107:6375)\nS: d620e4bf67eb0c152944ebeb51b7cb8e96942dd3 192.168.56.107:6375\n   slots: (0 slots) slave\n   replicates 363710c4657b85add9aa38982b0cf475917cda2e\nS: b2157db1aa59644c62a3006c6388d6a256eb5ef4 192.168.56.106:6373\n   slots: (0 slots) slave\n   replicates 85bd9a592cd33351d348b8390f74764e8f6622e7\nM: 908cef996b9759912ce2ff18eb6388618177ff95 192.168.56.106:6371\n   slots:[0-5460] (5461 slots) master\n   1 additional replica(s)\nS: 43e3cedfb93dbd312adb08bc41e717fc3baf08ad 192.168.56.107:6376\n   slots: (0 slots) slave\n   replicates 908cef996b9759912ce2ff18eb6388618177ff95\nM: 363710c4657b85add9aa38982b0cf475917cda2e 192.168.56.106:6372\n   slots:[10923-16383] (5461 slots) master\n   1 additional replica(s)\nM: 85bd9a592cd33351d348b8390f74764e8f6622e7 192.168.56.107:6374\n   slots:[5461-10922] (5462 slots) master\n   1 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n")])])]),a("h5",{attrs:{id:"_3-2-查看集群信息和节点信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-查看集群信息和节点信息"}},[e._v("#")]),e._v(" 3.2  查看集群信息和节点信息")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 连接至集群某个节点\nroot@Docker:/usr/local/bin# redis-cli -c -a 1234 -h 192.168.56.107 -p 6376  \nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n# 查看集群信息\n192.168.56.107:6376> cluster info\ncluster_state:ok\ncluster_slots_assigned:16384\ncluster_slots_ok:16384\ncluster_slots_pfail:0\ncluster_slots_fail:0\ncluster_known_nodes:6\ncluster_size:3\ncluster_current_epoch:6\ncluster_my_epoch:1\ncluster_stats_messages_ping_sent:608\ncluster_stats_messages_pong_sent:633\ncluster_stats_messages_meet_sent:1\ncluster_stats_messages_sent:1242\ncluster_stats_messages_ping_received:633\ncluster_stats_messages_pong_received:609\ncluster_stats_messages_received:1242\n# 查看集群结点信息\n192.168.56.107:6376> cluster nodes\nd620e4bf67eb0c152944ebeb51b7cb8e96942dd3 192.168.56.107:6375@16375 slave 363710c4657b85add9aa38982b0cf475917cda2e 0 1652341127000 2 connected\n85bd9a592cd33351d348b8390f74764e8f6622e7 192.168.56.107:6374@16374 master - 0 1652341128089 4 connected 5461-10922\n363710c4657b85add9aa38982b0cf475917cda2e 192.168.56.106:6372@16372 master - 0 1652341128000 2 connected 10923-16383\nb2157db1aa59644c62a3006c6388d6a256eb5ef4 192.168.56.106:6373@16373 slave 85bd9a592cd33351d348b8390f74764e8f6622e7 0 1652341129111 4 connected\n908cef996b9759912ce2ff18eb6388618177ff95 192.168.56.106:6371@16371 master - 0 1652341127078 1 connected 0-5460\n43e3cedfb93dbd312adb08bc41e717fc3baf08ad 192.168.56.107:6376@16376 myself,slave 908cef996b9759912ce2ff18eb6388618177ff95 0 1652341129000 1 connected\n")])])]),a("h5",{attrs:{id:"_3-3-set-get"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-set-get"}},[e._v("#")]),e._v(" 3.3  SET/GET")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 进入容器并连接至集群某个节点\n[root@Docker redis-cluster]# docker-compose exec redis-6371 /usr/local/bin/redis-cli -c -a 1234 -h 192.168.56.106 -p 6371\nWarning: Using a password with \'-a\' or \'-u\' option on the command line interface may not be safe.\n# 写入数据\n192.168.56.106:6371> set name tosinjia\n-> Redirected to slot [5798] located at 192.168.56.107:6374\nOK\n192.168.56.107:6374> set aaa 111\nOK\n192.168.56.107:6374> set bbb 222\n-> Redirected to slot [5287] located at 192.168.56.106:6371\nOK\n# 读取数据\n192.168.56.106:6371> get name\n-> Redirected to slot [5798] located at 192.168.56.107:6374\n"tosinjia"\n192.168.56.107:6374> get aaa\n"111"\n192.168.56.107:6374> get bbb\n-> Redirected to slot [5287] located at 192.168.56.106:6371\n"222"\n192.168.56.106:6371> get aaa\n-> Redirected to slot [10439] located at 192.168.56.107:6374\n"111"\n')])])]),a("ul",[a("li",[e._v("首先进入容器并连接至集群某个节点；")]),e._v(" "),a("li",[e._v("然后执行第一个 set 命令 "),a("code",[e._v("set name tosinjia")]),e._v("，"),a("code",[e._v("name")]),e._v(" 键根据哈希函数运算以后得到的值为 "),a("code",[e._v("[5798]")]),e._v("。当前集群环境的槽分配情况为："),a("code",[e._v("[0-5460] 6371节点")]),e._v("，"),a("code",[e._v("[5461-10922] 6374节点")]),e._v("，"),a("code",[e._v("[10923-16383] 6372节点")]),e._v("，所以该键的存储就被分配到了 "),a("strong",[e._v("6374")]),e._v(" 节点上；")]),e._v(" "),a("li",[e._v("再来看第二个 set 命令 "),a("code",[e._v("set aaa")]),e._v("，这里大家可能会有一些疑问，为什么看不到 "),a("code",[e._v("aaa")]),e._v(" 键根据哈希函数运算以后得到的值？因为刚才重定向至 6374 节点插入了数据，此时如果还有数据插入，正好键根据哈希函数运算以后得到的值也还在该节点的范围内，那么直接插入数据即可；")]),e._v(" "),a("li",[e._v("接着是第三个 set 命令 "),a("code",[e._v("set bbb")]),e._v("，"),a("code",[e._v("bbb")]),e._v(" 键根据哈希函数运算以后得到的值为 "),a("code",[e._v("[5287]")]),e._v("，所以该键的存储就被分配到了 "),a("strong",[e._v("6371")]),e._v(" 节点上；")]),e._v(" "),a("li",[e._v("然后是读取操作，第四个命令 "),a("code",[e._v("get name")]),e._v("，"),a("code",[e._v("name")]),e._v(" 键根据哈希函数运算以后得到的值为 "),a("code",[e._v("[5798]")]),e._v("，被重定向至 "),a("strong",[e._v("6374")]),e._v(" 节点读取；")]),e._v(" "),a("li",[e._v("第五个命令 "),a("code",[e._v("get aaa")]),e._v("，"),a("code",[e._v("aaa")]),e._v(" 键根据哈希函数运算以后得到的值也在 "),a("strong",[e._v("6374")]),e._v(" 节点，直接读取；")]),e._v(" "),a("li",[e._v("第六个命令 "),a("code",[e._v("get bbb")]),e._v("，"),a("code",[e._v("bbb")]),e._v(" 键根据哈希函数运算以后得到的值为 "),a("code",[e._v("[5287]")]),e._v("，被重定向至 "),a("strong",[e._v("6371")]),e._v(" 节点读取。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker redis-cluster]# docker-compose exec redis-6371 /usr/local/bin/redis-cli -c -a 1234 -h 192.168.56.107 -p 6374 \nWarning: Using a password with \'-a\' or \'-u\' option on the command line interface may not be safe.\n192.168.56.107:6374> get name\n"tosinjia"\n192.168.56.107:6374> get bbb\n-> Redirected to slot [5287] located at 192.168.56.106:6371\n"222"\n192.168.56.106:6371> get aaa\n-> Redirected to slot [10439] located at 192.168.56.107:6374\n"111"\n192.168.56.107:6374> get name\n"tosinjia"\n')])])]),a("h4",{attrs:{id:"_4-0-客户端连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-客户端连接"}},[e._v("#")]),e._v(" 4.0  客户端连接")]),e._v(" "),a("ul",[a("li",[e._v("最后来一波客户端连接操作，随便哪个节点，看看可否通过外部访问 Redis Cluster 集群。\n"),a("ul",[a("li",[e._v("name: docker-redis-cluster")]),e._v(" "),a("li",[e._v("Host: 192.168.56.106")]),e._v(" "),a("li",[e._v("Port: 6371")]),e._v(" "),a("li",[e._v("Auth: 1234")])])]),e._v(" "),a("li",[e._v("至此使用多机环境基于 Docker Compose 搭建 Redis Cluster 就到这里。虽然整体搭建过程感觉比起之前并没有简化太多。但是，如果我们想要停止并删除 Redis Cluster 集群环境，之前的方式就需要一个个去操作，而 Docker Compose 只需要一个 "),a("code",[e._v("docker-compose down")]),e._v(" 命令的操作即可。Docker Compose 的学习及使用就到这里，下文开始我们学习 Docker Swarm 的相关内容。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker-compose down\n\n")])])]),a("h3",{attrs:{id:"_13-docker-容器编排利器-docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-docker-容器编排利器-docker-compose"}},[e._v("#")]),e._v(" 13 Docker 容器编排利器 Docker Compose")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker13.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 容器编排利器 Docker Compose"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_1-0-compose-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-compose-简介"}},[e._v("#")]),e._v(" 1.0  Compose 简介")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("通过前面几篇文章的学习，我们可以通过 Dockerfile 文件让用户很方便的定义一个单独的应用容器。然而，在日常工作中，经常会碰到需要多个容器相互配合来完成某项任务的情况，例如之前我给大家讲过的《Docker 搭建 Redis Cluster 集群》，或者开发一个 Web 应用，除了 Web 服务容器本身，还需要数据库服务容器、缓存容器，甚至还包括负载均衡容器等等。")])]),e._v(" "),a("li",[a("p",[e._v("Docker Compose 恰好满足了这样的需求，它是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 "),a("code",[e._v("YAML")]),e._v(" 文件来配置应用程序所需要的服务。然后使用一个命令，就可以通过 "),a("code",[e._v("YAML")]),e._v(" 配置文件创建并启动所有服务。")])]),e._v(" "),a("li",[a("p",[e._v("Docker Compose 项目是 Docker 官方的开源项目，来源于之前的 Fig 项目，使用 Python 语言编写。负责实现对 Docker 容器集群的快速编排。项目地址为："),a("a",{attrs:{href:"https://github.com/docker/compose/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/docker/compose/releases"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("Docker Compose 使用的三个步骤为：")]),e._v(" "),a("ul",[a("li",[e._v("使用 "),a("code",[e._v("Dockerfile")]),e._v(" 文件定义应用程序的环境；")]),e._v(" "),a("li",[e._v("使用 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件定义构成应用程序的服务，这样它们可以在隔离环境中一起运行；")]),e._v(" "),a("li",[e._v("最后，执行 "),a("code",[e._v("docker-compose up")]),e._v(" 命令来创建并启动所有服务。")])])])]),e._v(" "),a("h4",{attrs:{id:"_2-0-compose-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-compose-安装"}},[e._v("#")]),e._v(" 2.0  Compose 安装")]),e._v(" "),a("h5",{attrs:{id:"_2-1-下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-下载"}},[e._v("#")]),e._v(" 2.1  下载")]),e._v(" "),a("ul",[a("li",[e._v("官方文档："),a("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/install/"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("您可以在 macOS，Windows 和 Linux 上运行 Compose。本文演示基于 Linux 环境的安装。我们可以使用 "),a("code",[e._v("curl")]),e._v(" 命令从 Github 下载它的二进制文件来使用，运行以下命令下载 Docker Compose 的当前稳定版本。或者从网页下载后上传至服务器指定目录 "),a("code",[e._v("/usr/local/bin")]),e._v(" 也行。\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/docker/compose/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/docker/compose/releases"),a("OutboundLink")],1)])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# uname -s\nLinux\n[root@Docker ~]# uname -m\nx86_64\n[root@Docker ~]# curl -L "https://github.com/docker/compose/releases/download/1.26.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n100 11.6M  100 11.6M    0     0  97938      0  0:02:05  0:02:05 --:--:-- 1986k\n')])])]),a("ul",[a("li",[e._v("因为 Docker Compose 存放在 GitHub，可能不太稳定。你也可以通过执行下面的命令，高速安装 Compose。该加速通道由 "),a("code",[e._v("DaoCloud")]),e._v(" 提供："),a("a",{attrs:{href:"http://get.daocloud.io/#install-compose",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://get.daocloud.io/#install-compose"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo curl -L https://get.daocloud.io/docker/compose/releases/download/1.26.2/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose\n\n")])])]),a("ul",[a("li",[e._v("您可以通过修改 URL 中的版本，自定义您所需要的版本文件。")])]),e._v(" "),a("h5",{attrs:{id:"_2-2-授权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-授权"}},[e._v("#")]),e._v(" 2.2  授权")]),e._v(" "),a("ul",[a("li",[e._v("安装完成以后，查看指定目录，发现该文件没有可执行权限，进行授权操作。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# cd /usr/local/bin/\n[root@Docker bin]# ll\ntotal 11968\n-rw-r--r--. 1 root root 12254160 May  5 10:34 docker-compose\n# 将可执行权限应用于该二进制文件\n[root@Docker bin]# chmod +x /usr/local/bin/docker-compose \n[root@Docker bin]# ll\ntotal 11968\n-rwxr-xr-x. 1 root root 12254160 May  5 10:34 docker-compose\n")])])]),a("h5",{attrs:{id:"_2-3-测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-测试"}},[e._v("#")]),e._v(" 2.3  测试")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker bin]# docker-compose --version\ndocker-compose version 1.26.2, build eefe0d31\n[root@Docker bin]# docker-compose version\ndocker-compose version 1.26.2, build eefe0d31\ndocker-py version: 4.2.2\nCPython version: 3.7.7\nOpenSSL version: OpenSSL 1.1.0l  10 Sep 2019\n\n[root@Docker bin]# docker --version\nDocker version 20.10.9, build c2ea9bc\n")])])]),a("h5",{attrs:{id:"_2-4-卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-卸载"}},[e._v("#")]),e._v(" 2.4  卸载")]),e._v(" "),a("ul",[a("li",[e._v("卸载 Compose 非常简单，直接删除二进制文件即可。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sudo rm /usr/local/bin/docker-compose\n")])])]),a("h4",{attrs:{id:"_3-0-docker-compose-yml-文件详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-docker-compose-yml-文件详解"}},[e._v("#")]),e._v(" 3.0  docker-compose.yml 文件详解")]),e._v(" "),a("h5",{attrs:{id:"_3-1-概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-概念"}},[e._v("#")]),e._v(" 3.1  概念")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("官方文档："),a("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/compose-file/"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("Docker Compose 允许用户通过 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件（YAML 格式）来定义一组相关联的容器为一个工程"),a("code",[e._v("（project）")]),e._v("。一个工程包含多个服务"),a("code",[e._v("（service）")]),e._v("，每个服务中定义了创建容器时所需的镜像、参数、依赖等。")])])]),e._v(" "),a("blockquote",[a("p",[e._v("工程名若无特殊指定，即为 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件所在目录的名称。")])]),e._v(" "),a("ul",[a("li",[e._v("Docker Compose 模板文件我们需要关注的顶级配置有 "),a("code",[e._v("version")]),e._v("、"),a("code",[e._v("services")]),e._v("、"),a("code",[e._v("networks")]),e._v("、"),a("code",[e._v("volumes")]),e._v(" 几个部分，除 "),a("code",[e._v("version")]),e._v(" 外，其他几个顶级配置下还有很多下级配置，后面也会详细给大家介绍，先来看看这几个顶级配置都什么意思：\n"),a("ul",[a("li",[a("code",[e._v("version")]),e._v("：描述 Compose 文件的版本信息，当前最新版本为 3.8，对应的 Docker 版本为 19.03.0+；")]),e._v(" "),a("li",[a("code",[e._v("services")]),e._v("：定义服务，可以多个，每个服务中定义了创建容器时所需的镜像、参数、依赖等；")]),e._v(" "),a("li",[a("code",[e._v("networkds")]),e._v("：定义网络，可以多个，根据 DNS server 让相同网络中的容器可以直接通过容器名称进行通信；")]),e._v(" "),a("li",[a("code",[e._v("volumes")]),e._v("：数据卷，用于实现目录挂载。")])])])]),e._v(" "),a("h5",{attrs:{id:"_3-2-案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-案例"}},[e._v("#")]),e._v(" 3.2  案例")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("在配置文件中，所有的容器通过 "),a("code",[e._v("services")]),e._v(" 来定义，然后使用 "),a("code",[e._v("docker-compose")]),e._v(" 脚本来启动，停止和重启容器，非常适合多个容器组合使用进行开发的场景。我们先从一个简单的 Compose 案例学起。")])]),e._v(" "),a("li",[a("p",[e._v("编写 docker-compose.yml 文件。")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 创建目录\n[root@Docker ~]# mkdir -p /usr/local/docker-nginx\n# 切换至指定目录\n[root@Docker ~]# cd /usr/local/docker-nginx/\n# 编写 docker-compose.yml 文件\n[root@Docker docker-nginx]# touch docker-compose.yml\n\n[root@Docker docker-nginx]# cat docker-compose.yml \n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    nginx: # 服务名称\n        image: nginx # 创建容器时所需的镜像\n        container_name: mynginx # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "80:80" # 左边宿主机端口:右边容器端口\n        networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n            - nginx-net\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\nnetworks:\n    nginx-net: # 一个具体网络的条目名称\n        name: nginx-net # 网络名称，默认为"工程名称_网络条目名称"\n        driver: bridge # 网络模式，默认为 bridge\n')])])]),a("ul",[a("li",[e._v("使用 "),a("code",[e._v("docker-compose up")]),e._v(" 创建并启动所有服务。这个简单的案例中就只有一个 Nginx 后续我们会来一些复杂的练习：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# docker-compose --help\n  down               Stop and remove containers, networks, images, and volumes\n  up                 Create and start containers\n\n[root@Docker docker-nginx]# docker-compose up --help\nUsage: up [options] [--scale SERVICE=NUM...] [SERVICE...]\n\nOptions:\n    -d, --detach               Detached mode: Run containers in the background\n\n# 前台启动\n[root@Docker docker-nginx]# docker-compose up\nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... done\nAttaching to mynginx\nmynginx  | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\nmynginx  | /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/\nmynginx  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\nmynginx  | 10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf\nmynginx  | 10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf\nmynginx  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\nmynginx  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\nmynginx  | /docker-entrypoint.sh: Configuration complete; ready for start up\nmynginx  | 2022/05/05 03:10:30 [notice] 1#1: using the "epoll" event method\nmynginx  | 2022/05/05 03:10:30 [notice] 1#1: nginx/1.21.3\nmynginx  | 2022/05/05 03:10:30 [notice] 1#1: built by gcc 8.3.0 (Debian 8.3.0-6) \nmynginx  | 2022/05/05 03:10:30 [notice] 1#1: OS: Linux 3.10.0-1160.el7.x86_64\nmynginx  | 2022/05/05 03:10:30 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576\nmynginx  | 2022/05/05 03:10:30 [notice] 1#1: start worker processes\nmynginx  | 2022/05/05 03:10:30 [notice] 1#1: start worker process 31\n\n# 后台启动\n[root@Docker docker-nginx]# docker-compose up -d\nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... done\n')])])]),a("ul",[a("li",[a("p",[e._v("http://192.168.56.106/")])]),e._v(" "),a("li",[a("p",[e._v("使用 "),a("code",[e._v("docker-compose down")]),e._v(" 可以停止并删除容器、网络。")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker docker-nginx]# docker-compose down\nStopping mynginx ... done\nRemoving mynginx ... done\nRemoving network nginx-net\n")])])]),a("h5",{attrs:{id:"_3-3-version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-version"}},[e._v("#")]),e._v(" 3.3  version")]),e._v(" "),a("ul",[a("li",[e._v("描述 Compose 文件的版本信息，当前最新版本为 3.8，对应的 Docker 版本为 19.03.0+。关于每个版本的详细信息请参考："),a("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/compose-versioning/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/compose-file/compose-versioning/"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("以下为 Compose 文件的版本信息所对应的 Docker 版本。")])]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Compose file format")]),e._v(" "),a("th",[e._v("Docker Engine release")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("3.8")]),e._v(" "),a("td",[e._v("19.03.0+")])]),e._v(" "),a("tr",[a("td",[e._v("3.7")]),e._v(" "),a("td",[e._v("18.06.0+")])]),e._v(" "),a("tr",[a("td",[e._v("3.6")]),e._v(" "),a("td",[e._v("18.02.0+")])]),e._v(" "),a("tr",[a("td",[e._v("3.5")]),e._v(" "),a("td",[e._v("17.12.0+")])]),e._v(" "),a("tr",[a("td",[e._v("3.4")]),e._v(" "),a("td",[e._v("17.09.0+")])]),e._v(" "),a("tr",[a("td",[e._v("3.3")]),e._v(" "),a("td",[e._v("17.06.0+")])]),e._v(" "),a("tr",[a("td",[e._v("3.2")]),e._v(" "),a("td",[e._v("17.04.0+")])]),e._v(" "),a("tr",[a("td",[e._v("3.1")]),e._v(" "),a("td",[e._v("1.13.1+")])]),e._v(" "),a("tr",[a("td",[e._v("3.0")]),e._v(" "),a("td",[e._v("1.13.0+")])]),e._v(" "),a("tr",[a("td",[e._v("2.4")]),e._v(" "),a("td",[e._v("17.12.0+")])]),e._v(" "),a("tr",[a("td",[e._v("2.3")]),e._v(" "),a("td",[e._v("17.06.0+")])]),e._v(" "),a("tr",[a("td",[e._v("2.2")]),e._v(" "),a("td",[e._v("1.13.0+")])]),e._v(" "),a("tr",[a("td",[e._v("2.1")]),e._v(" "),a("td",[e._v("1.12.0+")])]),e._v(" "),a("tr",[a("td",[e._v("2.0")]),e._v(" "),a("td",[e._v("1.10.0+")])]),e._v(" "),a("tr",[a("td",[e._v("1.0")]),e._v(" "),a("td",[e._v("1.9.1.+")])])])]),e._v(" "),a("h5",{attrs:{id:"_3-4-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-services"}},[e._v("#")]),e._v(" 3.4  services")]),e._v(" "),a("ul",[a("li",[e._v("刚才我们提到 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件中包含很多下级配置项，下面带大家把一些常用的配置项详细了解一下，先从顶级配置 "),a("code",[e._v("services")]),e._v(" 开始。")]),e._v(" "),a("li",[a("code",[e._v("services")]),e._v(" 用来定义服务，可以多个，每个服务中定义了创建容器时所需的镜像、参数、依赖等，就像将命令行参数传递给 "),a("code",[e._v("docker run")]),e._v(" 一样。同样，网络和数据卷的定义也是一样的。")]),e._v(" "),a("li",[e._v("比如，之前我们通过 docker run 命令构建一个 MySQL 应用容器的命令如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker run -di --name mysql8 -p 3306:3306 -v /mydata/docker_mysql8/conf:/etc/mysql/conf.d -v /mydata/docker_mysql8/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=1234 mysql:8\n749864c33e24df0c2720e9207e3bed9f4388619c4eebb33084668f84327e4e43\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                                  NAMES\n749864c33e24   mysql:8   "docker-entrypoint.s…"   51 seconds ago   Up 49 seconds   0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   mysql8\n[root@Docker ~]# docker stop mysql8\nmysql8\n[root@Docker ~]# docker rm mysql8  \nmysql8\n')])])]),a("ul",[a("li",[e._v("使用 "),a("code",[e._v("docker-compose.yml")]),e._v(" 以后则可以这样定义：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# mkdir docker-test/docker-myql8\n[root@Docker ~]# cd docker-test/docker-myql8/\n[root@Docker docker-myql8]# vim docker-compose.yml\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    mysql: # 服务名称\n        image: mysql:8 # 创建容器时所需的镜像\n        container_name: mysql8 # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "3306:3306" # 左边宿主机端口:右边容器端口\n        environment: # 创建容器时所需的环境变量\n            MYSQL_ROOT_PASSWORD: 1234\n        volumes:\n            - "/mydata/docker_mysql8/conf:/etc/mysql/conf.d"\n            - "/mydata/docker_mysql8/data:/var/lib/mysql"\n')])])]),a("ul",[a("li",[e._v("然后通过 "),a("code",[e._v("dokcer-compose")]),e._v(" 相关命令即可完成容器的创建，停止或删除等一系列操作。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-myql8]# docker-compose up -d  \nCreating network "docker-myql8_default" with the default driver\nCreating mysql8 ... done\n[root@Docker docker-myql8]# docker network ls\nNETWORK ID     NAME                   DRIVER    SCOPE\n1ed7e29224d6   docker-myql8_default   bridge    local\n[root@Docker docker-myql8]# docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS              PORTS                                                  NAMES\necaf27fa80cd   mysql:8   "docker-entrypoint.s…"   About a minute ago   Up About a minute   0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   mysql8\n[root@Docker docker-myql8]# docker-compose down\nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8_default\n')])])]),a("h6",{attrs:{id:"image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#image"}},[e._v("#")]),e._v(" image")]),e._v(" "),a("ul",[a("li",[e._v("指定创建容器时所需的镜像名称标签或者镜像 ID。如果镜像在本地不存在，会去远程拉取。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("services:\n  web:\n    image: hello-world # 创建容器时所需的镜像\n")])])]),a("h6",{attrs:{id:"build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[e._v("#")]),e._v(" build")]),e._v(" "),a("ul",[a("li",[e._v("除了可以基于指定的镜像构建容器，还可以基于 "),a("code",[e._v("Dockerfile")]),e._v(" 文件构建，在使用 "),a("code",[e._v("up")]),e._v(" 命令时会执行构建任务。")]),e._v(" "),a("li",[e._v("通过 "),a("code",[e._v("build")]),e._v(" 配置项可以指定 "),a("code",[e._v("Dockerfile")]),e._v(" 所在文件夹的路径。Compose 将会利用 "),a("code",[e._v("Dockerfile")]),e._v(" 自动构建镜像，然后使用镜像启动服务容器。")]),e._v(" "),a("li",[a("code",[e._v("build")]),e._v(" 配置项可以使用绝对路径，也可以使用相对路径。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 绝对路径，在该路径下基于名称为 Dockerfile 的文件构建镜像\n/usr/local/docker-centos\n# 相对路径，相对当前 docker-compose.yml 文件所在目录，基于名称为 Dockerfile 的文件构建镜像\n.\n")])])]),a("ul",[a("li",[e._v("接下来我们来个稍微复杂点的练习，通过基础镜像 "),a("code",[e._v("centos:7")]),e._v("，在该镜像中安装 jdk 和 tomcat 以后将其制作为一个新的镜像 "),a("code",[e._v("mycentos:7")]),e._v("。")]),e._v(" "),a("li",[e._v("创建目录并编写 "),a("code",[e._v("Dockerfile")]),e._v(" 文件。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 创建目录\n[root@Docker ~]# mkdir -p /usr/local/docker-centos\n# 切换至指定目录\n[root@Docker ~]# cd /usr/local/docker-centos/\n# 编写 Dockerfile 文件\n[root@Docker docker-centos]# vim Dockerfile\n")])])]),a("ul",[a("li",[a("code",[e._v("Dockerfile")]),e._v(" 文件内容如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 指明构建的新镜像是来自于 centos:7 基础镜像\nFROM centos:7\n# 通过镜像标签声明了作者信息\nLABEL maintainer="tosin.com"\n# 设置工作目录\nWORKDIR /usr/local\n# 新镜像构建成功以后创建指定目录\nRUN mkdir -p /usr/local/java && mkdir -p /usr/local/tomcat\n# 拷贝文件到镜像中并解压\nADD jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\nADD apache-tomcat-9.0.54.tar.gz /usr/local/tomcat\n# 暴露容器运行时的 8080 监听端口给外部\nEXPOSE 8080\n# 设置容器内 JAVA_HOME 环境变量\nENV JAVA_HOME /usr/local/java/jdk-11.0.6/\nENV PATH $PATH:$JAVA_HOME/bin\n# 启动容器时启动 tomcat 并查看 tomcat 日志信息\nCMD ["/usr/local/tomcat/apache-tomcat-9.0.54/bin/catalina.sh", "run"]\n')])])]),a("ul",[a("li",[e._v("将所需的资源包 "),a("code",[e._v("jdk")]),e._v(" 和 "),a("code",[e._v("tomcat")]),e._v(" 上传至 Dockerfile 同一目录。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker docker-centos]# ls\napache-tomcat-9.0.54.tar.gz  Dockerfile  jdk-11.0.6_linux-x64_bin.tar.gz\n")])])]),a("ul",[a("li",[e._v("创建目录并编写 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-centos]# vim docker-compose.yml\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    mycentos: # 服务名称\n        build: . # 相对当前 docker-compose.yml 文件所在目录，基于名称为 Dockerfile-alternate 的文件构建镜像\n        container_name: mycentos7 # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "8080:8080" # 左边宿主机端口:右边容器端口\n')])])]),a("ul",[a("li",[e._v("然后通过 "),a("code",[e._v("dokcer-compose")]),e._v(" 相关命令即可完成容器的创建，停止或删除等一系列操作。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-centos]# docker-compose up -d\nCreating network "docker-centos_default" with the default driver\nBuilding mycentos\nStep 1/10 : FROM centos:7\n ---\x3e eeb6ee3f44bd\nStep 2/10 : LABEL maintainer="tosin.com"\n ---\x3e Running in 3bbb6d453780\nRemoving intermediate container 3bbb6d453780\n ---\x3e edafe9ccc9b9\nStep 3/10 : WORKDIR /usr/local\n ---\x3e Running in 349f2462bb64\nRemoving intermediate container 349f2462bb64\n ---\x3e 944030e15f1d\nStep 4/10 : RUN mkdir -p /usr/local/java && mkdir -p /usr/local/tomcat\n ---\x3e Running in bb757530ff1e\nRemoving intermediate container bb757530ff1e\n ---\x3e b1699fdec7c7\nStep 5/10 : ADD jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\n ---\x3e c7d1458a364e\nStep 6/10 : ADD apache-tomcat-9.0.54.tar.gz /usr/local/tomcat\n ---\x3e 27f22dd3e4ef\nStep 7/10 : EXPOSE 8080\n ---\x3e Running in c3b9a7b9f264\nRemoving intermediate container c3b9a7b9f264\n ---\x3e bda082eafaf4\nStep 8/10 : ENV JAVA_HOME /usr/local/java/jdk-11.0.6/\n ---\x3e Running in 2dc5c7f1bd85\nRemoving intermediate container 2dc5c7f1bd85\n ---\x3e bbd2199d42bb\nStep 9/10 : ENV PATH $PATH:$JAVA_HOME/bin\n ---\x3e Running in 39131efef790\nRemoving intermediate container 39131efef790\n ---\x3e 8b5c98c818d7\nStep 10/10 : CMD ["/usr/local/tomcat/apache-tomcat-9.0.54/bin/catalina.sh", "run"]\n ---\x3e Running in 4eb85c1b6807\nRemoving intermediate container 4eb85c1b6807\n ---\x3e e2797d7e7d39\n\nSuccessfully built e2797d7e7d39\nSuccessfully tagged docker-centos_mycentos:latest\nWARNING: Image for service mycentos was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.\nCreating mycentos7 ... done\n\n[root@Docker docker-centos]# docker-compose down\nStopping mycentos7 ... done\nRemoving mycentos7 ... done\nRemoving network docker-centos_default\n')])])]),a("ul",[a("li",[a("a",{attrs:{href:"http://192.168.56.106:8080/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.56.106:8080/"),a("OutboundLink")],1)])]),e._v(" "),a("h6",{attrs:{id:"context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[e._v("#")]),e._v(" context")]),e._v(" "),a("ul",[a("li",[e._v("该选项可以是 Dockerfile 文件的绝对/相对路径，也可以是远程 Git 仓库的 URL，当提供的值是相对路径时，相对当前 docker-compose.yml 文件所在目录。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("build:\n  context: . # 相对当前 docker-compose.yml 文件所在目录，基于名称为 Dockerfile 的文件构建镜像\n")])])]),a("h6",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[e._v("#")]),e._v(" dockerfile")]),e._v(" "),a("ul",[a("li",[e._v("一般情况下，默认都基于文件名叫 Dockerfile 的文件构建镜像，当然也可以是自定义的文件名，使用 "),a("code",[e._v("dockerfile")]),e._v(" 声明，不过这个选项只能声明文件名，文件所在路径还是要通过 centext 来声明。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("build:\n  context: . # 相对当前 docker-compose.yml 文件所在目录\n  dockerfile: Dockerfile-alternate # 基于名称为 Dockerfile-alternate 的文件构建镜像\n")])])]),a("h6",{attrs:{id:"container-name"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#container-name"}},[e._v("#")]),e._v(" container_name")]),e._v(" "),a("ul",[a("li",[e._v("Compose 创建的容器默认生成的名称格式为："),a("code",[e._v("工程名称_服务条目名称_序号")]),e._v("。如果要使用自定义名称，使用 "),a("code",[e._v("container_name")]),e._v(" 声明。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('services:\n  mycentos:\n    build: .\n    container_name: mycentos7 # 容器名称，默认为"工程名称_服务条目名称_序号"\n')])])]),a("blockquote",[a("p",[e._v("因为 Docker 容器名称必须是唯一的，所以如果指定了自定义名称，就不能将服务扩展至多个容器。这样做可能会导致错误。")])]),e._v(" "),a("h6",{attrs:{id:"关于序号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于序号"}},[e._v("#")]),e._v(" 关于序号")]),e._v(" "),a("ul",[a("li",[e._v("序号是干什么用的呢，看下面这个例子你就懂了，docker-compose.yml 文件内容如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# mkdir -p docker-test/docker-helloworld\n[root@Docker ~]# cd docker-test/docker-helloworld/\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    helloworld: # 服务名称\n        image: hello-world    \n')])])]),a("ul",[a("li",[e._v("然后通过 "),a("code",[e._v("--scale")]),e._v(" 指定 helloworld 服务一次性启动 3 个。")]),e._v(" "),a("li",[e._v("通过下图可以看到有 3 个容器被创建，容器名称最后的序号是从 1 开始累加的，这就是序号的作用。所以如果指定了自定义名称，就不能将服务扩展至多个容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-helloworld]# docker-compose up -d --scale helloworld=3\nCreating network "docker-helloworld_default" with the default driver\nCreating docker-helloworld_helloworld_1 ... done\nCreating docker-helloworld_helloworld_2 ... done\nCreating docker-helloworld_helloworld_3 ... done\n[root@Docker docker-helloworld]# docker-compose ps\n             Name                Command   State    Ports\n---------------------------------------------------------\ndocker-helloworld_helloworld_1   /hello    Exit 0        \ndocker-helloworld_helloworld_2   /hello    Exit 0        \ndocker-helloworld_helloworld_3   /hello    Exit 0        \n\n[root@Docker docker-helloworld]# docker-compose down\nRemoving docker-helloworld_helloworld_1 ... done\nRemoving docker-helloworld_helloworld_2 ... done\nRemoving docker-helloworld_helloworld_3 ... done\nRemoving network docker-helloworld_default\n')])])]),a("h6",{attrs:{id:"depends-on"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#depends-on"}},[e._v("#")]),e._v(" depends_on")]),e._v(" "),a("ul",[a("li",[e._v("使用 Compose 最大的好处就是敲最少的命令做更多的事情，但一般项目容器启动的顺序是有要求的，如果直接从上到下启动容器，必然会因为容器依赖问题而启动失败。例如在没有启动数据库容器的情况下启动了 Web 应用容器，应用容器会因为找不到数据库而退出。"),a("code",[e._v("depends_on")]),e._v(" 就是用来解决容器依赖、启动先后问题的配置项。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('version: "3.8"\nservices:\n  web:\n    build: .\n    depends_on:\n      - db\n      - redis\n  redis:\n    image: redis\n  db:\n    image: mysql\n')])])]),a("ul",[a("li",[e._v("上述 YAML 文件定义的容器会先启动 db 和 redis 两个服务，最后才启动 web 服务。")])]),e._v(" "),a("h6",{attrs:{id:"ports"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ports"}},[e._v("#")]),e._v(" ports")]),e._v(" "),a("ul",[a("li",[e._v("容器对外暴露的端口，格式："),a("code",[e._v("左边宿主机端口:右边容器端口")]),e._v("。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('ports:\n  - "80:80"\n  - "8080:8080"\n')])])]),a("h6",{attrs:{id:"expose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expose"}},[e._v("#")]),e._v(" expose")]),e._v(" "),a("ul",[a("li",[e._v("容器暴露的端口不映射到宿主机，只允许能被连接的服务访问。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('expose:\n  - "80"\n  - "8080"\n')])])]),a("h6",{attrs:{id:"restart"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restart"}},[e._v("#")]),e._v(" restart")]),e._v(" "),a("ul",[a("li",[e._v("容器重启策略，简单的理解就是 Docker 重启以后容器要不要一起启动：\n"),a("ul",[a("li",[a("code",[e._v("no")]),e._v("：默认的重启策略，在任何情况下都不会重启容器；")]),e._v(" "),a("li",[a("code",[e._v("on-failure")]),e._v("：容器非正常退出时，比如退出状态为"),a("code",[e._v("非0")]),e._v("(异常退出)，才会重启容器；")]),e._v(" "),a("li",[a("code",[e._v("always")]),e._v("：容器总是重新启动，即使容器被手动停止了，当 Docker 重启时容器也还是会一起启动；")]),e._v(" "),a("li",[a("code",[e._v("unless-stopped")]),e._v("：容器总是重新启动，除非容器被停止（手动或其他方式），那么 Docker 重启时容器则不会启动。")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('services:\n  nginx:\n    image: nginx\n    container_name: mynginx\n    ports:\n      - "80:80"\n    restart: always\n')])])]),a("h6",{attrs:{id:"environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environment"}},[e._v("#")]),e._v(" environment")]),e._v(" "),a("ul",[a("li",[e._v("添加环境变量。可以使用数组也可以使用字典。布尔相关的值（true、false、yes、no）都需要用引号括起来，以确保 YML 解析器不会将它们转换为真或假。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("environment:\n  RACK_ENV: development\n  SHOW: 'true'\n  SESSION_SECRET:\n")])])]),a("ul",[a("li",[e._v("或者以下格式：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("environment:\n  - RACK_ENV=development\n  - SHOW=true\n  - SESSION_SECRET\n")])])]),a("h6",{attrs:{id:"env-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#env-file"}},[e._v("#")]),e._v(" env_file")]),e._v(" "),a("ul",[a("li",[e._v("从文件中获取环境变量，可以指定一个或多个文件，其优先级低于 environment 指定的环境变量。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("env_file:\n  - /opt/runtime_opts.env # 绝对路径\n  - ./common.env # 相对路径，相对当前 docker-compose.yml 文件所在目录\n  - ./apps/web.env # 相对路径，相对当前 docker-compose.yml 文件所在目录\n")])])]),a("ul",[a("li",[e._v("注意：env 文件中的每一行需采用 键=值 格式。以 # 开头的行会被视为注释并被忽略。空行也会被忽略。")])]),e._v(" "),a("h6",{attrs:{id:"command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command"}},[e._v("#")]),e._v(" command")]),e._v(" "),a("ul",[a("li",[e._v("覆盖容器启动后默认执行的命令。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('command: echo "helloworld"\n')])])]),a("ul",[a("li",[e._v("该命令也可以是一个列表。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('command: ["echo", "helloworld"]\n')])])]),a("h6",{attrs:{id:"volumes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volumes"}},[e._v("#")]),e._v(" volumes")]),e._v(" "),a("ul",[a("li",[e._v("数据卷，用于实现目录挂载，支持"),a("strong",[e._v("指定目录挂载")]),e._v("、"),a("strong",[e._v("匿名挂载")]),e._v("、"),a("strong",[e._v("具名挂载")]),e._v("。\n"),a("ul",[a("li",[e._v("指定目录挂载的格式为："),a("code",[e._v("左边宿主机目录:右边容器目录")]),e._v("，或者"),a("code",[e._v("左边宿主机目录:右边容器目录:读写权限")]),e._v("；")]),e._v(" "),a("li",[e._v("匿名挂载格式为："),a("code",[e._v("容器目录")]),e._v("即可，或者"),a("code",[e._v("容器目录:读写权限")]),e._v("；")]),e._v(" "),a("li",[e._v("具名挂载格式为："),a("code",[e._v("数据卷条目名称:容器目录")]),e._v("，或者"),a("code",[e._v("数据卷条目名称:容器目录:读写权限")]),e._v("。")])])])]),e._v(" "),a("blockquote",[a("p",[e._v("关于"),a("strong",[e._v("匿名挂载/具名挂载")]),e._v("更多的内容请阅读《Docker 最常用的镜像命令和容器命令》文章中容器相关命令部分的"),a("strong",[e._v("目录挂载")]),e._v("（容器数据卷操作）的内容。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-test]# mkdir docker-myql8-2\n[root@Docker docker-myql8-2]# pwd\n/root/docker-test/docker-myql8-2\n[root@Docker docker-myql8-2]# vim docker-compose.yml\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    mysql: # 服务名称\n        image: mysql:8 # 创建容器时所需的镜像\n        container_name: mysql8 # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "3306:3306" # 左边宿主机端口:右边容器端口\n        environment: # 创建容器时所需的环境变量\n            MYSQL_ROOT_PASSWORD: 1234\n        volumes:\n            # 绝对路径\n            - "/mydata/docker_mysql8/data:/var/lib/mysql"\n            # 相对路径，相对当前 docker-compose.yml 文件所在目录\n            - "./conf:/etc/mysql/conf.d"\n            # 匿名挂载，匿名挂载只需要写容器目录即可，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            - "/var/lib/mysql"\n            # 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            - "mysql-data-volume:/var/lib/mysql"\n\n# 定义数据卷，可以多个\nvolumes:\n    mysql-data-volume: # 一个具体数据卷的条目名称\n        name: mysql-data-volume # 数据卷名称，默认为"工程名称_数据卷条目名称"\n[root@Docker docker-myql8-2]# docker-compose up -d\nERROR: Duplicate mount points: [/mydata/docker_mysql8/data:/var/lib/mysql:rw, /var/lib/mysql, mysql-data-volume:/var/lib/mysql:rw]\n\n[root@Docker docker-myql8-2]# vim docker-compose.yml\n            # 绝对路径\n            # - "/mydata/docker_mysql8/data:/var/lib/mysql"\n            # 相对路径，相对当前 docker-compose.yml 文件所在目录\n            - "./conf:/etc/mysql/conf.d"\n            # 匿名挂载，匿名挂载只需要写容器目录即可，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            # - "/var/lib/mysql"\n            # 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            - "mysql-data-volume:/var/lib/mysql"\n\n[root@Docker docker-myql8-2]# docker-compose up -d  \nCreating network "docker-myql8-2_default" with the default driver\nCreating volume "mysql-data-volume" with default driver\nCreating mysql8 ... done\n[root@Docker docker-myql8-2]# docker inspect mysql8 \n        "Mounts": [\n            {\n                "Type": "bind",\n                "Source": "/root/docker-test/docker-myql8-2/conf",\n                "Destination": "/etc/mysql/conf.d",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            },\n            {\n                "Type": "volume",\n                "Name": "mysql-data-volume",\n                "Source": "/var/lib/docker/volumes/mysql-data-volume/_data",\n                "Destination": "/var/lib/mysql",\n                "Driver": "local",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": ""\n            }\n        ],\n\n            "Networks": {\n                "docker-myql8-2_default": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "mysql",\n                        "504be86485f8"\n                    ],\n                    "NetworkID": "59bb231be0aa602e94bd8e59759656ff9735a287bb37f62bcf296fa0d4204c42",\n                    "EndpointID": "43fe50c5f2bcbbbff973c32a040fc58c7506d0f1ada35a67ca658f748fa2ac9f",\n                    "Gateway": "172.24.0.1",\n                    "IPAddress": "172.24.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:18:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n\n[root@Docker docker-myql8-2]# docker-compose down\nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-2_default\n\n[root@Docker docker-myql8-2]# vim docker-compose.yml\n            # 相对路径，相对当前 docker-compose.yml 文件所在目录\n            - "./conf:/etc/mysql/conf.d"\n            # 匿名挂载，匿名挂载只需要写容器目录即可，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            - "/var/lib/mysql"\n            # 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成\n[root@Docker docker-myql8-2]# docker-compose up -d       \nCreating network "docker-myql8-2_default" with the default driver\nCreating mysql8 ... done\n[root@Docker docker-myql8-2]# docker inspect mysql8\n        "Mounts": [\n            {\n                "Type": "bind",\n                "Source": "/root/docker-test/docker-myql8-2/conf",\n                "Destination": "/etc/mysql/conf.d",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            },\n            {\n                "Type": "volume",\n                "Name": "fc4e7e8e6f1c31d5fa14a6845481001e24312a77cf426c0532fb2e65d7ee161a",\n                "Source": "/var/lib/docker/volumes/fc4e7e8e6f1c31d5fa14a6845481001e24312a77cf426c0532fb2e65d7ee161a/_data",\n                "Destination": "/var/lib/mysql",\n                "Driver": "local",\n                "Mode": "",\n                "RW": true,\n                "Propagation": ""\n            }\n        ],\n[root@Docker docker-myql8-2]# docker-compose down    \nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-2_default\n\n[root@Docker docker-myql8-2]# vim docker-compose.yml\n            # 绝对路径\n            - "/mydata/docker_mysql8/data:/var/lib/mysql"\n            # 相对路径，相对当前 docker-compose.yml 文件所在目录\n            - "./conf:/etc/mysql/conf.d"\n[root@Docker docker-myql8-2]# docker-compose up -d   \nCreating network "docker-myql8-2_default" with the default driver\nCreating mysql8 ... done\n[root@Docker docker-myql8-2]# docker inspect mysql8 \n        "Mounts": [\n            {\n                "Type": "bind",\n                "Source": "/mydata/docker_mysql8/data",\n                "Destination": "/var/lib/mysql",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            },\n            {\n                "Type": "bind",\n                "Source": "/root/docker-test/docker-myql8-2/conf",\n                "Destination": "/etc/mysql/conf.d",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            }\n        ],\n[root@Docker docker-myql8-2]# docker-compose down    \nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-2_default\n')])])]),a("h6",{attrs:{id:"network-mode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#network-mode"}},[e._v("#")]),e._v(" network_mode")]),e._v(" "),a("ul",[a("li",[e._v("设置网络模式，类似 "),a("code",[e._v("docker run")]),e._v(" 时添加的参数 "),a("code",[e._v("--net host")]),e._v(" 或者 "),a("code",[e._v("--network host")]),e._v(" 的用法。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('network_mode: "bridge"\nnetwork_mode: "host"\nnetwork_mode: "none"\nnetwork_mode: "service:[service name]"\nnetwork_mode: "container:[container name/id]"\n')])])]),a("h6",{attrs:{id:"networks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#networks"}},[e._v("#")]),e._v(" networks")]),e._v(" "),a("ul",[a("li",[e._v("配置容器连接的网络，引用顶级 networks 下的条目。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 定义服务，可以多个\nservices:\n  nginx: # 服务名称\n    networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n      - nginx-net # 一个具体网络的条目名称\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\nnetworks:\n  nginx-net: # 一个具体网络的条目名称\n    name: nginx-net # 网络名称，默认为"工程名称_网络条目名称"\n    driver: bridge # 网络模式，默认为 bridge\n')])])]),a("h6",{attrs:{id:"aliases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aliases"}},[e._v("#")]),e._v(" aliases")]),e._v(" "),a("ul",[a("li",[e._v("网络上此服务的别名。同一网络上的其他容器可以使用服务名或此别名连接到服务容器。同一服务在不同的网络上可以具有不同的别名。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 定义服务，可以多个\nservices:\n  nginx: # 服务名称\n    networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n      nginx-net: # 一个具体网络的条目名称\n        aliases: # 服务别名，可以多个\n          - nginx1 # 同一网络上的其他容器可以使用服务名或此别名连接到服务容器\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\nnetworks:\n  nginx-net: # 一个具体网络的条目名称\n    name: nginx-net # 网络名称，默认为"工程名称_网络条目名称"\n    driver: bridge # 网络模式，默认为 bridge\n')])])]),a("h6",{attrs:{id:"links"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#links"}},[e._v("#")]),e._v(" links")]),e._v(" "),a("h5",{attrs:{id:"_3-5-volumes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-volumes"}},[e._v("#")]),e._v(" 3.5  volumes")]),e._v(" "),a("ul",[a("li",[e._v("通过顶级配置 "),a("code",[e._v("services")]),e._v(" 的学习，大家应该已经明白顶级配置 "),a("code",[e._v("volumes")]),e._v(" 是干嘛的了，这里再详细把配置的不同方式讲解一下。")]),e._v(" "),a("li",[e._v('以下方式的数据卷声明创建卷时会使用默认的名称："工程名称_数据卷条目名称"。')])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-myql8-3]# pwd\n/root/docker-test/docker-myql8-3\n[root@Docker docker-myql8-3]# vim docker-compose.yml\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    mysql: # 服务名称\n        image: mysql:8 # 创建容器时所需的镜像\n        container_name: mysql8 # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "3306:3306" # 左边宿主机端口:右边容器端口\n        environment: # 创建容器时所需的环境变量\n            MYSQL_ROOT_PASSWORD: 1234\n        volumes:\n            # 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            - "mysql-data-volume:/var/lib/mysql"\n\n# 定义数据卷，可以多个\nvolumes:\n    mysql-data-volume: # 一个具体数据卷的条目名称\n        # name: mysql-data-volume # 数据卷名称，默认为"工程名称_数据卷条目名称"\n\n[root@Docker docker-myql8-3]# docker-compose up -d  \nCreating network "docker-myql8-3_default" with the default driver\nCreating volume "docker-myql8-3_mysql-data-volume" with default driver\nCreating mysql8 ... done\n[root@Docker docker-myql8-3]# docker inspect mysql8\n        "Mounts": [\n            {\n                "Type": "volume",\n                "Name": "docker-myql8-3_mysql-data-volume",\n                "Source": "/var/lib/docker/volumes/docker-myql8-3_mysql-data-volume/_data",\n                "Destination": "/var/lib/mysql",\n                "Driver": "local",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": ""\n            }\n        ],\n[root@Docker docker-myql8-3]# docker-compose down   \nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-3_default\n')])])]),a("ul",[a("li",[e._v("以下方式的数据卷声明创建卷时会使用自定义的名称。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-myql8-3]# vim docker-compose.yml\n        name: mysql-data-volume # 数据卷名称，默认为"工程名称_数据卷条目名称"\n\n[root@Docker docker-myql8-3]# docker-compose up -d\nCreating network "docker-myql8-3_default" with the default driver\nCreating mysql8 ... done\n[root@Docker docker-myql8-3]# docker inspect mysql8\n        "Mounts": [\n            {\n                "Type": "volume",\n                "Name": "mysql-data-volume",\n                "Source": "/var/lib/docker/volumes/mysql-data-volume/_data",\n                "Destination": "/var/lib/mysql",\n                "Driver": "local",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": ""\n            }\n        ],\n[root@Docker docker-myql8-3]# docker-compose down\nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-3_default\n')])])]),a("h5",{attrs:{id:"_3-6-networks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-networks"}},[e._v("#")]),e._v(" 3.6  networks")]),e._v(" "),a("ul",[a("li",[e._v("通过顶级配置 "),a("code",[e._v("services")]),e._v(" 的讲解，大家其实已经明白顶级配置 "),a("code",[e._v("volumes")]),e._v(" 是干嘛的了，这里再详细把配置的不同方式讲解一下。")]),e._v(" "),a("li",[e._v('如果不声明网络，每个工程默认会创建一个网络名称为"'),a("code",[e._v("工程名称_default")]),e._v('"的 '),a("code",[e._v("bridge")]),e._v(" 网络。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker docker-test]# mkdir docker-nginx\n[root@Docker docker-test]# cd docker-nginx/\n")])])]),a("ul",[a("li",[e._v('如果不声明网络，每个工程默认会创建一个网络名称为"工程名称_default"的 bridge 网络。')])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# vim docker-compose.yml\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    nginx: # 服务名称\n        image: nginx # 创建容器时所需的镜像\n        container_name: mynginx # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "80:80" # 左边宿主机端口:右边容器端口\n#        networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n#            nginx-net:\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\n#networks:\n#    nginx-net: # 一个具体网络的条目名称\n#        name: nginx-net # 网络名称，默认为"工程名称_网络条目名称"\n#        driver: bridge # 网络模式，默认为 bridge\n\n[root@Docker docker-nginx]# docker-compose up -d  \nCreating network "docker-nginx_default" with the default driver\nCreating mynginx ... done\n[root@Docker docker-nginx]# docker inspect mynginx\n            "Networks": {\n                "docker-nginx_default": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "bc193356abd5",\n                        "nginx"\n                    ],\n                    "NetworkID": "6d7570711975210e796f9697209ebd6d8e05b4c916e2de11bca6bb3933120438",\n                    "EndpointID": "58a28c6b74d3d0868937dd53b74f121a76d7e0a90dbed015f2daebf77d1208c1",\n                    "Gateway": "172.30.0.1",\n                    "IPAddress": "172.30.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:1e:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n[root@Docker docker-nginx]# docker network ls\nNETWORK ID     NAME                   DRIVER    SCOPE\n6d7570711975   docker-nginx_default   bridge    local\n[root@Docker docker-nginx]# docker-compose down\nStopping mynginx ... done\nRemoving mynginx ... done\nRemoving network docker-nginx_default\n')])])]),a("ul",[a("li",[e._v('以下方式的网络声明创建网络时会使用默认的名称："'),a("code",[e._v("工程名称_网络条目名称")]),e._v('"，网络模式默认为 '),a("code",[e._v("bridge")]),e._v("。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# vim docker-compose.yml\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    nginx: # 服务名称\n        image: nginx # 创建容器时所需的镜像\n        container_name: mynginx # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "80:80" # 左边宿主机端口:右边容器端口\n        networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n            nginx-net:\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\nnetworks:\n    nginx-net: # 一个具体网络的条目名称\n#        name: nginx-net # 网络名称，默认为"工程名称_网络条目名称"\n#        driver: bridge # 网络模式，默认为 bridge\n\n[root@Docker docker-nginx]# docker-compose up -d  \nCreating network "docker-nginx_nginx-net" with the default driver\nCreating mynginx ... done\n[root@Docker docker-nginx]# docker inspect mynginx\n            "Networks": {\n                "docker-nginx_nginx-net": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "nginx",\n                        "aa0c366f6127"\n                    ],\n                    "NetworkID": "d05067d8ec6dbef91445bec83ea7849736b733df4e19016a4389126566e5c9a3",\n                    "EndpointID": "5fd853276c6e83d0a1ceb91b9ac106193d4177a0870c27ffe89e24e01b873b95",\n                    "Gateway": "172.31.0.1",\n                    "IPAddress": "172.31.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:1f:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n[root@Docker docker-nginx]# docker network ls\nNETWORK ID     NAME                     DRIVER    SCOPE\nd05067d8ec6d   docker-nginx_nginx-net   bridge    local\n[root@Docker docker-nginx]# docker-compose down   \nStopping mynginx ... done\nRemoving mynginx ... done\nRemoving network docker-nginx_nginx-net\n')])])]),a("ul",[a("li",[e._v("以下方式的网络声明创建网络时会使用自定义的名称，还可以通过 driver 选择网络模式，默认为 bridge。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# vim docker-compose.yml\n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    nginx: # 服务名称\n        image: nginx # 创建容器时所需的镜像\n        container_name: mynginx # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "80:80" # 左边宿主机端口:右边容器端口\n        networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n            nginx-net:\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\nnetworks:\n    nginx-net: # 一个具体网络的条目名称\n        name: nginx-net # 网络名称，默认为"工程名称_网络条目名称"\n        driver: bridge # 网络模式，默认为 bridge\n\n[root@Docker docker-nginx]# docker-compose up -d  \nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... done\n[root@Docker docker-nginx]# docker inspect mynginx\n            "Networks": {\n                "nginx-net": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "nginx",\n                        "3e7cc6bba060"\n                    ],\n                    "NetworkID": "198cebdd2b6e5bd7e6ed1fdfac77834b1d8069e0781f802f15af727653b555ed",\n                    "EndpointID": "a0e9ef178e1631ecd7c33930b2fe0a160a37c1c17d713062713cd9724591ab9c",\n                    "Gateway": "192.168.0.1",\n                    "IPAddress": "192.168.0.2",\n                    "IPPrefixLen": 20,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:c0:a8:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n\n[root@Docker docker-nginx]# docker network ls\nNETWORK ID     NAME             DRIVER    SCOPE\n198cebdd2b6e   nginx-net        bridge    local\n[root@Docker docker-nginx]# docker-compose down   \nStopping mynginx ... done\nRemoving mynginx ... done\nRemoving network nginx-net\n')])])]),a("ul",[a("li",[e._v("http://192.168.56.106/")])]),e._v(" "),a("h4",{attrs:{id:"_4-0-compose-常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-compose-常用命令"}},[e._v("#")]),e._v(" 4.0  Compose 常用命令")]),e._v(" "),a("ul",[a("li",[e._v("官方文档："),a("a",{attrs:{href:"https://docs.docker.com/compose/reference/overview/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/reference/overview/"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("为了更熟练的使用 Compose，以下常用命令大家多多练习，方可熟能生巧。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker-compose [-f <arg>...] [options] [COMMAND] [ARGS...]\n")])])]),a("ul",[a("li",[e._v("部分命令选项如下：\n"),a("ul",[a("li",[a("code",[e._v("-f，--file")]),e._v("：指定使用的 Compose 模板文件，默认为 "),a("code",[e._v("docker-compose.yml")]),e._v("，可以多次指定，指定多个 yml；")]),e._v(" "),a("li",[a("code",[e._v("-p, --project-name")]),e._v("：指定工程名称，默认使用 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件所在目录的名称；")]),e._v(" "),a("li",[a("code",[e._v("-v")]),e._v("：打印版本并退出；")]),e._v(" "),a("li",[a("code",[e._v("--log-level")]),e._v("：定义日志等级（DEBUG, INFO, WARNING, ERROR, CRITICAL）。")])])])]),e._v(" "),a("h5",{attrs:{id:"_4-1-help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-help"}},[e._v("#")]),e._v(" 4.1  help")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose --help")]),e._v(" 查看帮助。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker-compose --help\nDefine and run multi-container applications with Docker.\n\nUsage:\n  docker-compose [-f <arg>...] [options] [COMMAND] [ARGS...]\n  docker-compose -h|--help\n\nOptions:\n  -f, --file FILE             Specify an alternate compose file\n                              (default: docker-compose.yml)\n  -p, --project-name NAME     Specify an alternate project name\n                              (default: directory name)\n  -c, --context NAME          Specify a context name\n  --verbose                   Show more output\n  --log-level LEVEL           Set log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)\n  --no-ansi                   Do not print ANSI control characters\n  -v, --version               Print version and exit\n  -H, --host HOST             Daemon socket to connect to\n\n  --tls                       Use TLS; implied by --tlsverify\n  --tlscacert CA_PATH         Trust certs signed only by this CA\n  --tlscert CLIENT_CERT_PATH  Path to TLS certificate file\n  --tlskey TLS_KEY_PATH       Path to TLS key file\n  --tlsverify                 Use TLS and verify the remote\n  --skip-hostname-check       Don't check the daemon's hostname against the\n                              name specified in the client certificate\n  --project-directory PATH    Specify an alternate working directory\n                              (default: the path of the Compose file)\n  --compatibility             If set, Compose will attempt to convert keys\n                              in v3 files to their non-Swarm equivalent\n  --env-file PATH             Specify an alternate environment file\n\nCommands:\n  build              Build or rebuild services\n  config             Validate and view the Compose file\n  create             Create services\n  down               Stop and remove containers, networks, images, and volumes\n  events             Receive real time events from containers\n  exec               Execute a command in a running container\n  help               Get help on a command\n  images             List images\n  kill               Kill containers\n  logs               View output from containers\n  pause              Pause services\n  port               Print the public port for a port binding\n  ps                 List containers\n  pull               Pull service images\n  push               Push service images\n  restart            Restart services\n  rm                 Remove stopped containers\n  run                Run a one-off command\n  scale              Set number of containers for a service\n  start              Start services\n  stop               Stop services\n  top                Display the running processes\n  unpause            Unpause services\n  up                 Create and start containers\n  version            Show the Docker-Compose version information\n")])])]),a("h5",{attrs:{id:"_4-2-config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-config"}},[e._v("#")]),e._v(" 4.2  config")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose config -q")]),e._v(" 验证 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件。当配置正确时，不输出任何内容，当配置错误时，输出错误信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-myql8-2]# pwd\n/root/docker-test/docker-myql8-2\n[root@Docker docker-myql8-2]# vim docker-compose.yml \n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    mysql: # 服务名称\n        image: mysql:8 # 创建容器时所需的镜像\n        container_name: mysql8 # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "3306:3306" # 左边宿主机端口:右边容器端口\n        environment: # 创建容器时所需的环境变量\n            MYSQL_ROOT_PASSWORD: 1234\n        volumes:\n            # 绝对路径\n            - "/mydata/docker_mysql8/data:/var/lib/mysql"\n            # 相对路径，相对当前 docker-compose.yml 文件所在目录\n            - "./conf:/etc/mysql/conf.d"\n            # 匿名挂载，匿名挂载只需要写容器目录即可，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            - "/var/lib/mysql"\n            # 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            # - "mysql-data-volume:/var/lib/mysql"\n\n# 定义数据卷，可以多个\nvolumes:\n    mysql-data-volume: # 一个具体数据卷的条目名称\n        name: mysql-data-volume # 数据卷名称，默认为"工程名称_数据卷条目名称"\n\n[root@Docker docker-myql8-2]# docker-compose config -q\nERROR: Duplicate mount points: [/mydata/docker_mysql8/data:/var/lib/mysql:rw, /var/lib/mysql]\n')])])]),a("h5",{attrs:{id:"_4-3-pull"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-pull"}},[e._v("#")]),e._v(" 4.3  pull")]),e._v(" "),a("ul",[a("li",[e._v("docker-compose pull 拉取服务依赖的镜像。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-myql8-2]# vim docker-compose.yml  \n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    mysql: # 服务名称\n        image: mysql:8 # 创建容器时所需的镜像\n        container_name: mysql8 # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "3306:3306" # 左边宿主机端口:右边容器端口\n        environment: # 创建容器时所需的环境变量\n            MYSQL_ROOT_PASSWORD: 1234\n        volumes:\n            # 绝对路径\n            - "/mydata/docker_mysql8/data:/var/lib/mysql"\n            # 相对路径，相对当前 docker-compose.yml 文件所在目录\n            - "./conf:/etc/mysql/conf.d"\n            # 匿名挂载，匿名挂载只需要写容器目录即可，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            # - "/var/lib/mysql"\n            # 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            # - "mysql-data-volume:/var/lib/mysql"\n\n# 定义数据卷，可以多个\nvolumes:\n    mysql-data-volume: # 一个具体数据卷的条目名称\n        name: mysql-data-volume # 数据卷名称，默认为"工程名称_数据卷条目名称"\n\n\n# 拉取工程中所有服务依赖的镜像\n[root@Docker docker-myql8-2]# docker-compose pull\nPulling mysql ... done\n# 拉取工程中 nginx 服务依赖的镜像\n[root@Docker docker-myql8-2]# docker-compose pull nginx\nERROR: No such service: nginx\n[root@Docker docker-myql8-2]# docker-compose pull mysql\nPulling mysql ... done\n# 拉取镜像过程中不打印拉取进度信息\n[root@Docker docker-myql8-2]# docker-compose pull -q\n')])])]),a("h5",{attrs:{id:"_4-4-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-up"}},[e._v("#")]),e._v(" 4.4  up")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose up")]),e._v(" 创建并启动所有服务的容器。指定多个 yml 加 "),a("code",[e._v("-f")]),e._v(" 选项。以守护进程模式运行加 -d 选项。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 前台启动\ndocker-compose up\n# 后台启动\ndocker-compose up -d\n# -f 指定使用的 Compose 模板文件，默认为 docker-compose.yml，可以多次指定，指定多个 yml\n[root@Docker docker-myql8-2]# docker-compose -f docker-compose.yml up -d\nCreating network "docker-myql8-2_default" with the default driver\nCreating mysql8 ... do\n')])])]),a("h5",{attrs:{id:"_4-5-logs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-logs"}},[e._v("#")]),e._v(" 4.5  logs")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose logs")]),e._v(" 查看服务容器的输出日志。默认情况下，docker-compose 将对不同的服务输出使用不同的颜色来区分。可以通过 "),a("code",[e._v("--no-color")]),e._v(" 来关闭颜色。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 输出日志，不同的服务输出使用不同的颜色来区分\n[root@Docker docker-myql8-2]# docker-compose logs\n# 跟踪日志输出\n[root@Docker docker-myql8-2]# docker-compose logs -f\n# 关闭颜色\n[root@Docker docker-myql8-2]# docker-compose logs -f --no-color\n")])])]),a("h5",{attrs:{id:"_4-6-ps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-ps"}},[e._v("#")]),e._v(" 4.6  ps")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose ps")]),e._v(" 列出工程中所有服务的容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 列出工程中所有服务的容器\n[root@Docker docker-myql8-2]# docker-compose ps\n Name              Command             State                          Ports                       \n--------------------------------------------------------------------------------------------------\nmysql8   docker-entrypoint.sh mysqld   Up      0.0.0.0:3306->3306/tcp,:::3306->3306/tcp, 33060/tcp\n# 列出工程中指定服务的容器\n[root@Docker docker-myql8-2]# docker-compose ps mysql\n Name              Command             State                          Ports                       \n--------------------------------------------------------------------------------------------------\nmysql8   docker-entrypoint.sh mysqld   Up      0.0.0.0:3306->3306/tcp,:::3306->3306/tcp, 33060/tcp\n[root@Docker docker-myql8-2]# docker-compose ps mysql8\nERROR: No such service: mysql8\n")])])]),a("h5",{attrs:{id:"_4-7-run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-run"}},[e._v("#")]),e._v(" 4.7  run")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# pwd\n/root/docker-test/docker-nginx\n[root@Docker docker-nginx]# cat docker-compose.yml \n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    nginx: # 服务名称\n        image: nginx # 创建容器时所需的镜像\n        container_name: mynginx # 容器名称，默认为"工程名称_服务条目名称_序号"\n        ports: # 宿主机与容器的端口映射关系\n            - "80:80" # 左边宿主机端口:右边容器端口\n        networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n            nginx-net:\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\nnetworks:\n    nginx-net: # 一个具体网络的条目名称\n        name: nginx-net # 网络名称，默认为"工程名称_网络条目名称"\n        driver: bridge # 网络模式，默认为 bridge\n\n# 在工程中指定服务的容器上执行 echo "helloworld"\n[root@Docker docker-nginx]# docker-compose run nginx echo "helloworld"\nCreating network "nginx-net" with driver "bridge"\nhelloworld\n[root@Docker docker-nginx]# docker-compose down\nRemoving docker-nginx_nginx_run_fa15940e2827 ... done\nRemoving network nginx-net\n')])])]),a("h5",{attrs:{id:"_4-8-exec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-exec"}},[e._v("#")]),e._v(" 4.8  exec")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose exec")]),e._v(" 进入服务容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# docker-compose up -d\nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... don\n\n# 进入工程中指定服务的容器\n[root@Docker docker-nginx]# docker-compose exec nginx bash\nroot@22569bee9446:/# exit\nexit\n# 当一个服务拥有多个容器时，可通过 --index 参数进入到该服务下的任何容器\n[root@Docker docker-nginx]# docker-compose exec --index=1 nginx bash\nroot@22569bee9446:/# exit\nexit\n[root@Docker docker-nginx]# docker-compose exec --index=2 nginx bash \nERROR: No container found for nginx_2\n')])])]),a("h5",{attrs:{id:"_4-9-pause"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-pause"}},[e._v("#")]),e._v(" 4.9  pause")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose pause")]),e._v(" 暂停服务容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 暂停工程中所有服务的容器\n[root@Docker docker-nginx]# docker-compose pause\nPausing mynginx ... done\n# 暂停工程中指定服务的容器\n[root@Docker docker-nginx]# docker-compose pause nginx\nPausing mynginx ... done\n")])])]),a("h5",{attrs:{id:"_4-10-unpause"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-unpause"}},[e._v("#")]),e._v(" 4.10  unpause")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose unpause")]),e._v("恢复服务容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 恢复工程中所有服务的容器\n[root@Docker docker-nginx]# docker-compose unpause\nUnpausing mynginx ... done\n# 恢复工程中指定服务的容器\n[root@Docker docker-nginx]# docker-compose unpause nginx\nUnpausing mynginx ... done\n")])])]),a("h5",{attrs:{id:"_4-11-restart"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-11-restart"}},[e._v("#")]),e._v(" 4.11  restart")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose restart")]),e._v(" 重启服务容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# docker-compose up -d\nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... done\n# 重启工程中所有服务的容器\n[root@Docker docker-nginx]# docker-compose restart\nRestarting mynginx ... done\n# 重启工程中指定服务的容器\n[root@Docker docker-nginx]# docker-compose restart nginx\nRestarting mynginx ... done\n')])])]),a("h5",{attrs:{id:"_4-12-start"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-12-start"}},[e._v("#")]),e._v(" 4.12  start")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose start")]),e._v(" 启动服务容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 启动工程中所有服务的容器\n[root@Docker docker-nginx]# docker-compose start\nStarting nginx ... done\n# 启动工程中指定服务的容器\n[root@Docker docker-nginx]# docker-compose start nginx\nStarting nginx ... done\n[root@Docker docker-nginx]# docker-compose down\nStopping mynginx ... done\nRemoving mynginx ... done\nRemoving network nginx-net\n[root@Docker docker-nginx]# docker-compose start\nStarting nginx ... failed\nERROR: No containers to start\n[root@Docker docker-nginx]# docker-compose start nginx\nStarting nginx ... failed\nERROR: No containers to start\n")])])]),a("h5",{attrs:{id:"_4-13-stop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-13-stop"}},[e._v("#")]),e._v(" 4.13  stop")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose stop")]),e._v(" 停止服务容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# docker-compose up -d\nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... done\n# 停止工程中所有服务的容器\n[root@Docker docker-nginx]# docker-compose stop\nStopping mynginx ... done\n[root@Docker docker-nginx]# docker-compose start\nStarting nginx ... done\n# 停止工程中指定服务的容器\n[root@Docker docker-nginx]# docker-compose stop nginx\nStopping mynginx ... done\n[root@Docker docker-nginx]# docker-compose start nginx\nStarting nginx ... done\n')])])]),a("h5",{attrs:{id:"_4-14-kill"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-14-kill"}},[e._v("#")]),e._v(" 4.14  kill")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose kill")]),e._v(" 通过发送 "),a("code",[e._v("SIGKILL")]),e._v(" 信号停止指定服务的容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 通过发送 SIGKILL 信号停止工程中指定服务的容器\n[root@Docker docker-nginx]# docker-compose kill nginx\nKilling mynginx ... done\n[root@Docker docker-nginx]# docker-compose start nginx\nStarting nginx ... done\n")])])]),a("h5",{attrs:{id:"_4-15-rm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-15-rm"}},[e._v("#")]),e._v(" 4.15  rm")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose rm")]),e._v(" 删除服务（停止状态）容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 删除所有（停止状态）服务的容器\n[root@Docker docker-nginx]# docker-compose rm\nNo stopped containers\n# 先停止所有服务的容器，再删除所有服务的容器\n[root@Docker docker-nginx]# docker-compose rm -s\nStopping mynginx ... done\nGoing to remove mynginx\nAre you sure? [yN] y\nRemoving mynginx ... done\n[root@Docker docker-nginx]# docker-compose up -d\nCreating mynginx ... done\n[root@Docker docker-nginx]# docker-compose down\nStopping mynginx ... done\nRemoving mynginx ... done\nRemoving network nginx-net\n[root@Docker docker-nginx]# docker-compose up -d\nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... done\n# 不询问是否删除，直接删除\ndocker-compose rm -f\n[root@Docker docker-nginx]# docker-compose rm -f\nNo stopped containers\n[root@Docker docker-nginx]# docker-compose stop\nStopping mynginx ... done\n[root@Docker docker-nginx]# docker-compose rm -f\nGoing to remove mynginx\nRemoving mynginx ... done\n\n[root@Docker docker-myql8-3]# rm -rf /var/lib/docker/volumes/docker-myql8-3_mysql-data-volume\n[root@Docker docker-myql8-3]# docker-compose up -d                                           \nCreating network "docker-myql8-3_default" with the default driver\nCreating mysql8 ... error\n\nERROR: for mysql8  Cannot create container for service mysql: open /var/lib/docker/volumes/docker-myql8-3_mysql-data-volume/_data: no such file or directory\n\nERROR: for mysql  Cannot create container for service mysql: open /var/lib/docker/volumes/docker-myql8-3_mysql-data-volume/_data: no such file or directory\nERROR: Encountered errors while bringing up the project.\n\n[root@Docker docker-myql8-3]# docker volume ls\n[root@Docker docker-myql8-3]# docker volume rm docker-myql8-3_mysql-data-volume\ndocker-myql8-3_mysql-data-volume\n[root@Docker docker-myql8-3]# docker-compose down\nRemoving network docker-myql8-3_default\n\n[root@Docker docker-myql8-3]# docker-compose up -d\nCreating network "docker-myql8-3_default" with the default driver\nCreating volume "docker-myql8-3_mysql-data-volume" with default driver\nCreating mysql8 ... done\n# 删除服务容器--删除服务容器挂载的数据卷\n[root@Docker docker-myql8-3]# docker-compose stop \nStopping mysql8 ... done\n[root@Docker docker-myql8-3]# docker-compose rm -v\nGoing to remove mysql8\nAre you sure? [yN] y\nRemoving mysql8 ... done\n[root@Docker docker-myql8-3]# docker volume ls\nDRIVER    VOLUME NAME\nlocal     docker-myql8-3_mysql-data-volume\n[root@Docker docker-myql8-3]# docker-compose down -v   \nRemoving network docker-myql8-3_default\nRemoving volume docker-myql8-3_mysql-data-volume\n\n[root@Docker docker-myql8-3]# docker-compose rm --help\n    -v            Remove any anonymous volumes attached to containers\n\n[root@Docker docker-myql8-3]# docker-compose up -d     \nCreating network "docker-myql8-3_default" with the default driver\nCreating volume "docker-myql8-3_mysql-data-volume" with default driver\nCreating mysql8 ... done\n# 删除工程中指定服务的容器\n[root@Docker docker-myql8-3]# docker-compose rm -sv mysql\nStopping mysql8 ... done\nGoing to remove mysql8\nAre you sure? [yN] y\nRemoving mysql8 ... done\n')])])]),a("h5",{attrs:{id:"_4-16-down"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-16-down"}},[e._v("#")]),e._v(" 4.16  down")]),e._v(" "),a("ul",[a("li",[e._v("停止并删除所有服务的容器、网络、镜像、数据卷。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-myql8-3]# docker-compose up -d  \nCreating network "docker-myql8-3_default" with the default driver\nCreating volume "docker-myql8-3_mysql-data-volume" with default driver\nCreating mysql8 ... done\n# 1 停止工程中所有服务的容器--停止并删除工程中所有服务的容器、网络\n[root@Docker docker-myql8-3]# docker-compose stop\nStopping mysql8 ... done\n\n\n[root@Docker docker-myql8-3]# docker-compose up -d  \nCreating network "docker-myql8-3_default" with the default driver\nCreating volume "docker-myql8-3_mysql-data-volume" with default driver\nCreating mysql8 ... done\n[root@Docker docker-myql8-3]# docker-compose down   \nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-3_default\n\n\n[root@Docker docker-myql8-3]# docker-compose up -d  \nCreating network "docker-myql8-3_default" with the default driver\nCreating volume "docker-myql8-3_mysql-data-volume" with default driver\nCreating mysql8 ... done\n# 2 停止并删除工程中所有服务的容器、网络、镜像\n[root@Docker docker-myql8-3]# docker-compose down --rmi all\nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-3_default\nRemoving image mysql:8\n[root@Docker docker-myql8-3]# docker-compose down -v\nRemoving network docker-myql8-3_default\nWARNING: Network docker-myql8-3_default not found.\nRemoving volume docker-myql8-3_mysql-data-volume\n[root@Docker docker-myql8-3]# docker-compose up -d         \nCreating network "docker-myql8-3_default" with the default driver\nCreating volume "docker-myql8-3_mysql-data-volume" with default driver\nPulling mysql (mysql:8)...\n8: Pulling from library/mysql\n72a69066d2fe: Pull complete\n93619dbc5b36: Pull complete\n99da31dd6142: Pull complete\n626033c43d70: Pull complete\n37d5d7efb64e: Pull complete\nac563158d721: Pull complete\nd2ba16033dad: Pull complete\n688ba7d5c01a: Pull complete\n00e060b6d11d: Pull complete\n1c04857f594f: Pull complete\n4d7cfa90e6ea: Pull complete\ne0431212d27d: Pull complete\nDigest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709\nStatus: Downloaded newer image for mysql:8\nCreating mysql8 ... done\n\n# 3 停止并删除工程中所有服务的容器、网络、数据卷\n[root@Docker docker-myql8-3]# docker-compose down -v\nStopping mysql8 ... done\nRemoving mysql8 ... done\nRemoving network docker-myql8-3_default\nRemoving volume docker-myql8-3_mysql-data-volume\n')])])]),a("h5",{attrs:{id:"_4-17-create"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-17-create"}},[e._v("#")]),e._v(" 4.17  create")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose create")]),e._v(" 为服务创建容器，已不推荐使用。推荐使用 "),a("code",[e._v("docker-compose up")]),e._v(" 来实现该功能。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker docker-nginx]# docker-compose create nginx\nWARNING: The create command is deprecated. Use the up command with the --no-start flag instead.\nCreating mynginx ... done\n")])])]),a("h5",{attrs:{id:"_4-18-scale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-18-scale"}},[e._v("#")]),e._v(" 4.18  scale")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("docker-compose scale")]),e._v(" 设置指定服务运行的容器个数，已不推荐使用。")])]),e._v(" "),a("li",[a("p",[e._v("推荐使用 "),a("code",[e._v("--scale service=num")]),e._v(" 的参数来设置数量。")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-helloworld]# pwd\n/root/docker-test/docker-helloworld\n[root@Docker docker-helloworld]# cat docker-compose.yml \n# 描述 Compose 文件的版本信息\nversion: "3.8"\n# 定义服务，可以多个\nservices:\n    helloworld: # 服务名称\n        image: hello-world\n\n# 通过 --scale 指定 helloworld 服务一次性启动 3 个\n[root@Docker docker-helloworld]# docker-compose up -d --scale helloworld=3\nCreating network "docker-helloworld_default" with the default driver\nCreating docker-helloworld_helloworld_1 ... done\nCreating docker-helloworld_helloworld_2 ... done\nCreating docker-helloworld_helloworld_3 ... done\n[root@Docker docker-helloworld]# docker-compose exec --index=3 helloworld bash\nERROR: No container found for helloworld_3\n')])])]),a("h5",{attrs:{id:"_4-19-images"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-19-images"}},[e._v("#")]),e._v(" 4.19  images")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose images")]),e._v(" 打印服务容器所对应的镜像。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker docker-nginx]# docker-compose up -d\nCreating network "nginx-net" with driver "bridge"\nCreating mynginx ... done\n# # 打印所有服务的容器所对应的镜像\n[root@Docker docker-nginx]# docker-compose images\nContainer   Repository    Tag       Image Id       Size  \n---------------------------------------------------------\nmynginx     nginx        latest   87a94228f133   133.3 MB\n# 打印指定服务的容器所对应的镜像\n[root@Docker docker-nginx]# docker-compose images nginx\nContainer   Repository    Tag       Image Id       Size  \n---------------------------------------------------------\nmynginx     nginx        latest   87a94228f133   133.3 MB\n')])])]),a("h5",{attrs:{id:"_4-20-port"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-20-port"}},[e._v("#")]),e._v(" 4.20  port")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose port")]),e._v(" 打印指定服务容器的某个端口所映射的宿主机端口。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker docker-nginx]# docker-compose port nginx 80\n0.0.0.0:80\n")])])]),a("h5",{attrs:{id:"_4-21-top"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-21-top"}},[e._v("#")]),e._v(" 4.21  top")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker-compose top")]),e._v(" 显示正在运行的进程。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 1 显示工程中所有服务的容器正在运行的进程\n[root@Docker docker-nginx]# docker-compose top\nmynginx\nUID    PID    PPID   C   STIME   TTY     TIME                        CMD                    \n--------------------------------------------------------------------------------------------\nroot   8426   8408   1   08:40   ?     00:00:00   nginx: master process nginx -g daemon off;\n101    8494   8426   0   08:40   ?     00:00:00   nginx: worker process                     \n# 2 显示工程中指定服务的容器正在运行的进程\n[root@Docker docker-nginx]# docker-compose top nginx\nmynginx\nUID    PID    PPID   C   STIME   TTY     TIME                        CMD                    \n--------------------------------------------------------------------------------------------\nroot   8426   8408   0   08:40   ?     00:00:00   nginx: master process nginx -g daemon off;\n101    8494   8426   0   08:40   ?     00:00:00   nginx: worker process                     \n\n")])])]),a("h4",{attrs:{id:"_5-0-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-总结"}},[e._v("#")]),e._v(" 5.0  总结")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Docker Compose 的整体使用步骤还是比较简单的，三个步骤为：")]),e._v(" "),a("ol",[a("li",[e._v("使用 "),a("code",[e._v("Dockerfile")]),e._v(" 文件定义应用程序的环境；")]),e._v(" "),a("li",[e._v("使用 "),a("code",[e._v("docker-compose.yml")]),e._v(" 文件定义构成应用程序的服务，这样它们可以在隔离环境中一起运行；")]),e._v(" "),a("li",[e._v("最后，执行 "),a("code",[e._v("docker-compose up")]),e._v(" 命令来创建并启动所有服务。")])])]),e._v(" "),a("li",[a("p",[e._v("虽然 "),a("strong",[e._v("docker-compose.yml 文件详解")]),e._v("和"),a("strong",[e._v("Compose 常用命令")]),e._v("这两大块的内容比较多，但是如果要快速入门使用 "),a("code",[e._v("Compose")]),e._v("，其实只需要了解其中部分内容即可。后期大家可在项目生产环境中根据自身情况再进一步深入学习即可。")])]),e._v(" "),a("li",[a("p",[e._v("接下来我们使用 Docker Compose 搭建一遍 Redis Cluster 集群环境，感受感受与之前的区别。")])])]),e._v(" "),a("h4",{attrs:{id:"_6-0-参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-0-参考资料"}},[e._v("#")]),e._v(" 6.0  参考资料")]),e._v(" "),a("h4",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[e._v("#")]),e._v(" 参考资料")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.docker.com/compose/install/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/install/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"http://get.daocloud.io/#install-compose",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://get.daocloud.io/#install-compose"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/compose/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/compose-file/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/compose/reference/overview/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://docs.docker.com/compose/reference/overview/"),a("OutboundLink")],1)])]),e._v(" "),a("h3",{attrs:{id:"docker-搭建-redis-cluster-集群环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-搭建-redis-cluster-集群环境"}},[e._v("#")]),e._v(" Docker 搭建 Redis Cluster 集群环境")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker12.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 搭建 Redis Cluster 集群环境"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_1-0-环境-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-环境-2"}},[e._v("#")]),e._v(" 1.0  环境")]),e._v(" "),a("ul",[a("li",[e._v("为了让环境更加真实，本文使用多机环境：\n"),a("ul",[a("li",[e._v("192.168.56.106 Docker")]),e._v(" "),a("li",[e._v("192.168.56.107 SystemFramework")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:06:95:01 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 62635sec preferred_lft 62635sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:27:bb:60 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.106/24 brd 192.168.56.255 scope global noprefixroute dynamic enp0s8\n       valid_lft 525sec preferred_lft 525sec\n    inet6 fe80::7601:80e4:1d9f:6c8c/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n[root@SystemFramework ~]# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:62:70:fe brd ff:ff:ff:ff:ff:ff\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 86327sec preferred_lft 86327sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:6d:a9:b6 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.107/24 brd 192.168.56.255 scope global noprefixroute dynamic enp0s8\n       valid_lft 527sec preferred_lft 527sec\n    inet6 fe80::743a:5bee:6fea:2e30/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[e._v("每台机器所使用的基础设施环境如下：\n"),a("ul",[a("li",[e._v("CentOS 7.9.2009 "),a("code",[e._v("centos-release-7-9")])]),e._v(" "),a("li",[a("code",[e._v("Docker version 20.10.9")])])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# rpm -q centos-release\ncentos-release-7-9.2009.0.el7.centos.x86_64\n[root@Docker ~]# cat /etc/redhat-release \nCentOS Linux release 7.9.2009 (Core)\n[root@Docker ~]# docker -v\nDocker version 20.10.9, build c2ea9bc\n\n[root@SystemFramework ~]# rpm -q centos-release\ncentos-release-7-9.2009.0.el7.centos.x86_64\n[root@SystemFramework ~]# cat /etc/redhat-release \nCentOS Linux release 7.9.2009 (Core)\n[root@SystemFramework ~]# docker -v\nDocker version 20.10.8, build 3967b7d\n")])])]),a("h4",{attrs:{id:"_2-0-搭建-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-搭建-2"}},[e._v("#")]),e._v(" 2.0  搭建")]),e._v(" "),a("ul",[a("li",[e._v("整体搭建步骤主要分为以下几步：\n"),a("ul",[a("li",[e._v("下载 Redis 镜像（其实这步可以省略，因为创建容器时，如果本地镜像不存在，就会去远程拉取）；")]),e._v(" "),a("li",[e._v("编写 Redis 配置文件；")]),e._v(" "),a("li",[e._v("创建 Redis 容器；")]),e._v(" "),a("li",[e._v("创建 Redis Cluster 集群。")])])])]),e._v(" "),a("h5",{attrs:{id:"_2-1-编写-redis-配置文件-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-编写-redis-配置文件-2"}},[e._v("#")]),e._v(" 2.1  编写 Redis 配置文件")]),e._v(" "),a("h5",{attrs:{id:"_2-2-创建-redis-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-创建-redis-容器"}},[e._v("#")]),e._v(" 2.2  创建 Redis 容器")]),e._v(" "),a("h5",{attrs:{id:"_2-3-创建-redis-cluster-集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-创建-redis-cluster-集群"}},[e._v("#")]),e._v(" 2.3  创建 Redis Cluster 集群")]),e._v(" "),a("h4",{attrs:{id:"_3-0-查看集群状态-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-查看集群状态-2"}},[e._v("#")]),e._v(" 3.0  查看集群状态")]),e._v(" "),a("ul",[a("li",[e._v("我们先进入容器，然后通过一些集群常用的命令查看一下集群的状态。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n")])])]),a("h5",{attrs:{id:"_3-1-检查集群状态-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-检查集群状态-2"}},[e._v("#")]),e._v(" 3.1  检查集群状态")]),e._v(" "),a("h5",{attrs:{id:"_3-2-查看集群信息和节点信息-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-查看集群信息和节点信息-2"}},[e._v("#")]),e._v(" 3.2  查看集群信息和节点信息")]),e._v(" "),a("h5",{attrs:{id:"_3-3-set-get-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-set-get-2"}},[e._v("#")]),e._v(" 3.3  SET/GET")]),e._v(" "),a("h4",{attrs:{id:"_4-0-客户端连接-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-客户端连接-2"}},[e._v("#")]),e._v(" 4.0  客户端连接")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("最后来一波客户端连接操作，随便哪个节点，看看可否通过外部访问 Redis Cluster 集群。")])]),e._v(" "),a("li",[a("p",[e._v("至此使用多机环境多个容器搭建 Redis Cluster 集群环境就到这里，其实整体搭建过程不算特别麻烦，因为：")]),e._v(" "),a("ul",[a("li",[e._v("创建 Redis 集群需要用到 Ruby，否则就得自己关联节点构建集群，自己分配槽；")]),e._v(" "),a("li",[e._v("如果使用 Ruby 构建 Redis 集群，就需要安装 Ruby 环境；")]),e._v(" "),a("li",[e._v("而 Redis 从 5 版本开始可以直接使用 redis-cli 命令创建集群了，就省去了很多麻烦事；")]),e._v(" "),a("li",[e._v("我们还使用了 shell for 循环语句简化了构建过程，否则那些语句一条条执行也够你闹心的。")])])]),e._v(" "),a("li",[a("p",[e._v("综上所述，有没有更简单的办法呢？当然有了，不然我在这跟你卖什么关子。")])]),e._v(" "),a("li",[a("p",[e._v("Docker Compose 就可以解决这个问题。后面我们先学习一下什么是 Docker Compose，然后使用 Docker Compose 再来搭建一遍 Redis Cluster 集群环境，感受感受这前后的区别。")])])]),e._v(" "),a("h3",{attrs:{id:"_11-docker-网络模式详解及容器间网络通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-docker-网络模式详解及容器间网络通信"}},[e._v("#")]),e._v(" 11 Docker 网络模式详解及容器间网络通信")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker11.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 网络模式详解及容器间网络通信"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("当项目大规模使用 Docker 时，容器通信的问题也就产生了。要解决容器通信问题，必须先了解很多关于网络的知识。Docker 作为目前最火的轻量级容器技术，有很多令人称道的功能，如 Docker 的镜像管理。然而，Docker 同样有着很多不完善的地方，网络方面就是 Docker 比较薄弱的部分。因此，我们有必要深入了解 Docker 的网络知识，以满足更高的网络需求。")])]),e._v(" "),a("h4",{attrs:{id:"_1-0-默认网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-默认网络"}},[e._v("#")]),e._v(" 1.0  默认网络")]),e._v(" "),a("ul",[a("li",[e._v("安装 Docker 以后，会默认创建三种网络，可以通过 docker network ls 查看。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network ls\nNETWORK ID     NAME      DRIVER    SCOPE\n4ae0332db571   bridge    bridge    local\nd8c2a3f46d08   host      host      local\nabadbe38c594   none      null      local\n")])])]),a("ul",[a("li",[e._v("在学习 Docker 网络之前，我们有必要先来了解一下这几种网络模式都是什么意思。")])]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("网络模式")]),e._v(" "),a("th",[e._v("简介")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("bridge")]),e._v(" "),a("td",[e._v("为每一个容器分配、设置 IP 等，并将容器连接到一个 "),a("code",[e._v("docker0")]),e._v(" 虚拟网桥，默认为该模式。")])]),e._v(" "),a("tr",[a("td",[e._v("host")]),e._v(" "),a("td",[e._v("容器将不会虚拟出自己的网卡，配置自己的 IP 等，而是使用宿主机的 IP 和端口。")])]),e._v(" "),a("tr",[a("td",[e._v("none")]),e._v(" "),a("td",[e._v("容器有独立的 Network namespace，但并没有对其进行任何网络设置，如分配 veth pair 和网桥连接，IP 等。")])]),e._v(" "),a("tr",[a("td",[e._v("container")]),e._v(" "),a("td",[e._v("新创建的容器不会创建自己的网卡和配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。")])])])]),e._v(" "),a("h5",{attrs:{id:"_1-1-bridge-网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-bridge-网络模式"}},[e._v("#")]),e._v(" 1.1  bridge 网络模式")]),e._v(" "),a("ul",[a("li",[e._v("在该模式中，Docker 守护进程创建了一个虚拟以太网桥 "),a("code",[e._v("docker0")]),e._v("，新建的容器会自动桥接到这个接口，附加在其上的任何网卡之间都能自动转发数据包。")]),e._v(" "),a("li",[e._v("默认情况下，守护进程会创建一对对等虚拟设备接口 "),a("code",[e._v("veth pair")]),e._v("，将其中一个接口设置为容器的 "),a("code",[e._v("eth0")]),e._v(" 接口（容器的网卡），另一个接口放置在宿主机的命名空间中，以类似 "),a("code",[e._v("vethxxx")]),e._v(" 这样的名字命名，从而将宿主机上的所有容器都连接到这个内部网络上。")]),e._v(" "),a("li",[e._v("比如我运行一个基于 "),a("code",[e._v("busybox")]),e._v(" 镜像构建的容器 "),a("code",[e._v("bbox01")]),e._v("，查看 "),a("code",[e._v("ip addr")]),e._v("：")])]),e._v(" "),a("blockquote",[a("p",[e._v("busybox 被称为嵌入式 Linux 的瑞士军刀，整合了很多小的 unix 下的通用功能到一个小的可执行文件中。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker run -it --name bbox01 busybox\nUnable to find image 'busybox:latest' locally\nlatest: Pulling from library/busybox\n5cc84ad355aa: Pull complete \nDigest: sha256:5acba83a746c7608ed544dc1533b87c737a0b0fb730301639a0179f9344b1678\nStatus: Downloaded newer image for busybox:latest\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n7: eth0@if8: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n/ # \n\n[root@Docker ~]# docker exec -it iauth-registry sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n5: eth0@if6: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue state UP \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[e._v("然后宿主机通过 ip addr 查看信息如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# ip addr\n4: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:16:c6:5e:87 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:16ff:fec6:5e87/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth0d9b0ab@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether b6:e9:be:c6:15:7d brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::b4e9:beff:fec6:157d/64 scope link \n       valid_lft forever preferred_lft forever\n8: vetha1c5d0c@if7: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether 9a:c6:42:99:91:67 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet6 fe80::98c6:42ff:fe99:9167/64 scope link \n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[a("p",[e._v("通过以上的比较可以发现，证实了之前所说的：守护进程会创建一对对等虚拟设备接口 "),a("code",[e._v("veth pair")]),e._v("，将其中一个接口设置为容器的 "),a("code",[e._v("eth0")]),e._v(" [eth0@if8]接口（容器的网卡），另一个接口放置在宿主机的命名空间中，以类似 "),a("code",[e._v("vethxxx")]),e._v(" [vetha1c5d0c@if7]这样的名字命名。")])]),e._v(" "),a("li",[a("p",[e._v("同时，守护进程还会从网桥 "),a("code",[e._v("docker0")]),e._v(" 的私有地址空间中分配一个 IP 地址和子网给该容器，并设置 docker0 的 IP 地址为容器的默认网关。也可以安装 "),a("code",[e._v("yum install -y bridge-utils")]),e._v(" 以后，通过 "),a("code",[e._v("brctl show")]),e._v(" 命令查看网桥信息。")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# yum install -y bridge-utils\n[root@Docker ~]# brctl show\nbridge name     bridge id               STP enabled     interfaces\ndocker0         8000.024216c65e87       no              veth0d9b0ab\n                                                        vetha1c5d0c\n")])])]),a("ul",[a("li",[e._v("对于每个容器的 IP 地址和 Gateway 信息，我们可以通过 "),a("code",[e._v("docker inspect 容器名称|ID")]),e._v(" 进行查看，在 "),a("code",[e._v("NetworkSettings")]),e._v(" 节点中可以看到详细信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker inspect bbox01\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "0f788c163a95cd94257a652ed4dd026bcf7329b7945c8d415f3d32f5ee0d662a",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {},\n            "SandboxKey": "/var/run/docker/netns/0f788c163a95",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "a13cc91243c1e4741a6e38fdbee2a36313423b1e89058b8ee015b591647ab0bd",\n            "Gateway": "172.17.0.1",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "172.17.0.3",\n            "IPPrefixLen": 16,\n            "IPv6Gateway": "",\n            "MacAddress": "02:42:ac:11:00:03",\n            "Networks": {\n                "bridge": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": null,\n                    "NetworkID": "4ae0332db57103ab7bbc5528b2c747201c0a4fdd51d0399d61924fc8be211a78",\n                    "EndpointID": "a13cc91243c1e4741a6e38fdbee2a36313423b1e89058b8ee015b591647ab0bd",\n                    "Gateway": "172.17.0.1",\n                    "IPAddress": "172.17.0.3",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:11:00:03",\n                    "DriverOpts": null\n                }\n            }\n        }\n')])])]),a("ul",[a("li",[e._v("我们可以通过 "),a("code",[e._v("docker network inspect bridge")]),e._v(" 查看所有 "),a("code",[e._v("bridge")]),e._v(" 网络模式下的容器，在 "),a("code",[e._v("Containers")]),e._v(" 节点中可以看到容器名称。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker network inspect bridge\n[\n    {\n        "Name": "bridge",\n        "Id": "4ae0332db57103ab7bbc5528b2c747201c0a4fdd51d0399d61924fc8be211a78",\n        "Created": "2022-04-29T10:35:04.412494977+08:00",\n        "Scope": "local",\n        "Driver": "bridge",\n        "EnableIPv6": false,\n        "IPAM": {\n            "Driver": "default",\n            "Options": null,\n            "Config": [\n                {\n                    "Subnet": "172.17.0.0/16",\n                    "Gateway": "172.17.0.1"\n                }\n            ]\n        },\n        "Internal": false,\n        "Attachable": false,\n        "Ingress": false,\n        "ConfigFrom": {\n            "Network": ""\n        },\n        "ConfigOnly": false,\n        "Containers": {\n            "6cbedf1bc79b8134398899f235c181416eb351b0534c10ef9064a500dfd43f0e": {\n                "Name": "iauth-registry",\n                "EndpointID": "443c87f86790501ba6736731e1e7063d5ecb43896a4bed61e18778b6b448cbff",\n                "MacAddress": "02:42:ac:11:00:02",\n                "IPv4Address": "172.17.0.2/16",\n                "IPv6Address": ""\n            },\n            "f67155142ee170a49f7e25f625c38ca47c1b8f250daf4ffaccc4ba893243caf4": {\n                "Name": "bbox01",\n                "EndpointID": "a13cc91243c1e4741a6e38fdbee2a36313423b1e89058b8ee015b591647ab0bd",\n                "MacAddress": "02:42:ac:11:00:03",\n                "IPv4Address": "172.17.0.3/16",\n                "IPv6Address": ""\n            }\n        },\n        "Options": {\n            "com.docker.network.bridge.default_bridge": "true",\n            "com.docker.network.bridge.enable_icc": "true",\n            "com.docker.network.bridge.enable_ip_masquerade": "true",\n            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",\n            "com.docker.network.bridge.name": "docker0",\n            "com.docker.network.driver.mtu": "1500"\n        },\n        "Labels": {}\n    }\n]\n')])])]),a("blockquote",[a("p",[e._v("关于 "),a("code",[e._v("bridge")]),e._v(" 网络模式的使用，只需要在创建容器时通过参数 "),a("code",[e._v("--net bridge")]),e._v(" 或者 "),a("code",[e._v("--network bridge")]),e._v(" 指定即可，当然这也是创建容器默认使用的网络模式，也就是说这个参数是可以省略的。")])]),e._v(" "),a("p",[a("img",{attrs:{src:n(516),alt:"docker-bridge"}})]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("容器名")]),e._v(" "),a("th",[e._v("eth0")]),e._v(" "),a("th",[e._v("veth")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("iauth-registry")]),e._v(" "),a("td",[e._v("eth0@if6")]),e._v(" "),a("td",[e._v("veth0d9b0ab@if5")])]),e._v(" "),a("tr",[a("td",[e._v("bbox01")]),e._v(" "),a("td",[e._v("eth0@if8")]),e._v(" "),a("td",[e._v("vetha1c5d0c@if7")])])])]),e._v(" "),a("ul",[a("li",[e._v("Bridge 桥接模式的实现步骤主要如下：\n"),a("ul",[a("li",[e._v("Docker Daemon 利用 veth pair 技术，在宿主机上创建一对对等虚拟网络接口设备，假设为 veth0 和 veth1。而veth pair 技术的特性可以保证无论哪一个 veth 接收到网络报文，都会将报文传输给另一方。")]),e._v(" "),a("li",[e._v("Docker Daemon 将 veth0 附加到 Docker Daemon 创建的 docker0 网桥上。保证宿主机的网络报文可以发往 veth0；")]),e._v(" "),a("li",[e._v("Docker Daemon 将 veth1 添加到 Docker Container 所属的 namespace 下，并被改名为 eth0。如此一来，宿主机的网络报文若发往 veth0，则立即会被 Container 的 eth0 接收，实现宿主机到 Docker Container 网络的联通性；同时，也保证 Docker Container 单独使用 eth0，实现容器网络环境的隔离性。")])])])]),e._v(" "),a("h5",{attrs:{id:"_1-2-host-网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-host-网络模式"}},[e._v("#")]),e._v(" 1.2  host 网络模式")]),e._v(" "),a("ul",[a("li",[e._v("host 网络模式需要在创建容器时通过参数 "),a("code",[e._v("--net host")]),e._v(" 或者 "),a("code",[e._v("--network host")]),e._v(" 指定；")]),e._v(" "),a("li",[e._v("采用 host 网络模式的 Docker Container，可以直接使用宿主机的 IP 地址与外界进行通信，若宿主机的 eth0 是一个公有 IP，那么容器也拥有这个公有 IP。同时容器内服务的端口也可以使用宿主机的端口，无需额外进行 NAT 转换；")]),e._v(" "),a("li",[e._v("host 网络模式可以让容器共享宿主机网络栈，这样的好处是外部主机与容器直接通信，但是容器的网络缺少隔离性。")])]),e._v(" "),a("p",[a("img",{attrs:{src:n(517),alt:"docker-host"}})]),e._v(" "),a("ul",[a("li",[e._v("比如我基于 host 网络模式创建了一个基于 busybox 镜像构建的容器 bbox02，查看 ip addr：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker run -di --name bbox02 --network host busybox  \n2c21d009f790237a6dab75658f06c7c01bbf7e2c363df7e5fea44f6d4703bc4e\n[root@Docker ~]# docker exec -it bbox02 sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether 08:00:27:06:95:01 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute enp0s3\n       valid_lft 71032sec preferred_lft 71032sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000\n    link/ether 08:00:27:27:bb:60 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.106/24 brd 192.168.56.255 scope global dynamic noprefixroute enp0s8\n       valid_lft 567sec preferred_lft 567sec\n    inet6 fe80::7601:80e4:1d9f:6c8c/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n4: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue \n    link/ether 02:42:16:c6:5e:87 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:16ff:fec6:5e87/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth0d9b0ab@if5: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue master docker0 \n    link/ether b6:e9:be:c6:15:7d brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::b4e9:beff:fec6:157d/64 scope link \n       valid_lft forever preferred_lft forever\n8: vetha1c5d0c@if7: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue master docker0 \n    link/ether 9a:c6:42:99:91:67 brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::98c6:42ff:fe99:9167/64 scope link \n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[e._v("然后宿主机通过 ip addr 查看信息如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:06:95:01 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 70979sec preferred_lft 70979sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:27:bb:60 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.106/24 brd 192.168.56.255 scope global noprefixroute dynamic enp0s8\n       valid_lft 515sec preferred_lft 515sec\n    inet6 fe80::7601:80e4:1d9f:6c8c/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n4: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:16:c6:5e:87 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:16ff:fec6:5e87/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth0d9b0ab@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether b6:e9:be:c6:15:7d brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::b4e9:beff:fec6:157d/64 scope link \n       valid_lft forever preferred_lft forever\n8: vetha1c5d0c@if7: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether 9a:c6:42:99:91:67 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet6 fe80::98c6:42ff:fe99:9167/64 scope link \n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[e._v("对，你没有看错，返回信息一模一样，不信接着往下看。我们可以通过 "),a("code",[e._v("docker network inspect host")]),e._v(" 查看所有 "),a("code",[e._v("host")]),e._v(" 网络模式下的容器，在 Containers 节点中可以看到容器名称。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker network inspect host\n[\n    {\n        "Name": "host",\n        "Id": "d8c2a3f46d08b8c0231d1cf7f553e724c0179254991fc6e08470e95698ea10a5",\n        "Created": "2021-10-17T12:13:11.090522799+08:00",\n        "Scope": "local",\n        "Driver": "host",\n        "EnableIPv6": false,\n        "IPAM": {\n            "Driver": "default",\n            "Options": null,\n            "Config": []\n        },\n        "Internal": false,\n        "Attachable": false,\n        "Ingress": false,\n        "ConfigFrom": {\n            "Network": ""\n        },\n        "ConfigOnly": false,\n        "Containers": {\n            "2c21d009f790237a6dab75658f06c7c01bbf7e2c363df7e5fea44f6d4703bc4e": {\n                "Name": "bbox02",\n                "EndpointID": "ba3b52244b8768aa6c0391ef30bed1f283eb3f01fbee96f850055158c76cae26",\n                "MacAddress": "",\n                "IPv4Address": "",\n                "IPv6Address": ""\n            }\n        },\n        "Options": {},\n        "Labels": {}\n    }\n]\n')])])]),a("h5",{attrs:{id:"_1-3-none-网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-none-网络模式"}},[e._v("#")]),e._v(" 1.3  none 网络模式")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("none 网络模式是指禁用网络功能，只有 lo 接口 local 的简写，代表 127.0.0.1，即 localhost 本地环回接口。在创建容器时通过参数 "),a("code",[e._v("--net none")]),e._v(" 或者 "),a("code",[e._v("--network none")]),e._v(" 指定；")])]),e._v(" "),a("li",[a("p",[e._v("none 网络模式即不为 Docker Container 创建任何的网络环境，容器内部就只能使用 loopback 网络设备，不会再有其他的网络资源。可以说 none 模式为 Docke Container 做了极少的网络设定，但是俗话说得好“少即是多”，在没有网络配置的情况下，作为 Docker 开发者，才能在这基础做其他无限多可能的网络定制开发。这也恰巧体现了 Docker 设计理念的开放。")])]),e._v(" "),a("li",[a("p",[e._v("比如我基于 none 网络模式创建了一个基于 busybox 镜像构建的容器 bbox03，查看 ip addr：")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker run -di --name bbox3 --network none busybox\n1b569f8d7989b6e11e2cbef2c4a1ee68216924d4645684d9465dd9a8ca40174d\n[root@Docker ~]# docker exec -it bbox3 sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n/ # \n")])])]),a("ul",[a("li",[e._v("我们可以通过 "),a("code",[e._v("docker network inspect none")]),e._v(" 查看所有 "),a("code",[e._v("none")]),e._v(" 网络模式下的容器，在 "),a("code",[e._v("Containers")]),e._v(" 节点中可以看到容器名称。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker network inspect none\n[\n    {\n        "Name": "none",\n        "Id": "abadbe38c594a75e7346c5f25183685f89013721ffced5dc1d4725c2e2083c82",\n        "Created": "2021-10-17T12:13:11.011457614+08:00",\n        "Scope": "local",\n        "Driver": "null",\n        "EnableIPv6": false,\n        "IPAM": {\n            "Driver": "default",\n            "Options": null,\n            "Config": []\n        },\n        "Internal": false,\n        "Attachable": false,\n        "Ingress": false,\n        "ConfigFrom": {\n            "Network": ""\n        },\n        "ConfigOnly": false,\n        "Containers": {\n            "1b569f8d7989b6e11e2cbef2c4a1ee68216924d4645684d9465dd9a8ca40174d": {\n                "Name": "bbox3",\n                "EndpointID": "a4b858333156a6c229b0739d59d24e0709ecda06ffe12fbde910183eac2b5d05",\n                "MacAddress": "",\n                "IPv4Address": "",\n                "IPv6Address": ""\n            }\n        },\n        "Options": {},\n        "Labels": {}\n    }\n]\n\n')])])]),a("h5",{attrs:{id:"_1-4-container-网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-container-网络模式"}},[e._v("#")]),e._v(" 1.4  container 网络模式")]),e._v(" "),a("ul",[a("li",[e._v("Container 网络模式是 Docker 中一种较为特别的网络的模式。在创建容器时通过参数 "),a("code",[e._v("--net container:已运行的容器名称|ID")]),e._v(" 或者 "),a("code",[e._v("--network container:已运行的容器名称|ID")]),e._v(" 指定；")]),e._v(" "),a("li",[e._v("处于这个模式下的 Docker 容器会共享一个网络栈，这样两个容器之间可以使用 localhost 高效快速通信。")])]),e._v(" "),a("p",[a("img",{attrs:{src:n(518),alt:"docker-container"}})]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("Container 网络模式即新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等")]),e._v("。同样两个容器除了网络方面相同之外，其他的如文件系统、进程列表等还是隔离的。")]),e._v(" "),a("li",[e._v("比如我基于容器 "),a("code",[e._v("bbox01")]),e._v(" 创建了 "),a("code",[e._v("container")]),e._v(" 网络模式的容器 "),a("code",[e._v("bbox04")]),e._v("，查看 "),a("code",[e._v("ip addr")]),e._v("：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker run -di --name bbox04 --network container:bbox01 busybox\n51c2c51fbb779f39d23fdf9c484490bd32f533de9e756b81fd9208a57514e444\n[root@Docker ~]# docker exec -it bbox04 sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n7: eth0@if8: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[e._v("容器 bbox01 的 ip addr 信息如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker exec -it bbox01 sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n7: eth0@if8: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[e._v("宿主机的 ip addr 信息如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:06:95:01 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 69743sec preferred_lft 69743sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:27:bb:60 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.106/24 brd 192.168.56.255 scope global noprefixroute dynamic enp0s8\n       valid_lft 594sec preferred_lft 594sec\n    inet6 fe80::7601:80e4:1d9f:6c8c/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n4: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:16:c6:5e:87 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:16ff:fec6:5e87/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth0d9b0ab@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether b6:e9:be:c6:15:7d brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::b4e9:beff:fec6:157d/64 scope link \n       valid_lft forever preferred_lft forever\n8: vetha1c5d0c@if7: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP group default \n    link/ether 9a:c6:42:99:91:67 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet6 fe80::98c6:42ff:fe99:9167/64 scope link \n       valid_lft forever preferred_lft forever\n")])])]),a("ul",[a("li",[e._v("通过以上测试可以发现，Docker 守护进程只创建了一对对等虚拟设备接口用于连接 bbox01 容器和宿主机，而 bbox04 容器则直接使用了 bbox01 容器的网卡信息。")]),e._v(" "),a("li",[e._v("这个时候如果将 bbox01 容器停止，会发现 bbox04 容器就只剩下 lo 接口了。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker stop bbox01\nbbox01\n[root@Docker ~]# docker exec -it bbox04 sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n/ # \n\n")])])]),a("ul",[a("li",[e._v("然后 bbox01 容器重启以后，bbox04 容器也重启一下，就又可以获取到网卡信息了。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker restart bbox01\n[root@Docker ~]# docker exec -it bbox04 sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n/ # exit\n[root@Docker ~]# docker restart bbox04\nbbox04\n[root@Docker ~]# docker exec -it bbox04 sh\n/ # ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n9: eth0@if10: <BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN> mtu 1500 qdisc noqueue \n    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n")])])]),a("h5",{attrs:{id:"_1-5-link"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-link"}},[e._v("#")]),e._v(" 1.5  link")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("docker run --link")]),e._v(" 可以用来链接两个容器，使得源容器（被链接的容器）和接收容器（主动去链接的容器）之间可以互相通信，并且接收容器可以获取源容器的一些数据，如源容器的环境变量。")]),e._v(" "),a("li",[e._v("这种方式"),a("strong",[e._v("官方已不推荐使用")]),e._v("，并且在未来版本可能会被移除，所以这里不作为重点讲解，感兴趣可自行了解。")]),e._v(" "),a("li",[e._v("官网警告信息："),a("a",{attrs:{href:"https://docs.docker.com/network/links/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Legacy container links | Docker Documentation"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_2-0-自定义网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-自定义网络"}},[e._v("#")]),e._v(" 2.0  自定义网络")]),e._v(" "),a("h5",{attrs:{id:"_2-1-创建网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-创建网络"}},[e._v("#")]),e._v(" 2.1  创建网络")]),e._v(" "),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker network create")]),e._v(" 命令可以创建自定义网络模式，命令提示如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network --help\n\nUsage:  docker network COMMAND\n\nManage networks\n\nCommands:\n  connect     Connect a container to a network\n  create      Create a network\n  disconnect  Disconnect a container from a network\n  inspect     Display detailed information on one or more networks\n  ls          List networks\n  prune       Remove all unused networks\n  rm          Remove one or more networks\n\nRun 'docker network COMMAND --help' for more information on a command.\n")])])]),a("ul",[a("li",[e._v("进一步查看 "),a("code",[e._v("docker network create")]),e._v(" 命令使用详情，发现可以通过 "),a("code",[e._v("--driver")]),e._v(" 指定网络模式且默认是 "),a("code",[e._v("bridge")]),e._v(" 网络模式，提示如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker network create --help\n\nUsage:  docker network create [OPTIONS] NETWORK\n\nCreate a network\n\nOptions:\n      --attachable           Enable manual container attachment\n      --aux-address map      Auxiliary IPv4 or IPv6 addresses used by Network driver (default map[])\n      --config-from string   The network from which to copy the configuration\n      --config-only          Create a configuration only network\n  -d, --driver string        Driver to manage the Network (default "bridge")\n      --gateway strings      IPv4 or IPv6 Gateway for the master subnet\n      --ingress              Create swarm routing-mesh network\n      --internal             Restrict external access to the network\n      --ip-range strings     Allocate container ip from a sub-range\n      --ipam-driver string   IP Address Management Driver (default "default")\n      --ipam-opt map         Set IPAM driver specific options (default map[])\n      --ipv6                 Enable IPv6 networking\n      --label list           Set metadata on a network\n  -o, --opt map              Set driver specific options (default map[])\n      --scope string         Control the network\'s scope\n      --subnet strings       Subnet in CIDR format that represents a network segment\n')])])]),a("ul",[a("li",[e._v("创建一个基于 "),a("code",[e._v("bridge")]),e._v(" 网络模式的自定义网络模式 "),a("code",[e._v("custom_network")]),e._v("，完整命令如下：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network create custom_network\n0925ffa4481531a8cc8d9f7ff1f046ab9d31c49bdb32ae30d78ae0f15dcb65ea\n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker network ls")]),e._v(" 查看网络模式：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network ls\nNETWORK ID     NAME             DRIVER    SCOPE\n4ae0332db571   bridge           bridge    local\n0925ffa44815   custom_network   bridge    local\nd8c2a3f46d08   host             host      local\nabadbe38c594   none             null      local\n")])])]),a("ul",[a("li",[e._v("通过自定义网络模式 "),a("code",[e._v("custom_network")]),e._v(" 创建容器：")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker run -di --name bbox05 --network custom_network busybox\n7687391d404e1d526fdb8fd8d2707807bd51d7714775e554902506cc7c44881d\n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker inspect 容器名称|ID")]),e._v(" 查看容器的网络信息，在 "),a("code",[e._v("NetworkSettings")]),e._v(" 节点中可以看到详细信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker inspect bbox05\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "38f0611b5d44f080a28f112715e0bea98653badeaad04a0080296c991a035ae2",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {},\n            "SandboxKey": "/var/run/docker/netns/38f0611b5d44",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "",\n            "Gateway": "",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "",\n            "IPPrefixLen": 0,\n            "IPv6Gateway": "",\n            "MacAddress": "",\n            "Networks": {\n                "custom_network": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "7687391d404e"\n                    ],\n                    "NetworkID": "0925ffa4481531a8cc8d9f7ff1f046ab9d31c49bdb32ae30d78ae0f15dcb65ea",\n                    "EndpointID": "cdecd69b44c08a29b880aa78b3d6cacb15804eb6df6db54110182d3fa03a3a38",\n                    "Gateway": "172.18.0.1",\n                    "IPAddress": "172.18.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:12:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n\n')])])]),a("h5",{attrs:{id:"_2-2-连接网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-连接网络"}},[e._v("#")]),e._v(" 2.2  连接网络")]),e._v(" "),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker network connect 网络名称 容器名称")]),e._v(" 为容器连接新的网络模式。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network connect --help\n\nUsage:  docker network connect [OPTIONS] NETWORK CONTAINER\n\nConnect a container to a network\n\nOptions:\n      --alias strings           Add network-scoped alias for the container\n      --driver-opt strings      driver options for the network\n      --ip string               IPv4 address (e.g., 172.30.100.104)\n      --ip6 string              IPv6 address (e.g., 2001:db8::33)\n      --link list               Add link to another container\n      --link-local-ip strings   Add a link-local address for the container\n\n[root@Docker ~]# docker network ls\nNETWORK ID     NAME             DRIVER    SCOPE\n4ae0332db571   bridge           bridge    local\n0925ffa44815   custom_network   bridge    local\nd8c2a3f46d08   host             host      local\nabadbe38c594   none             null      local\n[root@Docker ~]# docker network connect bridge bbox05\n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker inspect 容器名称|ID")]),e._v(" 再次查看容器的网络信息，多增加了默认的 "),a("code",[e._v("bridge")]),e._v("。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker inspect bbox05\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "38f0611b5d44f080a28f112715e0bea98653badeaad04a0080296c991a035ae2",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {},\n            "SandboxKey": "/var/run/docker/netns/38f0611b5d44",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "944dc57a11be64f3bb511dbf6eeadfa553f37d70299ce7e338e94b1ae0838ec0",\n            "Gateway": "172.17.0.1",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "172.17.0.4",\n            "IPPrefixLen": 16,\n            "IPv6Gateway": "",\n            "MacAddress": "02:42:ac:11:00:04",\n            "Networks": {\n                "bridge": {\n                    "IPAMConfig": {},\n                    "Links": null,\n                    "Aliases": [],\n                    "NetworkID": "4ae0332db57103ab7bbc5528b2c747201c0a4fdd51d0399d61924fc8be211a78",\n                    "EndpointID": "944dc57a11be64f3bb511dbf6eeadfa553f37d70299ce7e338e94b1ae0838ec0",\n                    "Gateway": "172.17.0.1",\n                    "IPAddress": "172.17.0.4",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:11:00:04",\n                    "DriverOpts": {}\n                },\n                "custom_network": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "7687391d404e"\n                    ],\n                    "NetworkID": "0925ffa4481531a8cc8d9f7ff1f046ab9d31c49bdb32ae30d78ae0f15dcb65ea",\n                    "EndpointID": "cdecd69b44c08a29b880aa78b3d6cacb15804eb6df6db54110182d3fa03a3a38",\n                    "Gateway": "172.18.0.1",\n                    "IPAddress": "172.18.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:12:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n')])])]),a("h5",{attrs:{id:"_2-3-断开网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-断开网络"}},[e._v("#")]),e._v(" 2.3  断开网络")]),e._v(" "),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker network disconnect 网络名称 容器名称")]),e._v(" 命令断开网络。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network disconnect custom_network bbox05\n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker inspect 容器名称|ID")]),e._v(" 再次查看容器的网络信息，发现只剩下默认的 "),a("code",[e._v("bridge")]),e._v("。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker inspect bbox05\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "38f0611b5d44f080a28f112715e0bea98653badeaad04a0080296c991a035ae2",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {},\n            "SandboxKey": "/var/run/docker/netns/38f0611b5d44",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "944dc57a11be64f3bb511dbf6eeadfa553f37d70299ce7e338e94b1ae0838ec0",\n            "Gateway": "172.17.0.1",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "172.17.0.4",\n            "IPPrefixLen": 16,\n            "IPv6Gateway": "",\n            "MacAddress": "02:42:ac:11:00:04",\n            "Networks": {\n                "bridge": {\n                    "IPAMConfig": {},\n                    "Links": null,\n                    "Aliases": [],\n                    "NetworkID": "4ae0332db57103ab7bbc5528b2c747201c0a4fdd51d0399d61924fc8be211a78",\n                    "EndpointID": "944dc57a11be64f3bb511dbf6eeadfa553f37d70299ce7e338e94b1ae0838ec0",\n                    "Gateway": "172.17.0.1",\n                    "IPAddress": "172.17.0.4",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:11:00:04",\n                    "DriverOpts": {}\n                }\n            }\n        }\n\n')])])]),a("h5",{attrs:{id:"_2-4-移除网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-移除网络"}},[e._v("#")]),e._v(" 2.4  移除网络")]),e._v(" "),a("ul",[a("li",[e._v("可以通过 "),a("code",[e._v("docker network rm 网络名称")]),e._v(" 命令移除自定义网络模式，网络模式移除成功会返回网络模式名称。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network connect custom_network bbox05\n[root@Docker ~]# docker network rm custom_network\nError response from daemon: error while removing network: network custom_network id 0925ffa4481531a8cc8d9f7ff1f046ab9d31c49bdb32ae30d78ae0f15dcb65ea has active endpoints\n[root@Docker ~]# docker network disconnect custom_network bbox05\n[root@Docker ~]# docker network rm custom_network\ncustom_network\n")])])]),a("blockquote",[a("p",[e._v("注意：如果通过某个自定义网络模式创建了容器，则该网络模式无法删除。")])]),e._v(" "),a("h4",{attrs:{id:"_3-0-容器间网络通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-容器间网络通信"}},[e._v("#")]),e._v(" 3.0  容器间网络通信")]),e._v(" "),a("ul",[a("li",[e._v("接下来我们通过所学的知识实现容器间的网络通信。首先明确一点，容器之间要互相通信，必须要有属于同一个网络的网卡。")]),e._v(" "),a("li",[e._v("我们先创建两个基于默认的 bridge 网络模式的容器")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network ls\nNETWORK ID     NAME      DRIVER    SCOPE\n4ae0332db571   bridge    bridge    local\nd8c2a3f46d08   host      host      local\nabadbe38c594   none      null      local\n[root@Docker ~]# docker run -di --name default_bbox1 busybox\na87cf4590425e892e2f35c2ba752133cd0bf2605e53d226d7677d4d5559236c4\n[root@Docker ~]# docker run -di --name default_bbox2 busybox\n02ccb288e946553a51667a6b98fe68e41b7cb33d35ad04028009a03cc5785b36\n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker network inspect bridge")]),e._v(" 查看两容器的具体 IP 信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker network inspect bridge\n        "Containers": {\n            "02ccb288e946553a51667a6b98fe68e41b7cb33d35ad04028009a03cc5785b36": {\n                "Name": "default_bbox2",\n                "EndpointID": "a262fdfe2c02178fa9291a2a8a015a6b1a5b08ad4bd443a7569da35800ffd16e",\n                "MacAddress": "02:42:ac:11:00:06",\n                "IPv4Address": "172.17.0.6/16",\n                "IPv6Address": ""\n            },\n            "a87cf4590425e892e2f35c2ba752133cd0bf2605e53d226d7677d4d5559236c4": {\n                "Name": "default_bbox1",\n                "EndpointID": "f3097cda5d8f65dd4475bfe074315614e490837e3af472e070d18d13a255ffe8",\n                "MacAddress": "02:42:ac:11:00:05",\n                "IPv4Address": "172.17.0.5/16",\n                "IPv6Address": ""\n            }\n        },\n')])])]),a("ul",[a("li",[e._v("然后测试两容器间是否可以进行网络通信。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker exec -it default_bbox1 ping 172.17.0.6 \nPING 172.17.0.6 (172.17.0.6): 56 data bytes\n64 bytes from 172.17.0.6: seq=0 ttl=64 time=0.326 ms\n64 bytes from 172.17.0.6: seq=1 ttl=64 time=0.104 ms\n")])])]),a("ul",[a("li",[e._v("经过测试，从结果得知两个属于同一个网络的容器是可以进行网络通信的，但是 IP 地址可能是不固定的，有被更改的情况发生，那容器内所有通信的 IP 地址也需要进行更改，能否使用容器名称进行网络通信？继续测试。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker exec -it default_bbox1 ping default_bbox2\nping: bad address 'default_bbox2'\n")])])]),a("ul",[a("li",[a("p",[e._v("经过测试，从结果得知使用容器进行网络通信是不行的，那怎么实现这个功能呢？")])]),e._v(" "),a("li",[a("p",[e._v("从 Docker 1.10 版本开始，docker daemon 实现了一个内嵌的 DNS server，使容器可以直接通过容器名称通信。方法很简单，只要在创建容器时使用 "),a("code",[e._v("--name")]),e._v(" 为容器命名即可。")])]),e._v(" "),a("li",[a("p",[e._v("但是使用 Docker DNS 有个限制："),a("strong",[e._v("只能在 user-defined 网络中使用")]),e._v("。也就是说，默认的 bridge 网络是无法使用 DNS 的，所以我们就需要自定义网络。")])]),e._v(" "),a("li",[a("p",[e._v("我们先基于 "),a("code",[e._v("bridge")]),e._v(" 网络模式创建自定义网络 "),a("code",[e._v("custom_network")]),e._v("，然后创建两个基于自定义网络模式的容器。")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker network create custom_network\nc278737661f453cad48472351fbb7c4c9dde281da69b07f5deb2117783d5d709\n[root@Docker ~]# docker network ls\nNETWORK ID     NAME             DRIVER    SCOPE\n4ae0332db571   bridge           bridge    local\nc278737661f4   custom_network   bridge    local\nd8c2a3f46d08   host             host      local\nabadbe38c594   none             null      local\n\n[root@Docker ~]# docker run -di --name custom_bbox1 --network custom_network busybox\n029eef3bb1e02e7ba76e665b18f89f13bb0e50a369fad5cf44c0fe7dc664c369\n[root@Docker ~]# docker run -di --name custom_bbox2 --network custom_network busybox \nded7389b70d7e66c3ea6d88307c832de0f3ee736f43c02fb380c9a5f2967abea\n")])])]),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker network inspect custom_network")]),e._v(" 查看两容器的具体 IP 信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker network inspect custom_network\n        "Containers": {\n            "029eef3bb1e02e7ba76e665b18f89f13bb0e50a369fad5cf44c0fe7dc664c369": {\n                "Name": "custom_bbox1",\n                "EndpointID": "60eab74fc2fa2785ea2bf2a762288b204a5b8d8b48c4a6d208b58af577aa1c4a",\n                "MacAddress": "02:42:ac:13:00:02",\n                "IPv4Address": "172.19.0.2/16",\n                "IPv6Address": ""\n            },\n            "ded7389b70d7e66c3ea6d88307c832de0f3ee736f43c02fb380c9a5f2967abea": {\n                "Name": "custom_bbox2",\n                "EndpointID": "e72793fdee79f93229ecb77fe757dde024c9bb6a1cab79327ec93039723951fa",\n                "MacAddress": "02:42:ac:13:00:03",\n                "IPv4Address": "172.19.0.3/16",\n                "IPv6Address": ""\n            }\n        },\n')])])]),a("ul",[a("li",[e._v("然后测试两容器间是否可以进行网络通信，分别使用具体 IP 和容器名称进行网络通信。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker exec -it custom_bbox1 ping 172.19.0.3\nPING 172.19.0.3 (172.19.0.3): 56 data bytes\n64 bytes from 172.19.0.3: seq=0 ttl=64 time=0.209 ms\n64 bytes from 172.19.0.3: seq=1 ttl=64 time=0.108 ms\n^C\n--- 172.19.0.3 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.108/0.158/0.209 ms\n[root@Docker ~]# docker exec -it custom_bbox1 ping custom_bbox2\nPING custom_bbox2 (172.19.0.3): 56 data bytes\n64 bytes from 172.19.0.3: seq=0 ttl=64 time=0.083 ms\n64 bytes from 172.19.0.3: seq=1 ttl=64 time=0.186 ms\n^C\n--- custom_bbox2 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.083/0.134/0.186 ms\n")])])]),a("ul",[a("li",[e._v("经过测试，从结果得知两个属于同一个自定义网络的容器是可以进行网络通信的，并且可以使用容器名称进行网络通信。")]),e._v(" "),a("li",[e._v("那如果此时我希望 "),a("code",[e._v("bridge")]),e._v(" 网络下的容器可以和 "),a("code",[e._v("custom_network")]),e._v(" 网络下的容器进行网络又该如何操作？其实答案也非常简单：让 "),a("code",[e._v("bridge")]),e._v(" 网络下的容器连接至新的 "),a("code",[e._v("custom_network")]),e._v(" 网络即可。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker network connect custom_network default_bbox1\n[root@Docker ~]# docker network inspect custom_network\n        "Containers": {\n            "029eef3bb1e02e7ba76e665b18f89f13bb0e50a369fad5cf44c0fe7dc664c369": {\n                "Name": "custom_bbox1",\n                "EndpointID": "60eab74fc2fa2785ea2bf2a762288b204a5b8d8b48c4a6d208b58af577aa1c4a",\n                "MacAddress": "02:42:ac:13:00:02",\n                "IPv4Address": "172.19.0.2/16",\n                "IPv6Address": ""\n            },\n            "a87cf4590425e892e2f35c2ba752133cd0bf2605e53d226d7677d4d5559236c4": {\n                "Name": "default_bbox1",\n                "EndpointID": "510a6a35e080b821d0021f467f869eb8cc6642c1b35a6b619b35f8510276acd1",\n                "MacAddress": "02:42:ac:13:00:04",\n                "IPv4Address": "172.19.0.4/16",\n                "IPv6Address": ""\n            },\n            "ded7389b70d7e66c3ea6d88307c832de0f3ee736f43c02fb380c9a5f2967abea": {\n                "Name": "custom_bbox2",\n                "EndpointID": "e72793fdee79f93229ecb77fe757dde024c9bb6a1cab79327ec93039723951fa",\n                "MacAddress": "02:42:ac:13:00:03",\n                "IPv4Address": "172.19.0.3/16",\n                "IPv6Address": ""\n            }\n        },\n[root@Docker ~]# docker exec -it default_bbox1 ping custom_bbox1\nPING custom_bbox1 (172.19.0.2): 56 data bytes\n64 bytes from 172.19.0.2: seq=0 ttl=64 time=0.112 ms\n64 bytes from 172.19.0.2: seq=1 ttl=64 time=0.103 ms\n^C\n--- custom_bbox1 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.103/0.107/0.112 ms\n[root@Docker ~]# docker exec -it custom_bbox2 ping default_bbox1\nPING default_bbox1 (172.19.0.4): 56 data bytes\n64 bytes from 172.19.0.4: seq=0 ttl=64 time=0.135 ms\n^C\n--- default_bbox1 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max = 0.135/0.189/0.244 ms\n')])])]),a("h3",{attrs:{id:"_10-docker-私有镜像仓库的搭建及认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-docker-私有镜像仓库的搭建及认证"}},[e._v("#")]),e._v(" 10 Docker 私有镜像仓库的搭建及认证")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker10.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 私有镜像仓库的搭建及认证"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("DockerHub 为我们提供了很多官方镜像和个人上传的镜像，我们可以下载机构或个人提供的镜像，也可以上传我们自己的本地镜像，但缺点是：")]),e._v(" "),a("ul",[a("li",[e._v("由于网络的原因，从 DockerHub 下载和上传镜像速度可能会比较慢；")]),e._v(" "),a("li",[e._v("在生产上使用的 Docker 镜像可能包含我们的代码、配置信息等，不想被外部人员获取，只允许内网的开发人员下载。")])])]),e._v(" "),a("li",[a("p",[e._v("为了解决以上问题，Docker 官方提供了一个叫做 "),a("code",[e._v("registry")]),e._v(" 的镜像用于搭建本地私有仓库使用。在内部网络搭建的 Docker 私有仓库可以使内网人员下载、上传都非常快速，不受外网带宽等因素的影响，同时不在内网的人员也无法下载我们的镜像，并且私有仓库也支持配置仓库认证功能。接下来详细讲解 "),a("code",[e._v("registry")]),e._v(" 私有仓库的搭建过程。")])])]),e._v(" "),a("h4",{attrs:{id:"_1-0-拉取私有仓库镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-拉取私有仓库镜像"}},[e._v("#")]),e._v(" 1.0 拉取私有仓库镜像")]),e._v(" "),a("ul",[a("li",[e._v("拉取私有仓库镜像。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker pull registry\nUsing default tag: latest\nlatest: Pulling from library/registry\n79e9f2f55bf5: Pull complete \n0d96da54f60b: Pull complete \n5b27040df4a2: Pull complete \ne2ead8259a04: Pull complete \n3790aef225b9: Pull complete \nDigest: sha256:169211e20e2f2d5d115674681eb79d21a217b296b43374b8e39f97fcf866b375\nStatus: Downloaded newer image for registry:latest\ndocker.io/library/registry:latest\n")])])]),a("h4",{attrs:{id:"_2-0-修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-修改配置"}},[e._v("#")]),e._v(" 2.0 修改配置")]),e._v(" "),a("ul",[a("li",[e._v("修改 daemon.json 文件。")]),e._v(" "),a("li",[e._v("添加以下内容"),a("code",[e._v('"insecure-registries": ["192.168.56.106:5000"]')]),e._v("，用于让 Docker 信任私有仓库地址，保存退出。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# ip addr\n3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:27:bb:60 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.106/24 brd 192.168.56.255 scope global noprefixroute dynamic enp0s8\n       valid_lft 422sec preferred_lft 422sec\n    inet6 fe80::7601:80e4:1d9f:6c8c/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n\n[root@Docker ~]# vim /etc/docker/daemon.json \n{\n  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn", "http://hub-mirror.c.163.com"],\n  "insecure-registries": ["192.168.56.106:5000"]\n}\n\n')])])]),a("ul",[a("li",[e._v("重新加载配置信息及重启 Docker 服务。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 重新加载某个服务的配置文件\n[root@Docker ~]# systemctl daemon-reload\n# 重新启动 docker\n[root@Docker ~]# systemctl restart docker\n")])])]),a("h4",{attrs:{id:"_3-0-创建私有仓库容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-创建私有仓库容器"}},[e._v("#")]),e._v(" 3.0 创建私有仓库容器")]),e._v(" "),a("ul",[a("li",[e._v("创建私有仓库容器。\n"),a("ul",[a("li",[e._v("-d：后台运行容器；")]),e._v(" "),a("li",[e._v("--name：为创建的容器命名；")]),e._v(" "),a("li",[e._v("-p：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个 -p 做多个端口映射；")]),e._v(" "),a("li",[e._v("-v：将容器内 /var/lib/registry 目录下的数据挂载至宿主机 /mydata/docker_registry 目录下；")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker run -di --name iregistry -p 5000:5000 -v /mydata/docker_registry:/var/lib/registry registry\n")])])]),a("ul",[a("li",[e._v("打开浏览器输入："),a("a",{attrs:{href:"http://192.168.56.106:5000/v2/_catalog",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.56.106:5000/v2/_catalog"),a("OutboundLink")],1),e._v(' 看到 {"repositories":[]} 表示私有仓库搭建成功并且内容为空。')])]),e._v(" "),a("h4",{attrs:{id:"_4-0-推送镜像至私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-推送镜像至私有仓库"}},[e._v("#")]),e._v(" 4.0 推送镜像至私有仓库")]),e._v(" "),a("ul",[a("li",[e._v("先给镜像设置标签 docker tag local-image:tagname new-repo:tagname；")]),e._v(" "),a("li",[e._v("再将镜像推送至私有仓库 docker push new-repo:tagname。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED        SIZE\nhello-world                 latest    feb5d9fea6a5   7 months ago   13.3kB\n[root@Docker ~]# docker tag hello-world:latest 192.168.56.106:5000/test-hello-world:1.0.0\n[root@Docker ~]# docker images\nREPOSITORY                             TAG       IMAGE ID       CREATED        SIZE\n192.168.56.106:5000/test-hello-world   1.0.0     feb5d9fea6a5   7 months ago   13.3kB\n[root@Docker ~]# docker push 192.168.56.106:5000/test-hello-world:1.0.0\nThe push refers to repository [192.168.56.106:5000/test-hello-world]\ne07ee1baac5f: Pushed \n1.0.0: digest: sha256:f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4 size: 525\n")])])]),a("ul",[a("li",[e._v("打开浏览器输入："),a("a",{attrs:{href:"http://192.168.56.106:5000/v2/_catalog",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.56.106:5000/v2/_catalog"),a("OutboundLink")],1),e._v(" 可以看到私有仓库中已上传的镜像。\n"),a("ol",[a("li",[e._v("获取仓库类的镜像：\n"),a("ul",[a("li",[e._v("http://192.168.56.106:5000/v2/_catalog")])])]),e._v(" "),a("li",[e._v("获取某个镜像的标签列表 "),a("code",[e._v("/v2/image_name/tags/list")]),e._v(" "),a("ul",[a("li",[e._v("http://192.168.56.106:5000/v2/test-hello-world/tags/list")])])])]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.west.cn/docs/56628.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker 查询或获取私有仓库(registry)中的镜像"),a("OutboundLink")],1)])])]),e._v(" "),a("li",[e._v("由于我们做了目录挂载，因此可以在宿主机 /mydata/docker_registry/docker/registry/v2/repositories 目录下查看。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# tree /mydata/docker_registry\n/mydata/docker_registry\n└── docker\n    └── registry\n        └── v2\n            ├── blobs\n            │   └── sha256\n            │       ├── 2d\n            │       │   └── 2db29710123e3e53a794f2694094b9b4338aa9ee5c40b930cb8063a1be392c54\n            │       │       └── data\n            │       ├── f5\n            │       │   └── f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n            │       │       └── data\n            │       └── fe\n            │           └── feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412\n            │               └── data\n            └── repositories\n                └── test-hello-world\n                    ├── _layers\n                    │   └── sha256\n                    │       ├── 2db29710123e3e53a794f2694094b9b4338aa9ee5c40b930cb8063a1be392c54\n                    │       │   └── link\n                    │       └── feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412\n                    │           └── link\n                    ├── _manifests\n                    │   ├── revisions\n                    │   │   └── sha256\n                    │   │       └── f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n                    │   │           └── link\n                    │   └── tags\n                    │       └── 1.0.0\n                    │           ├── current\n                    │           │   └── link\n                    │           └── index\n                    │               └── sha256\n                    │                   └── f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n                    │                       └── link\n                    └── _uploads\n\n28 directories, 8 files\n")])])]),a("h4",{attrs:{id:"_5-0-配置私有仓库认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-配置私有仓库认证"}},[e._v("#")]),e._v(" 5.0 配置私有仓库认证")]),e._v(" "),a("ul",[a("li",[e._v("私有仓库已经搭建好了，要确保私有仓库的安全性，还需要一个安全认证证书，防止发生意想不到的事情。所以需要在搭建私有仓库的 Docker 主机上先生成自签名证书。")]),e._v(" "),a("li",[e._v("创建证书存储目录。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# mkdir -p /usr/local/registry/certs\n")])])]),a("ul",[a("li",[e._v("生成自签名证书命令。\n"),a("ul",[a("li",[e._v("openssl req：创建证书签名请求等功能；")]),e._v(" "),a("li",[e._v("-newkey：创建 CSR 证书签名文件和 RSA 私钥文件；")]),e._v(" "),a("li",[e._v("rsa:2048：指定创建的 RSA 私钥长度为 2048；")]),e._v(" "),a("li",[e._v("-nodes：对私钥不进行加密；")]),e._v(" "),a("li",[e._v("-sha256：使用 SHA256 算法；")]),e._v(" "),a("li",[e._v("-keyout：创建的私钥文件名称及位置；")]),e._v(" "),a("li",[e._v("-x509：自签发证书格式；")]),e._v(" "),a("li",[e._v("-days：证书有效期；")]),e._v(" "),a("li",[e._v("-out：指定 CSR 输出文件名称及位置；")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("openssl req -newkey rsa:2048 -nodes -sha256 -keyout /usr/local/registry/certs/domain.key -x509 -days 365 -out /usr/local/registry/certs/domain.crt\n")])])]),a("h5",{attrs:{id:"_5-1-生成自签名证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-生成自签名证书"}},[e._v("#")]),e._v(" 5.1  生成自签名证书")]),e._v(" "),a("ul",[a("li",[e._v("通过 openssl 先生成自签名证书，运行命令以后需要填写一些证书信息，里面最关键的部分是："),a("code",[e._v("Common Name (eg, your name or your server's hostname) []:192.168.10.10")]),e._v("，这里填写的是私有仓库的地址。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# openssl req -newkey rsa:2048 -nodes -sha256 -keyout /usr/local/registry/certs/domain.key -x509 -days 365 -out /usr/local/registry/certs/domain.crtGenerating a 2048 bit RSA private key\n.........................................................+++\n.............................................+++\nwriting new private key to '/usr/local/registry/certs/domain.key'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:\nState or Province Name (full name) []:\nLocality Name (eg, city) [Default City]:\nOrganization Name (eg, company) [Default Company Ltd]:\nOrganizational Unit Name (eg, section) []:\nCommon Name (eg, your name or your server's hostname) []:192.168.56.106\nEmail Address []:\n[root@Docker ~]# ll /usr/local/registry/certs      \ntotal 8\n-rw-r--r--. 1 root root 1285 Apr 29 10:45 domain.crt\n-rw-r--r--. 1 root root 1704 Apr 29 10:45 domain.key\n")])])]),a("h5",{attrs:{id:"_5-2-生成鉴权密码文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-生成鉴权密码文件"}},[e._v("#")]),e._v(" 5.2  生成鉴权密码文件")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 创建存储鉴权密码文件目录\n[root@Docker ~]# mkdir -p /usr/local/registry/auth\n# 如果没有 htpasswd 功能需要安装 httpd\n[root@Docker ~]# yum install -y httpd\n# 创建用户和密码\n[root@Docker ~]# htpasswd --help\n -b  Use the password from the command line rather than prompting for it.\n -B  Force bcrypt aencryption of the password (very secure).\n -n  Don't update file; display results on stdout.\n[root@Docker ~]# htpasswd -Bbn root 1234 > /usr/local/registry/auth/htpasswd\n[root@Docker ~]# cat /usr/local/registry/auth/htpasswd \nroot:$2y$05$aOvWaoEIi3unIBLD1dMrKut3JPQsaamHpfmkPq42vaiO4/N0ON.pu\n")])])]),a("ul",[a("li",[e._v("htpasswd 是 apache http 的基本认证文件，使用 htpasswd 命令可以生成用户及密码文件。")])]),e._v(" "),a("h5",{attrs:{id:"_5-3-创建私有仓库容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-创建私有仓库容器"}},[e._v("#")]),e._v(" 5.3  创建私有仓库容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker run -di --name iauth-registry -p 5000:5000 \\\n\t-v /mydata/docker_registry:/var/lib/registry \\\n\t-v /usr/local/registry/certs:/certs \\\n\t-v /usr/local/registry/auth:/auth \\\n\t-e "REGISTRY_AUTH=htpasswd" \\\n\t-e "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" \\\n\t-e "REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd" \\\n\t-e "REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt" \\\n\t-e REGISTRY_HTTP_TLS_KEY=/certs/domain.key \\\n\tregistry\n')])])]),a("ul",[a("li",[a("a",{attrs:{href:"https://192.168.56.106:5000/v2/_catalog",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://192.168.56.106:5000/v2/_catalog"),a("OutboundLink")],1)])]),e._v(" "),a("h5",{attrs:{id:"_5-4-推送镜像至私有仓库失败"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-推送镜像至私有仓库失败"}},[e._v("#")]),e._v(" 5.4  推送镜像至私有仓库失败")]),e._v(" "),a("ul",[a("li",[e._v("先给镜像设置标签 docker tag local-image:tagname new-repo:tagname；")]),e._v(" "),a("li",[e._v("再将镜像推送至私有仓库 docker push new-repo:tagname。\n"),a("ul",[a("li",[e._v("如果直接 push 镜像肯定会失败，并且出现 no basic auth credentials 的错误，这是因为我们没有进行登录认证。")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker images\nREPOSITORY                             TAG       IMAGE ID       CREATED        SIZE\nhello-world                            latest    feb5d9fea6a5   7 months ago   13.3kB\n[root@Docker ~]# docker tag hello-world:latest 192.168.56.106:5000/test-hello-world:2.0.0\n[root@Docker ~]# docker images\nREPOSITORY                             TAG       IMAGE ID       CREATED        SIZE\n192.168.56.106:5000/test-hello-world   2.0.0     feb5d9fea6a5   7 months ago   13.3kB\n[root@Docker ~]# docker push 192.168.56.106:5000/test-hello-world:2.0.0\nThe push refers to repository [192.168.56.106:5000/test-hello-world]\ne07ee1baac5f: Preparing \nno basic auth credentials\n")])])]),a("h5",{attrs:{id:"_5-5-登录账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-登录账号"}},[e._v("#")]),e._v(" 5.5  登录账号")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker login 192.168.56.106:5000\nUsername: root\nPassword: \nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n")])])]),a("h5",{attrs:{id:"_5-6-推送镜像至私有仓库成功"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-推送镜像至私有仓库成功"}},[e._v("#")]),e._v(" 5.6  推送镜像至私有仓库成功")]),e._v(" "),a("ul",[a("li",[e._v("再次 push 镜像，发现已经可以推送成功了。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker push 192.168.56.106:5000/test-hello-world:2.0.0\nThe push refers to repository [192.168.56.106:5000/test-hello-world]\ne07ee1baac5f: Layer already exists \n2.0.0: digest: sha256:f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4 size: 525\n[root@Docker ~]# tree /mydata/docker_registry\n/mydata/docker_registry\n└── docker\n    └── registry\n        └── v2\n            ├── blobs\n            │   └── sha256\n            │       ├── 2d\n            │       │   └── 2db29710123e3e53a794f2694094b9b4338aa9ee5c40b930cb8063a1be392c54\n            │       │       └── data\n            │       ├── f5\n            │       │   └── f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n            │       │       └── data\n            │       └── fe\n            │           └── feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412\n            │               └── data\n            └── repositories\n                └── test-hello-world\n                    ├── _layers\n                    │   └── sha256\n                    │       ├── 2db29710123e3e53a794f2694094b9b4338aa9ee5c40b930cb8063a1be392c54\n                    │       │   └── link\n                    │       └── feb5d9fea6a5e9606aa995e879d862b825965ba48de054caab5ef356dc6b3412\n                    │           └── link\n                    ├── _manifests\n                    │   ├── revisions\n                    │   │   └── sha256\n                    │   │       └── f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n                    │   │           └── link\n                    │   └── tags\n                    │       ├── 1.0.0\n                    │       │   ├── current\n                    │       │   │   └── link\n                    │       │   └── index\n                    │       │       └── sha256\n                    │       │           └── f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n                    │       │               └── link\n                    │       └── 2.0.0\n                    │           ├── current\n                    │           │   └── link\n                    │           └── index\n                    │               └── sha256\n                    │                   └── f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n                    │                       └── link\n                    └── _uploads\n\n33 directories, 10 files\n")])])]),a("h5",{attrs:{id:"_5-7-退出账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-7-退出账号"}},[e._v("#")]),e._v(" 5.7  退出账号")]),e._v(" "),a("ul",[a("li",[e._v("通过 docker logout 命令退出账号。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker logout 192.168.56.106:5000\nRemoving login credentials for 192.168.56.106:5000\n")])])]),a("h3",{attrs:{id:"_9-dockerhub-镜像仓库的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-dockerhub-镜像仓库的使用"}},[e._v("#")]),e._v(" 9 DockerHub 镜像仓库的使用")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker9.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("DockerHub 镜像仓库的使用"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("之前我们使用的镜像都是从 DockerHub 公共仓库拉取的，我们也学习了如何制作自己的镜像，但是通过 tar 包的方式实现镜像的备份恢复迁移对于团队协作开发并不是特别友好，我们也可以将镜像推送至 DockerHub 仓库方便使用。")])]),e._v(" "),a("li",[a("p",[e._v("温馨提示：如果构建的镜像内携带了项目数据，建议还是使用私有仓库比较好。")])])]),e._v(" "),a("h4",{attrs:{id:"_1-0-注册账户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-注册账户"}},[e._v("#")]),e._v(" 1.0 注册账户")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_2-0-登录账户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-登录账户"}},[e._v("#")]),e._v(" 2.0 登录账户")]),e._v(" "),a("ul",[a("li",[e._v("通过 docker login 命令输入账号密码登录 DockerHub。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker login\nLogin with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.\nUsername: tosinjia\nPassword: \nWARNING! Your password will be stored unencrypted in /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n")])])]),a("h4",{attrs:{id:"_3-0-推送镜像至仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-推送镜像至仓库"}},[e._v("#")]),e._v(" 3.0 推送镜像至仓库")]),e._v(" "),a("ul",[a("li",[e._v("为了方便测试，我们将 hello-world 镜像拉取至本地，然后再上传至 DockerHub 仓库中。")]),e._v(" "),a("li",[e._v("先给镜像设置标签 "),a("code",[e._v("docker tag local-image:tagname new-repo:tagname")]),e._v("；")]),e._v(" "),a("li",[e._v("再将镜像推送至仓库 "),a("code",[e._v("docker push new-repo:tagname")]),e._v("。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker pull hello-world\n[root@Docker ~]# docker run hello-world\n[root@Docker ~]# docker images\nREPOSITORY          TAG       IMAGE ID       CREATED        SIZE\nhello-world         latest    feb5d9fea6a5   7 months ago   13.3\n[root@Docker ~]# docker tag hello-world:latest tosinjia/test-hello-world:1.0.0\n[root@Docker ~]# docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED        SIZE\ntosinjia/test-hello-world   1.0.0     feb5d9fea6a5   7 months ago   13.3kB\n[root@Docker ~]# docker push tosinjia/test-hello-world:1.0.0\nThe push refers to repository [docker.io/tosinjia/test-hello-world]\ne07ee1baac5f: Mounted from library/hello-world \n1.0.0: digest: sha256:f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4 size: 525\n")])])]),a("h4",{attrs:{id:"_4-0-查看仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-查看仓库"}},[e._v("#")]),e._v(" 4.0 查看仓库")]),e._v(" "),a("ul",[a("li",[e._v("https://hub.docker.com/repository/docker/tosinjia/test-hello-world\n"),a("ul",[a("li",[e._v("https://hub.docker.com/repository/registry-1.docker.io/tosinjia/test-hello-world/tags?page=1&ordering=last_updated")])])])]),e._v(" "),a("h4",{attrs:{id:"_5-0-拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-拉取镜像"}},[e._v("#")]),e._v(" 5.0 拉取镜像")]),e._v(" "),a("ul",[a("li",[e._v("通过 "),a("code",[e._v("docker pull tosinjia/test-hello-world:1.0.0")]),e._v(" 测试镜像是否可以拉取。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker pull tosinjia/test-hello-world:1.0.0\n1.0.0: Pulling from tosinjia/test-hello-world\nDigest: sha256:f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\nStatus: Image is up to date for tosinjia/test-hello-world:1.0.0\ndocker.io/tosinjia/test-hello-world:1.0.0\n\n[root@Docker ~]# docker rmi tosinjia/test-hello-world:1.0.0\nUntagged: tosinjia/test-hello-world:1.0.0\nUntagged: tosinjia/test-hello-world@sha256:f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\n\n[root@Docker ~]# docker pull tosinjia/test-hello-world:1.0.0\n1.0.0: Pulling from tosinjia/test-hello-world\nDigest: sha256:f54a58bc1aac5ea1a25d796ae155dc228b3f0e11d046ae276b39c4bf2f13d8c4\nStatus: Downloaded newer image for tosinjia/test-hello-world:1.0.0\ndocker.io/tosinjia/test-hello-world:1.0.0\n[root@Docker ~]# docker images\nREPOSITORY                  TAG       IMAGE ID       CREATED        SIZE\ntosinjia/test-hello-world   1.0.0     feb5d9fea6a5   7 months ago   13.3kB\n[root@Docker ~]# docker run tosinjia/test-hello-world:1.0.0\n")])])]),a("h4",{attrs:{id:"_6-0-退出账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-0-退出账号"}},[e._v("#")]),e._v(" 6.0 退出账号")]),e._v(" "),a("ul",[a("li",[e._v("通过 docker logout 命令退出 DockerHub。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker logout\nRemoving login credentials for https://index.docker.io/v1/\n")])])]),a("h3",{attrs:{id:"docker-镜像的备份恢复迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像的备份恢复迁移"}},[e._v("#")]),e._v(" Docker 镜像的备份恢复迁移")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker8.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 镜像的备份恢复迁移"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("https://www.bilibili.com/video/BV1844y167D1?p=34 -")])]),e._v(" "),a("h4",{attrs:{id:"_1-0-镜像备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-镜像备份"}},[e._v("#")]),e._v(" 1.0  镜像备份")]),e._v(" "),a("h4",{attrs:{id:"_2-0-镜像恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-镜像恢复"}},[e._v("#")]),e._v(" 2.0  镜像恢复")]),e._v(" "),a("h4",{attrs:{id:"_3-0-镜像迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-镜像迁移"}},[e._v("#")]),e._v(" 3.0  镜像迁移")]),e._v(" "),a("h3",{attrs:{id:"七-docker-镜像构建之-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七-docker-镜像构建之-dockerfile"}},[e._v("#")]),e._v(" 七 Docker 镜像构建之 Dockerfile")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker7.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 镜像构建之 Dockerfile"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("https://www.bilibili.com/video/BV1844y167D1?p=30 - https://www.bilibili.com/video/BV1844y167D1?p=33")])]),e._v(" "),a("li",[a("p",[e._v("在 Docker 中构建镜像最常用的方式，就是使用 Dockerfile。Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。官方文档：https://docs.docker.com/engine/reference/builder/")])])]),e._v(" "),a("h4",{attrs:{id:"_1-0-dockerfile-常用指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-dockerfile-常用指令"}},[e._v("#")]),e._v(" 1.0  Dockerfile 常用指令")]),e._v(" "),a("h5",{attrs:{id:"_1-1-from"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-from"}},[e._v("#")]),e._v(" 1.1  FROM")]),e._v(" "),a("ul",[a("li",[e._v("https://docs.docker.com/engine/reference/builder/#from")])]),e._v(" "),a("blockquote",[a("p",[e._v("语法：FROM <image>:<tag>\n指明构建的新镜像是来自于哪个基础镜像，如果没有选择 tag，那么默认值为 latest。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("FROM centos:7\n")])])]),a("blockquote",[a("p",[e._v("如果不以任何镜像为基础，那么写法为：FROM scratch。官方说明：scratch 镜像是一个空镜像，可以用于构建 busybox 等超小镜像，可以说是真正的从零开始构建属于自己的镜像。")])]),e._v(" "),a("h5",{attrs:{id:"_1-2-maintainer-deprecated"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-maintainer-deprecated"}},[e._v("#")]),e._v(" "),a("s",[e._v("1.2  MAINTAINER(deprecated)")])]),e._v(" "),a("blockquote",[a("p",[e._v("语法：MAINTAINER <name>\n指明镜像维护者及其联系方式（一般是邮箱地址）。官方说明已过时，推荐使用 LABEL。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("MAINTAINER mrhelloworld <mrhelloworld@126.com>\n")])])]),a("h5",{attrs:{id:"_1-3-label"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-label"}},[e._v("#")]),e._v(" 1.3  LABEL")]),e._v(" "),a("blockquote",[a("p",[e._v("语法：LABEL <key>=<value> <key>=<value> <key>=<value> ...\n功能是为镜像指定标签。也可以使用 LABEL 来指定镜像作者。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('LABEL maintainer="mrhelloworld.com"\n')])])]),a("h5",{attrs:{id:"_1-4-run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-run"}},[e._v("#")]),e._v(" 1.4  RUN")]),e._v(" "),a("blockquote",[a("p",[e._v("语法：RUN <command>\n构建镜像时运行的 Shell 命令，比如构建的新镜像中我们想在 /usr/local 目录下创建一个 java 目录。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("RUN mkdir -p /usr/local/java\n")])])]),a("h5",{attrs:{id:"_1-5-add"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-add"}},[e._v("#")]),e._v(" 1.5  ADD")]),e._v(" "),a("blockquote",[a("p",[e._v("语法：ADD <src>... <dest>\n拷贝文件或目录到镜像中。src 可以是一个本地文件或者是一个本地压缩文件，压缩文件会自动解压。还可以是一个 url，如果把 src 写成一个 url，那么 ADD 就类似于 wget 命令，然后自动下载和解压。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ADD jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\n")])])]),a("h5",{attrs:{id:"_1-6-copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-copy"}},[e._v("#")]),e._v(" 1.6  COPY")]),e._v(" "),a("blockquote",[a("p",[e._v("语法：COPY <src>... <dest>\n拷贝文件或目录到镜像中。用法同 ADD，只是不支持自动下载和解压。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("COPY jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\n")])])]),a("h5",{attrs:{id:"_1-7-expose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-7-expose"}},[e._v("#")]),e._v(" 1.7  EXPOSE")]),e._v(" "),a("blockquote",[a("p",[e._v("语法：EXPOSE <port> [<port>/<protocol>...]\n暴露容器运行时的监听端口给外部，可以指定端口是监听 TCP 还是 UDP，如果未指定协议，则默认为 TCP。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("EXPOSE 80 443 8080/tcp\n")])])]),a("blockquote",[a("p",[e._v("如果想使得容器与宿主机的端口有映射关系，必须在容器启动的时候加上 -P 参数。")])]),e._v(" "),a("h5",{attrs:{id:"_1-8-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-env"}},[e._v("#")]),e._v(" 1.8  ENV")]),e._v(" "),a("blockquote",[a("p",[e._v("语法：ENV <key> <value> 添加单个，ENV <key>=<value> ... 添加多个。\n设置容器内环境变量。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ENV JAVA_HOME /usr/local/java/jdk-11.0.6/\n")])])]),a("h5",{attrs:{id:"_1-9-cmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-9-cmd"}},[e._v("#")]),e._v(" 1.9  CMD")]),e._v(" "),a("blockquote",[a("p",[e._v('语法：\nCMD ["executable","param1","param2"]，比如：CMD ["/usr/local/tomcat/bin/catalina.sh", "start"]\nCMD ["param1","param2"]，比如：CMD [ "echo", "$JAVA_HOME" ]\nCMD command param1 param2，比如：CMD echo $JAVA_HOME')])]),e._v(" "),a("ul",[a("li",[e._v("启动容器时执行的 Shell 命令。在 Dockerfile 中只能有一条 CMD 指令。如果设置了多条 CMD，只有最后一条 CMD 会生效。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("CMD ehco $JAVA_HOME\n")])])]),a("blockquote",[a("p",[e._v('如果创建容器的时候指定了命令，则 CMD 命令会被替代。假如镜像叫 centos:7，创建容器时命令是：docker run -it --name centos7 centos:7 echo "helloworld" 或者 docker run -it --name centos7 centos:7 /bin/bash，就不会输出 $JAVA_HOME 的环境变量信息了，因为 CMD 命令被 echo "helloworld"、/bin/bash 覆盖了。')])]),e._v(" "),a("h5",{attrs:{id:"_1-10-entrypoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-10-entrypoint"}},[e._v("#")]),e._v(" 1.10  ENTRYPOINT")]),e._v(" "),a("blockquote",[a("p",[e._v('语法：\nENTRYPOINT ["executable", "param1", "param2"]，比如：ENTRYPOINT ["/usr/local/tomcat/bin/catalina.sh", "start"]\nENTRYPOINT command param1 param2，比如：ENTRYPOINT ehco $JAVA_HOME')])]),e._v(" "),a("ul",[a("li",[e._v("启动容器时执行的 Shell 命令，同 CMD 类似，不会被 docker run 命令行指定的参数所覆盖。在 Dockerfile 中只能有一条 ENTRYPOINT 指令。如果设置了多条 ENTRYPOINT，只有最后一条 ENTRYPOINT 会生效。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ENTRYPOINT ehco $JAVA_HOME\n")])])]),a("blockquote",[a("ul",[a("li",[e._v("如果在 Dockerfile 中同时写了 ENTRYPOINT 和 CMD，并且 CMD 指令不是一个完整的可执行命令，那么 CMD 指定的内容将会作为 ENTRYPOINT 的参数；")]),e._v(" "),a("li",[e._v("如果在 Dockerfile 中同时写了 ENTRYPOINT 和 CMD，并且 CMD 是一个完整的指令，那么它们两个会互相覆盖，谁在最后谁生效")])])]),e._v(" "),a("h5",{attrs:{id:"_1-11-workdir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-11-workdir"}},[e._v("#")]),e._v(" 1.11  WORKDIR")]),e._v(" "),a("ul",[a("li",[e._v("https://docs.docker.com/engine/reference/builder/#workdir")])]),e._v(" "),a("blockquote",[a("p",[e._v("语法：WORKDIR /path/to/workdir\n为 RUN、CMD、ENTRYPOINT 以及 COPY 和 ADD 设置工作目录。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("WORKDIR /usr/local\n")])])]),a("h5",{attrs:{id:"_1-12-volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-12-volume"}},[e._v("#")]),e._v(" 1.12  VOLUME")]),e._v(" "),a("blockquote",[a("p",[e._v("指定容器挂载点到宿主机自动生成的目录或其他容器。一般的使用场景为需要持久化存储数据时。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 容器的 /var/lib/mysql 目录会在运行时自动挂载为匿名卷，匿名卷在宿主机的 /var/lib/docker/volumes 目录下\nVOLUME ["/var/lib/mysql"]\n')])])]),a("blockquote",[a("p",[e._v("一般不会在 Dockerfile 中用到，更常见的还是在 docker run 的时候通过 -v 指定数据卷。")])]),e._v(" "),a("h4",{attrs:{id:"_2-0-构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-构建镜像"}},[e._v("#")]),e._v(" 2.0  构建镜像")]),e._v(" "),a("ul",[a("li",[e._v("Dockerfile 文件编写好以后，真正构建镜像时需要通过 docker build 命令。")]),e._v(" "),a("li",[e._v("docker build 命令用于使用 Dockerfile 创建镜像。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 使用当前目录的 Dockerfile 创建镜像\ndocker build -t mycentos:7 .\n# 通过 -f Dockerfile 文件的位置创建镜像\ndocker build -f /usr/local/dockerfile/Dockerfile -t mycentos:7 .\n")])])]),a("ul",[a("li",[e._v("-f：指定要使用的 Dockerfile 路径；")]),e._v(" "),a("li",[e._v("--tag, -t：镜像的名字及标签，可以在一次构建中为一个镜像设置多个标签。")])]),e._v(" "),a("h6",{attrs:{id:"_2-1-关于-理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-关于-理解"}},[e._v("#")]),e._v(" 2.1  关于 . 理解")]),e._v(" "),a("ul",[a("li",[e._v("我们在使用 docker build 命令去构建镜像时，往往会看到命令最后会有一个 . 号")]),e._v(" "),a("li",[e._v("Docker 在运行时分为 Docker 引擎（服务端守护进程） 和 客户端工具，我们日常使用各种 docker 命令，其实就是在使用 客户端工具 与 Docker 引擎 进行交互。")]),e._v(" "),a("li",[e._v("当我们使用 docker build 命令来构建镜像时，这个构建过程其实是在 Docker 引擎 中完成的，而不是在本机环境。如果在 Dockerfile 中使用了一些 ADD 等指令来操作文件，如何让 Docker 引擎 获取到这些文件呢？")]),e._v(" "),a("li",[e._v("这里就有了一个 镜像构建上下文 的概念，当构建的时候，由用户指定构建镜像时的上下文路径，而 docker build 会将这个路径下所有的文件都打包上传给 Docker 引擎，引擎内将这些内容展开后，就能获取到上下文中的文件了。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# ls\nanaconda-ks.cfg  apache-tomcat-9.0.54.tar.gz  jdk-11.0.6_linux-x64_bin.tar.gz\n[root@Docker ~]# cat /usr/local/dockerfile/Dockerfile   \n\nADD jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\nADD apache-tomcat-9.0.54.tar.gz /usr/local/tomcat/\n\n[root@Docker ~]# docker build -f /usr/local/dockerfile/Dockerfile -t mycentos:7 /root/\n\n# ADD等指令来操作文件 的 资源路径\n[root@Docker ~]# docker build -f /usr/local/dockerfile/Dockerfile -t mycentos:7 .\n")])])]),a("h4",{attrs:{id:"_3-0-dockerfile-实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-dockerfile-实践"}},[e._v("#")]),e._v(" 3.0  Dockerfile 实践")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND       CREATED          STATUS          PORTS                                       NAMES\nd97bbbfee70f   mycentos:7   "/bin/bash"   50 minutes ago   Up 50 minutes   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   mycentos7\n[root@Docker ~]# docker stop mycentos7\nmycentos7\n[root@Docker ~]# docker rm mycentos7\nmycentos7\n\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nmycentos      7         77c79c7a3957   56 minutes ago   523MB\n[root@Docker ~]# docker rmi mycentos:7\nUntagged: mycentos:7\nDeleted: sha256:77c79c7a39573413146580eae96fec88c48e4aab9e014ee057d52c257b2941e9\nDeleted: sha256:c3c32118a44d7ed4d1b51c82c49722e788a748f8fe2c762c03ef0d64185b9019\n')])])]),a("ul",[a("li",[e._v("接下来我们通过基础镜像 centos:7，在该镜像中安装 jdk 和 tomcat 以后将其制作为一个新的镜像 mycentos:7。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 创建目录。\n[root@Docker ~]# mkdir -p /usr/local/dockerfile\n[root@Docker ~]# cd /usr/local/dockerfile/\n# 编写 Dockerfile 文件。\n[root@Docker dockerfile]# vim Dockerfile\n# 指明构建的新镜像是来自于 centos:7 基础镜像\nFROM centos:7\n# 通过镜像标签声明了作者信息\nLABEL maintainer="TosinJia.foxmail.com"\n# 设置工作目录\nWORKDIR /usr/local\n# 新镜像构建成功以后创建指定目录\nRUN mkdir -p /usr/local/java && mkdir -p /usr/local/tomcat\n# 拷贝文件到镜像中并解压\nADD jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\nADD apache-tomcat-9.0.54.tar.gz /usr/local/tomcat/\n# 暴露容器运行时的 8080 监听端口给外部\nEXPOSE 8080\n# 设置容器内 JAVA_HOME 环境变量\nENV JAVA_HOME /usr/local/java/jdk-11.0.6/\nENV PATH $PATH:$JAVA_HOME/bin\n# 启动容器时启动 tomcat\n# CMD ["/usr/local/tomcat/apache-tomcat-9.0.54/bin/startup.sh", "run"]\n# run 运行并阻塞控制台，输出日志信息。容器里必须要有前台任务在执行，否则容器直接就退出了\n## 参考 https://hub.docker.com/_/tomcat CMD ["catalina.sh" "run"]\nCMD ["/usr/local/tomcat/apache-tomcat-9.0.54/bin/catalina.sh", "run"]\n')])])]),a("ul",[a("li",[e._v("构建镜像。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('\n[root@Docker ~]# ls\nanaconda-ks.cfg  apache-tomcat-9.0.54.tar.gz  jdk-11.0.6_linux-x64_bin.tar.gz\n\n# /root/ ADD 资源位置\n[root@Docker ~]# docker build -f /usr/local/dockerfile/Dockerfile -t mycentos:7 /root/\nSending build context to Docker daemon  191.7MB\nStep 1/10 : FROM centos:7\n ---\x3e eeb6ee3f44bd\nStep 2/10 : LABEL maintainer="TosinJia.foxmail.com"\n ---\x3e Running in ead5b4de4083\nRemoving intermediate container ead5b4de4083\n ---\x3e 5b9a0b767d5a\nStep 3/10 : WORKDIR /usr/local\n ---\x3e Running in bf7d09b2810b\nRemoving intermediate container bf7d09b2810b\n ---\x3e 526551478771\nStep 4/10 : RUN mkdir -p /usr/local/java && mkdir -p /usr/local/tomcat\n ---\x3e Running in 94f743e693e0\nRemoving intermediate container 94f743e693e0\n ---\x3e 434a7ec345fc\nStep 5/10 : ADD jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\n ---\x3e 1cd3c774f0fe\nStep 6/10 : ADD apache-tomcat-9.0.54.tar.gz /usr/local/tomcat/\n ---\x3e b4666bf0bdd5\nStep 7/10 : EXPOSE 8080\n ---\x3e Running in 3079f78945a2\nRemoving intermediate container 3079f78945a2\n ---\x3e 459cccc809db\nStep 8/10 : ENV JAVA_HOME /usr/local/java/jdk-11.0.6/\n ---\x3e Running in 5f70f3a8b736\nRemoving intermediate container 5f70f3a8b736\n ---\x3e 2d871d9393bf\nStep 9/10 : ENV PATH $PATH:$JAVA_HOME/bin\n ---\x3e Running in 11a30446c19b\nRemoving intermediate container 11a30446c19b\n ---\x3e 0f94de771fc4\nStep 10/10 : CMD ["/usr/local/tomcat/apache-tomcat-9.0.54/bin/catalina.sh", "run"]\n ---\x3e Running in 2628d40aa285\nRemoving intermediate container 2628d40aa285\n ---\x3e 12a919baf682\nSuccessfully built 12a919baf682\nSuccessfully tagged mycentos:7\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nmycentos      7         12a919baf682   58 seconds ago   523MB\n')])])]),a("h5",{attrs:{id:"java服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java服务"}},[e._v("#")]),e._v(" java服务")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@etcwebtest2 dytxcms-admin]# cat dockerfile \n# 基础镜像\nFROM  openjdk:8-jre\n# author\nMAINTAINER dytxcms\n\n# 挂载目录\nVOLUME /home/dytxcms\n# 创建目录\nRUN mkdir -p /home/dytxcms\n# 指定路径\nWORKDIR /home/dytxcms\n# 复制jar文件到路径\nCOPY ./jar/dytxcms-admin.jar /home/dytxcms/dytxcms-admin.jar\n# 时区设置 容器内时间和java控制台时间同时修改为指定时区\nENV TZ="Asia/Shanghai"\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo \'$TZ\' > /etc/timezone\n# 启动系统服务\nENTRYPOINT ["java","-jar","dytxcms-admin.jar"]\n\n[root@etcwebtest2 dytxcms-admin]# docker build -f dockerfile -t dytxcms-admin:1 .     \n[root@etcwebtest2 dytxcms-admin]# docker run -di --name dytxcms-admin1 -v /home/dytxcms/docker/dytxcms-admin/jar:/home/dytxcms -p 8080:8080 dytxcms-admin:1 \n')])])]),a("h4",{attrs:{id:"_4-0-镜像构建历史"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-镜像构建历史"}},[e._v("#")]),e._v(" 4.0  镜像构建历史")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker build -f /usr/local/dockerfile/Dockerfile -t mycentos:7 .\nSending build context to Docker daemon  191.7MB\nStep 1/10 : FROM centos:7\n ---\x3e eeb6ee3f44bd\nStep 2/10 : LABEL maintainer="TosinJia.foxmail.com"\n ---\x3e Running in ba6ed276294f\nRemoving intermediate container ba6ed276294f\n ---\x3e aeaa2ec82921\nStep 3/10 : WORKDIR /usr/local\n ---\x3e Running in 6bc900c321e2\nRemoving intermediate container 6bc900c321e2\n ---\x3e 33d0b8a14f91\nStep 4/10 : RUN mkdir -p /usr/local/java && mkdir -p /usr/local/tomcat\n ---\x3e Running in 1090536feeea\nRemoving intermediate container 1090536feeea\n ---\x3e 3f01b954991b\nStep 5/10 : ADD jdk-11.0.6_linux-x64_bin.tar.gz /usr/local/java\n ---\x3e 3053d8d94d58\nStep 6/10 : ADD apache-tomcat-9.0.54.tar.gz /usr/local/tomcat/\n ---\x3e 6c5d7fb0cb5c\nStep 7/10 : EXPOSE 8080\n ---\x3e Running in 62072522cdb1\nRemoving intermediate container 62072522cdb1\n ---\x3e 1432c1d66f5c\nStep 8/10 : ENV JAVA_HOME /usr/local/java/jdk-11.0.6/\n ---\x3e Running in 3940e4a788a8\nRemoving intermediate container 3940e4a788a8\n ---\x3e 16ff974ff544\nStep 9/10 : ENV PATH $PATH:$JAVA_HOME/bin\n ---\x3e Running in bb9fe5195552\nRemoving intermediate container bb9fe5195552\n ---\x3e 9592e558a0c1\nStep 10/10 : CMD ["/usr/local/tomcat/apache-tomcat-9.0.54/bin/catalina.sh", "run"]\n ---\x3e Running in a5a68132eb29\nRemoving intermediate container a5a68132eb29\n ---\x3e 6061b3b19be7\nSuccessfully built 6061b3b19be7\nSuccessfully tagged mycentos:7\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nmycentos      7         6061b3b19be7   48 seconds ago   523MB\n')])])]),a("ul",[a("li",[e._v("镜像构建历史")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('docker history 镜像名称:标签|ID\n[root@Docker ~]# docker history mycentos:7\nIMAGE          CREATED         CREATED BY                                      SIZE      COMMENT\n6061b3b19be7   3 minutes ago   /bin/sh -c #(nop)  CMD ["/usr/local/tomcat/a…   0B        \n9592e558a0c1   3 minutes ago   /bin/sh -c #(nop)  ENV PATH=/usr/local/sbin:…   0B        \n16ff974ff544   3 minutes ago   /bin/sh -c #(nop)  ENV JAVA_HOME=/usr/local/…   0B        \n1432c1d66f5c   3 minutes ago   /bin/sh -c #(nop)  EXPOSE 8080                  0B        \n6c5d7fb0cb5c   3 minutes ago   /bin/sh -c #(nop) ADD file:6612fb65141258663…   16MB      \n3053d8d94d58   3 minutes ago   /bin/sh -c #(nop) ADD file:f1400455da39a2c2e…   303MB     \n3f01b954991b   3 minutes ago   /bin/sh -c mkdir -p /usr/local/java && mkdir…   0B        \n33d0b8a14f91   3 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local            0B        \naeaa2ec82921   3 minutes ago   /bin/sh -c #(nop)  LABEL maintainer=TosinJia…   0B        \neeb6ee3f44bd   4 weeks ago     /bin/sh -c #(nop)  CMD ["/bin/bash"]            0B        \n<missing>      4 weeks ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        \n<missing>      4 weeks ago     /bin/sh -c #(nop) ADD file:b3ebbe8bd304723d4…   204MB    \n')])])]),a("h4",{attrs:{id:"_5-0-使用构建的镜像创建容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-使用构建的镜像创建容器"}},[e._v("#")]),e._v(" 5.0  使用构建的镜像创建容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker run -di --name mycentos7 -p 8080:8080 mycentos:7\n8d556158982dc66190899fb7e0c3b579a9e3479aea416207e55135d48499e814\n[root@Docker ~]# curl http://localhost:8080\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE        COMMAND                  CREATED              STATUS              PORTS                                       NAMES\n8d556158982d   mycentos:7   "/usr/local/tomcat/a…"   About a minute ago   Up About a minute   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   mycentos7\n[root@Docker ~]# docker stop mycentos7\nmycentos7\n[root@Docker ~]# docker rm mycentos7\nmycentos7\n\n[root@Docker ~]# docker rmi mycentos:7\nUntagged: mycentos:7\nDeleted: sha256:12a919baf6828b79803485c103d213699ad8fb6b8eb086753d5338cd2ad98f14\nDeleted: sha256:0f94de771fc4f0e27e79118635a373002354d9e1cf015978de7477473f1b5573\nDeleted: sha256:2d871d9393bf16eb6ed861480f08483106263dfed51bd0605ebdfd098bc344ab\nDeleted: sha256:459cccc809db4d05e429f8df5a83056b79d59775d47733245bbd557e5acab394\nDeleted: sha256:b4666bf0bdd5d93cbaca4060ef2fc2277cb3dcb2804183b9de215f2699affee6\nDeleted: sha256:cd22d80d0812ba70186efd5dacd3c9b6ee7b2952be865e284a90bc2c2e6cb21e\nDeleted: sha256:1cd3c774f0fecdbe9ec14f3034d212e6a6260b3f6063ee63e952c5a8b3e2cd3c\nDeleted: sha256:51fff184d17eb512c169877054f6d748e51217582fa742bb2f0512a1ba3043e4\nDeleted: sha256:434a7ec345fc41c953315adaedd027b7741bb592d566979322dcf1a36786ab2d\nDeleted: sha256:04188547afb48392235bbbbf4dd9471f231f200e175520e52513f631bab33d2b\nDeleted: sha256:526551478771da3b4f9ccf814eb85af6487a7f94af3766e7cdeb565cc124b407\nDeleted: sha256:5b9a0b767d5ae369d0f819877ea242a69493f6ac07375c4fe564e6460c566647\n')])])]),a("h3",{attrs:{id:"六-docker-镜像构建之-docker-commit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六-docker-镜像构建之-docker-commit"}},[e._v("#")]),e._v(" 六 Docker 镜像构建之 docker commit")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker6.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 镜像构建之 docker commit"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("https://www.bilibili.com/video/BV1844y167D1?p=27 - https://www.bilibili.com/video/BV1844y167D1?p=29")])]),e._v(" "),a("li",[a("p",[e._v("Docker 支持自己构建镜像，还支持将自己构建的镜像上传至公共仓库，镜像构建可以通过以下两种方式来实现：")]),e._v(" "),a("ol",[a("li",[e._v("docker commit：从容器创建一个新的镜像；")]),e._v(" "),a("li",[e._v("docker build：配合 Dockerfile 文件创建镜像。")])])]),e._v(" "),a("li",[a("p",[e._v("下面我们先通过 docker commit 来实现镜像的构建。")]),e._v(" "),a("ul",[a("li",[e._v("目标：我们通过基础镜像 centos:7，在该镜像中安装 jdk 和 tomcat 以后将其制作为一个新的镜像 mycentos:7。")])])])]),e._v(" "),a("h4",{attrs:{id:"_1-0-创建容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-创建容器"}},[e._v("#")]),e._v(" 1.0  创建容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 拉取镜像\n[root@Docker ~]# docker pull centos:7\n7: Pulling from library/centos\nDigest: sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987\nStatus: Image is up to date for centos:7\ndocker.io/library/centos:7\n[root@Docker ~]# docker pull centos:centos7\ncentos7: Pulling from library/centos\nDigest: sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987\nStatus: Downloaded newer image for centos:centos7\ndocker.io/library/centos:centos7\n\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED       SIZE\ncentos        7         eeb6ee3f44bd   4 weeks ago   204MB\ncentos        centos7   eeb6ee3f44bd   4 weeks ago   204MB\n\n# 创建容器\n[root@Docker ~]# docker run -di --name centos7 centos:7\n24ca094601f68d753d94902f664e8f9815db762b8adb15a4e7c35857920874f9\n\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE      COMMAND       CREATED          STATUS          PORTS     NAMES\n24ca094601f6   centos:7   "/bin/bash"   30 seconds ago   Up 29 seconds             centos7\n')])])]),a("h4",{attrs:{id:"_2-0-拷贝资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-拷贝资源"}},[e._v("#")]),e._v(" 2.0  拷贝资源")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# wget https://download.oracle.com/otn/java/jdk/11.0.6+8/90eb79fb590d45c8971362673c5ab495/jdk-11.0.6_linux-x64_bin.tar.gz?AuthParam=1634471086_c11f8a5eb0f7b0d336f8f14e24ed1c42\n\n[root@Docker ~]# mv jdk-11.0.6_linux-x64_bin.tar.gz\\?AuthParam\\=1634471086_c11f8a5eb0f7b0d336f8f14e24ed1c42 jdk-11.0.6_linux-x64_bin.tar.gz\n\n[root@Docker ~]# wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.54/bin/apache-tomcat-9.0.54.tar.gz\n--2021-10-17 19:49:14--  https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.54/bin/apache-tomcat-9.0.54.tar.gz\nResolving dlcdn.apache.org (dlcdn.apache.org)... 151.101.2.132, 2a04:4e42::644\nConnecting to dlcdn.apache.org (dlcdn.apache.org)|151.101.2.132|:443... connected.\nERROR: cannot verify dlcdn.apache.org's certificate, issued by ‘/C=US/O=Let's Encrypt/CN=R3’:\n  Issued certificate has expired.\nTo connect to dlcdn.apache.org insecurely, use `--no-check-certificate'.\n\nsftp> put apache-tomcat-9.0.54.tar.gz\n\n[root@Docker ~]# ls\nanaconda-ks.cfg  apache-tomcat-9.0.54.tar.gz  jdk-11.0.6_linux-x64_bin.tar.gz\n")])])]),a("ul",[a("li",[e._v("将宿主机的 jdk 和 tomcat 拷贝至容器")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker cp jdk-11.0.6_linux-x64_bin.tar.gz centos7:/root\n[root@Docker ~]# docker cp apache-tomcat-9.0.54.tar.gz centos7:/root\n")])])]),a("h4",{attrs:{id:"_3-0-安装资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-安装资源"}},[e._v("#")]),e._v(" 3.0  安装资源")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 进入容器\n[root@Docker ~]# docker exec -it centos7 /bin/bash\n# 切换至 /root 目录\n[root@24ca094601f6 /]# cd /root/\n[root@24ca094601f6 ~]# ls\nanaconda-ks.cfg  apache-tomcat-9.0.54.tar.gz  jdk-11.0.6_linux-x64_bin.tar.gz\n# 创建 java 和 tomcat 目录\n[root@24ca094601f6 ~]# mkdir -p /usr/local/java\n[root@24ca094601f6 ~]# mkdir -p /usr/local/tomcat\n# 将 jdk 和 tomcat 解压至容器 /usr/local/java 和 /usr/local/tomcat 目录中\n[root@24ca094601f6 ~]# tar -zxvf jdk-11.0.6_linux-x64_bin.tar.gz -C /usr/local/java/ \n[root@24ca094601f6 ~]# tar -zxvf apache-tomcat-9.0.54.tar.gz -C /usr/local/tomcat/\n\n[root@24ca094601f6 ~]# ll /usr/local/java/jdk-11.0.6/\n# 配置 jdk 环境变量\n[root@24ca094601f6 ~]# vi /etc/profile \n# 在环境变量文件中添加以下内容\nexport PATH USER LOGNAME MAIL HOSTNAME HISTSIZE HISTCONTROL\nexport JAVA_HOME=/usr/local/java/jdk-11.0.6/\nexport PATH=$PATH:$JAVA_HOME/bin\n\n# 重新加载环境变量文件\n[root@24ca094601f6 ~]# source /etc/profile\n\n# 测试环境变量是否配置成功\n[root@24ca094601f6 ~]# java -version\njava version "11.0.6" 2020-01-14 LTS\nJava(TM) SE Runtime Environment 18.9 (build 11.0.6+8-LTS)\nJava HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.6+8-LTS, mixed mode)\n\n# 删除容器内 jdk 和 tomcat\n[root@24ca094601f6 ~]# rm jdk-11.0.6_linux-x64_bin.tar.gz apache-tomcat-9.0.54.tar.gz \n\n# 启动tomcat\n[root@24ca094601f6 ~]# /usr/local/tomcat/apache-tomcat-9.0.54/bin/startup.sh \nUsing CATALINA_BASE:   /usr/local/tomcat/apache-tomcat-9.0.54\nUsing CATALINA_HOME:   /usr/local/tomcat/apache-tomcat-9.0.54\nUsing CATALINA_TMPDIR: /usr/local/tomcat/apache-tomcat-9.0.54/temp\nUsing JRE_HOME:        /usr/local/java/jdk-11.0.6/\nUsing CLASSPATH:       /usr/local/tomcat/apache-tomcat-9.0.54/bin/bootstrap.jar:/usr/local/tomcat/apache-tomcat-9.0.54/bin/tomcat-juli.jar\nUsing CATALINA_OPTS:   \nTomcat started.\n[root@24ca094601f6 ~]# curl http://localhost:8080\n\n[root@24ca094601f6 ~]# /usr/local/tomcat/apache-tomcat-9.0.54/bin/shutdown.sh \nUsing CATALINA_BASE:   /usr/local/tomcat/apache-tomcat-9.0.54\nUsing CATALINA_HOME:   /usr/local/tomcat/apache-tomcat-9.0.54\nUsing CATALINA_TMPDIR: /usr/local/tomcat/apache-tomcat-9.0.54/temp\nUsing JRE_HOME:        /usr/local/java/jdk-11.0.6/\nUsing CLASSPATH:       /usr/local/tomcat/apache-tomcat-9.0.54/bin/bootstrap.jar:/usr/local/tomcat/apache-tomcat-9.0.54/bin/tomcat-juli.jar\nUsing CATALINA_OPTS:   \nNOTE: Picked up JDK_JAVA_OPTIONS:  --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.util.concurrent=ALL-UNNAMED --add-opens=java.rmi/sun.rmi.transport=ALL-UNNAMED\n\n[root@24ca094601f6 ~]# exit\nexit\n')])])]),a("h4",{attrs:{id:"_4-0-构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-构建镜像"}},[e._v("#")]),e._v(" 4.0  构建镜像")]),e._v(" "),a("blockquote",[a("p",[e._v("docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker commit -a="TosinJia" -m="jdk11 and tomcat9" centos7 mycentos:7\nsha256:77c79c7a39573413146580eae96fec88c48e4aab9e014ee057d52c257b2941e9\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nmycentos      7         77c79c7a3957   17 seconds ago   523MB\ncentos        7         eeb6ee3f44bd   4 weeks ago      204MB\n')])])]),a("ul",[a("li",[e._v("-a：提交的镜像作者；")]),e._v(" "),a("li",[e._v("-c：使用 Dockerfile 指令来创建镜像；")]),e._v(" "),a("li",[e._v("-m：提交时的说明文字；")]),e._v(" "),a("li",[e._v("-p：在 commit 时，将容器暂停。")])]),e._v(" "),a("h4",{attrs:{id:"_5-0-使用构建的镜像创建容器-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-使用构建的镜像创建容器-2"}},[e._v("#")]),e._v(" 5.0  使用构建的镜像创建容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 创建容器\n[root@Docker ~]# docker run -di --name mycentos7 -p 8080:8080 mycentos:7\nd97bbbfee70fdc6e72d4b2157f3f7ca7ec387dca7ade1518ee23234b79179c29\n# 进入容器\n[root@Docker ~]# docker exec -it mycentos7 /bin/bash\n[root@d97bbbfee70f /]# java -version      \nbash: java: command not found\n# 重新加载配置文件\n[root@d97bbbfee70f /]# source /etc/profile\n[root@d97bbbfee70f /]# java -version      \njava version "11.0.6" 2020-01-14 LTS\nJava(TM) SE Runtime Environment 18.9 (build 11.0.6+8-LTS)\nJava HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.6+8-LTS, mixed mode)\n# 启动 tomcat\n[root@d97bbbfee70f /]# /usr/local/tomcat/apache-tomcat-9.0.54/bin/startup.sh \n\n[root@Docker ~]# curl http://localhost:8080\n')])])]),a("h3",{attrs:{id:"五-docker-之常见应用部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-docker-之常见应用部署"}},[e._v("#")]),e._v(" 五 Docker 之常见应用部署")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker5.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 之常见应用部署"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_1-0-tomcat"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-tomcat"}},[e._v("#")]),e._v(" 1.0  Tomcat")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 拉取镜像\n[root@Docker ~]# docker pull tomcat\nUsing default tag: latest\nlatest: Pulling from library/tomcat\nbb7d5a84853b: Pull complete \nf02b617c6a8c: Pull complete \nd32e17419b7e: Pull complete \nc9d2d81226a4: Pull complete \nfab4960f9cd2: Pull complete \nda1c1e7baf6d: Pull complete \n79b231561270: Pull complete \n7d337880d8b4: Pull complete \n2df65a31be06: Pull complete \n10cbf519de23: Pull complete \nDigest: sha256:7c30d3c92b191ec2b84f64be99326f9c83a4a4e079c899ee4d0a9a41abca8406\nStatus: Downloaded newer image for tomcat:latest\ndocker.io/library/tomcat:latest\n\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\ntomcat        latest    4ce9babdd885   4 days ago     680MB\n\n# 创建容器\n[root@Docker ~]# docker run -di --name tomcat01 -p 8080:8080 tomcat:latest \nf0106aa3f248c9b44961489ac6d56f50d09d3a1d4ca0d2f438ca9abf42740819\n[root@Docker ~]# curl http://localhost:8080\n\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE           COMMAND             CREATED              STATUS              PORTS                                       NAMES\nf0106aa3f248   tomcat:latest   "catalina.sh run"   About a minute ago   Up About a minute   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp   tomcat01\n# 进入容器\n[root@Docker ~]# docker exec -it tomcat01 /bin/bash\n# 查看 webapps 目录下是否有 ROOT 项目，我们熟悉的 Tomcat 猫页面一般就在这个项目中\nroot@f0106aa3f248:/usr/local/tomcat# ls webapps\nroot@f0106aa3f248:/usr/local/tomcat# ls webapps.dist\nROOT  docs  examples  host-manager  manager\n# 如上图所示，该目录下空空如也，其实 Tomcat 在比较新的版本中将默认的 ROOT 项目放在了 webapps.dist 中，如果你真想访问 http://192.168.10.10:8080/ 看到 Tomcat 猫，将其复制至 webapps 即可\nroot@f0106aa3f248:/usr/local/tomcat# cp -rf webapps.dist/ROOT/ /usr/local/tomcat/webapps\nroot@f0106aa3f248:/usr/local/tomcat# ls webapps\nROOT\n\n')])])]),a("h4",{attrs:{id:"_2-0-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-nginx"}},[e._v("#")]),e._v(" 2.0  Nginx")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 拉取镜像\n[root@Docker ~]# docker pull nginx\nUsing default tag: latest\nlatest: Pulling from library/nginx\nDigest: sha256:644a70516a26004c97d0d85c7fe1d0c3a67ea8ab7ddf4aff193d9f301670cf36\nStatus: Image is up to date for nginx:latest\ndocker.io/library/nginx:latest\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nnginx         latest    87a94228f133   6 days ago     133MB\n\n# 创建 Nginx 容器\n[root@Docker ~]# docker run -di --name nginx01 -p 80:80 nginx:latest\n4d5364389bb90126a28c6b37f6f6158f4015d6e3a294d627b796c81cf5f8bde1\n\n# 将容器内的配置文件拷贝到指定目录（请先提前创建好目录）\n## 创建目录\n[root@Docker ~]# mkdir -p /mydata/docker_nginx\n[root@Docker ~]# docker cp nginx01:/etc/nginx /mydata/docker_nginx/\n## 将容器内的配置文件拷贝到指定目录\n[root@Docker ~]# ll /mydata/docker_nginx/\ntotal 0\ndrwxr-xr-x. 3 root root 132 Oct 12 10:03 nginx\n# 重命名宿主机 /mydata/docker_nginx/nginx 为 /mydata/docker_nginx/conf\n[root@Docker ~]# mv /mydata/docker_nginx/nginx/ /mydata/docker_nginx/conf\n[root@Docker ~]# ll /mydata/docker_nginx/conf/\ntotal 24\ndrwxr-xr-x. 2 root root   26 Oct 18 16:09 conf.d\n-rw-r--r--. 1 root root 1007 Sep  7 23:21 fastcgi_params\n-rw-r--r--. 1 root root 5290 Sep  7 23:21 mime.types\nlrwxrwxrwx. 1 root root   22 Sep  7 23:38 modules -> /usr/lib/nginx/modules\n-rw-r--r--. 1 root root  648 Sep  7 23:38 nginx.conf\n-rw-r--r--. 1 root root  636 Sep  7 23:21 scgi_params\n-rw-r--r--. 1 root root  664 Sep  7 23:21 uwsgi_params\n\n# 终止并删除容器（目录挂载操作只能在创建容器时设置）\n[root@Docker ~]# docker stop nginx01\nnginx01\n[root@Docker ~]# docker rm nginx01\nnginx01\n\n# 创建 Nginx 容器，并将容器中的 /etc/nginx 目录和宿主机的 /mydata/docker_nginx/conf 目录进行挂载。\n[root@Docker ~]# docker run -di --name nginx01 -p 80:80 -v /mydata/docker_nginx/conf:/etc/nginx nginx:latest\n05e0f0997d83d92ef1af1f1bcc90677e90ae688bf814145efc350eb277e568d4\n[root@Docker ~]# curl http://localhost:80\n\n")])])]),a("h4",{attrs:{id:"_3-0-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-mysql"}},[e._v("#")]),e._v(" 3.0  MySQL")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 拉取镜像\n[root@Docker ~]# docker pull mysql:5.7\n5.7: Pulling from library/mysql\nb380bbd43752: Already exists \nf23cbf2ecc5d: Pull complete \n30cfc6c29c0a: Pull complete \nb38609286cbe: Pull complete \n8211d9e66cd6: Pull complete \n2313f9eeca4a: Pull complete \n7eb487d00da0: Pull complete \nbb9cc5c700e7: Pull complete \n88676eb32344: Pull complete \n8fea0b38a348: Pull complete \n3dc585bfc693: Pull complete \nDigest: sha256:b8814059bbd9c80b78fe4b2b0b70cd70fe3772b3c5d8ee1edfa46791db3224f9\nStatus: Downloaded newer image for mysql:5.7\ndocker.io/library/mysql:5.7\n\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nmysql         5.7       8a8a506ccfdc   5 days ago     448MB\n\n[root@Docker ~]# ll /mydata/docker_mysql\nls: cannot access /mydata/docker_mysql: No such file or directory\n\n# 创建容器 /mydata/docker_nysql/data /mydata/docker_mysql/data\n[root@Docker ~]# docker run -di --name mysql01 -p 3307:3306 -v /mydata/docker_mysql/conf:/etc/mysql/conf.d -v /mydata/docker_mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7\n\n\n")])])]),a("ul",[a("li",[e._v("-p：代表端口映射，格式为 宿主机映射端口:容器运行端口。")]),e._v(" "),a("li",[e._v("-e：代表添加环境变量 MYSQL_ROOT_PASSWORD 是 root 用户的登陆密码。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                                                  NAMES\n860c0717187d   mysql:5.7      "docker-entrypoint.s…"   24 seconds ago   Up 21 seconds   33060/tcp, 0.0.0.0:3307->3306/tcp, :::3307->3306/tcp   mysql01\n# 自动创建用于目录挂载的宿主机目录\n[root@Docker ~]# ll /mydata/docker_mysql\ntotal 0\ndrwxr-xr-x. 2 root root 6 Oct 18 16:52 conf\n')])])]),a("ul",[a("li",[e._v("也可以进入容器并使用 MySQL 命令打开客户端")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker exec -it mysql01 /bin/bash\nroot@860c0717187d:/# mysql -uroot -p123456 --default-character-set=utf8\n")])])]),a("h5",{attrs:{id:"修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改配置"}},[e._v("#")]),e._v(" 修改配置")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("进入容器\nroot@4dfc6e1ba4d1:/# find / -name my.cnf\n/etc/alternatives/my.cnf\n/etc/mysql/my.cnf\n/var/lib/dpkg/alternatives/my.cnf\nroot@4dfc6e1ba4d1:/# cat /etc/mysql/my.cnf\n!includedir /etc/mysql/conf.d/\n!includedir /etc/mysql/mysql.conf.d/\nroot@4dfc6e1ba4d1:/# ls /etc/mysql/conf.d/\nroot@4dfc6e1ba4d1:/# ls /etc/mysql/mysql.conf.d/\nmysqld.cnf\nroot@4dfc6e1ba4d1:/# cd /etc/mysql/mysql.conf.d/\nroot@4dfc6e1ba4d1:/etc/mysql/mysql.conf.d# cat mysqld.cnf \n\n[mysqld]\npid-file\t= /var/run/mysqld/mysqld.pid\nsocket\t\t= /var/run/mysqld/mysqld.sock\ndatadir\t\t= /var/lib/mysql\n#log-error\t= /var/log/mysql/error.log\n# By default we only accept connections from localhost\n#bind-address\t= 127.0.0.1\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\n\n\n[root@localhost ~]# docker cp imysql:/etc/mysql/mysql.conf.d/mysqld.cnf /mydata/docker_mysql/\n[root@localhost ~]# ll /mydata/docker_mysql/\n总用量 8\ndrwxr-xr-x. 2 root    root    6 10月 23 11:14 conf\ndrwxr-xr-x. 9 polkitd root 4096 10月 23 13:50 data\n-rw-r--r--. 1 root    root 1589 10月 19 05:36 mysqld.cnf\n[root@localhost docker_mysql]# cat mysqld.cnf \n[mysqld]\npid-file\t= /var/run/mysqld/mysqld.pid\nsocket\t\t= /var/run/mysqld/mysqld.sock\ndatadir\t\t= /var/lib/mysql\n#log-error\t= /var/log/mysql/error.log\n# By default we only accept connections from localhost\n#bind-address\t= 127.0.0.1\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\n\nsql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n[root@localhost docker_mysql]# docker cp  mysqld.cnf imysql:/etc/mysql/mysql.conf.d/\n重启容器\n")])])]),a("h5",{attrs:{id:"创建容器2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建容器2"}},[e._v("#")]),e._v(" 创建容器2")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@CentOS-7 ~]# docker run -di --name mysql01 -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7\n56eb1c220242a6d6fbfb63b0759457ff51d3fc61cdf3f10e396d9107e4690824\n[root@CentOS-7 ~]# mkdir etc_mysql\n[root@CentOS-7 ~]# docker cp mysql01:/etc/mysql etc_mysql/ \n[root@CentOS-7 ~]# tree etc_mysql/\netc_mysql/\n└── mysql\n    ├── conf.d\n    │   ├── docker.cnf\n    │   ├── mysql.cnf\n    │   └── mysqldump.cnf\n    ├── my.cnf -> /etc/alternatives/my.cnf\n    ├── my.cnf.fallback\n    ├── mysql.cnf\n    └── mysql.conf.d\n        └── mysqld.cnf\n\n# 想把容器中 /etc/mysql 复制到 /var/mysql/conf\n[root@CentOS-7 ~]# mkdir -p /var/mysql/conf\n[root@CentOS-7 ~]# cp -rf etc_mysql/mysql/* /var/mysql/conf/ \n[root@CentOS-7 ~]# tree /var/mysql/conf/\n/var/mysql/conf/\n├── conf.d\n│   ├── docker.cnf\n│   ├── mysql.cnf\n│   └── mysqldump.cnf\n├── my.cnf -> /etc/alternatives/my.cnf\n├── my.cnf.fallback\n├── mysql.cnf\n└── mysql.conf.d\n    └── mysqld.cnf\n\n[root@CentOS-7 ~]# docker run -di --name mysql -p 3306:3306 -v /var/mysql/conf:/etc/mysql -v /var/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=Clgg7890 mysql:5.7\nc1fe786d1845dc1a0958249c6c0762de867fa6fd09692585acee87ac16527d18\n\n[root@CentOS-7 ~]# vim /var/mysql/conf/mysql.conf.d/mysqld.cnf\n# Copyright (c) 2014, 2021, Oracle and/or its affiliates.\n#\n# This program is free software; you can redistribute it and/or modify\n# it under the terms of the GNU General Public License, version 2.0,\n# as published by the Free Software Foundation.\n#\n# This program is also distributed with certain software (including\n# but not limited to OpenSSL) that is licensed under separate terms,\n# as designated in a particular file or component or in included license\n# documentation.  The authors of MySQL hereby grant you an additional\n# permission to link the program and your derivative works with the\n# separately licensed software that they have included with MySQL.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License, version 2.0, for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program; if not, write to the Free Software\n# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA\n\n#\n# The MySQL  Server configuration file.\n#\n# For explanations see\n# http://dev.mysql.com/doc/mysql/en/server-system-variables.html\n\n[mysqld]\npid-file        = /var/run/mysqld/mysqld.pid\nsocket          = /var/run/mysqld/mysqld.sock\ndatadir         = /var/lib/mysql\n#log-error      = /var/log/mysql/error.log\n# By default we only accept connections from localhost\n#bind-address   = 127.0.0.1\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\n\nsql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n\n[root@CentOS-7 ~]# docker restart mysql\nmysql\n\n\n[root@CentOS-7 ~]# docker exec -it mysql /bin/bash\n\nroot@c1fe786d1845:/# cat /etc/mysql/mysql.conf.d/mysqld.cnf \n\nsql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\n\n")])])]),a("h4",{attrs:{id:"_4-0-redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-redis"}},[e._v("#")]),e._v(" 4.0  Redis")]),e._v(" "),a("h5",{attrs:{id:"方式一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式一"}},[e._v("#")]),e._v(" 方式一")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 拉取镜像\n[root@Docker ~]# docker pull redis\nUsing default tag: latest\nlatest: Pulling from library/redis\n7d63c13d9b9b: Pull complete \na2c3b174c5ad: Pull complete \n283a10257b0f: Pull complete \n7a08c63a873a: Pull complete \n0531663a7f55: Pull complete \n9bf50efb265c: Pull complete \nDigest: sha256:a89cb097693dd354de598d279c304a1c73ee550fbfff6d9ee515568e0c749cfe\nStatus: Downloaded newer image for redis:latest\ndocker.io/library/redis:latest\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED        SIZE\nredis         latest    7faaec683238   5 days ago     113MB\n# 创建容器\n[root@Docker ~]# docker run -di --name redis01 -p 6379:6379 redis\na17ec0816a7db3eb61e8449acac1c89b39dc464be9365f8bb5aeab93972d5a3a\n\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                                                  NAMES\na17ec0816a7d   redis          "docker-entrypoint.s…"   59 seconds ago   Up 54 seconds   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp              redis01\n')])])]),a("ul",[a("li",[e._v("连接容器中的 Redis 时，只需要连接宿主机的 IP + 指定的映射端口即可。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("root@a17ec0816a7d:/data# redis-server --version\nRedis server v=6.2.6 sha=00000000:0 malloc=jemalloc-5.1.0 bits=64 build=1527eab61b27d3bf\nroot@a17ec0816a7d:/data# whereis redis-server\nredis-server: /usr/local/bin/redis-server\n")])])]),a("ul",[a("li",[e._v("修改密码")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('root@a17ec0816a7d:/data# redis-cli -h 127.0.0.1 -p 6379\n127.0.0.1:6379> config set requirepass 123456\nOK\n127.0.0.1:6379> config get requirepass\n1) "requirepass"\n2) "123456"\n127.0.0.1:6379> quit\nroot@a17ec0816a7d:/data# redis-cli -h 127.0.0.1 -p 6379 -a 123456\nWarning: Using a password with \'-a\' or \'-u\' option on the command line interface may not be safe.\n127.0.0.1:6379> config get requirepass\n1) "requirepass"\n2) "123456"\n127.0.0.1:6379> \n')])])]),a("ul",[a("li",[e._v("重启后密码失效")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker stop redis01\nredis01\n[root@Docker ~]# docker start redis01\nredis01\n[root@Docker ~]# docker exec -it redis01 /bin/bash\nroot@a17ec0816a7d:/data# redis-cli -h 127.0.0.1 -p 6379          \n127.0.0.1:6379> config get requirepass\n1) "requirepass"\n2) ""\n')])])]),a("h5",{attrs:{id:"方式二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式二"}},[e._v("#")]),e._v(" 方式二")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_38958597/article/details/106048983",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker安装redis，并配置持久化"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# mkdir -p /mydata/docker_redis/{conf,data}\n[root@Docker ~]# ll /mydata/docker_redis/                 \ntotal 0\ndrwxr-xr-x. 2 root root 6 Oct 18 20:54 conf\ndrwxr-xr-x. 2 root root 6 Oct 18 20:54 data\n\n[root@Docker docker_redis]# wget https://download.redis.io/releases/redis-6.2.6.tar.gz\n[root@Docker docker_redis]# tar -zxvf redis-6.2.6.tar.gz \n[root@Docker docker_redis]# cp redis-6.2.6/redis.conf conf/\n[root@Docker docker_redis]# vim conf/redis.conf \n# 注释掉这部分，这是限制redis只能本地访问\n# bind 127.0.0.1 -::1\n\n# 默认是yes，开启保护模式，限制为本地访问\nprotected-mode no\n\n# 配置redis连接密码，默认是注释的\nrequirepass 123456\n\n# 默认no，改为yes意为以守护进程方式启动，可后台运行，除非kill进程（可选），改为yes会使配置文件方式启动redis失败\ndaemonize no\n\n# 更改本地redis数据库存放文件夹（可选）\ndir ./\n\nredis持久化（开启了这个，redis就不会每次重启时自动清空了）\nappendonly yes\n\n# 指定版本 redis:latest->redis:6.2.6 -v /mydata/docker_redis/data/:/data -v /mydata/docker_redis/data:/data\n[root@Docker docker_redis]# docker run -di -p 6379:6379 -v /mydata/docker_redis/conf/redis.conf:/etc/redis/redis.conf -v /mydata/docker_redis/data/:/data --name redis02 redis:latest redis-server /etc/redis/redis.conf\n7c8be503b9f2cd7e13ed8d99788d1caad01bf8267563109f2dd998d90ff2e287\n\n# 进入容器\n[root@Docker ~]# docker exec -it redis02 /bin/bash\nroot@7c8be503b9f2:/data# ll\nbash: ll: command not found\nroot@7c8be503b9f2:/data# ls\nappendonly.aof\n# 输入redis-cli连接redis，如果是连接其他服务器的redis，则需要加参数\nroot@7c8be503b9f2:/data# redis-cli -h 127.0.0.1 -p 6379 -a 123456\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n127.0.0.1:6379> config get requirepass\n1) \"requirepass\"\n2) \"123456\"\n127.0.0.1:6379> set name tosin\nOK\n\n[root@Docker docker_redis]# tree ./\n./\n├── conf\n│   └── redis.conf\n├── data\n│   └── appendonly.aof\n└── redis-6.2.6.tar.gz\n\n# 查看容器日志\n[root@Docker docker_redis]# docker logs --tail 200 -f redis02\n")])])]),a("h4",{attrs:{id:"_5-0-mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-mongodb"}},[e._v("#")]),e._v(" 5.0  MongoDB")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker pull mongo\n\n[root@Docker ~]# docker run -di --name mongo -p 27017:27017 mongo\n\n[root@Docker ~]# docker logs -f mongo\n\nWARNING: MongoDB 5.0+ requires a CPU with AVX support, and your current system does not appear to have that!\n  see https://jira.mongodb.org/browse/SERVER-54407\n  see also https://www.mongodb.com/community/forums/t/mongodb-5-0-cpu-intel-g4650-compatibility/116610/2\n  see also https://github.com/docker-library/mongo/issues/485#issuecomment-891991814\n\n\n\ndocker run -di --name mongo -p 27017:27017 mongo:4.4.12-rc0-focal\n\n\n")])])]),a("h5",{attrs:{id:"mongo-4-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongo-4-4"}},[e._v("#")]),e._v(" mongo:4.4")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/packge/article/details/126539320",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker安装mongoDB及使用"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('1. 拉取镜像\n[root@Docker ~]# docker pull mongo:4.4\n2. 创建数据持久化目录\n[root@Docker ~]# mkdir -p /mydata/docker_mongo/data\n\n[root@Docker ~]# docker run -dit --name mongo -v /mydata/docker_mongo/data:/data/db -p 27017:27017 mongo:4.4 --auth\n\n[root@Docker ~]# docker exec -it mongo mongo admin\nMongoDB shell version v4.4.18\nconnecting to: mongodb://127.0.0.1:27017/admin?compressors=disabled&gssapiServiceName=mongodb\nImplicit session: session { "id" : UUID("fb7c98e2-56b5-4e88-9c16-d5abda3965fe") }\nMongoDB server version: 4.4.18\nWelcome to the MongoDB shell.\nFor interactive help, type "help".\nFor more comprehensive documentation, see\n        https://docs.mongodb.com/\nQuestions? Try the MongoDB Developer Community Forums\n        https://community.mongodb.com\n> db.createUser({ user:\'root\',pwd:\'123456\',roles:[ { role:\'userAdminAnyDatabase\', db: \'admin\'},\'readWriteAnyDatabase\']});\nSuccessfully added user: {\n        "user" : "root",\n        "roles" : [\n                {\n                        "role" : "userAdminAnyDatabase",\n                        "db" : "admin"\n                },\n                "readWriteAnyDatabase"\n        ]\n}\n> db.auth(\'root\',\'123456\')\n1\n> db.user.insert({"name":"zhangsan","age":18})\nWriteResult({ "nInserted" : 1 })\n> db.user.find()\n{ "_id" : ObjectId("63c6b753e9de65599302057c"), "name" : "zhangsan", "age" : 18 }\n')])])]),a("h5",{attrs:{id:"mongodb-compass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-compass"}},[e._v("#")]),e._v(" MongoDB Compass")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_44009447/article/details/108583168",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用MongoDB Compass数据库可视化管理工具操作MongoDB数据库进行增删改查，数据导入导出"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.mongodb.com/try/download/compass",target:"_blank",rel:"noopener noreferrer"}},[e._v("MongoDB Compass官网下载地址"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_6-0-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-0-elasticsearch"}},[e._v("#")]),e._v(" 6.0  Elasticsearch")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('##### 拉取镜像\n[root@Docker ~]# docker pull elasticsearch:7.8.1\n##### 创建容器，为了方便演示，修改 ES 启动占用内存大小\n[root@Docker ~]# docker run -e ES_JAVA_OPTS="-Xms256m -Xmx512m" -e "discovery.type=single-node" -di --name es -p 9200:9200 -p 9300:9300 -p 5601:5601 -v /mydata/docker_es/plugins:/usr/share/elasticsearch/plugins elasticsearch:7.8.1\n\n##### 安装中文分词器\n1. 进入容器\n[root@Docker ~]# docker exec -it es /bin/bash\n2. 安装中文分词器\n[root@f6b1ff9ddcaf elasticsearch]# elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.8.1/elasticsearch-analysis-ik-7.8.1.zip\n-> Installing https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.8.1/elasticsearch-analysis-ik-7.8.1.zip\n-> Downloading https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.8.1/elasticsearch-analysis-ik-7.8.1.zip\n[=================================================] 100%?? \n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@     WARNING: plugin requires additional permissions     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n* java.net.SocketPermission * connect,resolve\nSee http://docs.oracle.com/javase/8/docs/technotes/guides/security/permissions.html\nfor descriptions of what these permissions allow and the associated risks.\n\nContinue with installation? [y/N]y   \n-> Installed analysis-ik\n[root@f6b1ff9ddcaf elasticsearch]# exit\nexit\n3. 重启es\n[root@Docker ~]# docker restart es\n')])])]),a("ul",[a("li",[e._v("访问\n"),a("ul",[a("li",[e._v("http://192.168.56.106:9200/")])])])]),e._v(" "),a("h4",{attrs:{id:"_7-0-solr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-0-solr"}},[e._v("#")]),e._v(" 7.0  Solr")]),e._v(" "),a("h4",{attrs:{id:"_8-0-rabbitmq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-0-rabbitmq"}},[e._v("#")]),e._v(" 8.0  RabbitMQ")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("1. 拉取镜像\n[root@Docker ~]# docker pull rabbitmq\n2. 创建容器\n[root@Docker ~]# docker run -di --name rabbitmq -p 4369:4369 -p 5671:5671 -p 5672:5672 -p 15671:15671 -p 15672:15672 -p 25672:25672 rabbitmq\n69604b87dd12205539339587ecf61ed785595ebe3442c8653f0647fb8e6db09c\n\n3. 进入容器并开启管理功能\n　　访问：http://192.168.10.10:15672/ 使用 guest 登录账号密码，结果如下：\n3.1 # 进入容器\n[root@Docker ~]# docker exec -it rabbitmq /bin/bash\n3.2 # 开启 RabbitMQ 管理功能\nroot@a2759454a01f:/# rabbitmq-plugins enable rabbitmq_management\nEnabling plugins on node rabbit@a2759454a01f:\nrabbitmq_management\nThe following plugins have been configured:\n  rabbitmq_management\n  rabbitmq_management_agent\n  rabbitmq_prometheus\n  rabbitmq_web_dispatch\nApplying plugin configuration to rabbit@a2759454a01f...\nThe following plugins have been enabled:\n  rabbitmq_management\n\nstarted 1 plugins.\n4. 访问 http://192.168.56.106:15672 使用 guest 登录账号密码\n")])])]),a("h5",{attrs:{id:"rabbitmq-3-management"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-3-management"}},[e._v("#")]),e._v(" rabbitmq:3-management")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/chezong/article/details/128900286",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker搭建RabbitMQ"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\n[root@Docker ~]# docker pull rabbitmq:3-management\n\n[root@Docker ~]# docker run -di \\\n> -e RABBITMQ_DEFAULT_USER=rabbitmq \\\n> -e RABBITMQ_DEFAULT_PASS=123456 \\\n> --name rabbitmq \\\n> -p 15672:15672 -p 5672:5672 \\\n> rabbitmq:3-management \n\n访问 http://192.168.56.106:15672 \n")])])]),a("h4",{attrs:{id:"gitlab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab"}},[e._v("#")]),e._v(" GitLab")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/328795102",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker下gitlab安装配置与使用"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/BThinker/article/details/124097795",target:"_blank",rel:"noopener noreferrer"}},[e._v("修改密码-Docker 搭建 Gitlab 服务器 (完整详细版) "),a("OutboundLink")],1)])]),e._v(" "),a("blockquote",[a("p",[e._v("分配 10G内存")])]),e._v(" "),a("h5",{attrs:{id:"gitlab-gitlab-ce"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-gitlab-ce"}},[e._v("#")]),e._v(" gitlab/gitlab-ce")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 1. 从Docker镜像仓库 拉取gitlab镜像\n[root@Docker ~]# docker search  gitlab/gitlab\n\n[root@Docker ~]# docker pull gitlab/gitlab-ce\n[root@Docker ~]# mkdir -p /mydata/docker_gitlab/{config,logs,data}\n\n# 2.运行gitlab镜像\n[root@Docker ~]# \ndocker run --detach \\\n--publish 443:443 -p 80:80 -p 22:22 \\\n--name igitlab \\\n--volume /mydata/docker_gitlab/config:/etc/gitlab:Z \\\n-v /mydata/docker_gitlab/logs:/var/log/gitlab:Z \\\n-v /mydata/docker_gitlab/data:/var/opt/gitlab:Z \\\ngitlab/gitlab-ce\n74698ca37146e2f1c10facc3338f9fb71616ccf222d8133dd5c3c46e0977cf54\ndocker: Error response from daemon: driver failed programming external connectivity on endpoint igitlab (2b72c6ff2c9d07b316c2c581aff5b2772c54d2640aa6c59f9f3616b500275700): Error starting userland proxy: listen tcp4 0.0.0.0:22: bind: address already in use.\n\ndocker run --detach \\\n--publish 443:443 -p 80:80 -p 22222:22 \\\n--name igitlab \\\n--volume /mydata/docker_gitlab/config:/etc/gitlab:Z \\\n-v /mydata/docker_gitlab/logs:/var/log/gitlab:Z \\\n-v /mydata/docker_gitlab/data:/var/opt/gitlab:Z \\\ngitlab/gitlab-ce\n\n# 3. 配置\n\n[root@Docker ~]# vim /mydata/docker_gitlab/config/gitlab.rb \n# 配置http协议所使用的访问地址,不加端口号默认为80\nexternal_url 'http://192.168.56.106'\n\n# 配置ssh协议所使用的访问地址和端口\ngitlab_rails['gitlab_ssh_host'] = 'http://192.168.56.106'\ngitlab_rails['gitlab_shell_ssh_port'] = 22222 # 此端口是run时22端口映射的222端口\n:wq #保存配置文件并退出\n\n# 每次修改gitlab 配置都需要重启\n[root@Docker ~]# docker restart igitlab\n\n# 4.邮箱服务配置\n[root@Docker ~]# vim /mydata/docker_gitlab/config/gitlab.rb\ngitlab_rails['smtp_enable'] = true\ngitlab_rails['smtp_address'] = \"smtp.qq.com\"\ngitlab_rails['smtp_port'] = 465\ngitlab_rails['smtp_user_name'] = \"1872275509@qq.com\"\ngitlab_rails['smtp_password'] = \"stwhalndkillcghc\"\ngitlab_rails['smtp_domain'] = \"smtp.qq.com\"\ngitlab_rails['smtp_authentication'] = \"login\"\ngitlab_rails['smtp_enable_starttls_auto'] = true\ngitlab_rails['smtp_tls'] = true\ngitlab_rails['smtp_pool'] = false\n\ngitlab_rails['gitlab_email_from'] = '1872275509@qq.com'\n\n\n[root@Docker ~]# docker logs -f --tail 10 igitlab\n...\n[2023-03-27T04:03:44+00:00] INFO: templatesymlink[Create a gitlab.yml and create a symlink to Rails root] sending run action to execute[clear the gitlab-rails cache] (delayed)\nRecipe: gitlab::gitlab-rails\n# http://192.168.56.106/\n...\ngitlab Reconfigured!\nChecking for unmigrated data on legacy storage\n\n\n# 修改密码\n## 开启 gitlab 的 bash 工具\n[root@Docker ~]# docker exec -it igitlab bash\n## 开启 gitlab-rails 工具\nroot@bf4784a3e876:/# gitlab-rails console -e production\n--------------------------------------------------------------------------------\n Ruby:         ruby 2.7.7p221 (2022-11-24 revision 168ec2b1e5) [x86_64-linux]\n GitLab:       15.9.3 (f030ca96950) FOSS\n GitLab Shell: 14.17.0\n PostgreSQL:   13.8\n-----------------------------------------------------------[ booted in 312.56s ]\nLoading production environment (Rails 6.1.7.2)\n## 查询id为1的用户，id为1的用户是超级管理员\nirb(main):001:0> user = User.where(id:1).first\n## 修改密码\nirb(main):002:0> user.password='GL123456'\n## 保存\nirb(main):003:0> user.save!\n=> #<User id:1 @root>\n=> \"GL123456\"\n=> true\nirb(main):004:0> Notify.test_email('296999770@qq.com','test Gitlab Email','Test').deliver_now\nDelivered mail 642130388aa95_282488039142@bf4784a3e876.mail (996.2ms)\n=> #<Mail::Message:295900, Multipart: false, Headers: <Date: Mon, 27 Mar 2023 05:57:12 +0000>, <From: GitLab <1872275509@qq.com>>, <Reply-To: GitLab <noreply@192.168.56.106>>, <To: 296999770@qq.com>, <Message-ID: <642130388aa95_282488039142@bf4784a3e876.mail>>, <Subject: test Gitlab Email>, <Mime-Version: 1.0>, <Content-Type: text/html; charset=UTF-8>, <Content-Transfer-Encoding: 7bit>, <Auto-Submitted: auto-generated>, <X-Auto-Response-Suppress: All>>\n# 退出\nirb(main):005:0> exit\n")])])]),a("ul",[a("li",[a("a",{attrs:{href:"http://192.168.56.106/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.56.106"),a("OutboundLink")],1)])]),e._v(" "),a("h5",{attrs:{id:"gitlab-gitlab-ee"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-gitlab-ee"}},[e._v("#")]),e._v(" gitlab/gitlab-ee")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker pull gitlab/gitlab-ee:15.10.0-ee.0\n\n[root@Docker ~]# docker images\nREPOSITORY                             TAG            IMAGE ID       CREATED         SIZE\ngitlab/gitlab-ee                       15.10.0-ee.0   70f83fb3b54d   16 months ago   3.18GB\n[root@Docker ~]# docker inspect --format='{{.RepoDigests}}' gitlab/gitlab-ee:15.10.0-ee.0\n[gitlab/gitlab-ee@sha256:f94866360b7461bf3899cd2d9ef10b1be4b04e19ec88f3b19fd42d7408c843fd]\n[root@Docker ~]# docker inspect --format='{{.RepoDigests}}' 70f83fb3b54d\n[gitlab/gitlab-ee@sha256:f94866360b7461bf3899cd2d9ef10b1be4b04e19ec88f3b19fd42d7408c843fd]\n\n[root@Docker ~]# mkdir -p /mydata/docker_gitlab-ee/{config,logs,data}\n\n[root@Docker ~]#\ndocker run --detach \\\n--publish 443:443 -p 80:80 -p 22222:22 \\\n--name igitlab-ee \\\n--volume /mydata/docker_gitlab-ee/config:/etc/gitlab:Z \\\n-v /mydata/docker_gitlab-ee/logs:/var/log/gitlab:Z \\\n-v /mydata/docker_gitlab-ee/data:/var/opt/gitlab:Z \\\n-v /etc/localtime:/etc/localtime \\\ngitlab/gitlab-ee:15.10.0-ee.0\n\n[root@Docker ~]# docker restart igitlab-ee\n[root@Docker ~]# docker exec -it igitlab-ee bash\nroot@0a0aa33baafb:/# gitlab-rails console -e production\n--------------------------------------------------------------------------------\n Ruby:         ruby 3.0.5p211 (2022-11-24 revision ba5cf0f7c5) [x86_64-linux]\n GitLab:       15.10.0-ee (defe6e7f882) EE\n GitLab Shell: 14.18.0\n PostgreSQL:   13.8\n-----------------------------------------------------------[ booted in 278.06s ]\nLoading production environment (Rails 6.1.7.2)\nirb(main):001:0> user = User.where(id:1).first\n=> #<User id:1 @root>\nirb(main):002:0> user.password='GL123456'\n=> \"GL123456\"\nirb(main):003:0> user.save!\n=> true\nirb(main):004:0> Notify.test_email('296999770@qq.com','test Gitlab Email','Test').deliver_now\nDelivered mail 6423ad1042ff3_47748d05941@0a0aa33baafb.mail (1051.7ms)\n=> #<Mail::Message:342140, Multipart: false, Headers: <Date: Wed, 29 Mar 2023 03:14:24 +0000>, <From: GitLab <1872275509@qq.com>>, <Reply-To: GitLab <noreply@192.168.56.106>>, <To: 296999770@qq.com>, <Message-ID: <6423ad1042ff3_47748d05941@0a0aa33baafb.mail>>, <Subject: test Gitlab Email>, <Mime-Version: 1.0>, <Content-Type: text/html; charset=UTF-8>, <Content-Transfer-Encoding: 7bit>, <Auto-Submitted: auto-generated>, <X-Auto-Response-Suppress: All>>\nirb(main):005:0> exit\n")])])]),a("h6",{attrs:{id:"默认密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认密码"}},[e._v("#")]),e._v(" 默认密码")]),e._v(" "),a("ul",[a("li",[e._v("初装以后，把密码放在了一个临时文件中/etc/gitlab/initial_root_password，这个文件将在首次执行reconfigure后24小时自动删除")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("root@0a0aa33baafb:/# ls /etc/gitlab/initial_root_password\n/etc/gitlab/initial_root_password\nroot@0a0aa33baafb:/# cat /etc/gitlab/initial_root_password\n# WARNING: This value is valid only in the following conditions\n#          1. If provided manually (either via `GITLAB_ROOT_PASSWORD` environment variable or via `gitlab_rails['initial_root_password']` setting in `gitlab.rb`, it was provided before database was seeded for the first time (usually, the first reconfigure run).\n#          2. Password hasn't been changed manually, either via UI or via command line.\n#\n#          If the password shown here doesn't work, you must reset the admin password following https://docs.gitlab.com/ee/security/reset_user_password.html#reset-your-root-password.\n\nPassword: SWYCTD74Tyivh0Y+uYjA3sZ7UKFilUuXS52pBgz7MMU=\n\n# NOTE: This file will be automatically deleted in the first reconfigure run after 24 hours.\n")])])]),a("h6",{attrs:{id:"头像问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#头像问题"}},[e._v("#")]),e._v(" 头像问题")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@sgkegfv9z7dzk7 docker_volumns]# vi /mydata/docker_gitlab-ee/config/gitlab.rb\ngitlab_rails['gravatar_plain_url'] = 'http://cdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'\ngitlab_rails['gravatar_ssl_url'] = 'https://seccdn.libravatar.org/avatar/%{hash}?s=%{size}&d=identicon'\n")])])]),a("h6",{attrs:{id:"升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#升级"}},[e._v("#")]),e._v(" 升级")]),e._v(" "),a("ul",[a("li",[e._v("https://gitlab-com.gitlab.io/support/toolbox/upgrade-path/\n"),a("ul",[a("li",[e._v("https://gitlab-com.gitlab.io/support/toolbox/upgrade-path/?current=15.10.0&distro=docker")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker run/pull gitlab/gitlab-ee:15.11.13-ee.0\ndocker run/pull gitlab/gitlab-ee:16.3.8-ee.0\ndocker run/pull gitlab/gitlab-ee:16.7.9-ee.0\ndocker run/pull gitlab/gitlab-ee:16.11.8-ee.0\ndocker run/pull gitlab/gitlab-ee:17.3.0-ee.0\n")])])]),a("h4",{attrs:{id:"wiznote"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wiznote"}},[e._v("#")]),e._v(" wiznote")]),e._v(" "),a("ul",[a("li",[e._v("https://hub.docker.com/r/wiznote/wizserver")]),e._v(" "),a("li",[e._v("https://blog.csdn.net/q20010619/article/details/115791435")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# mkdir -p /mydata/docker_wiznote/data\n\n[root@Docker ~]# docker pull wiznote/wizserver:latest\nlatest: Pulling from wiznote/wizserver\n2d473b07cdd5: Already exists \n1aeb668a9eb4: Pull complete \n6aa34afa3c7a: Pull complete \n7a81377970bd: Pull complete \n1402272be5bf: Pull complete \n5d32e2df24a1: Pull complete \nDigest: sha256:9a0feee93842a4d006bf7b986937702722f5f7a79d30fc36452d5e960cd4d15a\nStatus: Downloaded newer image for wiznote/wizserver:latest\ndocker.io/wiznote/wizserver:latest\n\n[root@Docker ~]# docker images\nREPOSITORY          TAG       IMAGE ID       CREATED        SIZE\nwiznote/wizserver   latest    7e15ae236f41   4 days ago     2.08GB\n\n[root@Docker ~]# docker run -di -v /mydata/docker_wiznote/data:/wiz/storage -v /etc/localtime:/etc/localtime -p 80:80 -p 9269:9269/udp --restart=always --name wiz wiznote/wizserver:latest\nad85b29cf8fe36524fac162df77431ddc2d531f4b4d767939dcf00a5cdbbe80a\n\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE                      COMMAND                  CREATED          STATUS          PORTS                                                                          NAMES\nad85b29cf8fe   wiznote/wizserver:latest   "bash /wiz/app/entry…"   55 seconds ago   Up 51 seconds   0.0.0.0:80->80/tcp, :::80->80/tcp, 0.0.0.0:9269->9269/udp, :::9269->9269/udp   wiz\n\n# 修改为不自动启动\n[root@Docker ~]# docker container update ad85b29cf8fe --restart=no\nad85b29cf8fe\n')])])]),a("ul",[a("li",[e._v("http://127.0.0.1/")])]),e._v(" "),a("h4",{attrs:{id:"leanote"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#leanote"}},[e._v("#")]),e._v(" leanote")]),e._v(" "),a("ul",[a("li",[e._v("https://hub.docker.com/r/leanote/leanote")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker pull leanote/leanote\nUsing default tag: latest\nlatest: Pulling from leanote/leanote\nImage docker.io/leanote/leanote:latest uses outdated schema1 manifest format. Please upgrade to a schema2 image for better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated-schema-v1/\na3ed95caeb02: Pull complete \nfc64c7ea2e33: Pull complete \n46a0de8612ef: Pull complete \na2527d2aae81: Pull complete \n61a444d70a90: Pull complete \nf3ea43bd4072: Pull complete \n13c9976e0f80: Pull complete \nDigest: sha256:f8596ad706d6dd01d2aa11e264878ac8719993c1f6060ec39c7c13f3a8264bff\nStatus: Downloaded newer image for leanote/leanote:latest\ndocker.io/leanote/leanote:latest\n\n\n[root@Docker ~]# mkdir -p /mydata/docker_leanote/data\n[root@Docker ~]# docker run -di -v /mydata/docker_leanote/data:/data 9000:9000 leanote\n[root@Docker ~]# docker images\nREPOSITORY        TAG       IMAGE ID       CREATED        SIZE\nleanote/leanote   latest    3e501d1da0cf   5 years ago    749MB\n\n[root@Docker ~]# docker run -di -v /mydata/docker_leanote/data:/data -p 9000:9000 leanote/leanote:latest\n72e52c7f9686b18d6af71072bcfa68e8fd436a7e47176f8b777fdae153b2dbd5\n\n\n\n")])])]),a("ul",[a("li",[e._v("http://localhost:9000/")])]),e._v(" "),a("h4",{attrs:{id:"oracle-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oracle-2"}},[e._v("#")]),e._v(" oracle")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/443324194",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker安装oracle数据库史上最全步骤（带图文）"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mike666/p/13999397.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker安装Oracle11g"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@SystemFramework ~]# docker pull registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g\nUsing default tag: latest\nlatest: Pulling from helowin/oracle_11g\ned5542b8e0e1: Pull complete \na3ed95caeb02: Pull complete \n1e8f80d0799e: Pull complete \nDigest: sha256:4c12b98372dfcbaafcd9564a37c8d91456090a5c6fb07a4ec18270c9d9ef9726\nStatus: Downloaded newer image for registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g:latest\nregistry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g:latest\n[root@SystemFramework ~]# docker images\nREPOSITORY                                             TAG       IMAGE ID       CREATED        SIZE\nregistry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g   latest    3fa112fd3642   6 years ago    6.85GB\n\n[root@SystemFramework ~]# docker run -d -p 1521:1521 --name oracle11g registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g\n3c0ae5a124fef4e583f067eee48c78a3abc91495ad707ccbca01d1d56d9d7c81\n[root@SystemFramework ~]# docker ps \nCONTAINER ID   IMAGE                                                  COMMAND                  CREATED          STATUS         PORTS                                       NAMES\n3c0ae5a124fe   registry.cn-hangzhou.aliyuncs.com/helowin/oracle_11g   \"/bin/sh -c '/home/o…\"   57 seconds ago   Up 9 seconds   0.0.0.0:1521->1521/tcp, :::1521->1521/tcp   oracle11g\n\n# 进入Oracle容器创建用户：\n# 容器镜像系统用户root密码为 helowin\n[root@SystemFramework ~]# docker exec -it oracle11g /bin/bash\n[oracle@3c0ae5a124fe /]$ cd /home/oracle/\n[oracle@3c0ae5a124fe ~]$ source .bash_profile \n[oracle@3c0ae5a124fe ~]$ sqlplus /nolog\n\nSQL*Plus: Release 11.2.0.1.0 Production on Tue Feb 8 09:07:12 2022\n\nCopyright (c) 1982, 2009, Oracle.  All rights reserved.\n\nSQL> conn /as sysdba\nConnected.\nSQL> alter user system identified by system;\n\nUser altered.\n\nSQL> alter user sys identified by system;\n\nUser altered.\n\nSQL> create user root identified by 123456;\n\nUser created.\n\nSQL> grant connect,resource,dba to root;\n\nGrant succeeded.\n\nSQL> alter profile default limit PASSWORD_LIFE_TIME UNLIMITED;\n\nProfile altered.\n\nSQL> alter system set processes=2000 scope=spfile;\n\nSystem altered.\n\nSQL> select * from dba_users t where t.username='root';\n\nno rows selected\n\nSQL> shutdown immediate;\nDatabase closed.\nDatabase dismounted.\nORACLE instance shut down.\nSQL> startup;   \nORACLE instance started.\n\nTotal System Global Area 1603411968 bytes\nFixed Size                  2213776 bytes\nVariable Size             436209776 bytes\nDatabase Buffers         1157627904 bytes\nRedo Buffers                7360512 bytes\nDatabase mounted.\nDatabase opened.\nSQL> select * from dba_users t where t.username='ROOT';\n\nUSERNAME                          USER_ID PASSWORD\n------------------------------ ---------- ------------------------------\nACCOUNT_STATUS                   LOCK_DATE EXPIRY_DA\n-------------------------------- --------- ---------\nDEFAULT_TABLESPACE             TEMPORARY_TABLESPACE           CREATED\n------------------------------ ------------------------------ ---------\nPROFILE                        INITIAL_RSRC_CONSUMER_GROUP\n------------------------------ ------------------------------\nEXTERNAL_NAME\n--------------------------------------------------------------------------------\nPASSWORD E AUTHENTI\n-------- - --------\nROOT                                   91\n\nUSERNAME                          USER_ID PASSWORD\n------------------------------ ---------- ------------------------------\nACCOUNT_STATUS                   LOCK_DATE EXPIRY_DA\n-------------------------------- --------- ---------\nDEFAULT_TABLESPACE             TEMPORARY_TABLESPACE           CREATED\n------------------------------ ------------------------------ ---------\nPROFILE                        INITIAL_RSRC_CONSUMER_GROUP\n------------------------------ ------------------------------\nEXTERNAL_NAME\n--------------------------------------------------------------------------------\nPASSWORD E AUTHENTI\n-------- - --------\nOPEN\n\nUSERNAME                          USER_ID PASSWORD\n------------------------------ ---------- ------------------------------\nACCOUNT_STATUS                   LOCK_DATE EXPIRY_DA\n-------------------------------- --------- ---------\nDEFAULT_TABLESPACE             TEMPORARY_TABLESPACE           CREATED\n------------------------------ ------------------------------ ---------\nPROFILE                        INITIAL_RSRC_CONSUMER_GROUP\n------------------------------ ------------------------------\nEXTERNAL_NAME\n--------------------------------------------------------------------------------\nPASSWORD E AUTHENTI\n-------- - --------\nUSERS                          TEMP                           08-FEB-22\n\nUSERNAME                          USER_ID PASSWORD\n------------------------------ ---------- ------------------------------\nACCOUNT_STATUS                   LOCK_DATE EXPIRY_DA\n-------------------------------- --------- ---------\nDEFAULT_TABLESPACE             TEMPORARY_TABLESPACE           CREATED\n------------------------------ ------------------------------ ---------\nPROFILE                        INITIAL_RSRC_CONSUMER_GROUP\n------------------------------ ------------------------------\nEXTERNAL_NAME\n--------------------------------------------------------------------------------\nPASSWORD E AUTHENTI\n-------- - --------\nDEFAULT                        DEFAULT_CONSUMER_GROUP\n\nUSERNAME                          USER_ID PASSWORD\n------------------------------ ---------- ------------------------------\nACCOUNT_STATUS                   LOCK_DATE EXPIRY_DA\n-------------------------------- --------- ---------\nDEFAULT_TABLESPACE             TEMPORARY_TABLESPACE           CREATED\n------------------------------ ------------------------------ ---------\nPROFILE                        INITIAL_RSRC_CONSUMER_GROUP\n------------------------------ ------------------------------\nEXTERNAL_NAME\n--------------------------------------------------------------------------------\nPASSWORD E AUTHENTI\n-------- - --------\n\n\nUSERNAME                          USER_ID PASSWORD\n------------------------------ ---------- ------------------------------\nACCOUNT_STATUS                   LOCK_DATE EXPIRY_DA\n-------------------------------- --------- ---------\nDEFAULT_TABLESPACE             TEMPORARY_TABLESPACE           CREATED\n------------------------------ ------------------------------ ---------\nPROFILE                        INITIAL_RSRC_CONSUMER_GROUP\n------------------------------ ------------------------------\nEXTERNAL_NAME\n--------------------------------------------------------------------------------\nPASSWORD E AUTHENTI\n-------- - --------\n10G 11G  N PASSWORD\n\nUSERNAME                          USER_ID PASSWORD\n------------------------------ ---------- ------------------------------\nACCOUNT_STATUS                   LOCK_DATE EXPIRY_DA\n-------------------------------- --------- ---------\nDEFAULT_TABLESPACE             TEMPORARY_TABLESPACE           CREATED\n------------------------------ ------------------------------ ---------\nPROFILE                        INITIAL_RSRC_CONSUMER_GROUP\n------------------------------ ------------------------------\nEXTERNAL_NAME\n--------------------------------------------------------------------------------\nPASSWORD E AUTHENTI\n-------- - --------\n\n\nSQL> exit;\nDisconnected from Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production\nWith the Partitioning, OLAP, Data Mining and Real Application Testing options\n\njdbc:oracle:thin:@localhost:1521:helowin\nroot 123456\n")])])]),a("h4",{attrs:{id:"zabbix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zabbix"}},[e._v("#")]),e._v(" Zabbix")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.zabbix.com/documentation/3.4/zh/start",target:"_blank",rel:"noopener noreferrer"}},[e._v("zabbix中文文档"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://hub.docker.com/u/zabbix",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/u/zabbix"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/zabbix/zabbix-server-mysql/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/r/zabbix/zabbix-server-mysql/"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/zabbix/zabbix-web-nginx-mysql",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/r/zabbix/zabbix-web-nginx-mysql"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/zabbix/zabbix-java-gateway",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/r/zabbix/zabbix-java-gateway"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/zabbix/zabbix-agent",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/r/zabbix/zabbix-agent"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/zabbix/zabbix-agent2",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/r/zabbix/zabbix-agent2"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/_/mysql?tab=tags",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/_/mysql?tab=tags"),a("OutboundLink")],1)])])])]),e._v(" "),a("h5",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),a("ul",[a("li",[e._v("Zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。")]),e._v(" "),a("li",[e._v("Zabbix能监视各种网络参数，保证服务器系统的安全运营；并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。")]),e._v(" "),a("li",[e._v("Zabbix 作为企业级分布式监控系统，具有很多优点，如：分布式监控，支持 node 和 proxy 分布式模式；自动化注册，根据规则，自动注册主机到监控平台，自动添加监控模板；支持 agentd、snmp、ipmi 和 jmx 等很多通信方式。然而部署一套完整的zabbix，需要安装数据库、web服务器、zabbix-server和zabbix-agent。")])]),e._v(" "),a("h5",{attrs:{id:"方式二-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式二-2"}},[e._v("#")]),e._v(" 方式二")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/jykn92/p/15149299.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("通过docker安装部署zabbix5.0监控平台"),a("OutboundLink")],1)])]),e._v(" "),a("h6",{attrs:{id:"下载镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像"}},[e._v("#")]),e._v(" 下载镜像")]),e._v(" "),a("ol",[a("li",[e._v("拉取mysql镜像 这里使用8.0版本，在linux终端拉取8.0.23镜像")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager2 ~]# docker pull mysql:8.0\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("下载zabbix-server镜像\n"),a("ul",[a("li",[e._v("zabbix-server镜像分两种，支持MySQL数据库zabbix-server-mysql，支持支持PostgreSQL数据库zabbix/zabbix-server-pgsql。下面安装的是支持MySQL数据库的Server镜像。打开zabbix-server-mysql的docker hub，大家会发现，zabbix-server-mysql有多个版本，可根据自己的环境选择合适版本。因为我的服务器是centos7版本，所以选择的是centos版本，zabbix版本我也选择最新版5.2.4，所以下载镜像方式如下：")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager2 ~]# docker pull zabbix/zabbix-server-mysql:centos-5.2.4\n# 如果你要使用最新版本的zabbix-server镜像，也可以直接执行如下方式下载镜像：\n[root@manager2 ~]# docker pull zabbix/zabbix-server-mysql:centos-latest\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("下载Zabbix web镜像\n"),a("ul",[a("li",[e._v("这里使用的是基于Nginx web服务器及支持MySQL数据库的Zabbix web接口zabbix/zabbix-web-nginx-mysql。这里我用的是centos-5.2.4版本：")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager2 ~]# docker pull zabbix/zabbix-web-nginx-mysql:centos-5.2.4\n# 要用最新版本，也可直接用latest版本\n[root@manager2 ~]# docker pull zabbix/zabbix-web-nginx-mysql:latest\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("下载zabbix-java-gateway镜像\n"),a("ul",[a("li",[e._v("Zabbix本身不支持直接监控Java，而是使用zabbix-java-gateway监控jvm/tomcat性能。这里我们使用centos-5.2.4版本，在linux终端执行如下命令：")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager2 ~]# docker pull zabbix/zabbix-java-gateway:centos-5.2.4\n\n[root@manager2 ~]# docker images\nREPOSITORY                      TAG            IMAGE ID       CREATED         SIZE\nmysql                           8.0            76152be68449   3 days ago      524MB\nzabbix/zabbix-server-mysql      centos-5.2.4   da5a144a3d6d   15 months ago   348MB\nzabbix/zabbix-web-nginx-mysql   centos-5.2.4   aa0430d0a79a   15 months ago   447MB\nzabbix/zabbix-java-gateway      centos-5.2.4   8ee9b15d7d44   15 months ago   398MB\n")])])]),a("h6",{attrs:{id:"运行镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行镜像"}},[e._v("#")]),e._v(" 运行镜像")]),e._v(" "),a("ol",[a("li",[e._v("创建docker网络\n"),a("ul",[a("li",[e._v("启动zabbix等镜像之前，需要先创建一个新的Docker网络。需要将后面的zabbix-server、mysql、web等容器都加入到此网络中，方便互相访问。在终端使用下面命令创建。")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager2 ~]# docker network create --driver bridge zabbix_net\n23a29f8a60a5706f1f95d81f102542e4aac9a57fc9f650bc3b087c14cd340528\n# 创建后，可以查看是否创建成功\n[root@manager2 ~]# docker network ls\nNETWORK ID     NAME              DRIVER    SCOPE\n23a29f8a60a5   zabbix_net        bridge    local\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("运行mysql镜像，创建mysql容器")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager2 ~]# docker run -itd -p 3306:3306 --name zabbix-mysql --network zabbix_net --restart unless-stopped -v /etc/localtime:/etc/localtime -v /dockerdata/zabbix/db:/var/lib/mysql -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" mysql:8.0 --default-authentication-plugin=mysql_native_password --character-set-server=utf8 --collation-server=utf8_bin\n[root@manager3 zabbix]# docker run -itd -p 3306:3306 --name zabbix-mysql --network zabbix_net --restart unless-stopped -v /etc/localtime:/etc/localtime -v /dockerdata/zabbix/db:/var/lib/mysql -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" mysql:8.0.23 --default-authentication-plugin=mysql_native_password --character-set-server=utf8 --collation-server=utf8_bin\nf0876b901385d82f965816b6d72315e8efd0ef84a12a449ae29a1c1b6bbf0041\n\n[root@manager2 ~]# docker run -dit -p 3306:3306 --name zabbix-mysql --network zabbix_net --restart always -v /etc/localtime:/etc/localtime -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" mysql:5.7\nUnable to find image \'mysql:5.7\' locally\n5.7: Pulling from library/mysql\nStatus: Downloaded newer image for mysql:5.7\n7614c92f7edc7810c382a412e26dc43801763b0fad2843e07e856313119c1c91\n')])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("运行zabbix-java-gateway镜像，创建zabbix-java-gateway容器")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager2 ~]# docker run -v /etc/localtime:/etc/localtime -dit --restart=always --name=zabbix-java-gateway --network zabbix_net zabbix/zabbix-java-gateway:centos-5.2.4\nad95051e33a914bcf99ca602caa4caf67ccab6dae40f4a821389e015771b6188\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("运行zabbix-server-mysql镜像，启动zabbix-server-mysql容器\n"),a("ul",[a("li",[e._v("创建zabbix-server-mysql容器之前，首先创建数据卷zabbix-server-vol")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager2 ~]# docker volume create zabbix-server-vol\nzabbix-server-vol\n[root@manager2 ~]# docker volume ls\nDRIVER    VOLUME NAME\nlocal     zabbix-server-vol\n\n[root@manager2 ~]# docker run -dit -p 10051:10051 --mount source=zabbix-server-vol,target=/etc/zabbix -v /etc/localtime:/etc/localtime -v /usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts --name=zabbix-server-mysql --restart=always --network zabbix_net -e DB_SERVER_HOST="zabbix-mysql" -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" -e ZBX_JAVAGATEWAY="zabbix-java-gateway" -e ZBX_JAVAGATEWAY_ENABLE="true" -e ZBX_JAVAGATEWAYPORT=10052 zabbix/zabbix-server-mysql:centos-5.2.4\na921517b9275639147fc919fc159808cb67cfb34d96834e733cb70a09a5d5b23\n')])])]),a("ol",{attrs:{start:"5"}},[a("li",[e._v("运行zabbix-web-nginx-mysql镜像，创建zabbix-web-nginx-mysql容器\n"),a("ul",[a("li",[a("a",{attrs:{href:"http://192.168.217.4:8080/zabbix",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.217.4:8080/zabbix"),a("OutboundLink")],1),e._v(" "),a("ul",[a("li",[e._v("admin/zabbix")])])])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager2 ~]# docker run -dit -p 8080:8080 -v /etc/localtime:/etc/localtime -v /dockerdata/zabbix/fonts/DejaVuSans.ttf:/usr/share/zabbix/assets/fonts/DejaVuSans.ttf --name zabbix-web-nginx-mysql --restart=always --network zabbix_net -e DB_SERVER_HOST="zabbix-mysql" -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" -e ZBX_SERVER_HOST="zabbix-server-mysql" zabbix/zabbix-web-nginx-mysql:centos-5.2.4\n82ad7379ab2ce69e838c4a378ef3d00746d4c2a180b9e5bd7378989e3b12664d\ndocker: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: error during container init: error mounting "/dockerdata/zabbix/fonts/DejaVuSans.ttf" to rootfs at "/usr/share/zabbix/assets/fonts/DejaVuSans.ttf": mount /dockerdata/zabbix/fonts/DejaVuSans.ttf:/usr/share/zabbix/assets/fonts/DejaVuSans.ttf (via /proc/self/fd/7), flags: 0x5000: not a directory: unknown: Are you trying to mount a directory onto a file (or vice-versa)? Check if the specified host path exists and is the expected type.\n\n[root@manager2 ~]# docker ps -a\nCONTAINER ID   IMAGE                                        COMMAND                  CREATED          STATUS          PORTS                                                  NAMES\n0b606fd4a3dd   zabbix/zabbix-web-nginx-mysql:centos-5.2.4   "docker-entrypoint.sh"   2 minutes ago    Created         0.0.0.0:8080->8080/tcp, :::8080->8080/tcp, 8443/tcp    zabbix-web-nginx-mysql\n[root@manager2 ~]# docker rm zabbix-web-nginx-mysql\nzabbix-web-nginx-mysql\n\n[root@manager2 ~]# docker run -dit -p 8080:8080 -v /etc/localtime:/etc/localtime --name zabbix-web-nginx-mysql --restart=always --network zabbix_net -e DB_SERVER_HOST="zabbix-mysql" -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" -e ZBX_SERVER_HOST="zabbix-server-mysql" zabbix/zabbix-web-nginx-mysql:centos-5.2.4\nddac6b6e7f19aba7069ef488c70745744d0a4e956e5d41c38f9889930d6b5261\n')])])]),a("ol",{attrs:{start:"6"}},[a("li",[e._v("运行zabbix-agent镜像")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('docker pull zabbix/zabbix-agent:centos-5.2.4\n# 本地agent的安装\n[root@manager2 ~]# docker run -dit --name zabbix-agent -p 10050:10050 --network zabbix_net -e ZBX_HOSTNAME="Zabbix server" -e ZBX_SERVER_HOST="zabbix-server-mysql" -e ZBX_SERVER_PORT=10051 zabbix/zabbix-agent:centos-5.2.4\n0b34525ec603dcf0a6c986061b49852e16e34e8ec8dd3f23be9e24a31c51eef1\n[root@manager2 ~]# docker ps\nCONTAINER ID   IMAGE                                        COMMAND                  CREATED          STATUS          PORTS                                                  NAMES\n0b34525ec603   zabbix/zabbix-agent:centos-5.2.4             "/sbin/tini -- /usr/…"   18 seconds ago   Up 16 seconds   0.0.0.0:10050->10050/tcp, :::10050->10050/tcp          zabbix-agent\nddac6b6e7f19   zabbix/zabbix-web-nginx-mysql:centos-5.2.4   "docker-entrypoint.sh"   5 minutes ago    Up 5 minutes    0.0.0.0:8080->8080/tcp, :::8080->8080/tcp, 8443/tcp    zabbix-web-nginx-mysql\na921517b9275   zabbix/zabbix-server-mysql:centos-5.2.4      "/sbin/tini -- /usr/…"   16 minutes ago   Up 16 minutes   0.0.0.0:10051->10051/tcp, :::10051->10051/tcp          zabbix-server-mysql\nad95051e33a9   zabbix/zabbix-java-gateway:centos-5.2.4      "docker-entrypoint.s…"   18 minutes ago   Up 18 minutes   10052/tcp                                              zabbix-java-gateway\n7614c92f7edc   mysql:5.7                                    "docker-entrypoint.s…"   19 minutes ago   Up 19 minutes   0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   zabbix-mysql\n[root@manager2 ~]# docker stop zabbix-agent\n\n# zabbix-agent2 zabbix/zabbix-agent2:centos-5.2.4 docker: Error response from daemon: manifest for zabbix/zabbix-agent2:centos-5.2.4 not found: manifest unknown: manifest unknown.\n[root@manager2 ~]# docker run -dit --name zabbix-agent2 -p 10050:10050 -v /var/run/docker.sock:/var/run/docker.sock --network zabbix_net -e ZBX_HOSTNAME="Zabbix-agent2 server" -e ZBX_SERVER_HOST="zabbix-server-mysql" -e ZBX_SERVER_PORT=10051 --privileged zabbix/zabbix-agent2:latest\n85b21ee93c34d35023e5980a2408bf124fa17b1f3c5070579cf3d77fa4dcd510\n[root@manager2 ~]# docker ps\nCONTAINER ID   IMAGE                                        COMMAND                  CREATED          STATUS          PORTS                                                      NAMES\n85b21ee93c34   zabbix/zabbix-agent2:latest                  "/sbin/tini -- /usr/…"   53 seconds ago   Up 52 seconds   0.0.0.0:10050->10050/tcp, :::10050->10050/tcp, 31999/tcp   zabbix-agent2\nddac6b6e7f19   zabbix/zabbix-web-nginx-mysql:centos-5.2.4   "docker-entrypoint.sh"   17 minutes ago   Up 17 minutes   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp, 8443/tcp        zabbix-web-nginx-mysql\na921517b9275   zabbix/zabbix-server-mysql:centos-5.2.4      "/sbin/tini -- /usr/…"   28 minutes ago   Up 28 minutes   0.0.0.0:10051->10051/tcp, :::10051->10051/tcp              zabbix-server-mysql\nad95051e33a9   zabbix/zabbix-java-gateway:centos-5.2.4      "docker-entrypoint.s…"   30 minutes ago   Up 30 minutes   10052/tcp                                                  zabbix-java-gateway\n7614c92f7edc   mysql:5.7                                    "docker-entrypoint.s…"   31 minutes ago   Up 31 minutes   0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp       zabbix-mysql\n')])])]),a("h6",{attrs:{id:"通过docker-compose一键安装zabbix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过docker-compose一键安装zabbix"}},[e._v("#")]),e._v(" 通过docker-compose一键安装zabbix")]),e._v(" "),a("ul",[a("li",[e._v("待编排的容器")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('docker network create --driver bridge zabbix_net\n# docker run -dit -p 3306:3306 --name zabbix-mysql --network zabbix_net --restart always -v /etc/localtime:/etc/localtime -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" mysql:5.7\ndocker run -v /etc/localtime:/etc/localtime -dit --restart=always --name=zabbix-java-gateway --network zabbix_net zabbix/zabbix-java-gateway:centos-5.2.4\ndocker run -itd -p 3306:3306 --name zabbix-mysql --network zabbix_net --restart unless-stopped -v /etc/localtime:/etc/localtime -v /dockerdata/zabbix/db:/var/lib/mysql -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" mysql:8.0.23 --default-authentication-plugin=mysql_native_password --character-set-server=utf8 --collation-server=utf8_bin\n\ndocker volume create zabbix-server-vol\ndocker run -dit -p 10051:10051 --mount source=zabbix-server-vol,target=/etc/zabbix -v /etc/localtime:/etc/localtime -v /usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts --name=zabbix-server-mysql --restart=always --network zabbix_net -e DB_SERVER_HOST="zabbix-mysql" -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" -e ZBX_JAVAGATEWAY="zabbix-java-gateway" -e ZBX_JAVAGATEWAY_ENABLE="true" -e ZBX_JAVAGATEWAYPORT=10052 zabbix/zabbix-server-mysql:centos-5.2.4\ndocker run -dit -p 8080:8080 -v /etc/localtime:/etc/localtime --name zabbix-web-nginx-mysql --restart=always --network zabbix_net -e DB_SERVER_HOST="zabbix-mysql" -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" -e ZBX_SERVER_HOST="zabbix-server-mysql" zabbix/zabbix-web-nginx-mysql:centos-5.2.4\ndocker run -dit --name zabbix-agent2 -p 10050:10050 -v /var/run/docker.sock:/var/run/docker.sock --network zabbix_net -e ZBX_HOSTNAME="Zabbix-agent2 server" -e ZBX_SERVER_HOST="zabbix-server-mysql" -e ZBX_SERVER_PORT=10051 --privileged zabbix/zabbix-agent2:latest\n')])])]),a("ul",[a("li",[e._v("docker-compose.yml")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 描述 Compose 文件的版本信息\nversion: "3.8"\n\n# 定义服务，可以多个\nservices:\n#    zabbix-mysql:\n#        image: mysql:5.7\n#        restart: always \n#        environment: \n#            - MYSQL_DATABASE=zabbix\n#            - MYSQL_USER=zabbix\n#            - MYSQL_PASSWORD=zabbix123\n#            - MYSQL_ROOT_PASSWORD=root123\n#        volumes: \n#            - /etc/localtime:/etc/localtime\n#        ports: \n#            - "3306:3306" \n#        networks: \n#            - zabbix_net \n    zabbix-mysql:\n        image: mysql:8.0.23\n        restart: unless-stopped\n        environment:\n            - MYSQL_DATABASE=zabbix\n            - MYSQL_USER=zabbix\n            - MYSQL_PASSWORD=zabbix123 \n            - MYSQL_ROOT_PASSWORD=root123\n        command: # 覆盖容器启动后默认执行的命令\n            - mysqld\n            - --default-authentication-plugin=mysql_native_password \n            - --character-set-server=utf8 \n            - --collation-server=utf8_bin\n        volumes:\n            - /etc/localtime:/etc/localtime \n            - /dockerdata/zabbix/db:/var/lib/mysql \n        ports:\n            - "3306:3306"\n        networks:\n            - zabbix_net\n\n\n    zabbix-java-gateway:\n        image: zabbix/zabbix-java-gateway:centos-5.2.4\n        restart: always\n        volumes:\n            - /etc/localtime:/etc/localtime\n        networks:\n            - zabbix_net\n\n    zabbix-server-mysql: # 服务名称\n        image: zabbix/zabbix-server-mysql:centos-5.2.4 # 指定创建容器时所需的镜像名称标签或者镜像 ID\n        restart: always # 容器重启策略 容器总是重新启动，即使容器被手动停止了，当 Docker 重启时容器也还是会一起启动\n        environment: # 添加环境变量 可以使用数组也可以使用字典。布尔相关的值（true、false、yes、no）都需要用引号括起来，以确保 YML 解析器不会将它们转换为真或假\n            - DB_SERVER_HOST=zabbix-mysql\n            - MYSQL_DATABASE=zabbix\n            - MYSQL_USER=zabbix\n            - MYSQL_PASSWORD=zabbix123\n            - MYSQL_ROOT_PASSWORD=root123\n            - ZBX_JAVAGATEWAY=zabbix-java-gateway\n            - ZBX_JAVAGATEWAY_ENABLE="true" \n            - ZBX_JAVAGATEWAYPORT=10052\n        volumes: # 数据卷，用于实现目录挂载，支持指定目录挂载、匿名挂载、具名挂载\n            # 具名挂载，就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成\n            - zabbix-server-vol:/etc/zabbix\n            # 绝对路径\n            - /etc/localtime:/etc/localtime \n            - /usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts\n        ports: # 宿主机与容器的端口映射关系\n            - "10051:10051" # 左边宿主机端口:右边容器端口\n        networks: # 配置容器连接的网络，引用顶级 networks 下的条目\n            - zabbix_net # 一个具体网络的条目名称\n        depends_on: # 容器依赖、启动先后问题的配置项\n            - zabbix-mysql\n\n    zabbix-web-nginx-mysql:\n        image: zabbix/zabbix-web-nginx-mysql:centos-5.2.4\n        restart: always\n        environment:\n            - DB_SERVER_HOST=zabbix-mysql\n            - MYSQL_DATABASE=zabbix\n            - MYSQL_USER=zabbix\n            - MYSQL_PASSWORD=zabbix123\n            - MYSQL_ROOT_PASSWORD=root123\n            - ZBX_SERVER_HOST=zabbix-server-mysql\n        volumes:\n            - /etc/localtime:/etc/localtime\n        ports:\n            - "8080:8080"\n        networks:\n            - zabbix_net\n        depends_on:\n            - zabbix-mysql\n            - zabbix-server-mysql\n\n    zabbix-agent2:\n        image: zabbix/zabbix-agent2:latest\n        restart: always\n        environment:\n            - ZBX_HOSTNAME=Zabbix-agent2 server\n            - ZBX_SERVER_HOST=zabbix-server-mysql\n            - ZBX_SERVER_PORT=10051\n        volumes:\n            - /var/run/docker.sock:/var/run/docker.sock \n        ports:\n            - "10050:10050"\n        networks:\n            - zabbix_net\n\n# 定义网络，可以多个。如果不声明，默认会创建一个网络名称为"工程名称_default"的 bridge 网络\nnetworks:\n    zabbix_net: # 一个具体网络的条目名称\n#        name: zabbix_net # 网络名称，默认为"工程名称_网络条目名称"\n        driver: bridge # 网络模式，默认为 bridge\n\n# 定义数据卷，可以多个\nvolumes:\n    zabbix-server-vol: # 一个具体数据卷的条目名称\n#        name: zabbix-server-vol # 数据卷名称，默认为"工程名称_数据卷条目名称"\n\n')])])]),a("ul",[a("li",[e._v("测试")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager3 zabbix]# docker compose config -q\n[root@manager3 zabbix]# docker compose up -d \n[root@manager3 zabbix]# docker compose ps\nNAME                              COMMAND                  SERVICE                  STATUS              PORTS\nzabbix-zabbix-agent2-1            "/sbin/tini -- /usr/…"   zabbix-agent2            running             0.0.0.0:10050->10050/tcp, :::10050->10050/tcp\nzabbix-zabbix-java-gateway-1      "docker-entrypoint.s…"   zabbix-java-gateway      running             10052/tcp\nzabbix-zabbix-mysql-1             "docker-entrypoint.s…"   zabbix-mysql             running             0.0.0.0:3306->3306/tcp, :::3306->3306/tcp\nzabbix-zabbix-server-mysql-1      "/sbin/tini -- /usr/…"   zabbix-server-mysql      running             0.0.0.0:10051->10051/tcp, :::10051->10051/tcp\nzabbix-zabbix-web-nginx-mysql-1   "docker-entrypoint.sh"   zabbix-web-nginx-mysql   running             0.0.0.0:8080->8080/tcp, :::8080->8080/tcp\n[root@manager3 zabbix]# docker ps\nCONTAINER ID   IMAGE                                        COMMAND                  CREATED          STATUS          PORTS                                                      NAMES\n5edae596d56a   zabbix/zabbix-web-nginx-mysql:centos-5.2.4   "docker-entrypoint.sh"   14 minutes ago   Up 14 minutes   0.0.0.0:8080->8080/tcp, :::8080->8080/tcp, 8443/tcp        zabbix-zabbix-web-nginx-mysql-1\nbe56ce541307   zabbix/zabbix-server-mysql:centos-5.2.4      "/sbin/tini -- /usr/…"   14 minutes ago   Up 14 minutes   0.0.0.0:10051->10051/tcp, :::10051->10051/tcp              zabbix-zabbix-server-mysql-1\n423fff963383   zabbix/zabbix-agent2:latest                  "/sbin/tini -- /usr/…"   14 minutes ago   Up 14 minutes   0.0.0.0:10050->10050/tcp, :::10050->10050/tcp, 31999/tcp   zabbix-zabbix-agent2-1\nc3173e870b6b   zabbix/zabbix-java-gateway:centos-5.2.4      "docker-entrypoint.s…"   14 minutes ago   Up 14 minutes   10052/tcp                                                  zabbix-zabbix-java-gateway-1\nae506163854e   mysql:8.0.23                                 "docker-entrypoint.s…"   14 minutes ago   Up 14 minutes   0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp       zabbix-zabbix-mysql-1\n[root@manager3 zabbix]# docker compose ls\nNAME                STATUS              CONFIG FILES\nzabbix              running(5)          /root/docker/zabbix/docker-compose.yml\n[root@manager3 zabbix]# docker compose logs -f zabbix-mysql\n[root@manager3 zabbix]# docker compose images zabbix-agent2\nContainer                Repository             Tag                 Image Id            Size\nzabbix-zabbix-agent2-1   zabbix/zabbix-agent2   latest              51a2ca7b3174        34.3MB\n[root@manager3 zabbix]# docker compose port zabbix-mysql 3306\n0.0.0.0:3306\n[root@manager3 zabbix]# docker compose top zabbix-mysql     \nzabbix-zabbix-mysql-1\nUID       PID     PPID    C    STIME   TTY   TIME       CMD\npolkitd   14563   14516   4    10:35   ?     00:03:15   mysqld --default-authentication-plugin=mysql_native_password --character-set-server=utf8 --collation-server=utf8_bin \n[root@manager3 zabbix]# docker compose stop zabbix-web-nginx-mysql\n[+] Running 1/1\n ⠿ Container zabbix-zabbix-web-nginx-mysql-1  Stopped \n[root@manager3 zabbix]# docker compose start zabbix-web-nginx-mysql \n[+] Running 1/1\n ⠿ Container zabbix-zabbix-web-nginx-mysql-1  Started \n\n[root@manager3 zabbix]# docker compose exec zabbix-server-mysql bash\n# 环境变量      \nbash-4.4$ echo $MYSQL_ROOT_PASSWORD\nroot123\nbash-4.4$ ip addr\n\'1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n66: eth0@if67: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:18:00:05 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 172.24.0.5/16 brd 172.24.255.255 scope global eth0\n       valid_lft forever preferred_lft forever\n\n[root@manager3 zabbix]# docker network ls\n7d9d9358e4ab   zabbix_zabbix_net   bridge    local\n[root@manager3 ~]# brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr-7d9d9358e4ab         8000.02424fa7e9a8       no              veth0760fd2\n                                                        veth140fd74\n                                                        vethb515ec8\n                                                        vethf108366\n                                                        vethf3195d9\n[root@manager3 ~]# ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:d4:51:b6 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 78391sec preferred_lft 78391sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n3: enp0s8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:4a:3b:34 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.217.5/24 brd 192.168.217.255 scope global noprefixroute dynamic enp0s8\n       valid_lft 535sec preferred_lft 535sec\n    inet6 fe80::f24f:3bd1:29b8:24be/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n4: docker_gwbridge: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:01:85:17:10 brd ff:ff:ff:ff:ff:ff\n    inet 172.18.0.1/16 brd 172.18.255.255 scope global docker_gwbridge\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:1ff:fe85:1710/64 scope link \n       valid_lft forever preferred_lft forever\n5: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default \n    link/ether 02:42:ff:44:7c:c5 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n58: veth0d87341@if57: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker_gwbridge state UP group default \n    link/ether 96:ec:f7:7b:8e:8d brd ff:ff:ff:ff:ff:ff link-netnsid 6\n    inet6 fe80::94ec:f7ff:fe7b:8e8d/64 scope link \n       valid_lft forever preferred_lft forever\n59: br-7d9d9358e4ab: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:4f:a7:e9:a8 brd ff:ff:ff:ff:ff:ff\n    inet 172.24.0.1/16 brd 172.24.255.255 scope global br-7d9d9358e4ab\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:4fff:fea7:e9a8/64 scope link \n       valid_lft forever preferred_lft forever\n61: veth0760fd2@if60: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master br-7d9d9358e4ab state UP group default \n    link/ether 4e:ea:bd:ed:b0:e3 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet6 fe80::4cea:bdff:feed:b0e3/64 scope link \n       valid_lft forever preferred_lft forever\n63: vethf108366@if62: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master br-7d9d9358e4ab state UP group default \n    link/ether 06:45:06:62:95:74 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n    inet6 fe80::445:6ff:fe62:9574/64 scope link \n       valid_lft forever preferred_lft forever\n65: veth140fd74@if64: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master br-7d9d9358e4ab state UP group default \n    link/ether fe:11:7b:e9:20:4b brd ff:ff:ff:ff:ff:ff link-netnsid 1\n    inet6 fe80::fc11:7bff:fee9:204b/64 scope link \n       valid_lft forever preferred_lft forever\n67: vethb515ec8@if66: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master br-7d9d9358e4ab state UP group default \n    link/ether 82:e1:9c:60:0c:97 brd ff:ff:ff:ff:ff:ff link-netnsid 3\n    inet6 fe80::80e1:9cff:fe60:c97/64 scope link \n       valid_lft forever preferred_lft forever\n69: vethf3195d9@if68: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master br-7d9d9358e4ab state UP group default \n    link/ether 06:a9:11:e7:79:b4 brd ff:ff:ff:ff:ff:ff link-netnsid 4\n    inet6 fe80::4a9:11ff:fee7:79b4/64 scope link \n       valid_lft forever preferred_lft forever\n\n[root@manager3 ~]# docker network inspect zabbix_zabbix_net\n[\n    {\n        "Name": "zabbix_zabbix_net",\n        "Id": "7d9d9358e4ab0c45ae081ca945424eb92e8e300b554b3de8c25ebd29f320665f",\n        "Created": "2022-05-16T10:35:04.280479061+08:00",\n        "Scope": "local",\n        "Driver": "bridge",\n        "EnableIPv6": false,\n        "IPAM": {\n            "Driver": "default",\n            "Options": null,\n            "Config": [\n                {\n                    "Subnet": "172.24.0.0/16",\n                    "Gateway": "172.24.0.1"\n                }\n            ]\n        },\n        "Internal": false,\n        "Attachable": false,\n        "Ingress": false,\n        "ConfigFrom": {\n            "Network": ""\n        },\n        "ConfigOnly": false,\n        "Containers": {\n            "423fff963383f5b3050b5c3fbe660bbd73ee36bc9233ac6558d4816ce62b0662": {\n                "Name": "zabbix-zabbix-agent2-1",\n                "EndpointID": "dbe48835142a5499cd328618ffb6595a3c25cab05190c193c22ff7d0abbabb3d",\n                "MacAddress": "02:42:ac:18:00:03",\n                "IPv4Address": "172.24.0.3/16",\n                "IPv6Address": ""\n            },\n            "5edae596d56ac74bdec3f5e3146565c23aed08ffeea87142cf273ad157a7ff00": {\n                "Name": "zabbix-zabbix-web-nginx-mysql-1",\n                "EndpointID": "bb9d481d9fb914bc9e3712d7f4a8d313cec29a7414c49eb12a8520d9eb55eee4",\n                "MacAddress": "02:42:ac:18:00:06",\n                "IPv4Address": "172.24.0.6/16",\n                "IPv6Address": ""\n            },\n            "ae506163854ebc2748c5e625de932f5e87529f8fa029dd9c10c5e7cc1b143969": {\n                "Name": "zabbix-zabbix-mysql-1",\n                "EndpointID": "706e078dad8214c37d36b6313d8a50be387a38af761cb07e46bb8d04c5677a40",\n                "MacAddress": "02:42:ac:18:00:02",\n                "IPv4Address": "172.24.0.2/16",\n                "IPv6Address": ""\n            },\n            "be56ce541307761e2c231575b458e6c0fa5958d8bc3cf8e2ee818abd731bca2e": {\n                "Name": "zabbix-zabbix-server-mysql-1",\n                "EndpointID": "cbbb543cb3d7902a881d77d5363b9d3f2fe64495073ec4b93b9743cfe6dab302",\n                "MacAddress": "02:42:ac:18:00:05",\n                "IPv4Address": "172.24.0.5/16",\n                "IPv6Address": ""\n            },\n            "c3173e870b6b79f405787332ea9c14b54281c0e7b49f84e5f5a7b0fcf1c4e262": {\n                "Name": "zabbix-zabbix-java-gateway-1",\n                "EndpointID": "d97b2529ff621243311c2cd200615e5fd22d8aee45abf6f6ffde9d10ee7af8a2",\n                "MacAddress": "02:42:ac:18:00:04",\n                "IPv4Address": "172.24.0.4/16",\n                "IPv6Address": ""\n            }\n        },\n        "Options": {},\n        "Labels": {\n            "com.docker.compose.network": "zabbix_net",\n            "com.docker.compose.project": "zabbix",\n            "com.docker.compose.version": "2.5.0"\n        }\n    }\n]\n\n[root@manager3 zabbix]# docker volume ls\nDRIVER    VOLUME NAME\nlocal     zabbix_zabbix-server-vol\n[root@manager3 zabbix]# docker volume inspect zabbix_zabbix-server-vol\n[\n    {\n        "CreatedAt": "2022-05-16T10:37:32+08:00",\n        "Driver": "local",\n        "Labels": {\n            "com.docker.compose.project": "zabbix",\n            "com.docker.compose.version": "2.5.0",\n            "com.docker.compose.volume": "zabbix-server-vol"\n        },\n        "Mountpoint": "/var/lib/docker/volumes/zabbix_zabbix-server-vol/_data",\n        "Name": "zabbix_zabbix-server-vol",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n')])])]),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"http://192.168.217.5:8080/zabbix",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://192.168.217.5:8080/zabbix"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[e._v("Admin:zabbix")])])]),e._v(" "),a("li",[a("p",[e._v("docker inspect zabbix-zabbix-server-mysql-1")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager3 zabbix]# docker inspect zabbix-zabbix-server-mysql-1\n[\n    {\n        "Id": "be56ce541307761e2c231575b458e6c0fa5958d8bc3cf8e2ee818abd731bca2e",\n        "Created": "2022-05-16T02:35:04.735227182Z",\n        "Path": "/sbin/tini",\n        "Args": [\n            "--",\n            "/usr/bin/docker-entrypoint.sh",\n            "/usr/sbin/zabbix_server",\n            "--foreground",\n            "-c",\n            "/etc/zabbix/zabbix_server.conf"\n        ],\n        "State": {\n            "Status": "running",\n            "Running": true,\n            "Paused": false,\n            "Restarting": false,\n            "OOMKilled": false,\n            "Dead": false,\n            "Pid": 14795,\n            "ExitCode": 0,\n            "Error": "",\n            "StartedAt": "2022-05-16T02:35:08.919402675Z",\n            "FinishedAt": "0001-01-01T00:00:00Z"\n        },\n        "Image": "sha256:da5a144a3d6dbc46c629cf8866fc73ccc7c91400c09d8607519c081801411d15",\n        "ResolvConfPath": "/var/lib/docker/containers/be56ce541307761e2c231575b458e6c0fa5958d8bc3cf8e2ee818abd731bca2e/resolv.conf",\n        "HostnamePath": "/var/lib/docker/containers/be56ce541307761e2c231575b458e6c0fa5958d8bc3cf8e2ee818abd731bca2e/hostname",\n        "HostsPath": "/var/lib/docker/containers/be56ce541307761e2c231575b458e6c0fa5958d8bc3cf8e2ee818abd731bca2e/hosts",\n        "LogPath": "/var/lib/docker/containers/be56ce541307761e2c231575b458e6c0fa5958d8bc3cf8e2ee818abd731bca2e/be56ce541307761e2c231575b458e6c0fa5958d8bc3cf8e2ee818abd731bca2e-json.log",\n        "Name": "/zabbix-zabbix-server-mysql-1",\n        "RestartCount": 0,\n        "Driver": "overlay2",\n        "Platform": "linux",\n        "MountLabel": "",\n        "ProcessLabel": "",\n        "AppArmorProfile": "",\n        "ExecIDs": null,\n        "HostConfig": {\n            "Binds": [\n                "/etc/localtime:/etc/localtime:rw",\n                "/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts:rw"\n            ],\n            "ContainerIDFile": "",\n            "LogConfig": {\n                "Type": "json-file",\n                "Config": {}\n            },\n            "NetworkMode": "zabbix_zabbix_net",\n            "PortBindings": {\n                "10051/tcp": [\n                    {\n                        "HostIp": "",\n                        "HostPort": "10051"\n                    }\n                ]\n            },\n            "RestartPolicy": {\n                "Name": "always",\n                "MaximumRetryCount": 0\n            },\n            "AutoRemove": false,\n            "VolumeDriver": "",\n            "VolumesFrom": null,\n            "CapAdd": null,\n            "CapDrop": null,\n            "CgroupnsMode": "host",\n            "Dns": null,\n            "DnsOptions": null,\n            "DnsSearch": null,\n            "ExtraHosts": null,\n            "GroupAdd": null,\n            "IpcMode": "private",\n            "Cgroup": "",\n            "Links": null,\n            "OomScoreAdj": 0,\n            "PidMode": "",\n            "Privileged": false,\n            "PublishAllPorts": false,\n            "ReadonlyRootfs": false,\n            "SecurityOpt": null,\n            "UTSMode": "",\n            "UsernsMode": "",\n            "ShmSize": 67108864,\n            "Runtime": "runc",\n            "ConsoleSize": [\n                0,\n                0\n            ],\n            "Isolation": "",\n            "CpuShares": 0,\n            "Memory": 0,\n            "NanoCpus": 0,\n            "CgroupParent": "",\n            "BlkioWeight": 0,\n            "BlkioWeightDevice": null,\n            "BlkioDeviceReadBps": null,\n            "BlkioDeviceWriteBps": null,\n            "BlkioDeviceReadIOps": null,\n            "BlkioDeviceWriteIOps": null,\n            "CpuPeriod": 0,\n            "CpuQuota": 0,\n            "CpuRealtimePeriod": 0,\n            "CpuRealtimeRuntime": 0,\n            "CpusetCpus": "",\n            "CpusetMems": "",\n            "Devices": null,\n            "DeviceCgroupRules": null,\n            "DeviceRequests": null,\n            "KernelMemory": 0,\n            "KernelMemoryTCP": 0,\n            "MemoryReservation": 0,\n            "MemorySwap": 0,\n            "MemorySwappiness": null,\n            "OomKillDisable": false,\n            "PidsLimit": null,\n            "Ulimits": null,\n            "CpuCount": 0,\n            "CpuPercent": 0,\n            "IOMaximumIOps": 0,\n            "IOMaximumBandwidth": 0,\n            "Mounts": [\n                {\n                    "Type": "volume",\n                    "Source": "zabbix_zabbix-server-vol",\n                    "Target": "/etc/zabbix",\n                    "VolumeOptions": {}\n                }\n            ],\n            "MaskedPaths": [\n                "/proc/asound",\n                "/proc/acpi",\n                "/proc/kcore",\n                "/proc/keys",\n                "/proc/latency_stats",\n                "/proc/timer_list",\n                "/proc/timer_stats",\n                "/proc/sched_debug",\n                "/proc/scsi",\n                "/sys/firmware"\n            ],\n            "ReadonlyPaths": [\n                "/proc/bus",\n                "/proc/fs",\n                "/proc/irq",\n                "/proc/sys",\n                "/proc/sysrq-trigger"\n            ]\n        },\n        "GraphDriver": {\n            "Data": {\n                "LowerDir": "/var/lib/docker/overlay2/a0cf401bbdbf4dcb32dd7f60ddbe44b31dd3f7e5d8ddf11ffcf71c1cbc73bc51-init/diff:/var/lib/docker/overlay2/6258e28b823b4f33b356067408b9578d62c546e7286230df8b9bdfb9ce7baf4f/diff:/var/lib/docker/overlay2/58c5e75ed74b8ba99f6f9ced4171e57a8c9c8dad93d31346670756e0c9b77f7b/diff:/var/lib/docker/overlay2/a496045898bb6d5b3a991c508ece8e75cf72021f4801476c0c1178172bf31c51/diff:/var/lib/docker/overlay2/7124cc22fb0092c33720f960a9316355dc6fb10a028286d2393b73c661c8e500/diff",\n                "MergedDir": "/var/lib/docker/overlay2/a0cf401bbdbf4dcb32dd7f60ddbe44b31dd3f7e5d8ddf11ffcf71c1cbc73bc51/merged",\n                "UpperDir": "/var/lib/docker/overlay2/a0cf401bbdbf4dcb32dd7f60ddbe44b31dd3f7e5d8ddf11ffcf71c1cbc73bc51/diff",\n                "WorkDir": "/var/lib/docker/overlay2/a0cf401bbdbf4dcb32dd7f60ddbe44b31dd3f7e5d8ddf11ffcf71c1cbc73bc51/work"\n            },\n            "Name": "overlay2"\n        },\n        "Mounts": [\n            {\n                "Type": "volume",\n                "Name": "zabbix_zabbix-server-vol",\n                "Source": "/var/lib/docker/volumes/zabbix_zabbix-server-vol/_data",\n                "Destination": "/etc/zabbix",\n                "Driver": "local",\n                "Mode": "z",\n                "RW": true,\n                "Propagation": ""\n            },\n            {\n                "Type": "volume",\n                "Name": "a44ba1fda704100a630ea0dbbf692d18f721988f9c57a7181c58db0c3408036e",\n                "Source": "/var/lib/docker/volumes/a44ba1fda704100a630ea0dbbf692d18f721988f9c57a7181c58db0c3408036e/_data",\n                "Destination": "/var/lib/zabbix/snmptraps",\n                "Driver": "local",\n                "Mode": "",\n                "RW": true,\n                "Propagation": ""\n            },\n            {\n                "Type": "volume",\n                "Name": "75ce4556e36592d50cbed272c36ee7167ed517d84fb48257b1f12f3ada948b42",\n                "Source": "/var/lib/docker/volumes/75ce4556e36592d50cbed272c36ee7167ed517d84fb48257b1f12f3ada948b42/_data",\n                "Destination": "/var/lib/zabbix/export",\n                "Driver": "local",\n                "Mode": "",\n                "RW": true,\n                "Propagation": ""\n            },\n            {\n                "Type": "bind",\n                "Source": "/etc/localtime",\n                "Destination": "/etc/localtime",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            },\n            {\n                "Type": "bind",\n                "Source": "/usr/lib/zabbix/alertscripts",\n                "Destination": "/usr/lib/zabbix/alertscripts",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            }\n        ],\n        "Config": {\n            "Hostname": "be56ce541307",\n            "Domainname": "",\n            "User": "1997",\n            "AttachStdin": false,\n            "AttachStdout": true,\n            "AttachStderr": true,\n            "ExposedPorts": {\n                "10051/tcp": {}\n            },\n            "Tty": false,\n            "OpenStdin": false,\n            "StdinOnce": false,\n            "Env": [\n                "ZBX_JAVAGATEWAY_ENABLE=\\"true\\"",\n                "ZBX_JAVAGATEWAYPORT=10052",\n                "DB_SERVER_HOST=zabbix-mysql",\n                "MYSQL_DATABASE=zabbix",\n                "MYSQL_USER=zabbix",\n                "MYSQL_PASSWORD=zabbix123",\n                "MYSQL_ROOT_PASSWORD=root123",\n                "ZBX_JAVAGATEWAY=zabbix-java-gateway",\n                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",\n                "TINI_VERSION=v0.19.0",\n                "TERM=xterm",\n                "MIBDIRS=/usr/share/snmp/mibs:/var/lib/zabbix/mibs",\n                "MIBS=+ALL",\n                "ZBX_VERSION=5.2.4",\n                "ZBX_SOURCES=https://git.zabbix.com/scm/zbx/zabbix.git"\n            ],\n            "Cmd": [\n                "/usr/sbin/zabbix_server",\n                "--foreground",\n                "-c",\n                "/etc/zabbix/zabbix_server.conf"\n            ],\n            "Image": "zabbix/zabbix-server-mysql:centos-5.2.4",\n            "Volumes": {\n                "/etc/localtime": {},\n                "/etc/zabbix": {},\n                "/usr/lib/zabbix/alertscripts": {},\n                "/var/lib/zabbix/export": {},\n                "/var/lib/zabbix/snmptraps": {}\n            },\n            "WorkingDir": "/var/lib/zabbix",\n            "Entrypoint": [\n                "/sbin/tini",\n                "--",\n                "/usr/bin/docker-entrypoint.sh"\n            ],\n            "OnBuild": null,\n            "Labels": {\n                "com.docker.compose.config-hash": "8073bebcfce6c6c0a4eda8d202d0d5783b5a9f3669f4fd770ee3165bc442a4c7",\n                "com.docker.compose.container-number": "1",\n                "com.docker.compose.depends_on": "zabbix-mysql:service_started",\n                "com.docker.compose.image": "sha256:da5a144a3d6dbc46c629cf8866fc73ccc7c91400c09d8607519c081801411d15",\n                "com.docker.compose.oneoff": "False",\n                "com.docker.compose.project": "zabbix",\n                "com.docker.compose.project.config_files": "/root/docker/zabbix/docker-compose.yml",\n                "com.docker.compose.project.working_dir": "/root/docker/zabbix",\n                "com.docker.compose.service": "zabbix-server-mysql",\n                "com.docker.compose.version": "2.5.0",\n                "org.label-schema.build-date": "20201204",\n                "org.label-schema.license": "GPLv2",\n                "org.label-schema.name": "CentOS Base Image",\n                "org.label-schema.schema-version": "1.0",\n                "org.label-schema.vendor": "CentOS",\n                "org.opencontainers.image.authors": "Alexey Pustovalov <alexey.pustovalov@zabbix.com>",\n                "org.opencontainers.image.description": "Zabbix server with MySQL database support",\n                "org.opencontainers.image.documentation": "https://www.zabbix.com/documentation/5.2/manual/installation/containers",\n                "org.opencontainers.image.licenses": "GPL v2.0",\n                "org.opencontainers.image.source": "https://git.zabbix.com/scm/zbx/zabbix.git",\n                "org.opencontainers.image.title": "Zabbix server (MySQL)",\n                "org.opencontainers.image.url": "https://zabbix.com/",\n                "org.opencontainers.image.vendor": "Zabbix LLC",\n                "org.opencontainers.image.version": "5.2.4"\n            },\n            "StopSignal": "SIGTERM"\n        },\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "a3d408075ce3d790002ad0ee0fba7ddc74f98f58cc0d754f864ccfc7daf1b4c3",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {\n                "10051/tcp": [\n                    {\n                        "HostIp": "0.0.0.0",\n                        "HostPort": "10051"\n                    },\n                    {\n                        "HostIp": "::",\n                        "HostPort": "10051"\n                    }\n                ]\n            },\n            "SandboxKey": "/var/run/docker/netns/a3d408075ce3",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "",\n            "Gateway": "",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "",\n            "IPPrefixLen": 0,\n            "IPv6Gateway": "",\n            "MacAddress": "",\n            "Networks": {\n                "zabbix_zabbix_net": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "zabbix-zabbix-server-mysql-1",\n                        "zabbix-server-mysql",\n                        "be56ce541307"\n                    ],\n                    "NetworkID": "7d9d9358e4ab0c45ae081ca945424eb92e8e300b554b3de8c25ebd29f320665f",\n                    "EndpointID": "cbbb543cb3d7902a881d77d5363b9d3f2fe64495073ec4b93b9743cfe6dab302",\n                    "Gateway": "172.24.0.1",\n                    "IPAddress": "172.24.0.5",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:18:00:05",\n                    "DriverOpts": null\n                }\n            }\n        }\n    }\n]\n')])])]),a("ul",[a("li",[e._v("zabbix-zabbix-mysql-1")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager3 zabbix]# docker inspect zabbix-zabbix-mysql-1\n[\n    {\n        "Id": "ae506163854ebc2748c5e625de932f5e87529f8fa029dd9c10c5e7cc1b143969",\n        "Created": "2022-05-16T02:35:04.511742468Z",\n        "Path": "docker-entrypoint.sh",\n        "Args": [\n            "mysqld",\n            "--default-authentication-plugin=mysql_native_password",\n            "--character-set-server=utf8",\n            "--collation-server=utf8_bin"\n        ],\n        "State": {\n            "Status": "running",\n            "Running": true,\n            "Paused": false,\n            "Restarting": false,\n            "OOMKilled": false,\n            "Dead": false,\n            "Pid": 14563,\n            "ExitCode": 0,\n            "Error": "",\n            "StartedAt": "2022-05-16T02:35:07.097629925Z",\n            "FinishedAt": "0001-01-01T00:00:00Z"\n        },\n        "Image": "sha256:cbe8815cbea8fb86ce7d3169a82d05301e7dfe1a8d4228941f23f4f115a887f2",\n        "ResolvConfPath": "/var/lib/docker/containers/ae506163854ebc2748c5e625de932f5e87529f8fa029dd9c10c5e7cc1b143969/resolv.conf",\n        "HostnamePath": "/var/lib/docker/containers/ae506163854ebc2748c5e625de932f5e87529f8fa029dd9c10c5e7cc1b143969/hostname",\n        "HostsPath": "/var/lib/docker/containers/ae506163854ebc2748c5e625de932f5e87529f8fa029dd9c10c5e7cc1b143969/hosts",\n        "LogPath": "/var/lib/docker/containers/ae506163854ebc2748c5e625de932f5e87529f8fa029dd9c10c5e7cc1b143969/ae506163854ebc2748c5e625de932f5e87529f8fa029dd9c10c5e7cc1b143969-json.log",\n        "Name": "/zabbix-zabbix-mysql-1",\n        "RestartCount": 0,\n        "Driver": "overlay2",\n        "Platform": "linux",\n        "MountLabel": "",\n        "ProcessLabel": "",\n        "AppArmorProfile": "",\n        "ExecIDs": null,\n        "HostConfig": {\n            "Binds": [\n                "/dockerdata/zabbix/db:/var/lib/mysql:rw",\n                "/etc/localtime:/etc/localtime:rw"\n            ],\n            "ContainerIDFile": "",\n            "LogConfig": {\n                "Type": "json-file",\n                "Config": {}\n            },\n            "NetworkMode": "zabbix_zabbix_net",\n            "PortBindings": {\n                "3306/tcp": [\n                    {\n                        "HostIp": "",\n                        "HostPort": "3306"\n                    }\n                ]\n            },\n            "RestartPolicy": {\n                "Name": "unless-stopped",\n                "MaximumRetryCount": 0\n            },\n            "AutoRemove": false,\n            "VolumeDriver": "",\n            "VolumesFrom": null,\n            "CapAdd": null,\n            "CapDrop": null,\n            "CgroupnsMode": "host",\n            "Dns": null,\n            "DnsOptions": null,\n            "DnsSearch": null,\n            "ExtraHosts": null,\n            "GroupAdd": null,\n            "IpcMode": "private",\n            "Cgroup": "",\n            "Links": null,\n            "OomScoreAdj": 0,\n            "PidMode": "",\n            "Privileged": false,\n            "PublishAllPorts": false,\n            "ReadonlyRootfs": false,\n            "SecurityOpt": null,\n            "UTSMode": "",\n            "UsernsMode": "",\n            "ShmSize": 67108864,\n            "Runtime": "runc",\n            "ConsoleSize": [\n                0,\n                0\n            ],\n            "Isolation": "",\n            "CpuShares": 0,\n            "Memory": 0,\n            "NanoCpus": 0,\n            "CgroupParent": "",\n            "BlkioWeight": 0,\n            "BlkioWeightDevice": null,\n            "BlkioDeviceReadBps": null,\n            "BlkioDeviceWriteBps": null,\n            "BlkioDeviceReadIOps": null,\n            "BlkioDeviceWriteIOps": null,\n            "CpuPeriod": 0,\n            "CpuQuota": 0,\n            "CpuRealtimePeriod": 0,\n            "CpuRealtimeRuntime": 0,\n            "CpusetCpus": "",\n            "CpusetMems": "",\n            "Devices": null,\n            "DeviceCgroupRules": null,\n            "DeviceRequests": null,\n            "KernelMemory": 0,\n            "KernelMemoryTCP": 0,\n            "MemoryReservation": 0,\n            "MemorySwap": 0,\n            "MemorySwappiness": null,\n            "OomKillDisable": false,\n            "PidsLimit": null,\n            "Ulimits": null,\n            "CpuCount": 0,\n            "CpuPercent": 0,\n            "IOMaximumIOps": 0,\n            "IOMaximumBandwidth": 0,\n            "MaskedPaths": [\n                "/proc/asound",\n                "/proc/acpi",\n                "/proc/kcore",\n                "/proc/keys",\n                "/proc/latency_stats",\n                "/proc/timer_list",\n                "/proc/timer_stats",\n                "/proc/sched_debug",\n                "/proc/scsi",\n                "/sys/firmware"\n            ],\n            "ReadonlyPaths": [\n                "/proc/bus",\n                "/proc/fs",\n                "/proc/irq",\n                "/proc/sys",\n                "/proc/sysrq-trigger"\n            ]\n        },\n        "GraphDriver": {\n            "Data": {\n                "LowerDir": "/var/lib/docker/overlay2/9753b7bed1fd9c58f490d36740b03192a6326be7fdfe6ea38dd2c38f231a1428-init/diff:/var/lib/docker/overlay2/f8ae57da4a22ecd8523de2575bcb89d24bb8fa470c9f2d0377ea1f9e867db962/diff:/var/lib/docker/overlay2/a118ddc021e23fe1c5a73fc0d85feaea4d72107eb39125f55761d65f7cb3db82/diff:/var/lib/docker/overlay2/90fb880199885e35a69ee3f9e752cb3773d00d3c7a18b8cccccea9790bbf54c5/diff:/var/lib/docker/overlay2/0b95c0674aab9d817f7679014252d94741d21e6e68be78adda078271f98be3db/diff:/var/lib/docker/overlay2/39c7c915a61167c256a76e9d02c9652ccf3a781045445681de3bca1ca39d1b58/diff:/var/lib/docker/overlay2/12c95016eaef20ced58f41cdb16bd1697c29cc8970f52367f25e5934be5fdf06/diff:/var/lib/docker/overlay2/cd6217c7ef0de0d5566280a59c2dfd56bf0129f1b488218c4f2f82545469847b/diff:/var/lib/docker/overlay2/21a060cd688cfddbed9b857fac451504e5a7f6dbd9bed456357cdd8bbff86454/diff:/var/lib/docker/overlay2/5ea6043aef32bf37686be9a85ee0efd23147238e6f6ee98149ac70520d49b7b3/diff:/var/lib/docker/overlay2/4ddf5d50f90770f84a9e5764e8e376a2cc3c7b762a064ebde49499b58f4a8453/diff:/var/lib/docker/overlay2/20ec1f566fcb5cbc6c7871b06146ae2945546d4e0bf49e1fada34ce527bcca5e/diff:/var/lib/docker/overlay2/e64f5e9972eabc919e9ac1463b244121f42570cd06b9a5b058d881c039d44848/diff",\n                "MergedDir": "/var/lib/docker/overlay2/9753b7bed1fd9c58f490d36740b03192a6326be7fdfe6ea38dd2c38f231a1428/merged",\n                "UpperDir": "/var/lib/docker/overlay2/9753b7bed1fd9c58f490d36740b03192a6326be7fdfe6ea38dd2c38f231a1428/diff",\n                "WorkDir": "/var/lib/docker/overlay2/9753b7bed1fd9c58f490d36740b03192a6326be7fdfe6ea38dd2c38f231a1428/work"\n            },\n            "Name": "overlay2"\n        },\n        "Mounts": [\n            {\n                "Type": "bind",\n                "Source": "/dockerdata/zabbix/db",\n                "Destination": "/var/lib/mysql",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            },\n            {\n                "Type": "bind",\n                "Source": "/etc/localtime",\n                "Destination": "/etc/localtime",\n                "Mode": "rw",\n                "RW": true,\n                "Propagation": "rprivate"\n            }\n        ],\n        "Config": {\n            "Hostname": "ae506163854e",\n            "Domainname": "",\n            "User": "",\n            "AttachStdin": false,\n            "AttachStdout": true,\n            "AttachStderr": true,\n            "ExposedPorts": {\n                "3306/tcp": {},\n                "33060/tcp": {}\n            },\n            "Tty": false,\n            "OpenStdin": false,\n            "StdinOnce": false,\n            "Env": [\n                "MYSQL_PASSWORD=zabbix123",\n                "MYSQL_ROOT_PASSWORD=root123",\n                "MYSQL_DATABASE=zabbix",\n                "MYSQL_USER=zabbix",\n                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",\n                "GOSU_VERSION=1.12",\n                "MYSQL_MAJOR=8.0",\n                "MYSQL_VERSION=8.0.23-1debian10"\n            ],\n            "Cmd": [\n                "mysqld",\n                "--default-authentication-plugin=mysql_native_password",\n                "--character-set-server=utf8",\n                "--collation-server=utf8_bin"\n            ],\n            "Image": "mysql:8.0.23",\n            "Volumes": {\n                "/etc/localtime": {},\n                "/var/lib/mysql": {}\n            },\n            "WorkingDir": "",\n            "Entrypoint": [\n                "docker-entrypoint.sh"\n            ],\n            "OnBuild": null,\n            "Labels": {\n                "com.docker.compose.config-hash": "8841a9110235d3274f9dd41576b4363b1a34ff7d2a4ee751d74113a2912d1d88",\n                "com.docker.compose.container-number": "1",\n                "com.docker.compose.depends_on": "",\n                "com.docker.compose.image": "sha256:cbe8815cbea8fb86ce7d3169a82d05301e7dfe1a8d4228941f23f4f115a887f2",\n                "com.docker.compose.oneoff": "False",\n                "com.docker.compose.project": "zabbix",\n                "com.docker.compose.project.config_files": "/root/docker/zabbix/docker-compose.yml",\n                "com.docker.compose.project.working_dir": "/root/docker/zabbix",\n                "com.docker.compose.service": "zabbix-mysql",\n                "com.docker.compose.version": "2.5.0"\n            }\n        },\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "b2938505356551da7493f0d8671b315c728d4ec0a7fbaadc0a44ed517dc1053e",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {\n                "3306/tcp": [\n                    {\n                        "HostIp": "0.0.0.0",\n                        "HostPort": "3306"\n                    },\n                    {\n                        "HostIp": "::",\n                        "HostPort": "3306"\n                    }\n                ],\n                "33060/tcp": null\n            },\n            "SandboxKey": "/var/run/docker/netns/b29385053565",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "",\n            "Gateway": "",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "",\n            "IPPrefixLen": 0,\n            "IPv6Gateway": "",\n            "MacAddress": "",\n            "Networks": {\n                "zabbix_zabbix_net": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": [\n                        "zabbix-zabbix-mysql-1",\n                        "zabbix-mysql",\n                        "ae506163854e"\n                    ],\n                    "NetworkID": "7d9d9358e4ab0c45ae081ca945424eb92e8e300b554b3de8c25ebd29f320665f",\n                    "EndpointID": "706e078dad8214c37d36b6313d8a50be387a38af761cb07e46bb8d04c5677a40",\n                    "Gateway": "172.24.0.1",\n                    "IPAddress": "172.24.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:18:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n    }\n]\n')])])]),a("h5",{attrs:{id:"方式一-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方式一-2"}},[e._v("#")]),e._v(" 方式一")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/lz1996/p/12625349.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("基于 Docker 安装 zabbix"),a("OutboundLink")],1)])]),e._v(" "),a("h6",{attrs:{id:"下载镜像-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像-2"}},[e._v("#")]),e._v(" 下载镜像")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 1、下载载MySQL镜像mysql:5.7\n[root@manager1 ~]# docker pull mysql:5.7\n# 2、下载zabbix-server镜像，zabbix-server镜像分两种，支持MySQL数据库zabbix-server-mysql，支持支持PostgreSQL数据库zabbix/zabbix-server-pgsql。因为我的服务器是centos7版本，所以选择的是centos-latest版本。\n[root@manager1 ~]# docker pull zabbix/zabbix-server-mysql:centos-latest\n# 3、下载Zabbix web镜像，这里使用的是基于Nginx web服务器及支持MySQL数据库的Zabbix web接口zabbix/zabbix-web-nginx-mysql。\n[root@manager1 ~]# docker pull zabbix/zabbix-web-nginx-mysql:latest\n# 4、下载zabbix-java-gateway镜像， Zabbix本身不支持直接监控Java，而是使用zabbix-java-gateway监控jvm/tomcat性能\n[root@manager1 ~]# docker pull zabbix/zabbix-java-gateway:latest\n[root@manager1 ~]# docker image ls\nREPOSITORY                      TAG             IMAGE ID       CREATED      SIZE\nzabbix/zabbix-web-nginx-mysql   latest          67f384410b88   3 days ago   196MB\nzabbix/zabbix-server-mysql      centos-latest   2e63d22d3e2a   3 days ago   503MB\nzabbix/zabbix-java-gateway      latest          451175797d22   3 days ago   84.4MB\nmysql                           5.7             a3d35804fa37   3 days ago   462MB\n")])])]),a("h6",{attrs:{id:"运行镜像-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行镜像-2"}},[e._v("#")]),e._v(" 运行镜像")]),e._v(" "),a("ol",[a("li",[e._v("启动zabbix等镜像之前，需要先创建一个新的 Docker 网络。需要将后面的zabbix-server、mysql、web等容器都加入到此网络中，方便互相访问。在终端使用下面命令创建。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker network create --driver bridge zabbix_net\nb3980d5ceea361ff99eac31ecf92dea24d3b8d33dbfb43f58f0a2bffd827c2e6\n# 创建后，可以查看是否创建成功。\n[root@manager1 ~]# docker network ls \nNETWORK ID     NAME              DRIVER    SCOPE\nb3980d5ceea3   zabbix_net        bridge    local\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[e._v("运行mysql 镜像，创建mysql容器。\n"),a("ul",[a("li",[e._v("-p 是将容器中的3306端口映射到服务器的3306端口")]),e._v(" "),a("li",[e._v("--network zabbix_net是将容器加入到zabbix_net网络中，")]),e._v(" "),a("li",[e._v("-v /etc/localtime:/etc/localtime是同步服务器和容器内部的时区，")]),e._v(" "),a("li",[e._v("--restart always设置自启动，")]),e._v(" "),a("li",[e._v('-e MYSQL_DATABASE="zabbix"，创建环境变量。\n'),a("ol",[a("li",[e._v('MYSQL_DATABASE="zabbix" 在msql中创建的数据库的名')]),e._v(" "),a("li",[e._v('MYSQL_USER="zabbix" 创建msql的登录账户名')]),e._v(" "),a("li",[e._v('MYSQL_PASSWORD="zabbix123" 设置创建msql的登录账户的密码')]),e._v(" "),a("li",[e._v('MYSQL_ROOT_PASSWORD="root123" 设置msql数据库root 的密码')])])]),e._v(" "),a("li",[e._v("--name zabbix-mysql，给容器命名。")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager1 ~]# docker run -dit -p 3306:3306 --name zabbix-mysql --network zabbix_net --restart always -v /etc/localtime:/etc/localtime -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" mysql:5.7\n2c8d55a9119cddfc8a7f915ce7c89665850d612b139ae568b1862d0a56d957d8\n[root@manager1 ~]# ll /etc/localtime \nlrwxrwxrwx. 1 root root 35 Sep  4  2021 /etc/localtime -> ../usr/share/zoneinfo/Asia/Shanghai\n')])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("运行zabbix-java-gateway镜像，创建zabbix-java-gateway容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@manager1 ~]# docker run -v /etc/localtime:/etc/localtime -dit --restart=always --name=zabbix-java-gateway --network zabbix_net zabbix/zabbix-java-gateway:latest\n1ebabb84cafa6382aba0dafda6ca84a1b6815364bb10b5c11f9105bcdf1c9cf0\nERRO[0011] error waiting for container: context canceled \n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("运行zabbix-server-mysql镜像，创建zabbix-server-mysql容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 首先创建数据卷zabbix-server-vol，通过命令\n[root@manager1 ~]# docker volume create zabbix-server-vol\nzabbix-server-vol\n# 启动zabbix-server-mysql容器。\n[root@manager1 ~]# docker run -dit -p 10051:10051 --mount source=zabbix-server-vol,target=/etc/zabbix -v /etc/localtime:/etc/localtime -v /usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts --name=zabbix-server-mysql --restart=always --network zabbix_net -e DB_SERVER_HOST="zabbix-mysql" -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" -e ZBX_JAVAGATEWAY="zabbix-java-gateway" zabbix/zabbix-server-mysql:centos-latest\nd0716bbd7f631807272b869ab1fb3dff4cdb47e370a0b1d4665c6414c4f99060\nERRO[0008] error waiting for container: context canceled \n')])])]),a("ol",{attrs:{start:"5"}},[a("li",[e._v("运行zabbix-web-nginx-mysql镜像，创建zabbix-web-nginx-mysql容器。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@manager1 ~]# docker run -dit -p 8080:8080 -v /etc/localtime:/etc/localtime --name zabbix-web-nginx-mysql --restart=always --network zabbix_net -e DB_SERVER_HOST="zabbix-mysql" -e MYSQL_DATABASE="zabbix" -e MYSQL_USER="zabbix" -e MYSQL_PASSWORD="zabbix123" -e MYSQL_ROOT_PASSWORD="root123" -e ZBX_SERVER_HOST="zabbix-server-mysql" zabbix/zabbix-web-nginx-mysql:latest\n34a278e54019398a65103a12a3f71a2d701f70c94a42a67f41a5b73c561ddd4e\n[root@manager1 ~]# docker ps\nCONTAINER ID   IMAGE                                      COMMAND                  CREATED              STATUS                         PORTS                                                  NAMES\n34a278e54019   zabbix/zabbix-web-nginx-mysql:latest       "docker-entrypoint.sh"   About a minute ago   Up 52 seconds                  0.0.0.0:8080->8080/tcp, :::8080->8080/tcp, 8443/tcp    zabbix-web-nginx-mysql\nd0716bbd7f63   zabbix/zabbix-server-mysql:centos-latest   "/usr/bin/tini -- /u…"   6 minutes ago        Restarting (1) 9 seconds ago                                                          zabbix-server-mysql\n1ebabb84cafa   zabbix/zabbix-java-gateway:latest          "docker-entrypoint.s…"   18 minutes ago       Up 17 minutes                  10052/tcp                                              zabbix-java-gateway\n2c8d55a9119c   mysql:5.7                                  "docker-entrypoint.s…"   25 minutes ago       Up 25 minutes                  0.0.0.0:3306->3306/tcp, :::3306->3306/tcp, 33060/tcp   zabbix-mysql\n')])])]),a("ol",{attrs:{start:"6"}},[a("li",[e._v("在浏览器中输入http://IP/zabbix，打开zabbix首页，其中用户名密码分别是admin/zabbix。\n"),a("ul",[a("li",[e._v("http://192.168.217.3:8080/zabbix\n"),a("ul",[a("li",[e._v("admin/zabbix")])])])])])]),e._v(" "),a("h4",{attrs:{id:"minio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#minio"}},[e._v("#")]),e._v(" MinIO")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://note.youdao.com/s/7dlR8i3n",target:"_blank",rel:"noopener noreferrer"}},[e._v("MinIO教程"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/r/minio/minio",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://hub.docker.com/r/minio/minios"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/yangkuo024/article/details/120134202",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker安装minio（最新版）-避坑"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('1. 拉取docker镜像\n[root@SystemFramework ~]# docker pull minio/minio\n2. 创建文件路径\n[root@SystemFramework ~]# mkdir -p /mydata/docker_minio/{data,config}\n\n3. 启动服务：注意，这里要单独设置console的端口，不然会报错，且无法访问\n[root@SystemFramework ~]# \ndocker run -d --name minio105 \\\n-p 9000:9000 -p 9001:9001 \\\n--restart=always \\\n-e "MINIO_ACCESS_KEY=admin" -e "MINIO_SECRET_KEY=admin123" \\\n-v /mydata/docker_minio/data:/data -v /mydata/docker_minio/config:/root/.minio \\\nminio/minio server /data \\\n--console-address ":9001"\n\n5. 浏览器访问：注意—>此处的端口，是你设置的console的端口：9999\n- http://192.168.56.107:9001\n\t- admin admin123\n')])])]),a("h4",{attrs:{id:"fastdfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fastdfs"}},[e._v("#")]),e._v(" FastDFS")]),e._v(" "),a("h5",{attrs:{id:"参考-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考-2"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/happyfish100/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方网站"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/happyfish100/fastdfs/wiki/",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置文档"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.oschina.net/question/tag/fastdfs",target:"_blank",rel:"noopener noreferrer"}},[e._v("参考资料"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/happyfish100/fastdfs-client-java",target:"_blank",rel:"noopener noreferrer"}},[e._v("Java客户端"),a("OutboundLink")],1)])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/provence666/p/10987156.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker 安装 FastDFS"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/386411711",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 安装 fastdfs"),a("OutboundLink")],1)])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/89922854",target:"_blank",rel:"noopener noreferrer"}},[e._v("基于Docker搭建分布式文件系统FastDfs"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://blog.csdn.net/qq_18671415/article/details/114867419",target:"_blank",rel:"noopener noreferrer"}},[e._v("docker 安装 FastDFS"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://blog.csdn.net/gymaisyl/article/details/84554986",target:"_blank",rel:"noopener noreferrer"}},[e._v("FastDFS 安装 -- 基于Docker使用,开启FastDFS的Tracker和Storage"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/e13c269def61",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用docker安装fastdfs"),a("OutboundLink")],1)])])]),e._v(" "),a("h5",{attrs:{id:"环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[e._v("#")]),e._v(" 环境")]),e._v(" "),a("ul",[a("li",[e._v("主机IP：172.16.6.89\n"),a("ul",[a("li",[e._v("VirtualBox 虚拟机CentOS7\n"),a("ul",[a("li",[e._v("虚拟机网络\n"),a("ul",[a("li",[e._v("网络地址转换（NAT）  端口转发 【java.net.SocketTimeoutException: connect timed out】\n"),a("ul",[a("li",[e._v("tracker:22122 8888 23000")])])]),e._v(" "),a("li",[e._v("仅主机（HOST-ONLY ）网络")])])])])])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker storage]# cat /etc/os-release \nNAME="CentOS Linux"\nVERSION="7 (Core)"\nID="centos"\nID_LIKE="rhel fedora"\nVERSION_ID="7"\nPRETTY_NAME="CentOS Linux 7 (Core)"\nANSI_COLOR="0;31"\nCPE_NAME="cpe:/o:centos:centos:7"\nHOME_URL="https://www.centos.org/"\nBUG_REPORT_URL="https://bugs.centos.org/"\n\nCENTOS_MANTISBT_PROJECT="CentOS-7"\nCENTOS_MANTISBT_PROJECT_VERSION="7"\nREDHAT_SUPPORT_PRODUCT="centos"\nREDHAT_SUPPORT_PRODUCT_VERSION="7"\n\n# 网络地址转换（NAT）\n[root@Docker ~]# ip address\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:06:95:01 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 83077sec preferred_lft 83077sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n\n# 仅主机（HOST-ONLY ）网络\n[root@CentOS-7 ~]# ip address\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:80:9b:a2 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.56.102/24 brd 192.168.56.255 scope global noprefixroute dynamic enp0s3\n       valid_lft 554sec preferred_lft 554sec\n    inet6 fe80::806f:eb6c:8c0f:1819/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n# 关闭防火墙\n[root@Docker storage]# systemctl stop firewalld  \n')])])]),a("h5",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),a("h6",{attrs:{id:"虚拟主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机"}},[e._v("#")]),e._v(" 虚拟主机")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 搜索镜像\n# https://hub.docker.com/search?q=fastdfs&type=image\n[root@Docker ~]# docker search fastdfs\nNAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nseason/fastdfs                 FastDFS                                         80                   \nygqygq2/fastdfs-nginx          整合了nginx的fastdfs                                28                   [OK]\nluhuiguo/fastdfs               FastDFS is an open source high performance d…   25                   [OK]\nmorunchang/fastdfs             A FastDFS image                                 20                   \ndelron/fastdfs                                                                 15                   \n\n# 拉取镜像\n# https://hub.docker.com/r/delron/fastdfs\n[root@Docker ~]# docker pull delron/fastdfs\nUsing default tag: latest\nlatest: Pulling from delron/fastdfs\n469cfcc7a4b3: Pull complete \n4b4f08bd0171: Pull complete \n95eef9978b96: Pull complete \naff83d00c747: Pull complete \n1e95dffa1075: Pull complete \nf114184ac28c: Pull complete \n649b2ad6afe2: Pull complete \n8ab2127a38c5: Pull complete \n4d12f9bd27c7: Pull complete \nbfc05d82f0a6: Pull complete \n76f2a6d84a19: Pull complete \n89bd9c4e6fea: Pull complete \n6c06548e40ac: Pull complete \n11186700b494: Pull complete \nDigest: sha256:9583cb80170c153bc12615fd077fe364a8fd5a95194b7cf9a8a32d2c11f8a49d\nStatus: Downloaded newer image for delron/fastdfs:latest\ndocker.io/delron/fastdfs:latest\n\n# 查看拉取的镜像\n[root@Docker ~]# docker images\nREPOSITORY          TAG       IMAGE ID       CREATED        SIZE\ndelron/fastdfs      latest    8487e86fc6ee   3 years ago    464\n\n# 使用docker镜像构建tracker容器（跟踪服务器，起到调度的作用）\n[root@CentOS-7 ~]# docker run -dti --network=host --name tracker -v /var/fdfs/tracker:/var/fdfs -v /etc/localtime:/etc/localtime delron/fastdfs tracker\n7dc6b6c231441398925950c4ab3839b7b9aa0e92de90cd10bb1f6cd83e2b6276\n\n# 使用docker镜像构建storage容器（存储服务器，提供容量和备份服务）\n# TRACKER_SERVER=本机的ip地址:22122 本机ip地址不要使用127.0.0.1\n[root@CentOS-7 ~]# docker run -dti --network=host --name storage -e TRACKER_SERVER=192.168.56.102:22122 -v /var/fdfs/storage:/var/fdfs  -v /etc/localtime:/etc/localtime delron/fastdfs storage\n34188ef60136bb4a6da788f676c5cb6c817ff8acefb8e9d5de7fe81b57776951\n")])])]),a("h6",{attrs:{id:"进入storage容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入storage容器"}},[e._v("#")]),e._v(" 进入storage容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('#到storage的配置文件中查看（配置）http访问的端口\n[root@CentOS-7 ~]# docker exec -it storage /bin/bash\n[root@CentOS-7 nginx-1.12.2]# cat /etc/fdfs/storage.conf\n# is this config file disabled\n# false for enabled\n# true for disabled\ndisabled=false\n\n# the name of the group this storage server belongs to\n#\n# comment or remove this item for fetching from tracker server,\n# in this case, use_storage_id must set to true in tracker.conf,\n# and storage_ids.conf must be configed correctly.\ngroup_name=group1\n\n# bind an address of this host\n# empty for bind all addresses of this host\nbind_addr=\n\n# if bind an address of this host when connect to other servers \n# (this storage server as a client)\n# true for binding the address configed by above parameter: "bind_addr"\n# false for binding any address of this host\nclient_bind=true\n\n# the storage server port\nport=23000\n\n# connect timeout in seconds\n# default value is 30s\nconnect_timeout=30\n\n# network timeout in seconds\n# default value is 30s\nnetwork_timeout=60\n\n# heart beat interval in seconds\nheart_beat_interval=30\n\n# disk usage report interval in seconds\nstat_report_interval=60\n\n# the base path to store data and log files\nbase_path=/var/fdfs\n\n# max concurrent connections the server supported\n# default value is 256\n# more max_connections means more memory will be used\nmax_connections=256\n\n# the buff size to recv / send data\n# this parameter must more than 8KB\n# default value is 64KB\n# since V2.00\nbuff_size = 256KB\n\n# accept thread count\n# default value is 1\n# since V4.07\naccept_threads=1\n\n# work thread count, should <= max_connections\n# work thread deal network io\n# default value is 4\n# since V2.00\nwork_threads=4\n\n# if disk read / write separated\n##  false for mixed read and write\n##  true for separated read and write\n# default value is true\n# since V2.00\ndisk_rw_separated = true\n\n# disk reader thread count per store base path\n# for mixed read / write, this parameter can be 0\n# default value is 1\n# since V2.00\ndisk_reader_threads = 1\n\n# disk writer thread count per store base path\n# for mixed read / write, this parameter can be 0\n# default value is 1\n# since V2.00\ndisk_writer_threads = 1\n\n# when no entry to sync, try read binlog again after X milliseconds\n# must > 0, default value is 200ms\nsync_wait_msec=50\n\n# after sync a file, usleep milliseconds\n# 0 for sync successively (never call usleep)\nsync_interval=0\n\n# storage sync start time of a day, time format: Hour:Minute\n# Hour from 0 to 23, Minute from 0 to 59\nsync_start_time=00:00\n\n# storage sync end time of a day, time format: Hour:Minute\n# Hour from 0 to 23, Minute from 0 to 59\nsync_end_time=23:59\n\n# write to the mark file after sync N files\n# default value is 500\nwrite_mark_file_freq=500\n\n# path(disk or mount point) count, default value is 1\nstore_path_count=1\n\n# store_path#, based 0, if store_path0 not exists, it\'s value is base_path\n# the paths must be exist\nstore_path0=/var/fdfs\n#store_path1=/var/fdfs2\n\n# subdir_count  * subdir_count directories will be auto created under each \n# store_path (disk), value can be 1 to 256, default value is 256\nsubdir_count_per_path=256\n\n# tracker_server can ocur more than once, and tracker_server format is\n#  "host:port", host can be hostname or ip address\ntracker_server=192.168.56.102:22122\n\n#standard log level as syslog, case insensitive, value list:\n### emerg for emergency\n### alert\n### crit for critical\n### error\n### warn for warning\n### notice\n### info\n### debug\nlog_level=info\n\n#unix group name to run this program, \n#not set (empty) means run by the group of current user\nrun_by_group=\n\n#unix username to run this program,\n#not set (empty) means run by current user\nrun_by_user=\n\n# allow_hosts can ocur more than once, host can be hostname or ip address,\n# "*" (only one asterisk) means match all ip addresses\n# we can use CIDR ips like 192.168.5.64/26\n# and also use range like these: 10.0.1.[0-254] and host[01-08,20-25].domain.com\n# for example:\n# allow_hosts=10.0.1.[1-15,20]\n# allow_hosts=host[01-08,20-25].domain.com\n# allow_hosts=192.168.5.64/26\nallow_hosts=*\n\n# the mode of the files distributed to the data path\n# 0: round robin(default)\n# 1: random, distributted by hash code\nfile_distribute_path_mode=0\n\n# valid when file_distribute_to_path is set to 0 (round robin), \n# when the written file count reaches this number, then rotate to next path\n# default value is 100\nfile_distribute_rotate_count=100\n\n# call fsync to disk when write big file\n# 0: never call fsync\n# other: call fsync when written bytes >= this bytes\n# default value is 0 (never call fsync)\nfsync_after_written_bytes=0\n\n# sync log buff to disk every interval seconds\n# must > 0, default value is 10 seconds\nsync_log_buff_interval=10\n\n# sync binlog buff / cache to disk every interval seconds\n# default value is 60 seconds\nsync_binlog_buff_interval=10\n\n# sync storage stat info to disk every interval seconds\n# default value is 300 seconds\nsync_stat_file_interval=300\n\n# thread stack size, should >= 512KB\n# default value is 512KB\nthread_stack_size=512KB\n\n# the priority as a source server for uploading file.\n# the lower this value, the higher its uploading priority.\n# default value is 10\nupload_priority=10\n\n# the NIC alias prefix, such as eth in Linux, you can see it by ifconfig -a\n# multi aliases split by comma. empty value means auto set by OS type\n# default values is empty\nif_alias_prefix=\n\n# if check file duplicate, when set to true, use FastDHT to store file indexes\n# 1 or yes: need check\n# 0 or no: do not check\n# default value is 0\ncheck_file_duplicate=0\n\n# file signature method for check file duplicate\n## hash: four 32 bits hash code\n## md5: MD5 signature\n# default value is hash\n# since V4.01\nfile_signature_method=hash\n\n# namespace for storing file indexes (key-value pairs)\n# this item must be set when check_file_duplicate is true / on\nkey_namespace=FastDFS\n\n# set keep_alive to 1 to enable persistent connection with FastDHT servers\n# default value is 0 (short connection)\nkeep_alive=0\n\n# you can use "#include filename" (not include double quotes) directive to \n# load FastDHT server list, when the filename is a relative path such as \n# pure filename, the base path is the base path of current/this config file.\n# must set FastDHT server list when check_file_duplicate is true / on\n# please see INSTALL of FastDHT for detail\n##include /home/yuqing/fastdht/conf/fdht_servers.conf\n\n# if log to access log\n# default value is false\n# since V4.00\nuse_access_log = false\n\n# if rotate the access log every day\n# default value is false\n# since V4.00\nrotate_access_log = false\n\n# rotate access log time base, time format: Hour:Minute\n# Hour from 0 to 23, Minute from 0 to 59\n# default value is 00:00\n# since V4.00\naccess_log_rotate_time=00:00\n\n# if rotate the error log every day\n# default value is false\n# since V4.02\nrotate_error_log = false\n\n# rotate error log time base, time format: Hour:Minute\n# Hour from 0 to 23, Minute from 0 to 59\n# default value is 00:00\n# since V4.02\nerror_log_rotate_time=00:00\n\n# rotate access log when the log file exceeds this size\n# 0 means never rotates log file by log file size\n# default value is 0\n# since V4.02\nrotate_access_log_size = 0\n\n# rotate error log when the log file exceeds this size\n# 0 means never rotates log file by log file size\n# default value is 0\n# since V4.02\nrotate_error_log_size = 0\n\n# keep days of the log files\n# 0 means do not delete old log files\n# default value is 0\nlog_file_keep_days = 0\n\n# if skip the invalid record when sync file\n# default value is false\n# since V4.02\nfile_sync_skip_invalid_record=false\n\n# if use connection pool\n# default value is false\n# since V4.05\nuse_connection_pool = false\n\n# connections whose the idle time exceeds this time will be closed\n# unit: second\n# default value is 3600\n# since V4.05\nconnection_pool_max_idle_time = 3600\n\n# use the ip address of this storage server if domain_name is empty,\n# else this domain name will ocur in the url redirected by the tracker server\nhttp.domain_name=\n\n# the port of the web server on this storage server\nhttp.server_port=8888\n\n# 查看日志\n[root@CentOS-7 nginx-1.12.2]# tail -f /var/fdfs/logs/storaged.log \nmkdir data path: FB ...\nmkdir data path: FC ...\nmkdir data path: FD ...\nmkdir data path: FE ...\nmkdir data path: FF ...\ndata path: /var/fdfs/data, mkdir sub dir done.\n[2022-03-15 14:31:26] INFO - file: storage_param_getter.c, line: 191, use_storage_id=0, id_type_in_filename=ip, storage_ip_changed_auto_adjust=1, store_path=0, reserved_storage_space=10.00%, use_trunk_file=0, slot_min_size=256, slot_max_size=16 MB, trunk_file_size=64 MB, trunk_create_file_advance=0, trunk_create_file_time_base=02:00, trunk_create_file_interval=86400, trunk_create_file_space_threshold=20 GB, trunk_init_check_occupying=0, trunk_init_reload_from_binlog=0, trunk_compress_binlog_min_interval=0, store_slave_file_use_link=0\n[2022-03-15 14:31:26] INFO - file: storage_func.c, line: 257, tracker_client_ip: 192.168.56.102, my_server_id_str: 192.168.56.102, g_server_id_in_filename: 1714989248\n[2022-03-15 14:31:27] INFO - file: tracker_client_thread.c, line: 310, successfully connect to tracker server 192.168.56.102:22122, as a tracker client, my ip is 192.168.56.102\n[2022-03-15 14:31:57] INFO - file: tracker_client_thread.c, line: 1263, tracker server 192.168.56.102:22122, set tracker leader: 192.168.56.102:22122\n\n\n# 进入storage,查看（配置）nginx\n[root@CentOS-7 nginx-1.12.2]# cat /usr/local/nginx/conf/nginx.conf \n\n#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n\n#pid        logs/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n    #                  \'$status $body_bytes_sent "$http_referer" \'\n    #                  \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n\n    server {\n        listen       8888;\n        server_name  localhost;\n        location ~/group[0-9]/ {\n            ngx_fastdfs_module;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root html;\n        }\n    }\n\n\n    # another virtual host using mix of IP-, name-, and port-based configuration\n    #\n    #server {\n    #    listen       8000;\n    #    listen       somename:8080;\n    #    server_name  somename  alias  another.alias;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n\n    # HTTPS server\n    #\n    #server {\n    #    listen       443 ssl;\n    #    server_name  localhost;\n\n    #    ssl_certificate      cert.pem;\n    #    ssl_certificate_key  cert.key;\n\n    #    ssl_session_cache    shared:SSL:1m;\n    #    ssl_session_timeout  5m;\n\n    #    ssl_ciphers  HIGH:!aNULL:!MD5;\n    #    ssl_prefer_server_ciphers  on;\n\n    #    location / {\n    #        root   html;\n    #        index  index.html index.htm;\n    #    }\n    #}\n\n}\n\n# 测试上传文件\n## ONLY-HOST\n[root@CentOS-7 nginx-1.12.2]# cd /var/fdfs/\n[root@CentOS-7 fdfs]# wget https://tosinjia.github.io/assets/img/gitTutorial-1.5aedb74a.png\n--2022-03-15 14:35:54--  https://tosinjia.github.io/assets/img/gitTutorial-1.5aedb74a.png\nResolving tosinjia.github.io (tosinjia.github.io)... failed: Name or service not known.\nwget: unable to resolve host address \'tosinjia.github.io\'\n### sftp上传\n[root@CentOS-7 fdfs]# ll\n-rw-r--r--.   1 root root 47884 Mar 15 14:42 gitTutorial-1.5aedb74a.png\n[root@CentOS-7 fdfs]# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf gitTutorial-1.5aedb74a.png \ngroup1/M00/00/00/wKg4ZmIwNeqAOQV3AAC7DKpELK4856.png\n[root@CentOS-7 fdfs]# /usr/bin/fdfs_test /etc/fdfs/client.conf upload gitTutorial-1.5aedb74a.png\nThis is FastDFS client test program v5.11\n\nCopyright (C) 2008, Happy Fish / YuQing\n\nFastDFS may be copied only under the terms of the GNU General\nPublic License V3, which may be found in the FastDFS source kit.\nPlease visit the FastDFS Home Page http://www.csource.org/ \nfor more detail.\n\n[2022-03-15 14:46:06] DEBUG - base_path=/var/fdfs, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0\n\ntracker_query_storage_store_list_without_group: \n        server 1. group_name=, ip_addr=192.168.56.102, port=23000\n\ngroup_name=group1, ip_addr=192.168.56.102, port=23000\nstorage_upload_by_filename\ngroup_name=group1, remote_filename=M00/00/00/wKg4ZmIwNi6AFTz3AAC7DKpELK4735.png\nsource ip address: 192.168.56.102\nfile timestamp=2022-03-15 14:46:06\nfile size=47884\nfile crc32=2856594606\nexample file url: http://192.168.56.102/group1/M00/00/00/wKg4ZmIwNi6AFTz3AAC7DKpELK4735.png\nstorage_upload_slave_by_filename\ngroup_name=group1, remote_filename=M00/00/00/wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\nsource ip address: 192.168.56.102\nfile timestamp=2022-03-15 14:46:06\nfile size=47884\nfile crc32=2856594606\nexample file url: http://192.168.56.102/group1/M00/00/00/wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\n\n[root@CentOS-7 fdfs]# wget http://192.168.56.102:8888/group1/M00/00/00/wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\n--2022-03-15 14:48:15--  http://192.168.56.102:8888/group1/M00/00/00/wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\nConnecting to 192.168.56.102:8888... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 47884 (47K) [image/png]\nSaving to: \'wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\'\n\n100%[===================================================================================================================================================================================>] 47,884      --.-K/s   in 0s      \n\n2022-03-15 14:48:15 (204 MB/s) - \'wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\' saved [47884/47884]\n\n## NAT\n[root@Docker nginx-1.12.2]# cd /var/fdfs/\n[root@Docker fdfs]# wget https://tosinjia.github.io/assets/img/gitTutorial-1.5aedb74a.png\n\n[root@CentOS-7 fdfs]# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf gitTutorial-1.5aedb74a.png \n[2022-03-09 14:32:45] ERROR - file: connection_pool.c, line: 130, connect to 10.0.2.2:23000 fail, errno: 111, error info: Connection refused\nupload file fail, error no: 111, error info: Connection refused\n\n[root@Docker fdfs]# /usr/bin/fdfs_upload_file /etc/fdfs/client.conf gitTutorial-1.5aedb74a.png \ngroup1/M00/00/00/CgACD2IoH4OAb1s5AAC7DKpELK4099.png\n[root@CentOS-7 fdfs]# /usr/bin/fdfs_test /etc/fdfs/client.conf upload gitTutorial-1.5aedb74a.png\nThis is FastDFS client test program v5.11\n\nCopyright (C) 2008, Happy Fish / YuQing\n\nFastDFS may be copied only under the terms of the GNU General\nPublic License V3, which may be found in the FastDFS source kit.\nPlease visit the FastDFS Home Page http://www.csource.org/ \nfor more detail.\n\n[2022-03-15 10:15:26] DEBUG - base_path=/var/fdfs, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0\n\ntracker_query_storage_store_list_without_group: \n        server 1. group_name=, ip_addr=10.0.2.2, port=23000\n\ngroup_name=group1, ip_addr=10.0.2.2, port=23000\nstorage_upload_by_filename\ngroup_name=group1, remote_filename=M00/00/00/CgACD2Iv9r6AYpl6AAC7DKpELK4993.png\nsource ip address: 10.0.2.15\nfile timestamp=2022-03-15 10:15:26\nfile size=47884\nfile crc32=2856594606\nexample file url: http://10.0.2.2/group1/M00/00/00/CgACD2Iv9r6AYpl6AAC7DKpELK4993.png\nstorage_upload_slave_by_filename\ngroup_name=group1, remote_filename=M00/00/00/CgACD2Iv9r6AYpl6AAC7DKpELK4993_big.png\nsource ip address: 10.0.2.15\nfile timestamp=2022-03-15 10:15:26\nfile size=47884\nfile crc32=2856594606\nexample file url: http://10.0.2.2/group1/M00/00/00/CgACD2Iv9r6AYpl6AAC7DKpELK4993_big.png\n')])])]),a("h6",{attrs:{id:"虚拟主机-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机-2"}},[e._v("#")]),e._v(" 虚拟主机")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@CentOS-7 ~]# wget http://192.168.56.102:8888/group1/M00/00/00/wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\n\n[root@CentOS-7 ~]# tree /var/fdfs/tracker/\n/var/fdfs/tracker/\n├── data\n│   ├── fdfs_trackerd.pid\n│   ├── storage_changelog.dat\n│   ├── storage_groups_new.dat\n│   ├── storage_servers_new.dat\n│   └── storage_sync_timestamp.dat\n└── logs\n    └── trackerd.log\n\n[root@CentOS-7 ~]# tree /var/fdfs/storage/ -L 2\n/var/fdfs/storage/\n├── data\n│   ├── 00\n│   ├── 01\n│   ├── 02\n\n│   ├── FD\n│   ├── fdfs_storaged.pid\n│   ├── FE\n│   ├── FF\n│   ├── storage_stat.dat\n│   └── sync\n├── gitTutorial-1.5aedb74a.png\n├── logs\n│   └── storaged.log\n└── wKg4ZmIwNi6AFTz3AAC7DKpELK4735_big.png\n\n# 开机自启动\n[root@CentOS-7 ~]# docker container update tracker --restart=always\ntracker\n[root@CentOS-7 ~]# docker container update storage --restart=always\nstorage\n")])])]),a("h6",{attrs:{id:"代码验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代码验证"}},[e._v("#")]),e._v(" 代码验证")]),e._v(" "),a("ul",[a("li",[e._v("https://github.com/TosinJia/lyyzoo-fastdfs-java/blob/master/src/main/java/com/lyyzoo/fastdfs/TestFastDFS.java")])]),e._v(" "),a("h6",{attrs:{id:"问题处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题处理"}},[e._v("#")]),e._v(" 问题处理")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("上传测试失败")]),e._v(" "),a("ol",[a("li",[e._v("10.0.2.15图片上传测试成功")]),e._v(" "),a("li",[e._v("172.16.6.89访问图片异常，关闭防火墙后，测试成功")])])]),e._v(" "),a("li",[a("p",[e._v("storage 无法启动")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@CentOS-7 ~]# ll /var/fdfs/storage/logs/\ntotal 0\n[root@CentOS-7 ~]# touch /var/fdfs/storage/logs/storaged.log\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[e._v("开机自启动")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@CentOS-7 ~]# chmod +x /etc/rc.d/rc.local \n[root@CentOS-7 ~]# vim /etc/rc.d/rc.local    \n#!/bin/bash\n# THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES\n#\n# It is highly advisable to create own systemd services or udev rules\n# to run scripts during boot instead of using this file.\n#\n# In contrast to previous versions due to parallel execution during boot\n# this script will NOT be run after all other services.\n#\n# Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure\n# that this script will be executed during boot.\n# 1.storage container unable to start\n\ntouch /var/lock/subsys/local\ntouch /var/fdfs/storage/logs/storaged.log\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[e._v("java上传图片失败\n"),a("ul",[a("li",[e._v("调整虚拟机网络 HOST-ONLY")])])])]),e._v(" "),a("h5",{attrs:{id:"卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#卸载"}},[e._v("#")]),e._v(" 卸载")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker storage]# docker ps\nCONTAINER ID   IMAGE            COMMAND                  CREATED          STATUS          PORTS     NAMES\n5d12eb7cc860   delron/fastdfs   "/usr/bin/start1.sh …"   21 minutes ago   Up 21 minutes             storage\n82326d09f686   delron/fastdfs   "/usr/bin/start1.sh …"   22 minutes ago   Up 22 minutes             tracker\n[root@Docker storage]# docker stop tracker storage\ntracker\nstorage\n[root@Docker storage]# docker rm tracker storage    \ntracker\nstorage\n[root@Docker ~]# rm -rf /var/fdfs\n')])])]),a("h4",{attrs:{id:"maven私服"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#maven私服"}},[e._v("#")]),e._v(" Maven私服")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/u012943767/article/details/79475718",target:"_blank",rel:"noopener noreferrer"}},[e._v("使用Docker搭建Maven私服"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/z69183787/article/details/104754411",target:"_blank",rel:"noopener noreferrer"}},[e._v("Maven脚手架最佳实践"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/btt2013/article/details/125173893",target:"_blank",rel:"noopener noreferrer"}},[e._v("Maven之自定义archetype生成项目骨架(构建脚手架项目)"),a("OutboundLink")],1)])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker pull sonatype/nexus3\n [root@Docker ~]# docker run -di -p 8081:8081 --name inexus -v /root/nexus-data:/var/nexus-data --restart=always sonatype/nexus3\n[root@Docker ~]# docker exec -it inexus bash\nbash-4.4$ cat /nexus-data/admin.password\nf903e086-5b33-4743-b038-e30a6c6a0804\n")])])]),a("ul",[a("li",[e._v("http://192.168.56.106:8081\n"),a("ul",[a("li",[e._v("admin f903e086-5b33-4743-b038-e30a6c6a0804")]),e._v(" "),a("li",[e._v("admin admin")])])])]),e._v(" "),a("h3",{attrs:{id:"四-docker-最常用的镜像命令和容器命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-docker-最常用的镜像命令和容器命令"}},[e._v("#")]),e._v(" 四 Docker 最常用的镜像命令和容器命令")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("2021最新Docker入门到精通视频 14-28")])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker4.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 最常用的镜像命令和容器命令"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("https://docs.docker.com/reference/")])])]),e._v(" "),a("h4",{attrs:{id:"_1-镜像相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-镜像相关命令"}},[e._v("#")]),e._v(" 1 镜像相关命令")]),e._v(" "),a("h5",{attrs:{id:"_1-1-查看镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-查看镜像"}},[e._v("#")]),e._v(" 1.1 查看镜像")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED       SIZE\nhello-world   latest    feb5d9fea6a5   3 weeks ago   13.3kB\n")])])]),a("ul",[a("li",[e._v("REPOSITORY：镜像在仓库中的名称，本文中以后都简称镜像名称")]),e._v(" "),a("li",[e._v("TAG：镜像标签")]),e._v(" "),a("li",[e._v("IMAGE ID：镜像 ID")]),e._v(" "),a("li",[e._v("CREATED：镜像的创建日期（不是获取该镜像的日期）")]),e._v(" "),a("li",[e._v("SIZE：镜像大小")])]),e._v(" "),a("blockquote",[a("p",[e._v("这些镜像都是存储在 Docker 宿主机的 /var/lib/docker 目录下。")])]),e._v(" "),a("h5",{attrs:{id:"_1-2-搜索镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-搜索镜像"}},[e._v("#")]),e._v(" 1.2 搜索镜像")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# https://hub.docker.com/search?q=redis&type=image\n[root@Docker ~]# docker search redis\nNAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nredis                            Redis is an open source key-value store that…   10042     [OK]       \nsameersbn/redis                                                                  83                   [OK]\ngrokzen/redis-cluster            Redis cluster 3.0, 3.2, 4.0, 5.0, 6.0, 6.2      79                   \nrediscommander/redis-commander   Alpine image for redis-commander - Redis man…   66                   [OK]\nredislabs/redisearch             Redis With the RedisSearch module pre-loaded…   39                   \nredislabs/redisinsight           RedisInsight - The GUI for Redis                35                   \nredislabs/redis                  Clustered in-memory database engine compatib…   31                   \noliver006/redis_exporter          Prometheus Exporter for Redis Metrics. Supp…   30                   \nredislabs/rejson                 RedisJSON - Enhanced JSON data type processi…   27                   \narm32v7/redis                    Redis is an open source key-value store that…   25                   \nredislabs/redisgraph             A graph database module for Redis               16                   [OK]\nredislabs/rebloom                A probablistic datatypes module for Redis       15                   [OK]\narm64v8/redis                    Redis is an open source key-value store that…   15                   \nredislabs/redismod               An automated build of redismod - latest Redi…   15                   [OK]\nwebhippie/redis                  Docker image for redis                          11                   [OK]\nredislabs/redistimeseries        A time series database module for Redis         10                   \ns7anley/redis-sentinel-docker    Redis Sentinel                                  10                   [OK]\ninsready/redis-stat              Docker image for the real-time Redis monitor…   10                   [OK]\ngoodsmileduck/redis-cli          redis-cli on alpine                             9                    [OK]\ncentos/redis-32-centos7          Redis in-memory data structure store, used a…   5                    \nclearlinux/redis                 Redis key-value data structure server with t…   3                    \ntiredofit/redis                  Redis Server w/ Zabbix monitoring and S6 Ove…   1                    [OK]\nwodby/redis                      Redis container image with orchestration        1                    [OK]\nrunnable/redis-stunnel           stunnel to redis provided by linking contain…   1                    [OK]\nxetamus/redis-resource           forked redis-resource                           0                    [OK]\n")])])]),a("ul",[a("li",[e._v("NAME：镜像名称")]),e._v(" "),a("li",[e._v("DESCRIPTION：镜像描述")]),e._v(" "),a("li",[e._v("STARS：用户评价，反映一个镜像的受欢迎程度")]),e._v(" "),a("li",[e._v("OFFICIAL：是否为官方构建")]),e._v(" "),a("li",[e._v("AUTOMATED：自动构建，表示该镜像由 Docker Hub 自动构建流程创建的。")])]),e._v(" "),a("h5",{attrs:{id:"_1-3-拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-拉取镜像"}},[e._v("#")]),e._v(" 1.3 拉取镜像")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# https://hub.docker.com/_/redis\n[root@Docker ~]# docker pull redis\nUsing default tag: latest\nlatest: Pulling from library/redis\n7d63c13d9b9b: Pull complete \na2c3b174c5ad: Pull complete \n283a10257b0f: Pull complete \n7a08c63a873a: Pull complete \n0531663a7f55: Pull complete \n9bf50efb265c: Pull complete \nDigest: sha256:a89cb097693dd354de598d279c304a1c73ee550fbfff6d9ee515568e0c749cfe\nStatus: Downloaded newer image for redis:latest\ndocker.io/library/redis:latest\n\n# https://hub.docker.com/_/redis?tab=tags\n[root@Docker ~]# docker pull redis:5\n5: Pulling from library/redis\n7d63c13d9b9b: Already exists \na2c3b174c5ad: Already exists \n283a10257b0f: Already exists \n54ac4e97e390: Pull complete \n0d3ede1e63a5: Pull complete \n878bf2d7168d: Pull complete \nDigest: sha256:8217ee751b6a72bc4b3ef757c18aa9619e939d5073d5a26ce2074905385000b0\nStatus: Downloaded newer image for redis:5\ndocker.io/library/redis:5\n\n[root@Docker ~]# docker pull centos:7\n7: Pulling from library/centos\n2d473b07cdd5: Pull complete \nDigest: sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987\nStatus: Downloaded newer image for centos:7\ndocker.io/library/centos:7\n")])])]),a("h5",{attrs:{id:"_1-4-删除镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-删除镜像"}},[e._v("#")]),e._v(" 1.4 删除镜像")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED       SIZE\nredis         5         02fee89f17ad   4 days ago    110MB\nredis         latest    7faaec683238   4 days ago    113MB\nhello-world   latest    feb5d9fea6a5   3 weeks ago   13.3kB\n\n#  可以查询到所有镜像的 ID，通过组合命令可以实现删除所有镜像的操作\n[root@Docker ~]# docker images -q\n02fee89f17ad\n7faaec683238\nfeb5d9fea6a5\n\n[root@Docker ~]# docker rmi redis:latest\n\n[root@Docker ~]# docker rmi `docker images -q`\n[root@Docker ~]# docker images\nREPOSITORY    TAG       IMAGE ID       CREATED       SIZE\nhello-world   latest    feb5d9fea6a5   3 weeks ago   13.3kB\n")])])]),a("blockquote",[a("p",[e._v("注意：如果通过某个镜像创建了容器，则该镜像无法删除。\n解决办法：先删除镜像中的容器，再删除该镜像。")])]),e._v(" "),a("h4",{attrs:{id:"_2-容器相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-容器相关命令"}},[e._v("#")]),e._v(" 2 容器相关命令")]),e._v(" "),a("h5",{attrs:{id:"_2-1-查看容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-查看容器"}},[e._v("#")]),e._v(" 2.1 查看容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker ps --help\n\nUsage:  docker ps [OPTIONS]\n\nList containers\n\nOptions:\n  -a, --all             Show all containers (default shows just running)\n  -f, --filter filter   Filter output based on conditions provided\n      --format string   Pretty-print containers using a Go template\n  -n, --last int        Show n last created containers (includes all states) (default -1)\n  -l, --latest          Show the latest created container (includes all states)\n      --no-trunc        Don't truncate output\n  -q, --quiet           Only display container IDs\n  -s, --size            Display total file sizes\n")])])]),a("h6",{attrs:{id:"查看正在运行的容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看正在运行的容器"}},[e._v("#")]),e._v(" 查看正在运行的容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n")])])]),a("ul",[a("li",[e._v("CONTAINER ID：容器 ID")]),e._v(" "),a("li",[e._v("IMAGE：所属镜像")]),e._v(" "),a("li",[e._v("COMMAND：")]),e._v(" "),a("li",[e._v("CREATED：创建时间")]),e._v(" "),a("li",[e._v("STATUS：容器状态")]),e._v(" "),a("li",[e._v("PORTS：端口")]),e._v(" "),a("li",[e._v("NAMES：容器名称")])]),e._v(" "),a("h6",{attrs:{id:"查看停止的容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看停止的容器"}},[e._v("#")]),e._v(" 查看停止的容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker ps -f status=exited\nCONTAINER ID   IMAGE         COMMAND    CREATED             STATUS                         PORTS     NAMES\n23042f6ee907   hello-world   "/hello"   About an hour ago   Exited (0) About an hour ago             flamboyant_einstein\n\n[root@Docker ~]# docker ps -f --help\ninvalid argument "--help" for "-f, --filter" flag: bad format of filter (expected name=value)\nSee \'docker ps --help\'.\n')])])]),a("h6",{attrs:{id:"查看所有容器-包括运行和停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看所有容器-包括运行和停止"}},[e._v("#")]),e._v(" 查看所有容器（包括运行和停止）")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker ps -a\nCONTAINER ID   IMAGE         COMMAND    CREATED             STATUS                         PORTS     NAMES\n23042f6ee907   hello-world   "/hello"   About an hour ago   Exited (0) About an hour ago             flamboyant_einstein\n')])])]),a("h6",{attrs:{id:"查看最后一次运行的容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看最后一次运行的容器"}},[e._v("#")]),e._v(" 查看最后一次运行的容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker ps -l\nCONTAINER ID   IMAGE         COMMAND    CREATED             STATUS                         PORTS     NAMES\n23042f6ee907   hello-world   "/hello"   About an hour ago   Exited (0) About an hour ago             flamboyant_einstein\n')])])]),a("ul",[a("li",[e._v("查看最后2次运行的容器")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker ps -l -n 2\nCONTAINER ID   IMAGE         COMMAND    CREATED             STATUS                         PORTS     NAMES\n23042f6ee907   hello-world   "/hello"   About an hour ago   Exited (0) About an hour ago             flamboyant_einstein\n')])])]),a("h5",{attrs:{id:"_2-2-创建与启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-创建与启动容器"}},[e._v("#")]),e._v(" 2.2 创建与启动容器")]),e._v(" "),a("ul",[a("li",[e._v("https://docs.docker.com/engine/reference/commandline/run/\n"),a("ul",[a("li",[e._v("https://docs.docker.com/engine/reference/commandline/run/#restart-policies---restart")])])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker run --help\n\nUsage:  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]\n\nRun a command in a new container\n\nOptions:\n  -i, --interactive                    Keep STDIN open even if not attached\n  -t, --tty                            Allocate a pseudo-TTY\n      --name string                    Assign a name to the container\n  -v, --volume list                    Bind mount a volume\n  -d, --detach                         Run container in background and print container ID \n  -p, --publish list                   Publish a container's port(s) to the host\n  -P, --publish-all                    Publish all exposed ports to random ports\n")])])]),a("ul",[a("li",[e._v("-i：表示运行容器；")]),e._v(" "),a("li",[e._v("-t：表示容器启动后会进入其命令行。加入这两个参数后，容器创建就能登录进去。即分配一个伪终端；")]),e._v(" "),a("li",[e._v("--name：为创建的容器命名；")]),e._v(" "),a("li",[e._v("-v：表示目录映射关系（前者是宿主机目录，后者是映射到宿主机上的目录），可以使用多个 -v 做多个目录或文件映射。注意：最好做目录映射，在宿主机上做修改，然后共享到容器上；")]),e._v(" "),a("li",[e._v("-d：在 run 后面加上 -d 参数，则会创建一个守护式容器在后台运行（这样创建容器后不会自动登录容器，如果只加 -i -t 两个参数，创建容器后就会自动进容器里）；")]),e._v(" "),a("li",[e._v("-p：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个 -p 做多个端口映射。")]),e._v(" "),a("li",[e._v("-P：随机使用宿主机的可用端口与容器内暴露的端口映射。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker run --name mynginx -P nginx       \nUnable to find image \'nginx:latest\' locally\nlatest: Pulling from library/nginx\nb380bbd43752: Pull complete \nfca7e12d1754: Pull complete \n745ab57616cb: Pull complete \na4723e260b6f: Pull complete \n1c84ebdff681: Pull complete \n858292fd2e56: Pull complete \nDigest: sha256:644a70516a26004c97d0d85c7fe1d0c3a67ea8ab7ddf4aff193d9f301670cf36\nStatus: Downloaded newer image for nginx:latest\n/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf\n10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\n/docker-entrypoint.sh: Configuration complete; ready for start up\n2021/10/17 06:03:04 [notice] 1#1: using the "epoll" event method\n2021/10/17 06:03:04 [notice] 1#1: nginx/1.21.3\n2021/10/17 06:03:04 [notice] 1#1: built by gcc 8.3.0 (Debian 8.3.0-6) \n2021/10/17 06:03:04 [notice] 1#1: OS: Linux 3.10.0-1160.el7.x86_64\n2021/10/17 06:03:04 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576\n2021/10/17 06:03:04 [notice] 1#1: start worker processes\n2021/10/17 06:03:04 [notice] 1#1: start worker process 31\n172.17.0.1 - - [17/Oct/2021:06:05:21 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.29.0" "-"\n\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                     NAMES\ne1081f3505dc   nginx     "/docker-entrypoint.…"   29 seconds ago   Up 25 seconds   0.0.0.0:49153->80/tcp, :::49153->80/tcp   mynginx\n# 访问mynginx\n[root@Docker ~]# curl http://127.0.0.1:49153/\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\nhtml { color-scheme: light dark; }\nbody { width: 35em; margin: 0 auto;\nfont-family: Tahoma, Verdana, Arial, sans-serif; }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href="http://nginx.org/">nginx.org</a>.<br/>\nCommercial support is available at\n<a href="http://nginx.com/">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n\n\n[root@Docker ~]# docker run --name mynginx -P nginx      \n# Ctrl+C\n^C2021/10/17 06:06:51 [notice] 1#1: signal 2 (SIGINT) received, exiting\n2021/10/17 06:06:51 [notice] 31#31: exiting\n2021/10/17 06:06:51 [notice] 31#31: exit\n2021/10/17 06:06:52 [notice] 1#1: signal 17 (SIGCHLD) received from 31\n2021/10/17 06:06:52 [notice] 1#1: worker process 31 exited with code 0\n2021/10/17 06:06:52 [notice] 1#1: exit\n\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n[root@Docker ~]# docker ps -a\nCONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS                          PORTS     NAMES\ne1081f3505dc   nginx         "/docker-entrypoint.…"   5 minutes ago   Exited (0) About a minute ago             mynginx\n23042f6ee907   hello-world   "/hello"                 2 hours ago     Exited (0) 2 hours ago                    flamboyant_einstein\n[root@Docker ~]# docker rm mynginx\nmynginx\n\n')])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker run --name mynginx -p 80:80 nginx\n\n[root@Docker ~]# docker ps \nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS                               NAMES\naeebb841309c   nginx     "/docker-entrypoint.…"   10 seconds ago   Up 9 seconds   0.0.0.0:80->80/tcp, :::80->80/tcp   mynginx\n[root@Docker ~]# curl http://127.0.0.1:80\n\n[root@Docker ~]# docker run --name mynginx -p 80:80 nginx\n172.17.0.1 - - [17/Oct/2021:06:11:15 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.29.0" "-"\n^C2021/10/17 06:12:41 [notice] 1#1: signal 2 (SIGINT) received, exiting\n2021/10/17 06:12:41 [notice] 31#31: exiting\n2021/10/17 06:12:41 [notice] 31#31: exit\n2021/10/17 06:12:41 [notice] 1#1: signal 17 (SIGCHLD) received from 31\n2021/10/17 06:12:41 [notice] 1#1: worker process 31 exited with code 0\n2021/10/17 06:12:41 [notice] 1#1: exit\n\n[root@Docker ~]# docker ps -a\nCONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS                     PORTS     NAMES\naeebb841309c   nginx         "/docker-entrypoint.…"   2 minutes ago   Exited (0) 9 seconds ago             mynginx\n23042f6ee907   hello-world   "/hello"                 2 hours ago     Exited (0) 2 hours ago               flamboyant_einstein\n[root@Docker ~]# docker rm aeebb841309c\naeebb841309c\n')])])]),a("h6",{attrs:{id:"创建并进入容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建并进入容器"}},[e._v("#")]),e._v(" 创建并进入容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker run -it --name mynginx -p 80:80 nginx\n/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf\n10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\n/docker-entrypoint.sh: Configuration complete; ready for start up\n2021/10/17 06:16:39 [notice] 1#1: using the "epoll" event method\n2021/10/17 06:16:39 [notice] 1#1: nginx/1.21.3\n2021/10/17 06:16:39 [notice] 1#1: built by gcc 8.3.0 (Debian 8.3.0-6) \n2021/10/17 06:16:39 [notice] 1#1: OS: Linux 3.10.0-1160.el7.x86_64\n2021/10/17 06:16:39 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576\n2021/10/17 06:16:39 [notice] 1#1: start worker processes\n2021/10/17 06:16:39 [notice] 1#1: start worker process 31\n\n^C2021/10/17 06:17:27 [notice] 1#1: signal 2 (SIGINT) received, exiting\n2021/10/17 06:17:27 [notice] 31#31: signal 2 (SIGINT) received, exiting\n2021/10/17 06:17:27 [notice] 31#31: exiting\n2021/10/17 06:17:27 [notice] 31#31: exit\n2021/10/17 06:17:27 [notice] 1#1: signal 17 (SIGCHLD) received from 31\n2021/10/17 06:17:27 [notice] 1#1: worker process 31 exited with code 0\n2021/10/17 06:17:27 [notice] 1#1: exit\n\n\n')])])]),a("blockquote",[a("p",[e._v("注意：Docker 容器运行必须有一个前台进程， 如果没有前台进程执行，容器认为是空闲状态，就会自动退出。")])]),e._v(" "),a("ul",[a("li",[e._v("退出当前容器")])]),e._v(" "),a("h6",{attrs:{id:"守护式方式创建容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#守护式方式创建容器"}},[e._v("#")]),e._v(" 守护式方式创建容器")]),e._v(" "),a("blockquote",[a("p",[e._v("docker run -di --name 容器名称 镜像名称:标签")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker run -di --name mynginx -p 80:80 nginx:latest\ne99c0f1d78c7745a01cea08786f3d143d5277615808ff84995d69bf5a9ddf9bf\n[root@Docker ~]# docker ps\nCONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                               NAMES\ne99c0f1d78c7   nginx:latest   "/docker-entrypoint.…"   21 seconds ago   Up 18 seconds   0.0.0.0:80->80/tcp, :::80->80/tcp   mynginx\n[root@Docker ~]# curl http://127.0.0.1:80\n')])])]),a("ul",[a("li",[e._v("登录守护式容器方式\n"),a("ul",[a("li",[e._v("https://docs.docker.com/engine/reference/commandline/exec/#options")])])])]),e._v(" "),a("blockquote",[a("p",[e._v("docker exec -it 容器名称|容器ID /bin/bash|sh")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# docker exec -it -w /root mynginx /bin/bash\n[root@Docker ~]# docker exec -it mynginx /bin/bash\nroot@e99c0f1d78c7:/# ls\nbin  boot  dev  docker-entrypoint.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nroot@e99c0f1d78c7:/# cat /etc/nginx/conf.d/default.conf   \nroot@e99c0f1d78c7:/# exit\nexit\n[root@Docker ~]# \n")])])]),a("h5",{attrs:{id:"_2-3-停止与启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-停止与启动容器"}},[e._v("#")]),e._v(" 2.3 停止与启动容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 停止容器\ndocker stop 容器名称|容器ID\n# 启动容器\ndocker start 容器名称|容器ID\n\n[root@Docker ~]# docker stop mynginx\nmynginx\n[root@Docker ~]# curl http://127.0.0.1:80\ncurl: (7) Failed connect to 127.0.0.1:80; Connection refused\n\n[root@Docker ~]# docker start mynginx\nmynginx\n")])])]),a("h5",{attrs:{id:"_2-4-文件拷贝"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-文件拷贝"}},[e._v("#")]),e._v(" 2.4 文件拷贝")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 如果我们需要将文件拷贝到容器内可以使用 cp 命令。\ndocker cp 需要拷贝的文件或目录 容器名称:容器目录\n# 也可以将文件从容器内拷贝出来。\ndocker cp 容器名称:容器目录 需要拷贝的文件或目录\n\n[root@Docker ~]# docker cp jdk-11.0.6_linux-x64_bin.tar.gz centos7:/root\n")])])]),a("h5",{attrs:{id:"_2-5-目录挂载-容器数据卷操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-目录挂载-容器数据卷操作"}},[e._v("#")]),e._v(" 2.5 目录挂载（容器数据卷操作）")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_42236404/article/details/104718731",target:"_blank",rel:"noopener noreferrer"}},[e._v("一看就懂！ Docker 修改挂载目录的三种方式"),a("OutboundLink")],1)])]),e._v(" "),a("blockquote",[a("p",[e._v("容器与宿主机之间的数据卷属于引用的关系，数据卷是从外界挂载到容器内部中的，所以可以脱离容器的生命周期而独立存在，正是由于数据卷的生命周期并不等同于容器的生命周期，在容器退出或者删除以后，数据卷仍然不会受到影响，数据卷的生命周期会一直持续到没有容器使用它为止。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker data]# docker run -di -v /mydata/docker_centos/data:/usr/local/data --name centos7-02 centos:7\nc4c8feee14bb0ee23a2f351d5a5d1a89fc63530c653cd88a6c17a8819891279c\n# Mounts 节点\n[root@Docker data]# docker inspect centos7-02\n[\n    {\n        "Id": "c4c8feee14bb0ee23a2f351d5a5d1a89fc63530c653cd88a6c17a8819891279c",\n        "Created": "2021-10-17T10:20:50.345767904Z",\n        "Path": "/bin/bash",\n        "Args": [],\n        "State": {\n            "Status": "running",\n            "Running": true,\n            "Paused": false,\n            "Restarting": false,\n            "OOMKilled": false,\n            "Dead": false,\n            "Pid": 13662,\n            "ExitCode": 0,\n            "Error": "",\n            "StartedAt": "2021-10-17T10:20:51.06928339Z",\n            "FinishedAt": "0001-01-01T00:00:00Z"\n        },\n        "Image": "sha256:eeb6ee3f44bd0b5103bb561b4c16bcb82328cfe5809ab675bb17ab3a16c517c9",\n        "ResolvConfPath": "/var/lib/docker/containers/c4c8feee14bb0ee23a2f351d5a5d1a89fc63530c653cd88a6c17a8819891279c/resolv.conf",\n        "HostnamePath": "/var/lib/docker/containers/c4c8feee14bb0ee23a2f351d5a5d1a89fc63530c653cd88a6c17a8819891279c/hostname",\n        "HostsPath": "/var/lib/docker/containers/c4c8feee14bb0ee23a2f351d5a5d1a89fc63530c653cd88a6c17a8819891279c/hosts",\n        "LogPath": "/var/lib/docker/containers/c4c8feee14bb0ee23a2f351d5a5d1a89fc63530c653cd88a6c17a8819891279c/c4c8feee14bb0ee23a2f351d5a5d1a89fc63530c653cd88a6c17a8819891279c-json.log",\n        "Name": "/centos7-02",\n        "RestartCount": 0,\n        "Driver": "overlay2",\n        "Platform": "linux",\n        "MountLabel": "",\n        "ProcessLabel": "",\n        "AppArmorProfile": "",\n        "ExecIDs": null,\n        "HostConfig": {\n            "Binds": [\n                "/mydata/docker_centos/data:/usr/local/data"\n            ],\n            "ContainerIDFile": "",\n            "LogConfig": {\n                "Type": "json-file",\n                "Config": {}\n            },\n            "NetworkMode": "default",\n            "PortBindings": {},\n            "RestartPolicy": {\n                "Name": "no",\n                "MaximumRetryCount": 0\n            },\n            "AutoRemove": false,\n            "VolumeDriver": "",\n            "VolumesFrom": null,\n            "CapAdd": null,\n            "CapDrop": null,\n            "CgroupnsMode": "host",\n            "Dns": [],\n            "DnsOptions": [],\n            "DnsSearch": [],\n            "ExtraHosts": null,\n            "GroupAdd": null,\n            "IpcMode": "private",\n            "Cgroup": "",\n            "Links": null,\n            "OomScoreAdj": 0,\n            "PidMode": "",\n            "Privileged": false,\n            "PublishAllPorts": false,\n            "ReadonlyRootfs": false,\n            "SecurityOpt": null,\n            "UTSMode": "",\n            "UsernsMode": "",\n            "ShmSize": 67108864,\n            "Runtime": "runc",\n            "ConsoleSize": [\n                0,\n                0\n            ],\n            "Isolation": "",\n            "CpuShares": 0,\n            "Memory": 0,\n            "NanoCpus": 0,\n            "CgroupParent": "",\n            "BlkioWeight": 0,\n            "BlkioWeightDevice": [],\n            "BlkioDeviceReadBps": null,\n            "BlkioDeviceWriteBps": null,\n            "BlkioDeviceReadIOps": null,\n            "BlkioDeviceWriteIOps": null,\n            "CpuPeriod": 0,\n            "CpuQuota": 0,\n            "CpuRealtimePeriod": 0,\n            "CpuRealtimeRuntime": 0,\n            "CpusetCpus": "",\n            "CpusetMems": "",\n            "Devices": [],\n            "DeviceCgroupRules": null,\n            "DeviceRequests": null,\n            "KernelMemory": 0,\n            "KernelMemoryTCP": 0,\n            "MemoryReservation": 0,\n            "MemorySwap": 0,\n            "MemorySwappiness": null,\n            "OomKillDisable": false,\n            "PidsLimit": null,\n            "Ulimits": null,\n            "CpuCount": 0,\n            "CpuPercent": 0,\n            "IOMaximumIOps": 0,\n            "IOMaximumBandwidth": 0,\n            "MaskedPaths": [\n                "/proc/asound",\n                "/proc/acpi",\n                "/proc/kcore",\n                "/proc/keys",\n                "/proc/latency_stats",\n                "/proc/timer_list",\n                "/proc/timer_stats",\n                "/proc/sched_debug",\n                "/proc/scsi",\n                "/sys/firmware"\n            ],\n            "ReadonlyPaths": [\n                "/proc/bus",\n                "/proc/fs",\n                "/proc/irq",\n                "/proc/sys",\n                "/proc/sysrq-trigger"\n            ]\n        },\n        "GraphDriver": {\n            "Data": {\n                "LowerDir": "/var/lib/docker/overlay2/3b0d896f0a73f6384d2d32aec61d9fec746aad4928714df719c8e637f608c5ba-init/diff:/var/lib/docker/overlay2/d2353568cfef71438c7bad257668096bdb4d2fb75099d034fcb96b5a885db6bd/diff",\n                "MergedDir": "/var/lib/docker/overlay2/3b0d896f0a73f6384d2d32aec61d9fec746aad4928714df719c8e637f608c5ba/merged",\n                "UpperDir": "/var/lib/docker/overlay2/3b0d896f0a73f6384d2d32aec61d9fec746aad4928714df719c8e637f608c5ba/diff",\n                "WorkDir": "/var/lib/docker/overlay2/3b0d896f0a73f6384d2d32aec61d9fec746aad4928714df719c8e637f608c5ba/work"\n            },\n            "Name": "overlay2"\n        },\n        "Mounts": [\n            {\n                "Type": "bind",\n                "Source": "/mydata/docker_centos/data",\n                "Destination": "/usr/local/data",\n                "Mode": "",\n                "RW": true,\n                "Propagation": "rprivate"\n            }\n        ],\n        "Config": {\n            "Hostname": "c4c8feee14bb",\n            "Domainname": "",\n            "User": "",\n            "AttachStdin": false,\n            "AttachStdout": false,\n            "AttachStderr": false,\n            "Tty": false,\n            "OpenStdin": true,\n            "StdinOnce": false,\n            "Env": [\n                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"\n            ],\n            "Cmd": [\n                "/bin/bash"\n            ],\n            "Image": "centos:7",\n            "Volumes": null,\n            "WorkingDir": "",\n            "Entrypoint": null,\n            "OnBuild": null,\n            "Labels": {\n                "org.label-schema.build-date": "20201113",\n                "org.label-schema.license": "GPLv2",\n                "org.label-schema.name": "CentOS Base Image",\n                "org.label-schema.schema-version": "1.0",\n                "org.label-schema.vendor": "CentOS",\n                "org.opencontainers.image.created": "2020-11-13 00:00:00+00:00",\n                "org.opencontainers.image.licenses": "GPL-2.0-only",\n                "org.opencontainers.image.title": "CentOS Base Image",\n                "org.opencontainers.image.vendor": "CentOS"\n            }\n        },\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "43a7cbb12551b15d19cffbdf0119cfe07a8e3a3270fdda6a21fa715c1e9fac89",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {},\n            "SandboxKey": "/var/run/docker/netns/43a7cbb12551",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "f56719fd7a135be5886c94576b2c783f31b5560e89740cca3fa3f1ec43eb1870",\n            "Gateway": "172.17.0.1",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "172.17.0.2",\n            "IPPrefixLen": 16,\n            "IPv6Gateway": "",\n            "MacAddress": "02:42:ac:11:00:02",\n            "Networks": {\n                "bridge": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": null,\n                    "NetworkID": "569236c4d0fee9e6c6533046eb367417dd214ce6b9f1b2419ab2f6f32813acc9",\n                    "EndpointID": "f56719fd7a135be5886c94576b2c783f31b5560e89740cca3fa3f1ec43eb1870",\n                    "Gateway": "172.17.0.1",\n                    "IPAddress": "172.17.0.2",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:11:00:02",\n                    "DriverOpts": null\n                }\n            }\n        }\n    }\n]\n')])])]),a("h6",{attrs:{id:"匿名挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匿名挂载"}},[e._v("#")]),e._v(" 匿名挂载")]),e._v(" "),a("ul",[a("li",[e._v("匿名挂载只需要写容器目录即可，容器外对应的目录会在 /var/lib/docker/volume 中生成。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 匿名挂载\n[root@Docker data]# docker run -di -v /usr/local/data --name centos7-02 centos:7\n7bf262d313c3ca7ea7ddc450a7df0415e52f57fff41bce786c30cac5513b8977\n# 查看 volume 数据卷信息\n[root@Docker data]# docker volume ls\nDRIVER    VOLUME NAME\nlocal     6703229608fc0cba934a667ddd38d4f0d981133a08a44b564080332e18589bbf\n[root@Docker data]# ls /var/lib/docker/volumes/\n6703229608fc0cba934a667ddd38d4f0d981133a08a44b564080332e18589bbf  backingFsBlockDev  metadata.db\n")])])]),a("ul",[a("li",[e._v("验证")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# docker exec -it centos7-02 /bin/bash\n[root@7bf262d313c3 /]# cd /usr/local/data/\n[root@7bf262d313c3 data]# touch test.txt\n\n[root@Docker data]# cd /var/lib/docker/volumes/6703229608fc0cba934a667ddd38d4f0d981133a08a44b564080332e18589bbf/_data/\n[root@Docker _data]# ls\ntest.txt\n\n[root@Docker _data]# docker inspect centos7-02\n        "Mounts": [\n            {\n                "Type": "volume",\n                "Name": "6703229608fc0cba934a667ddd38d4f0d981133a08a44b564080332e18589bbf",\n                "Source": "/var/lib/docker/volumes/6703229608fc0cba934a667ddd38d4f0d981133a08a44b564080332e18589bbf/_data",\n                "Destination": "/usr/local/data",\n                "Driver": "local",\n                "Mode": "",\n                "RW": true,\n                "Propagation": ""\n            }\n        ],\n')])])]),a("h6",{attrs:{id:"具名挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具名挂载"}},[e._v("#")]),e._v(" 具名挂载")]),e._v(" "),a("ul",[a("li",[e._v("具名挂载就是给数据卷起了个名字，容器外对应的目录会在 /var/lib/docker/volume 中生成。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 具名挂载\n[root@Docker _data]# docker run -di -v docker_centos_data:/usr/local/data --name centos7-03 centos:7\n21990bf7c0f66072eeacceb06fb59204ed0d503eab9c6bc102460911c6c85613\n# 查看 volume 数据卷信息\n[root@Docker _data]# docker volume ls\nDRIVER    VOLUME NAME\nlocal     docker_centos_data\n")])])]),a("h6",{attrs:{id:"指定目录挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定目录挂载"}},[e._v("#")]),e._v(" 指定目录挂载")]),e._v(" "),a("ul",[a("li",[e._v("这种方式的挂载不会在 /var/lib/docker/volume 目录生成内容。")])]),e._v(" "),a("blockquote",[a("p",[e._v("多目录挂载\ndocker run -di -v /宿主机目录:/容器目录 -v /宿主机目录2:/容器目录2 镜像名")])]),e._v(" "),a("ul",[a("li",[e._v("容器创建的时候，容器目录会自动创建，并且和宿主机目录进行绑定")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# mkdir -p /mydata/docker_centos/data\n[root@Docker ~]# docker run -di -v /mydata/docker_centos/data:/usr/local/data --name centos7-01 centos:7\n955ce44799c688e0220270343cdaaca53fc3077b012200e45646897f6ac5a9ed\n[root@Docker ~]# cd /mydata/docker_centos/data\n[root@Docker data]# ll\ntotal 0\n[root@Docker data]# vim test.txt\n目录挂载测试\n"test.txt" [New] 1L, 19C written  \n\n[root@Docker ~]# docker exec -it centos7-01 /bin/bash\n[root@955ce44799c6 /]# cd /usr/local/data/\n[root@955ce44799c6 data]# cat test.txt \n目录挂载测试\n\n[root@955ce44799c6 data]# touch abc.txt\n\n[root@Docker data]# ls\nabc.txt  test.txt\n')])])]),a("h6",{attrs:{id:"查看目录挂载关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看目录挂载关系"}},[e._v("#")]),e._v(" 查看目录挂载关系")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 具名挂载\n[root@Docker _data]# docker run -di -v docker_centos_data:/usr/local/data --name centos7-03 centos:7\n21990bf7c0f66072eeacceb06fb59204ed0d503eab9c6bc102460911c6c85613\n# 查看 volume 数据卷信息\n[root@Docker _data]# docker volume ls\nDRIVER    VOLUME NAME\nlocal     docker_centos_data\n")])])]),a("ul",[a("li",[e._v("通过 docker volume inspect 数据卷名称 可以查看该数据卷对应宿主机的目录地址。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker _data]# docker volume inspect docker_centos_data\n[\n    {\n        "CreatedAt": "2021-10-17T18:41:49+08:00",\n        "Driver": "local",\n        "Labels": null,\n        "Mountpoint": "/var/lib/docker/volumes/docker_centos_data/_data",\n        "Name": "docker_centos_data",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n')])])]),a("ul",[a("li",[e._v("通过 docker inspect 容器ID或名称 ，在返回的 JSON 节点中找到 Mounts，可以查看详细的数据挂载信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker _data]# docker inspect centos7-03 \n        "Mounts": [\n            {\n                "Type": "volume",\n                "Name": "docker_centos_data",\n                "Source": "/var/lib/docker/volumes/docker_centos_data/_data",\n                "Destination": "/usr/local/data",\n                "Driver": "local",\n                "Mode": "z",\n                "RW": true,\n                "Propagation": ""\n            }\n        ],\n')])])]),a("h6",{attrs:{id:"只读-读写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#只读-读写"}},[e._v("#")]),e._v(" 只读/读写")]),e._v(" "),a("blockquote",[a("p",[e._v("只读。只能通过修改宿主机内容实现对容器的数据管理。\ndocker run -it -v /宿主机目录:/容器目录:ro --name 容器名 镜像名\n读写，默认。宿主机和容器可以双向操作数据。\ndocker run -it -v /宿主机目录:/容器目录:rw --name 容器名 镜像名")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker _data]# docker run -di -v /mydata/docker_centos/data/:/usr/local/data:ro --name centos7-04-ro centos:7    \n2fdc012b00280f1a2ef470613aeaf3e6d8430cc7cc0e71e7c08a353c508552ab\n[root@Docker _data]# docker exec -it centos7-04-ro /bin/bash\n[root@2fdc012b0028 /]# cd /usr/local/data/\n[root@2fdc012b0028 data]# ll\ntotal 4\n-rw-r--r--. 1 root root  0 Oct 17 10:06 abc.txt\n-rw-r--r--. 1 root root 25 Oct 17 10:05 test.txt\n[root@2fdc012b0028 data]# ls\nabc.txt  test.txt\n[root@2fdc012b0028 data]# touch 1.txt\ntouch: cannot touch '1.txt': Read-only file system\n\n[root@Docker _data]# docker run -di -v /mydata/docker_centos/data/:/usr/local/data:rw --name centos7-04-rw centos:7 \n970e33f208d6b6259e82208792e99e49f1c7cfddc179e13f92c9952c59b9f2f3\n[root@Docker _data]# docker exec -it centos7-04-rw /bin/bash\n[root@970e33f208d6 /]# cd /usr/local/data/\n[root@970e33f208d6 data]# touch 1.txt\n[root@970e33f208d6 data]# ls\n1.txt  abc.txt  test.txt\n\n[root@Docker ~]# ls /mydata/docker_centos/data/\n1.txt  abc.txt  test.txt\n")])])]),a("h6",{attrs:{id:"volumes-from-继承"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volumes-from-继承"}},[e._v("#")]),e._v(" volumes-from（继承）")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 容器 centos7-01 指定目录挂载\n[root@Docker ~]# docker run -di -v /mydata/docker_centos/data/:/usr/local/data --name centos7-01 centos:7\n78da11a76b40be8e1a7a867f82246cec2985bf95601a629e672ff0e0660db274\n# 容器 centos7-04 和 centos7-05 相当于继承 centos7-01 容器的挂载目录\n[root@Docker ~]# docker run -di --volumes-from centos7-01:ro --name centos7-04 centos:7\na44e824e63cbd07b8444457a4f6ba896e995c6ec6c3143dff1f5e66645be37e1\n[root@Docker ~]# docker run -di --volumes-from centos7-01:rw --name centos7-05 centos:7 \nfe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77\n")])])]),a("ul",[a("li",[e._v("验证")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker volume ls\nDRIVER    VOLUME NAME\n[root@Docker ~]# docker exec -it centos7-04 /bin/bash\n[root@a44e824e63cb /]# cd /usr/local/data/\n[root@a44e824e63cb data]# ls\n1.txt  abc.txt  test.txt\n[root@a44e824e63cb data]# touch 2.txt\ntouch: cannot touch '2.txt': Read-only file system\n[root@a44e824e63cb data]# exit\nexit\n[root@Docker ~]# docker exec -it centos7-05 /bin/bash\n[root@fe95d9d7a5a8 /]# cd /usr/local/data/\n[root@fe95d9d7a5a8 data]# ls\n1.txt  abc.txt  test.txt\n[root@fe95d9d7a5a8 data]# touch 2.txt\n[root@fe95d9d7a5a8 data]# exit\nexit\n\n[root@Docker ~]# ls /mydata/docker_centos/data/\n1.txt  2.txt  abc.txt  test.txt\n")])])]),a("h5",{attrs:{id:"_2-6-查看容器-ip-地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-查看容器-ip-地址"}},[e._v("#")]),e._v(" 2.6 查看容器 IP 地址")]),e._v(" "),a("ul",[a("li",[e._v("我们可以通过以下命令查看容器的元信息。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('docker inspect 容器名称|容器ID\n\n[root@Docker ~]# docker ps \nCONTAINER ID   IMAGE      COMMAND       CREATED          STATUS          PORTS     NAMES\nfe95d9d7a5a8   centos:7   "/bin/bash"   8 minutes ago    Up 8 minutes              centos7-05\n\n# Networks\n[root@Docker ~]# docker inspect centos7-05\n[\n    {\n        "Id": "fe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77",\n        "Created": "2021-10-17T11:05:11.330109573Z",\n        "Path": "/bin/bash",\n        "Args": [],\n        "State": {\n            "Status": "running",\n            "Running": true,\n            "Paused": false,\n            "Restarting": false,\n            "OOMKilled": false,\n            "Dead": false,\n            "Pid": 14309,\n            "ExitCode": 0,\n            "Error": "",\n            "StartedAt": "2021-10-17T11:05:11.905135967Z",\n            "FinishedAt": "0001-01-01T00:00:00Z"\n        },\n        "Image": "sha256:eeb6ee3f44bd0b5103bb561b4c16bcb82328cfe5809ab675bb17ab3a16c517c9",\n        "ResolvConfPath": "/var/lib/docker/containers/fe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77/resolv.conf",\n        "HostnamePath": "/var/lib/docker/containers/fe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77/hostname",\n        "HostsPath": "/var/lib/docker/containers/fe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77/hosts",\n        "LogPath": "/var/lib/docker/containers/fe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77/fe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77-json.log",\n        "Name": "/centos7-05",\n        "RestartCount": 0,\n        "Driver": "overlay2",\n        "Platform": "linux",\n        "MountLabel": "",\n        "ProcessLabel": "",\n        "AppArmorProfile": "",\n        "ExecIDs": null,\n        "HostConfig": {\n            "Binds": null,\n            "ContainerIDFile": "",\n            "LogConfig": {\n                "Type": "json-file",\n                "Config": {}\n            },\n            "NetworkMode": "default",\n            "PortBindings": {},\n            "RestartPolicy": {\n                "Name": "no",\n                "MaximumRetryCount": 0\n            },\n            "AutoRemove": false,\n            "VolumeDriver": "",\n            "VolumesFrom": [\n                "centos7-01:rw"\n            ],\n            "CapAdd": null,\n            "CapDrop": null,\n            "CgroupnsMode": "host",\n            "Dns": [],\n            "DnsOptions": [],\n            "DnsSearch": [],\n            "ExtraHosts": null,\n            "GroupAdd": null,\n            "IpcMode": "private",\n            "Cgroup": "",\n            "Links": null,\n            "OomScoreAdj": 0,\n            "PidMode": "",\n            "Privileged": false,\n            "PublishAllPorts": false,\n            "ReadonlyRootfs": false,\n            "SecurityOpt": null,\n            "UTSMode": "",\n            "UsernsMode": "",\n            "ShmSize": 67108864,\n            "Runtime": "runc",\n            "ConsoleSize": [\n                0,\n                0\n            ],\n            "Isolation": "",\n            "CpuShares": 0,\n            "Memory": 0,\n            "NanoCpus": 0,\n            "CgroupParent": "",\n            "BlkioWeight": 0,\n            "BlkioWeightDevice": [],\n            "BlkioDeviceReadBps": null,\n            "BlkioDeviceWriteBps": null,\n            "BlkioDeviceReadIOps": null,\n            "BlkioDeviceWriteIOps": null,\n            "CpuPeriod": 0,\n            "CpuQuota": 0,\n            "CpuRealtimePeriod": 0,\n            "CpuRealtimeRuntime": 0,\n            "CpusetCpus": "",\n            "CpusetMems": "",\n            "Devices": [],\n            "DeviceCgroupRules": null,\n            "DeviceRequests": null,\n            "KernelMemory": 0,\n            "KernelMemoryTCP": 0,\n            "MemoryReservation": 0,\n            "MemorySwap": 0,\n            "MemorySwappiness": null,\n            "OomKillDisable": false,\n            "PidsLimit": null,\n            "Ulimits": null,\n            "CpuCount": 0,\n            "CpuPercent": 0,\n            "IOMaximumIOps": 0,\n            "IOMaximumBandwidth": 0,\n            "MaskedPaths": [\n                "/proc/asound",\n                "/proc/acpi",\n                "/proc/kcore",\n                "/proc/keys",\n                "/proc/latency_stats",\n                "/proc/timer_list",\n                "/proc/timer_stats",\n                "/proc/sched_debug",\n                "/proc/scsi",\n                "/sys/firmware"\n            ],\n            "ReadonlyPaths": [\n                "/proc/bus",\n                "/proc/fs",\n                "/proc/irq",\n                "/proc/sys",\n                "/proc/sysrq-trigger"\n            ]\n        },\n        "GraphDriver": {\n            "Data": {\n                "LowerDir": "/var/lib/docker/overlay2/65a147843fb889988ccb305106075f04ac0746976a5380892f3d574d30460c61-init/diff:/var/lib/docker/overlay2/d2353568cfef71438c7bad257668096bdb4d2fb75099d034fcb96b5a885db6bd/diff",\n                "MergedDir": "/var/lib/docker/overlay2/65a147843fb889988ccb305106075f04ac0746976a5380892f3d574d30460c61/merged",\n                "UpperDir": "/var/lib/docker/overlay2/65a147843fb889988ccb305106075f04ac0746976a5380892f3d574d30460c61/diff",\n                "WorkDir": "/var/lib/docker/overlay2/65a147843fb889988ccb305106075f04ac0746976a5380892f3d574d30460c61/work"\n            },\n            "Name": "overlay2"\n        },\n        "Mounts": [\n            {\n                "Type": "bind",\n                "Source": "/mydata/docker_centos/data",\n                "Destination": "/usr/local/data",\n                "Mode": "",\n                "RW": true,\n                "Propagation": "rprivate"\n            }\n        ],\n        "Config": {\n            "Hostname": "fe95d9d7a5a8",\n            "Domainname": "",\n            "User": "",\n            "AttachStdin": false,\n            "AttachStdout": false,\n            "AttachStderr": false,\n            "Tty": false,\n            "OpenStdin": true,\n            "StdinOnce": false,\n            "Env": [\n                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"\n            ],\n            "Cmd": [\n                "/bin/bash"\n            ],\n            "Image": "centos:7",\n            "Volumes": null,\n            "WorkingDir": "",\n            "Entrypoint": null,\n            "OnBuild": null,\n            "Labels": {\n                "org.label-schema.build-date": "20201113",\n                "org.label-schema.license": "GPLv2",\n                "org.label-schema.name": "CentOS Base Image",\n                "org.label-schema.schema-version": "1.0",\n                "org.label-schema.vendor": "CentOS",\n                "org.opencontainers.image.created": "2020-11-13 00:00:00+00:00",\n                "org.opencontainers.image.licenses": "GPL-2.0-only",\n                "org.opencontainers.image.title": "CentOS Base Image",\n                "org.opencontainers.image.vendor": "CentOS"\n            }\n        },\n        "NetworkSettings": {\n            "Bridge": "",\n            "SandboxID": "c3b25e757b9224fa91076738baf0940e2b12ca4ebe787f2e2e1c868f0c4ac682",\n            "HairpinMode": false,\n            "LinkLocalIPv6Address": "",\n            "LinkLocalIPv6PrefixLen": 0,\n            "Ports": {},\n            "SandboxKey": "/var/run/docker/netns/c3b25e757b92",\n            "SecondaryIPAddresses": null,\n            "SecondaryIPv6Addresses": null,\n            "EndpointID": "80749b46f6924ec0911c10add57243fed2ea473f0ae523f6d9cb1ed424548d35",\n            "Gateway": "172.17.0.1",\n            "GlobalIPv6Address": "",\n            "GlobalIPv6PrefixLen": 0,\n            "IPAddress": "172.17.0.8",\n            "IPPrefixLen": 16,\n            "IPv6Gateway": "",\n            "MacAddress": "02:42:ac:11:00:08",\n            "Networks": {\n                "bridge": {\n                    "IPAMConfig": null,\n                    "Links": null,\n                    "Aliases": null,\n                    "NetworkID": "569236c4d0fee9e6c6533046eb367417dd214ce6b9f1b2419ab2f6f32813acc9",\n                    "EndpointID": "80749b46f6924ec0911c10add57243fed2ea473f0ae523f6d9cb1ed424548d35",\n                    "Gateway": "172.17.0.1",\n                    "IPAddress": "172.17.0.8",\n                    "IPPrefixLen": 16,\n                    "IPv6Gateway": "",\n                    "GlobalIPv6Address": "",\n                    "GlobalIPv6PrefixLen": 0,\n                    "MacAddress": "02:42:ac:11:00:08",\n                    "DriverOpts": null\n                }\n            }\n        }\n    }\n]\n')])])]),a("ul",[a("li",[e._v("也可以直接执行下面的命令直接输出 IP 地址。")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker inspect --format='{{.NetworkSettings.IPAddress}}' 容器名称|容器ID\n\n[root@Docker ~]# docker inspect --format='{{.NetworkSettings.IPAddress}}' centos7-05 \n172.17.0.8\n")])])]),a("h5",{attrs:{id:"_2-7-删除容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-删除容器"}},[e._v("#")]),e._v(" 2.7 删除容器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 删除指定容器\ndocker rm 容器名称|容器ID\n# 删除多个容器\ndocker rm 容器名称|容器ID 容器名称|容器ID\n\n[root@Docker ~]# docker ps \nCONTAINER ID   IMAGE      COMMAND       CREATED          STATUS          PORTS     NAMES\nfe95d9d7a5a8   centos:7   "/bin/bash"   11 minutes ago   Up 11 minutes             centos7-05\na44e824e63cb   centos:7   "/bin/bash"   12 minutes ago   Up 12 minutes             centos7-04\n78da11a76b40   centos:7   "/bin/bash"   14 minutes ago   Up 14 minutes             centos7-01\n970e33f208d6   centos:7   "/bin/bash"   18 minutes ago   Up 18 minutes             centos7-04-rw\n2fdc012b0028   centos:7   "/bin/bash"   20 minutes ago   Up 20 minutes             centos7-04-ro\n21990bf7c0f6   centos:7   "/bin/bash"   35 minutes ago   Up 35 minutes             centos7-03\n7bf262d313c3   centos:7   "/bin/bash"   49 minutes ago   Up 49 minutes             centos7-02\n[root@Docker ~]# docker rm centos7-05 \nError response from daemon: You cannot remove a running container fe95d9d7a5a8c73d4692d88524ef8bfc481072a059c7c3d912efdaa309f39c77. Stop the container before attempting removal or force remove\n\n[root@Docker ~]# docker stop $(docker ps -q) \nfe95d9d7a5a8\na44e824e63cb\n78da11a76b40\n970e33f208d6\n2fdc012b0028\n21990bf7c0f6\n7bf262d313c3\n\n[root@Docker ~]# docker rm `docker ps -a -q`\nfe95d9d7a5a8\na44e824e63cb\n78da11a76b40\n970e33f208d6\n2fdc012b0028\n21990bf7c0f6\n7bf262d313c3\n23042f6ee907\n[root@Docker ~]# docker ps -a\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n\n')])])]),a("h3",{attrs:{id:"二-docker-架构及工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-docker-架构及工作原理"}},[e._v("#")]),e._v(" 二 Docker 架构及工作原理")]),e._v(" "),a("ul",[a("li",[e._v("2021最新Docker入门到精通视频 09-13")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker2.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 架构及工作原理"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_5-0-镜像分层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-镜像分层"}},[e._v("#")]),e._v(" 5.0 镜像分层")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# https://hub.docker.com/_/redis\n[root@Docker ~]# docker pull redis\nUsing default tag: latest\nlatest: Pulling from library/redis\n7d63c13d9b9b: Pull complete \na2c3b174c5ad: Pull complete \n283a10257b0f: Pull complete \n7a08c63a873a: Pull complete \n0531663a7f55: Pull complete \n9bf50efb265c: Pull complete \nDigest: sha256:a89cb097693dd354de598d279c304a1c73ee550fbfff6d9ee515568e0c749cfe\nStatus: Downloaded newer image for redis:latest\ndocker.io/library/redis:latest\n")])])]),a("h4",{attrs:{id:"_7-0-注册中心"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-0-注册中心"}},[e._v("#")]),e._v(" 7.0 注册中心")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Docker 公司提供了公共的镜像仓库 https://hub.docker.com（Docker 称之为 Repository）提供了庞大的镜像集合供使用。")])]),e._v(" "),a("li",[a("p",[e._v("https://hub.docker.com/_/registry 构建局域网注册中心")])])]),e._v(" "),a("h3",{attrs:{id:"三-docker-安装及配置镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-docker-安装及配置镜像加速"}},[e._v("#")]),e._v(" 三 Docker 安装及配置镜像加速")]),e._v(" "),a("ul",[a("li",[e._v("2021最新Docker入门到精通视频 05-08")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/mrhelloworld/p/docker3.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker 安装及配置镜像加速"),a("OutboundLink")],1)])]),e._v(" "),a("h4",{attrs:{id:"_1-0-docker-版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-0-docker-版本"}},[e._v("#")]),e._v(" 1.0 Docker 版本")]),e._v(" "),a("h4",{attrs:{id:"_2-0-在-centos-上安装-docker-引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-在-centos-上安装-docker-引擎"}},[e._v("#")]),e._v(" 2.0 在 CentOS 上安装 Docker 引擎")]),e._v(" "),a("ul",[a("li",[e._v("https://docs.docker.com/engine/install/centos/")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# yum list installed | grep docker\n\n# 安装 yum-utils\n[root@Docker ~]# yum install -y yum-utils\n# 设置 yum 源为阿里云方便下载 Docker Engine\n[root@Docker ~]# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nLoaded plugins: fastestmirror\nadding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\ngrabbing file http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo\nrepo saved to /etc/yum.repos.d/docker-ce.repo\n\n# 安装最新版本的 Docker Engine 和容器。\n[root@Docker ~]# yum install docker-ce docker-ce-cli containerd.io\n\nTotal download size: 95 M\nInstalled size: 383 M\nIs this ok [y/d/N]: y\nDownloading packages:\n\nTotal                                                                                                                                                                             10 MB/s |  95 MB  00:00:09     \nRetrieving key from https://mirrors.aliyun.com/docker-ce/linux/centos/gpg\nImporting GPG key 0x621E9F35:\n Userid     : "Docker Release (CE rpm) <docker@docker.com>"\n Fingerprint: 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35\n From       : https://mirrors.aliyun.com/docker-ce/linux/centos/gpg\nIs this ok [y/N]: y\n')])])]),a("ul",[a("li",[e._v("方式二")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[e._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@CentOS-7 ~]# curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun\n# Executing docker install script, commit: 614d05e0e669a0577500d055677bb6f71e822356\n+ sh -c 'yum install -y -q yum-utils'\nDelta RPMs disabled because /usr/bin/applydeltarpm not installed.\nwarning: /var/cache/yum/x86_64/7/base/packages/yum-utils-1.1.31-54.el7_8.noarch.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY\nPublic key for yum-utils-1.1.31-54.el7_8.noarch.rpm is not installed\nPublic key for libxml2-python-2.9.1-6.el7_9.6.x86_64.rpm is not installed\nImporting GPG key 0xF4A80EB5:\n Userid     : \"CentOS-7 Key (CentOS 7 Official Signing Key) <security@centos.org>\"\n Fingerprint: 6341 ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5\n Package    : centos-release-7-9.2009.0.el7.centos.x86_64 (@anaconda)\n From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7\n+ sh -c 'yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo'\nLoaded plugins: fastestmirror\nadding repo from: https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\ngrabbing file https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo\nrepo saved to /etc/yum.repos.d/docker-ce.repo\n+ '[' stable '!=' stable ']'\n+ sh -c 'yum makecache'\nLoaded plugins: fastestmirror\nLoading mirror speeds from cached hostfile\n * base: mirrors.ustc.edu.cn\n * extras: mirrors.aliyun.com\n * updates: mirrors.aliyun.com\nbase                                                                                                                                                                                                                                                  | 3.6 kB  00:00:00     \ndocker-ce-stable                                                                                                                                                                                                                                      | 3.5 kB  00:00:00     \nextras                                                                                                                                                                                                                                                | 2.9 kB  00:00:00     \nupdates                                                                                                                                                                                                                                               | 2.9 kB  00:00:00     \n(1/10): docker-ce-stable/7/x86_64/updateinfo                                                                                                                                                                                                          |   55 B  00:00:00     \n(2/10): base/7/x86_64/other_db                                                                                                                                                                                                                        | 2.6 MB  00:00:01     \n(3/10): docker-ce-stable/7/x86_64/primary_db                                                                                                                                                                                                          |  78 kB  00:00:00     \n(4/10): extras/7/x86_64/other_db                                                                                                                                                                                                                      | 147 kB  00:00:00     \n(5/10): docker-ce-stable/7/x86_64/other_db                                                                                                                                                                                                            | 124 kB  00:00:00     \n(6/10): docker-ce-stable/7/x86_64/filelists_db                                                                                                                                                                                                        |  32 kB  00:00:01     \n(7/10): updates/7/x86_64/other_db                                                                                                                                                                                                                     | 1.0 MB  00:00:00     \n(8/10): base/7/x86_64/filelists_db                                                                                                                                                                                                                    | 7.2 MB  00:00:01     \n(9/10): extras/7/x86_64/filelists_db                                                                                                                                                                                                                  | 277 kB  00:00:00     \n(10/10): updates/7/x86_64/filelists_db                                                                                                                                                                                                                | 8.2 MB  00:00:04     \nMetadata Cache Created\n+ sh -c 'yum install -y -q docker-ce docker-ce-cli containerd.io docker-scan-plugin docker-compose-plugin docker-ce-rootless-extras'\nwarning: /var/cache/yum/x86_64/7/docker-ce-stable/packages/docker-ce-20.10.16-3.el7.x86_64.rpm: Header V4 RSA/SHA512 Signature, key ID 621e9f35: NOKEY\nPublic key for docker-ce-20.10.16-3.el7.x86_64.rpm is not installed\nImporting GPG key 0x621E9F35:\n Userid     : \"Docker Release (CE rpm) <docker@docker.com>\"\n Fingerprint: 060a 61c5 1b55 8a7f 742b 77aa c52f eb6b 621e 9f35\n From       : https://mirrors.aliyun.com/docker-ce/linux/centos/gpg\n\n================================================================================\n\nTo run Docker as a non-privileged user, consider setting up the\nDocker daemon in rootless mode for your user:\n\n    dockerd-rootless-setuptool.sh install\n\nVisit https://docs.docker.com/go/rootless/ to learn about rootless mode.\n\n\nTo run the Docker daemon as a fully privileged service, but granting non-root\nusers access, refer to https://docs.docker.com/go/daemon-access/\n\nWARNING: Access to the remote API on a privileged Docker daemon is equivalent\n         to root access on the host. Refer to the 'Docker daemon attack surface'\n         documentation for details: https://docs.docker.com/go/attack-surface/\n\n================================================================================\n\n[root@manager1 ~]# find / -name docker-compose \n/usr/libexec/docker/cli-plugins/docker-compose\n[root@manager1 cli-plugins]# docker compose version\nDocker Compose version v2.5.0\n")])])]),a("h5",{attrs:{id:"_2-5-docker的启动与停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-docker的启动与停止"}},[e._v("#")]),e._v(" 2.5 Docker的启动与停止")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 启动 docker\n[root@Docker ~]# systemctl start docker\n# 停止 docker\n[root@Docker ~]# systemctl stop docker \n# 重启 docker\n[root@Docker ~]# systemctl restart docker\n# 设置开机启动\n[root@Docker ~]# systemctl enable docker\n# 查看 docker 状态\n[root@Docker ~]# systemctl status docker\n\n\n# 查看 docker 内容器的运行状态\n[root@Docker ~]# docker stats\n# 查看 docker 概要信息\n[root@Docker ~]# docker info\nClient:\n Context:    default\n Debug Mode: false\n Plugins:\n  app: Docker App (Docker Inc., v0.9.1-beta3)\n  buildx: Build with BuildKit (Docker Inc., v0.6.3-docker)\n  scan: Docker Scan (Docker Inc., v0.8.0)\n\nServer:\n Containers: 0\n  Running: 0\n  Paused: 0\n  Stopped: 0\n Images: 0\n Server Version: 20.10.9\n Storage Driver: overlay2\n  Backing Filesystem: xfs\n  Supports d_type: true\n  Native Overlay Diff: true\n  userxattr: false\n Logging Driver: json-file\n Cgroup Driver: cgroupfs\n Cgroup Version: 1\n Plugins:\n  Volume: local\n  Network: bridge host ipvlan macvlan null overlay\n  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog\n Swarm: inactive\n Runtimes: runc io.containerd.runc.v2 io.containerd.runtime.v1.linux\n Default Runtime: runc\n Init Binary: docker-init\n containerd version: 5b46e404f6b9f661a205e28d59c982d3634148f8\n runc version: v1.0.2-0-g52b36a2\n init version: de40ad0\n Security Options:\n  seccomp\n   Profile: default\n Kernel Version: 3.10.0-1160.el7.x86_64\n Operating System: CentOS Linux 7 (Core)\n OSType: linux\n Architecture: x86_64\n CPUs: 1\n Total Memory: 487MiB\n Name: Docker\n ID: WJWC:6F7P:VDUH:AZ5N:N7DC:K6VV:ICVW:ENXO:OUZM:UWWJ:DL3L:HULP\n Docker Root Dir: /var/lib/docker\n Debug Mode: false\n Registry: https://index.docker.io/v1/\n Labels:\n Experimental: false\n Insecure Registries:\n  127.0.0.0/8\n Live Restore Enabled: false\n\n# 查看 docker 帮助文档\n[root@Docker ~]# docker --help\n")])])]),a("h5",{attrs:{id:"_2-6-安装验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-安装验证"}},[e._v("#")]),e._v(" 2.6 安装验证")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[root@Docker ~]# docker -v\nDocker version 20.10.9, build c2ea9bc\n\n[root@Docker ~]# docker version\nClient: Docker Engine - Community\n Version:           20.10.9\n API version:       1.41\n Go version:        go1.16.8\n Git commit:        c2ea9bc\n Built:             Mon Oct  4 16:08:14 2021\n OS/Arch:           linux/amd64\n Context:           default\n Experimental:      true\n\nServer: Docker Engine - Community\n Engine:\n  Version:          20.10.9\n  API version:      1.41 (minimum version 1.12)\n  Go version:       go1.16.8\n  Git commit:       79ea9d3\n  Built:            Mon Oct  4 16:06:37 2021\n  OS/Arch:          linux/amd64\n  Experimental:     false\n containerd:\n  Version:          1.4.11\n  GitCommit:        5b46e404f6b9f661a205e28d59c982d3634148f8\n runc:\n  Version:          1.0.2\n  GitCommit:        v1.0.2-0-g52b36a2\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0\n")])])]),a("h4",{attrs:{id:"_3-0-配置镜像加速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-配置镜像加速"}},[e._v("#")]),e._v(" 3.0 配置镜像加速")]),e._v(" "),a("ul",[a("li",[e._v("中国科学技术大学（LUG@USTC）的开源镜像：https://docker.mirrors.ustc.edu.cn")]),e._v(" "),a("li",[e._v("网易的开源镜像：http://hub-mirror.c.163.com")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('[root@Docker ~]# ls /etc/docker/\nkey.json\n\n[root@Docker ~]# vim /etc/docker/daemon.json\n{\n  "registry-mirrors": ["https://docker.mirrors.ustc.edu.cn", "http://hub-mirror.c.163.com"]\n}\n"/etc/docker/daemon.json" [New] 3L, 96C written  \n\n重新加载配置信息及重启 Docker 服务\n# 重新加载某个服务的配置文件\n[root@Docker ~]# systemctl daemon-reload\n# 重新启动 docker\n[root@Docker ~]# systemctl restart docker\n\n')])])]),a("h4",{attrs:{id:"_4-0-hello-world"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-0-hello-world"}},[e._v("#")]),e._v(" 4.0 hello-world")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# https://hub.docker.com/_/hello-world\n[root@Docker ~]# docker run hello-world\nUnable to find image 'hello-world:latest' locally # 本地找不到 hello-world 镜像\nlatest: Pulling from library/hello-world # 拉取最新版本的 hello-world 镜像\n2db29710123e: Pull complete \nDigest: sha256:37a0b92b08d4919615c3ee023f7ddb068d12b8387475d64c622ac30f45c29c51\nStatus: Downloaded newer image for hello-world:latest\n\n# 看到此消息表示您已正常安装。\nHello from Docker!\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n 1. The Docker client contacted the Docker daemon.\n 2. The Docker daemon pulled the \"hello-world\" image from the Docker Hub.\n    (amd64)\n 3. The Docker daemon created a new container from that image which runs the\n    executable that produces the output you are currently reading.\n 4. The Docker daemon streamed that output to the Docker client, which sent it\n    to your terminal.\n\nTo try something more ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu bash\n\nShare images, automate workflows, and more with a free Docker ID:\n https://hub.docker.com/\n\nFor more examples and ideas, visit:\n https://docs.docker.com/get-started/\n")])])]),a("h3",{attrs:{id:"修改docker默认镜像和容器存储位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改docker默认镜像和容器存储位置"}},[e._v("#")]),e._v(" 修改Docker默认镜像和容器存储位置")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('1、查看当前docker的默认存储目录\n[root@5agr99kespnzks ~]# docker info | grep \'Docker Root Dir\'    \n Docker Root Dir: /var/lib/docker\n[root@5agr99kespnzks ~]# docker images\nREPOSITORY         TAG            IMAGE ID       CREATED         SIZE\ngitlab/gitlab-ee   15.10.0-ee.0   70f83fb3b54d   17 months ago   3.18GB\n2、停止docker服务\n[root@5agr99kespnzks ~]# systemctl stop docker && systemctl stop docker.socket \n3、目录迁移\n\n创建新的docker目录\n[root@5agr99kespnzks ~]# mkdir -p /mydata/docker\n迁移/var/lib/docker目录下面的文件到 /home/docker\n[root@5agr99kespnzks ~]# mv /var/lib/docker/* /mydata/docker/\n4、修改配置文件\n[root@5agr99kespnzks ~]# vi /etc/docker/daemon.json\n{\n    "registry-mirrors": ["https://docker.anyhub.us.kg"],\n    "data-root": "/mydata/docker"\n}\n5、重启 docker 服务\n[root@5agr99kespnzks ~]# systemctl daemon-reload && systemctl start docker\n6、检查docker存储路径是否配置成功\n[root@5agr99kespnzks ~]# docker info | grep \'Docker Root Dir\'\n Docker Root Dir: /mydata/docker\n[root@5agr99kespnzks ~]# docker --version\nDocker version 26.1.4, build 5650f9b\n')])])])])}),[],!1,null,null,null);r.default=t.exports}}]);