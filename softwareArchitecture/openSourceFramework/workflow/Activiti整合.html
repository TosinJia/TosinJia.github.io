<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TosinJia</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <link rel="icon" href="/images/favicon.ico">
    <meta name="description" content="TosinJia">
    
    <link rel="preload" href="/assets/css/0.styles.d77f493a.css" as="style"><link rel="preload" href="/assets/js/app.de0ffd6c.js" as="script"><link rel="preload" href="/assets/js/3.059a2ce3.js" as="script"><link rel="preload" href="/assets/js/15.94aa71a8.js" as="script"><link rel="prefetch" href="/assets/js/10.471d2f7d.js"><link rel="prefetch" href="/assets/js/11.64c9bea0.js"><link rel="prefetch" href="/assets/js/12.8cd035ea.js"><link rel="prefetch" href="/assets/js/13.ac133c7d.js"><link rel="prefetch" href="/assets/js/14.55b76568.js"><link rel="prefetch" href="/assets/js/16.6d62875d.js"><link rel="prefetch" href="/assets/js/17.d3dbf31d.js"><link rel="prefetch" href="/assets/js/18.5f3a7f7e.js"><link rel="prefetch" href="/assets/js/19.adf383b8.js"><link rel="prefetch" href="/assets/js/2.9d302d7a.js"><link rel="prefetch" href="/assets/js/20.1074faf8.js"><link rel="prefetch" href="/assets/js/21.05a74ab0.js"><link rel="prefetch" href="/assets/js/22.7f76ccfc.js"><link rel="prefetch" href="/assets/js/23.9304b5d5.js"><link rel="prefetch" href="/assets/js/24.86d2ac06.js"><link rel="prefetch" href="/assets/js/25.a13eba67.js"><link rel="prefetch" href="/assets/js/26.9baa244d.js"><link rel="prefetch" href="/assets/js/27.7a40c7b4.js"><link rel="prefetch" href="/assets/js/28.9e30bc88.js"><link rel="prefetch" href="/assets/js/29.5a968fce.js"><link rel="prefetch" href="/assets/js/30.8faabbe6.js"><link rel="prefetch" href="/assets/js/31.60e0f28d.js"><link rel="prefetch" href="/assets/js/32.7bb1d9af.js"><link rel="prefetch" href="/assets/js/33.6f86b100.js"><link rel="prefetch" href="/assets/js/34.84067eaf.js"><link rel="prefetch" href="/assets/js/35.b2b8ac8d.js"><link rel="prefetch" href="/assets/js/36.7fc4dbe8.js"><link rel="prefetch" href="/assets/js/37.7849bc09.js"><link rel="prefetch" href="/assets/js/38.235de5e3.js"><link rel="prefetch" href="/assets/js/39.161f213e.js"><link rel="prefetch" href="/assets/js/4.335c6a02.js"><link rel="prefetch" href="/assets/js/40.f3b94ce2.js"><link rel="prefetch" href="/assets/js/41.fdc5ac1f.js"><link rel="prefetch" href="/assets/js/42.9d9ce856.js"><link rel="prefetch" href="/assets/js/43.883aa723.js"><link rel="prefetch" href="/assets/js/44.09215286.js"><link rel="prefetch" href="/assets/js/45.dae7f7c0.js"><link rel="prefetch" href="/assets/js/46.66c92fb8.js"><link rel="prefetch" href="/assets/js/47.575074f0.js"><link rel="prefetch" href="/assets/js/48.3e1ece3e.js"><link rel="prefetch" href="/assets/js/49.42212c07.js"><link rel="prefetch" href="/assets/js/5.2f47cbe8.js"><link rel="prefetch" href="/assets/js/50.47bec168.js"><link rel="prefetch" href="/assets/js/51.742ddc89.js"><link rel="prefetch" href="/assets/js/52.6876737a.js"><link rel="prefetch" href="/assets/js/53.5e1f3810.js"><link rel="prefetch" href="/assets/js/54.3dbad0f1.js"><link rel="prefetch" href="/assets/js/55.f233405f.js"><link rel="prefetch" href="/assets/js/56.d1566959.js"><link rel="prefetch" href="/assets/js/57.a58e03cf.js"><link rel="prefetch" href="/assets/js/6.e8a5dbcd.js"><link rel="prefetch" href="/assets/js/7.fe9d2c9f.js"><link rel="prefetch" href="/assets/js/8.0880906a.js"><link rel="prefetch" href="/assets/js/9.6e293cc6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d77f493a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">TosinJia</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件架构" class="dropdown-title"><span class="title">软件架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件架构" class="mobile-dropdown-title"><span class="title">软件架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/relatedTechnology.html" class="nav-link">
  相关技术
</a></li><li class="dropdown-item"><h4>
          开源框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/introduction.html" class="nav-link">
  简介
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/fontEnd/" class="nav-link">
  前端框架
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-vue/" class="nav-link">
  RuoYi-Vue
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud/" class="nav-link">
  RuoYi-Cloud
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作流" class="dropdown-title"><span class="title">工作流</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作流" class="mobile-dropdown-title"><span class="title">工作流</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/" class="nav-link router-link-active">
  Activiti
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti基础.html" class="nav-link">
  Activiti基础
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti进阶.html" class="nav-link">
  Activiti进阶
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti整合.html" class="nav-link">
  Activiti整合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow down"></span></button> <button type="button" aria-label="教程" class="mobile-dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tutorials/linuxTutorial.html" class="nav-link">
  Linux教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/maven.html" class="nav-link">
  Maven教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/gitTutorial.html" class="nav-link">
  Git教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/vueTutorial.html" class="nav-link">
  Vue教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/thymeleaf.html" class="nav-link">
  Thymeleaf教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/docker.html" class="nav-link">
  Docker教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/virtualMachine.html" class="nav-link">
  虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/JMeter.html" class="nav-link">
  JMeter
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/PowerDesigner.html" class="nav-link">
  PowerDesigner
</a></li><li class="dropdown-subitem"><a href="/database/oracle.html" class="nav-link">
  Oracle
</a></li><li class="dropdown-subitem"><a href="/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搭建" class="dropdown-title"><span class="title">搭建</span> <span class="arrow down"></span></button> <button type="button" aria-label="搭建" class="mobile-dropdown-title"><span class="title">搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/build/" class="nav-link">
  站点搭建
</a></li><li class="dropdown-item"><!----> <a href="/build/thirdPartyMd.html" class="nav-link">
  三方Markdown
</a></li></ul></div></div><div class="nav-item"><a href="https://www.bing.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件架构" class="dropdown-title"><span class="title">软件架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件架构" class="mobile-dropdown-title"><span class="title">软件架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/relatedTechnology.html" class="nav-link">
  相关技术
</a></li><li class="dropdown-item"><h4>
          开源框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/introduction.html" class="nav-link">
  简介
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/fontEnd/" class="nav-link">
  前端框架
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-vue/" class="nav-link">
  RuoYi-Vue
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud/" class="nav-link">
  RuoYi-Cloud
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作流" class="dropdown-title"><span class="title">工作流</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作流" class="mobile-dropdown-title"><span class="title">工作流</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/" class="nav-link router-link-active">
  Activiti
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti基础.html" class="nav-link">
  Activiti基础
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti进阶.html" class="nav-link">
  Activiti进阶
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti整合.html" class="nav-link">
  Activiti整合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow down"></span></button> <button type="button" aria-label="教程" class="mobile-dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tutorials/linuxTutorial.html" class="nav-link">
  Linux教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/maven.html" class="nav-link">
  Maven教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/gitTutorial.html" class="nav-link">
  Git教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/vueTutorial.html" class="nav-link">
  Vue教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/thymeleaf.html" class="nav-link">
  Thymeleaf教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/docker.html" class="nav-link">
  Docker教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/virtualMachine.html" class="nav-link">
  虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/JMeter.html" class="nav-link">
  JMeter
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/PowerDesigner.html" class="nav-link">
  PowerDesigner
</a></li><li class="dropdown-subitem"><a href="/database/oracle.html" class="nav-link">
  Oracle
</a></li><li class="dropdown-subitem"><a href="/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搭建" class="dropdown-title"><span class="title">搭建</span> <span class="arrow down"></span></button> <button type="button" aria-label="搭建" class="mobile-dropdown-title"><span class="title">搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/build/" class="nav-link">
  站点搭建
</a></li><li class="dropdown-item"><!----> <a href="/build/thirdPartyMd.html" class="nav-link">
  三方Markdown
</a></li></ul></div></div><div class="nav-item"><a href="https://www.bing.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_1-1-activiti与spring整合的配置" class="sidebar-link">1.1 Activiti与Spring整合的配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_1-、在pom-xml文件引入坐标" class="sidebar-link">1)、在pom.xml文件引入坐标</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-、创建activiti-spring-xml" class="sidebar-link">2)、创建activiti-spring.xml</a></li></ul></li><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_1-2-测试activiti与spring整合" class="sidebar-link">1.2 测试Activiti与Spring整合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_1-、测试代码" class="sidebar-link">1）、测试代码</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-、执行流程分析" class="sidebar-link">2）、执行流程分析</a></li></ul></li><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-1-springboot整合activiti7的配置" class="sidebar-link">2.1     SpringBoot整合Activiti7的配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-2-springboot的application-yml文件配置" class="sidebar-link">2.2    SpringBoot的application.yml文件配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-3-编写启动类" class="sidebar-link">2.3 编写启动类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-4-添加springsecurity安全框架整合配置" class="sidebar-link">2.4    添加SpringSecurity安全框架整合配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-4-1-添加securityutil类" class="sidebar-link">2.4.1  添加SecurityUtil类</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-4-2-添加demoapplicationconfig类" class="sidebar-link">2.4.2  添加DemoApplicationConfig类</a></li></ul></li><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-5-创建bpmn文件" class="sidebar-link">2.5 创建Bpmn文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#_2-6-使用junit方式测试" class="sidebar-link">2.6    使用Junit方式测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#src-test-java-com-itheima-test-testactiviti-java" class="sidebar-link">src/test/java/com/itheima/test/TestActiviti.java</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/workflow/Activiti%E6%95%B4%E5%90%88.html#src-test-java-com-itheima-test-itestactiviti-java" class="sidebar-link">src/test/java/com/itheima/test/iTestActiviti.java</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#activiti整合spring">Activiti整合Spring</a></li><li><a href="#一、activiti与spring整合开发">一、Activiti与Spring整合开发</a><ul><li><a href="#_1-1-activiti与spring整合的配置">1.1 Activiti与Spring整合的配置</a><ul><li><a href="#_1-、在pom-xml文件引入坐标">1)、在pom.xml文件引入坐标</a></li><li><a href="#_2-、创建activiti-spring-xml">2)、创建activiti-spring.xml</a></li></ul></li><li><a href="#_1-2-测试activiti与spring整合">1.2 测试Activiti与Spring整合</a><ul><li><a href="#_1-、测试代码">1）、测试代码</a></li><li><a href="#_2-、执行流程分析">2）、执行流程分析</a></li></ul></li></ul></li><li><a href="#二、activiti7与springboot整合开发">二、Activiti7与SpringBoot整合开发</a><ul><li><a href="#_2-1-springboot整合activiti7的配置">2.1     SpringBoot整合Activiti7的配置</a></li><li><a href="#_2-2-springboot的application-yml文件配置">2.2    SpringBoot的application.yml文件配置</a></li><li><a href="#_2-3-编写启动类">2.3 编写启动类</a></li><li><a href="#_2-4-添加springsecurity安全框架整合配置">2.4    添加SpringSecurity安全框架整合配置</a><ul><li><a href="#_2-4-1-添加securityutil类">2.4.1  添加SecurityUtil类</a></li><li><a href="#_2-4-2-添加demoapplicationconfig类">2.4.2  添加DemoApplicationConfig类</a></li></ul></li><li><a href="#_2-5-创建bpmn文件">2.5 创建Bpmn文件</a></li><li><a href="#_2-6-使用junit方式测试">2.6    使用Junit方式测试</a><ul><li><a href="#src-test-java-com-itheima-test-testactiviti-java">src/test/java/com/itheima/test/TestActiviti.java</a></li><li><a href="#src-test-java-com-itheima-test-itestactiviti-java">src/test/java/com/itheima/test/iTestActiviti.java</a></li></ul></li></ul></li></ul></div><p></p> <h1 id="activiti整合spring"><a href="#activiti整合spring" class="header-anchor">#</a> Activiti整合Spring</h1> <h1 id="一、activiti与spring整合开发"><a href="#一、activiti与spring整合开发" class="header-anchor">#</a> 一、Activiti与Spring整合开发</h1> <h2 id="_1-1-activiti与spring整合的配置"><a href="#_1-1-activiti与spring整合的配置" class="header-anchor">#</a> 1.1 Activiti与Spring整合的配置</h2> <h3 id="_1-、在pom-xml文件引入坐标"><a href="#_1-、在pom-xml文件引入坐标" class="header-anchor">#</a> 1)、在pom.xml文件引入坐标</h3> <p>如下</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>1.6.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j.version</span><span class="token punctuation">&gt;</span></span>1.2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-engine<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-bpmn-model<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-bpmn-converter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-json-converter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-bpmn-layout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-cloud-services-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.5.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.40<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.0.7.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- log start --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${log4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-nop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- log end --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-dbcp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-dbcp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>alfresco<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Activiti Releases<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://artifacts.alfresco.com/nexus/content/repositories/activiti-releases/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>releases</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>releases</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在Activiti中核心类的是ProcessEngine流程引擎，与Spring整合就是让Spring来管理ProcessEngine</p> <p>通过org.activiti.spring.SpringProcessEngineConfiguration 与Spring整合方式来创建ProcessEngine对象。</p> <p>创建spring与activiti的整合配置文件：activiti-spring.xml（名称不固定）</p> <h3 id="_2-、创建activiti-spring-xml"><a href="#_2-、创建activiti-spring-xml" class="header-anchor">#</a> 2)、创建activiti-spring.xml</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>tx</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/tx<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 数据源 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.commons.dbcp.BasicDataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>driverClassName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.mysql.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/activiti<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>maxActive<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>maxIdle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 工作流引擎配置bean --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngineConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.activiti.spring.SpringProcessEngineConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 数据源 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 使用spring事务管理器 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 数据库策略 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>databaseSchemaUpdate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>drop-create<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 流程引擎 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngine<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.activiti.spring.ProcessEngineFactoryBean<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngineConfiguration<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngineConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 资源服务service --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>repositoryService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngine<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getRepositoryService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 流程运行service --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>runtimeService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngine<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getRuntimeService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 任务管理service --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>taskService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngine<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getTaskService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 历史管理service --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>historyService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>processEngine<span class="token punctuation">&quot;</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>getHistoryService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 事务管理器 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.jdbc.datasource.DataSourceTransactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dataSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 通知 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>advice</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txAdvice<span class="token punctuation">&quot;</span></span> <span class="token attr-name">transaction-manager</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>transactionManager<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 传播行为 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>save*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>insert*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>delete*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>update*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>REQUIRED<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>find*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SUPPORTS<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tx:</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>get*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">propagation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>SUPPORTS<span class="token punctuation">&quot;</span></span> <span class="token attr-name">read-only</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>attributes</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tx:</span>advice</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 切面，根据具体项目修改切点配置
    &lt;aop:config proxy-target-class=&quot;true&quot;&gt;
        &lt;aop:advisor advice-ref=&quot;txAdvice&quot;
                     pointcut=&quot;execution(*com.itheima.service.impl..(..))&quot;/&gt;
    &lt;/aop:config&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>databaseSchemaUpdate的取值内容：</p> <p>flase：       默认值。activiti在启动时，会对比数据库表中保存的版本，如果没有表或者版本不匹配，将抛出异常。（生产环境常用）
true：        activiti会对数据库中所有表进行更新操作。如果表不存在，则自动创建。（开发时常用）
create_drop： 在activiti启动时创建表，在关闭时删除表（必须手动关闭引擎，才能删除表）。（单元测试常用）
drop-create： 在activiti启动时删除原来的旧表，然后在创建新表（不需要手动关闭引擎）。</p> <h2 id="_1-2-测试activiti与spring整合"><a href="#_1-2-测试activiti与spring整合" class="header-anchor">#</a> 1.2 测试Activiti与Spring整合</h2> <h3 id="_1-、测试代码"><a href="#_1-、测试代码" class="header-anchor">#</a> 1）、测试代码</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
   测试activiti与spring整合是否成功
**/</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>locations <span class="token operator">=</span> <span class="token string">&quot;classpath:activiti-spring.xml&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiTest</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Autowired</span>
     <span class="token keyword">private</span> <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>
     
     <span class="token annotation punctuation">@Test</span>
     <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;部署对象:&quot;</span><span class="token operator">+</span>repositoryService<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-、执行流程分析"><a href="#_2-、执行流程分析" class="header-anchor">#</a> 2）、执行流程分析</h3> <p>下面我们一起来分析Activiti与Spring整合加载的过程。</p> <p>1、加载activiti-spring.xml配置文件</p> <p>2、加载SpringProcessEngineConfiguration对象，这个对象它需要依赖注入dataSource对象和transactionManager对象。</p> <p>3、加载ProcessEngineFactoryBean工厂来创建ProcessEngine对象，而ProcessEngineFactoryBean工厂又需要依赖注入processEngineConfiguration对象。</p> <p>4、processEngine对象来负责创建我们的Service对象，从而简化Activiti的开发过程。</p> <h1 id="二、activiti7与springboot整合开发"><a href="#二、activiti7与springboot整合开发" class="header-anchor">#</a> 二、Activiti7与SpringBoot整合开发</h1> <p>Activiti7发布正式版之后，它与SpringBoot2.x已经完全支持整合开发。</p> <h2 id="_2-1-springboot整合activiti7的配置"><a href="#_2-1-springboot整合activiti7的配置" class="header-anchor">#</a> 2.1     SpringBoot整合Activiti7的配置</h2> <p>为了能够实现SpringBoot与Activiti7整合开发，首先我们要引入相关的依赖支持。</p> <p>在工程的pom.xml文件中引入相关的依赖，其中activiti的依赖是：activiti-spring-boot-starter。</p> <p>具体依赖如下所示：</p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.reporting.outputEncoding</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.activiti<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>activiti-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.0.0.Beta2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.29<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>通过该pom.xml文件所导入的坐标，我们就可以实现activiti7与Springboot整合。</p> <h2 id="_2-2-springboot的application-yml文件配置"><a href="#_2-2-springboot的application-yml文件配置" class="header-anchor">#</a> 2.2    SpringBoot的application.yml文件配置</h2> <p>为了能够实现Activiti7生成的表放到Mysql数据库中，需要在配置文件application.yml中添加相关的配置</p> <p>注意：activiti7默认没有开启数据库历史记录，需要手动配置开启</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>///activiti<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;serverTimezone=GMT</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
  <span class="token key atrule">activiti</span><span class="token punctuation">:</span>
    <span class="token comment">#1.flase：默认值。activiti在启动时，对比数据库表中保存的版本，如果没有表或者版本不匹配，将抛出异常</span>
    <span class="token comment">#2.true： activiti会对数据库中所有表进行更新操作。如果表不存在，则自动创建</span>
    <span class="token comment">#3.create_drop： 在activiti启动时创建表，在关闭时删除表（必须手动关闭引擎，才能删除表）</span>
    <span class="token comment">#4.drop-create： 在activiti启动时删除原来的旧表，然后在创建新表（不需要手动关闭引擎）</span>
    <span class="token key atrule">database-schema-update</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#检测历史表是否存在 activiti7默认没有开启数据库历史记录 启动数据库历史记录</span>
    <span class="token key atrule">db-history-used</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment">#记录历史等级 可配置的历史级别有none, activity, audit, full</span>
    <span class="token comment">#none：不保存任何的历史数据，因此，在流程执行过程中，这是最高效的。</span>
    <span class="token comment">#activity：级别高于none，保存流程实例与流程行为，其他数据不保存。</span>
    <span class="token comment">#audit：除activity级别会保存的数据外，还会保存全部的流程任务及其属性。audit为history的默认值。</span>
    <span class="token comment">#full：保存历史数据的最高级别，除了会保存audit级别的数据外，还会保存其他全部流程相关的细节数据，包括一些流程参数等。</span>
    <span class="token key atrule">history-level</span><span class="token punctuation">:</span> full
    <span class="token comment">#校验流程文件，默认校验resources下的processes文件夹里的流程文件</span>
    <span class="token key atrule">check-process-definitions</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><h2 id="_2-3-编写启动类"><a href="#_2-3-编写启动类" class="header-anchor">#</a> 2.3 编写启动类</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ActApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_2-4-添加springsecurity安全框架整合配置"><a href="#_2-4-添加springsecurity安全框架整合配置" class="header-anchor">#</a> 2.4    添加SpringSecurity安全框架整合配置</h2> <p>因为Activiti7与SpringBoot整合后，默认情况下，集成了SpringSecurity安全框架，这样我们就要去准备SpringSecurity整合进来的相关用户权限配置信息。</p> <p>SpringBoot的依赖包已经将SpringSecurity的依赖包也添加进项目中。</p> <h3 id="_2-4-1-添加securityutil类"><a href="#_2-4-1-添加securityutil类" class="header-anchor">#</a> 2.4.1  添加SecurityUtil类</h3> <p>为了能够快速实现SpringSecurity安全框架的配置，所添加的一个组件。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">Authentication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SecurityContextHolder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SecurityContextImpl</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetails</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SecurityUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token annotation punctuation">@Autowired</span>
     <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;myUserDetailsService&quot;</span><span class="token punctuation">)</span>
     <span class="token keyword">private</span> <span class="token class-name">UserDetailsService</span> userDetailsService<span class="token punctuation">;</span>
 
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">UserDetails</span> user <span class="token operator">=</span> userDetailsService<span class="token punctuation">.</span><span class="token function">loadUserByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;User &quot;</span> <span class="token operator">+</span> username <span class="token operator">+</span> <span class="token string">&quot; doesn't exist, please provide a valid user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;&gt; Logged in as: &quot;</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">setContext</span><span class="token punctuation">(</span>
             <span class="token keyword">new</span> <span class="token class-name">SecurityContextImpl</span><span class="token punctuation">(</span>
                     <span class="token keyword">new</span> <span class="token class-name">Authentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                         <span class="token annotation punctuation">@Override</span>
                         <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                             <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getAuthorities</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                         <span class="token punctuation">}</span>
                         <span class="token annotation punctuation">@Override</span>
                         <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                             <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                         <span class="token punctuation">}</span>
                         <span class="token annotation punctuation">@Override</span>
                         <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getDetails</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                             <span class="token keyword">return</span> user<span class="token punctuation">;</span>
                         <span class="token punctuation">}</span>
                         <span class="token annotation punctuation">@Override</span>
                         <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                             <span class="token keyword">return</span> user<span class="token punctuation">;</span>
                         <span class="token punctuation">}</span>
                         <span class="token annotation punctuation">@Override</span>
                         <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                             <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                         <span class="token punctuation">}</span>
                         <span class="token annotation punctuation">@Override</span>
                         <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAuthenticated</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isAuthenticated<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
                         <span class="token annotation punctuation">@Override</span>
                         <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                             <span class="token keyword">return</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>identity<span class="token punctuation">.</span></span>Authentication</span><span class="token punctuation">.</span><span class="token function">setAuthenticatedUserId</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>这个类可以从我们下载的Activiti7官方提供的Example中找到。</p> <h3 id="_2-4-2-添加demoapplicationconfig类"><a href="#_2-4-2-添加demoapplicationconfig类" class="header-anchor">#</a> 2.4.2  添加DemoApplicationConfig类</h3> <p>在Activiti7官方下载的Example中找到DemoApplicationConfig类，它的作用是为了实现SpringSecurity框架的用户权限的配置，这样我们就可以在系统中使用用户权限信息。</p> <p>本次项目中基本是在文件中定义出来的用户信息，当然也可以是数据库中查询的用户权限信息。</p> <p>后面处理流程时用到的任务负责人，需要添加在这里</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>authority<span class="token punctuation">.</span></span><span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span><span class="token class-name">UserDetailsService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>bcrypt<span class="token punctuation">.</span></span><span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>password<span class="token punctuation">.</span></span><span class="token class-name">PasswordEncoder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>provisioning<span class="token punctuation">.</span></span><span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplicationConfiguration</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">DemoApplicationConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token annotation punctuation">@Bean</span>
     <span class="token keyword">public</span> <span class="token class-name">UserDetailsService</span> <span class="token function">myUserDetailsService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">InMemoryUserDetailsManager</span> inMemoryUserDetailsManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryUserDetailsManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//这里添加用户，后面处理流程时用到的任务负责人，需要添加在这里</span>
         <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> usersGroupsAndRoles <span class="token operator">=</span> <span class="token punctuation">{</span>
                 <span class="token punctuation">{</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                 <span class="token punctuation">{</span><span class="token string">&quot;rose&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                 <span class="token punctuation">{</span><span class="token string">&quot;tom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_activitiTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                 <span class="token punctuation">{</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP_otherTeam&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                 <span class="token punctuation">{</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_USER&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                 <span class="token punctuation">{</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROLE_ACTIVITI_ADMIN&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>

         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> user <span class="token operator">:</span> usersGroupsAndRoles<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> authoritiesStrings <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;&gt; Registering new user: &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; with the following Authorities[&quot;</span> <span class="token operator">+</span> authoritiesStrings <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             inMemoryUserDetailsManager<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>user<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     authoritiesStrings<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SimpleGrantedAuthority</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token keyword">return</span> inMemoryUserDetailsManager<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token annotation punctuation">@Bean</span>
     <span class="token keyword">public</span> <span class="token class-name">PasswordEncoder</span> <span class="token function">passwordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-5-创建bpmn文件"><a href="#_2-5-创建bpmn文件" class="header-anchor">#</a> 2.5 创建Bpmn文件</h2> <blockquote><p>Activiti7可以自动部署流程，前提是在resources目录下，创建一个新的目录processes，用来放置bpmn文件。</p></blockquote> <p>创建一个简单的Bpmn流程文件，并设置任务的用户组Candidate Groups。</p> <p>Candidate Groups中的内容与上面DemoApplicationConfiguration类中出现的用户组名称要保持一致，可以填写：activitiTeam 或者 otherTeam。</p> <p>这样填写的好处：当不确定到底由谁来负责当前任务的时候，只要是Groups内的用户都可以拾取这个任务</p> <p><img src="/assets/img/1578369213.bb6d7758.png" alt=""></p> <h2 id="_2-6-使用junit方式测试"><a href="#_2-6-使用junit方式测试" class="header-anchor">#</a> 2.6    使用Junit方式测试</h2> <h3 id="src-test-java-com-itheima-test-testactiviti-java"><a href="#src-test-java-com-itheima-test-testactiviti-java" class="header-anchor">#</a> src/test/java/com/itheima/test/TestActiviti.java</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">SecurityUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">ProcessPayloadBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessRuntime</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Task</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>model<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">TaskRuntime</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Actviti7DemoApplicationTests</span> <span class="token punctuation">{</span>
     <span class="token annotation punctuation">@Autowired</span>
     <span class="token keyword">private</span> <span class="token class-name">ProcessRuntime</span> processRuntime<span class="token punctuation">;</span>
     <span class="token annotation punctuation">@Autowired</span>
     <span class="token keyword">private</span> <span class="token class-name">TaskRuntime</span> taskRuntime<span class="token punctuation">;</span>
     <span class="token annotation punctuation">@Autowired</span>
     <span class="token keyword">private</span> <span class="token class-name">SecurityUtil</span> securityUtil<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testActBoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>taskRuntime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查看流程定义
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>ProcessDefinition</span><span class="token punctuation">&gt;</span></span> processDefinitionPage <span class="token operator">=</span>
                processRuntime<span class="token punctuation">.</span><span class="token function">processDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;可用的流程定义数量：&quot;</span> <span class="token operator">+</span> processDefinitionPage<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span>ProcessDefinition</span> pd <span class="token operator">:</span> processDefinitionPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程定义：&quot;</span> <span class="token operator">+</span> pd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 启动流程实例
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStartProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;system&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProcessInstance</span> pi <span class="token operator">=</span> processRuntime<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">ProcessPayloadBuilder</span><span class="token punctuation">.</span>
                <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">withProcessDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;myProcess&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;流程实例ID：&quot;</span> <span class="token operator">+</span> pi<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     **查询任务，并完成自己的任务
     **/</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;jack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskPage<span class="token operator">=</span>taskRuntime<span class="token punctuation">.</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskPage<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Task</span> task<span class="token operator">:</span>taskPage<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                taskRuntime<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span>
                        <span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">withTaskId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务：&quot;</span><span class="token operator">+</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                taskRuntime<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span>
                        <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                        <span class="token function">withTaskId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> taskPage2<span class="token operator">=</span>taskRuntime<span class="token punctuation">.</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span>of<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>taskPage2<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;任务：&quot;</span><span class="token operator">+</span>taskPage2<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="src-test-java-com-itheima-test-itestactiviti-java"><a href="#src-test-java-com-itheima-test-itestactiviti-java" class="header-anchor">#</a> src/test/java/com/itheima/test/iTestActiviti.java</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>test<span class="token punctuation">.</span>dot<span class="token punctuation">.</span></span><span class="token class-name">ActTaskDTO</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">JsonUtils</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">SecurityUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">ProcessInstance</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>model<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">ProcessPayloadBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>process<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">ProcessRuntime</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Task</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>model<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>api<span class="token punctuation">.</span>task<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span><span class="token class-name">TaskRuntime</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>bpmn<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Process</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>bpmn<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">HistoryService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">RepositoryService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">RuntimeService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>history<span class="token punctuation">.</span></span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>history<span class="token punctuation">.</span></span><span class="token class-name">HistoricProcessInstance</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>history<span class="token punctuation">.</span></span><span class="token class-name">HistoricTaskInstance</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Deployment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ProcessDefinition</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">ProcessDefinitionQuery</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * 	部署ID f6fbfa74-2383-11ed-9ba4-0a0027000002 act_re_deployment ID_;ACT_RE_PROCDEF DEPLOYMENT_ID_
 * 	实例ID 81ffdcf5-2353-11ed-aaec-0a0027000002 act_ru_execution ID_
 * 	流程ID testleave1:1:67ed4864-2346-11ed-bd18-0a0027000002 act_ru_execution PROC_DEF_ID_
 * 	任务ID 1bfa4bdb-22b0-11ed-a687-0a0027000002 act_ru_task ID_
 *
 * 定义
 * 实例
 * 任务
 *
 * 类似 TestActiviti2.java
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> iTestActiviti <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RepositoryService</span> repositoryService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">HistoryService</span> historyService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RuntimeService</span> runtimeService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ProcessRuntime</span> processRuntime<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TaskRuntime</span> taskRuntime<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ProcessDefinitionQuery</span> processDefinitionQuery <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderByProcessDefinitionVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// java.lang.IllegalArgumentException: class org.activiti.engine.impl.ProcessDefinitionQueryImpl declares multiple JSON fields named databaseType</span>
<span class="token comment">//        JsonUtils.log(log, &quot;ProcessDefinitionQuery processDefinitionQuery:&quot;, processDefinitionQuery);</span>
        <span class="token class-name">List</span> list <span class="token operator">=</span> processDefinitionQuery<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;processDefinitionQuery.list()&quot;</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deploy1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 方式一</span>
<span class="token comment">//        ClassPathResource resource = new ClassPathResource(&quot;bpmn/testleave1.bpmn&quot;);</span>
<span class="token comment">//        InputStream inputStream = resource.getInputStream();</span>
<span class="token comment">//        Deployment deploy = repositoryService.createDeployment().addInputStream(&quot;testleave1.bpmn&quot;, resource).deploy();</span>
<span class="token comment">//        Deployment deploy = repositoryService.createDeployment()</span>
<span class="token comment">//                .addInputStream(&quot;testleave1.bpmn&quot;, inputStream)</span>
<span class="token comment">//                .deploy();</span>

        <span class="token comment">// 方式二</span>
<span class="token comment">//        3、使用service进行流程的部署，定义一个流程的名字，把bpmn和png部署到数据中</span>
        <span class="token class-name">Deployment</span> deploy <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">&quot;我的请假流程部署名称1&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addClasspathResource</span><span class="token punctuation">(</span><span class="token string">&quot;bpmn/ileave1.bpmn&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        4、输出部署信息</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;Deployment deploy:&quot;</span><span class="token punctuation">,</span> deploy<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//{&quot;name&quot;:&quot;测试请假流程-普通表单2&quot;,&quot;tenantId&quot;:&quot;&quot;,&quot;resources&quot;:{&quot;bpmn/testleave2.bpmn&quot;:{&quot;name&quot;:&quot;bpmn/testleave2.bpmn&quot;,&quot;bytes&quot;:[60,63,120,109,108,32,118,101,114,115,105,111,110,61,34,49,46,48,34,32,101,110,99,111,100,105,110,103,61,34,85,84,70,45,56,34,63,62,13,10,60,100,101,102,105,110,105,116,105,111,110,115,32,120,109,108,110,115,61,34,104,116,116,112,58,47,47,119,119,119,46,111,109,103,46,111,114,103,47,115,112,101,99,47,66,80,77,78,47,50,48,49,48,48,53,50,52,47,77,79,68,69,76,34,32,120,109,108,110,115,58,120,115,105,61,34,104,116,116,112,58,47,47,119,119,119,46,119,51,46,111,114,103,47,50,48,48,49,47,88,77,76,83,99,104,101,109,97,45,105,110,115,116,97,110,99,101,34,32,120,109,108,110,115,58,97,99,116,105,118,105,116,105,61,34,104,116,116,112,58,47,47,97,99,116,105,118,105,116,105,46,111,114,103,47,98,112,109,110,34,32,120,109,108,110,115,58,98,112,109,110,100,105,61,34,104,116,116,112,58,47,47,119,119,119,46,111,109,103,46,111,114,103,47,115,112,101,99,47,66,80,77,78,47,50,48,49,48,48,53,50,52,47,68,73,34,32,120,109,108,110,115,58,111,109,103,100,99,61,34,104,116,116,112,58,47,47,119,119,119,46,111,109,103,46,111,114,103,47,115,112,101,99,47,68,68,47,50,48,49,48,48,53,50,52,47,68,67,34,32,120,109,108,110,115,58,111,109,103,100,105,61,34,104,116,116,112,58,47,47,119,119,119,46,111,109,103,46,111,114,103,47,115,112,101,99,47,68,68,47,50,48,49,48,48,53,50,52,47,68,73,34,32,120,109,108,110,115,58,120,115,100,61,34,104,116,116,112,58,47,47,119,119,119,46,119,51,46,111,114,103,47,50,48,48,49,47,88,77,76,83,99,104,101,109,97,34,32,116,97,114,103,101,116,78,97,109,101,115,112,97,99,101,61,34,104,116,116,112,58,47,47,119,119,119,46,107,97,102,101,105,116,117,46,109,101,47,97,99,116,105,118,105,116,105,47,108,101,97,118,101,34,62,13,10,32,32,60,112,114,111,99,101,115,115,32,105,100,61,34,116,101,115,116,108,101,97,118,101,50,34,32,110,97,109,101,61,34,-26,-75,-117,-24,-81,-107,-24,-81,-73,-27,-127,-121,-26,-75,-127,-25,-88,-117,45,-26,-103,-82,-23,-128,-102,-24,-95,-88,-27,-115,-107,50,34,32,105,115,69,120,101,99,117,116,97,98,108,101,61,34,116,114,117,101,34,62,13,10,32,32,32,32,60,100,111,99,117,109,101,110,116,97,116,105,111,110,62,-24,-81,-73,-27,-127,-121,-26,-75,-127,-25,-88,-117,-26,-68,-108,-25,-92,-70,60,47,100,111,99,117,109,101,110,116,97,116,105,111,110,62,13,10,32,32,32,32,60,115,116,97,114,116,69,118,101,110,116,32,105,100,61,34,115,116,97,114,116,101,118,101,110,116,49,34,32,110,97,109,101,61,34,83,116,97,114,116,34,32,47,62,13,10,32,32,32,32,60,117,115,101,114,84,97,115,107,32,105,100,61,34,100,101,112,116,76,101,97,100,101,114,86,101,114,105,102,121,34,32,110,97,109,101,61,34,-23,-125,-88,-23,-105,-88,-23,-94,-122,-27,-81,-68,-27,-82,-95,-26,-119,-71,34,32,97,99,116,105,118,105,116,105,58,102,111,114,109,75,101,121,61,34,100,101,112,116,76,101,97,100,101,114,86,101,114,105,102,121,34,32,97,99,116,105,118,105,116,105,58,99,97,110,100,105,100,97,116,101,85,115,101,114,115,61,34,36,123,100,101,112,116,76,101,97,100,101,114,125,34,62,13,10,32,32,32,32,32,32,60,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,102,111,114,109,80,114,111,112,101,114,116,121,32,105,100,61,34,70,111,114,109,80,114,111,112,101,114,116,121,95,51,113,105,112,105,115,50,45,45,95,95,33,33,114,97,100,105,111,45,45,95,95,33,33,-27,-82,-95,-26,-119,-71,-26,-124,-113,-24,-89,-127,45,45,95,95,33,33,105,45,45,95,95,33,33,-27,-112,-116,-26,-124,-113,45,45,95,95,45,45,-28,-72,-115,-27,-112,-116,-26,-124,-113,34,32,116,121,112,101,61,34,115,116,114,105,110,103,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,102,111,114,109,80,114,111,112,101,114,116,121,32,105,100,61,34,70,111,114,109,80,114,111,112,101,114,116,121,95,48,108,102,102,112,99,109,45,45,95,95,33,33,116,101,120,116,97,114,101,97,45,45,95,95,33,33,-26,-119,-71,-26,-77,-88,45,45,95,95,33,33,102,95,95,33,33,110,117,108,108,34,32,116,121,112,101,61,34,115,116,114,105,110,103,34,32,47,62,13,10,32,32,32,32,32,32,60,47,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,60,47,117,115,101,114,84,97,115,107,62,13,10,32,32,32,32,60,101,120,99,108,117,115,105,118,101,71,97,116,101,119,97,121,32,105,100,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,53,34,62,13,10,32,32,32,32,32,32,60,111,117,116,103,111,105,110,103,62,70,108,111,119,95,48,113,51,98,98,106,108,60,47,111,117,116,103,111,105,110,103,62,13,10,32,32,32,32,60,47,101,120,99,108,117,115,105,118,101,71,97,116,101,119,97,121,62,13,10,32,32,32,32,60,117,115,101,114,84,97,115,107,32,105,100,61,34,104,114,86,101,114,105,102,121,34,32,110,97,109,101,61,34,-28,-70,-70,-28,-70,-117,-27,-82,-95,-26,-119,-71,34,32,97,99,116,105,118,105,116,105,58,102,111,114,109,75,101,121,61,34,104,114,86,101,114,105,102,121,34,32,97,99,116,105,118,105,116,105,58,99,97,110,100,105,100,97,116,101,71,114,111,117,112,115,61,34,104,114,34,62,13,10,32,32,32,32,32,32,60,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,102,111,114,109,80,114,111,112,101,114,116,121,32,105,100,61,34,70,111,114,109,80,114,111,112,101,114,116,121,95,50,51,117,57,53,106,98,45,45,95,95,33,33,114,97,100,105,111,45,45,95,95,33,33,-27,-82,-95,-26,-119,-71,-26,-124,-113,-24,-89,-127,45,45,95,95,33,33,105,45,45,95,95,33,33,-27,-112,-116,-26,-124,-113,45,45,95,95,45,45,-28,-72,-115,-27,-112,-116,-26,-124,-113,34,32,116,121,112,101,61,34,115,116,114,105,110,103,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,102,111,114,109,80,114,111,112,101,114,116,121,32,105,100,61,34,70,111,114,109,80,114,111,112,101,114,116,121,95,51,116,55,116,102,107,118,45,45,95,95,33,33,116,101,120,116,97,114,101,97,45,45,95,95,33,33,-26,-119,-71,-26,-77,-88,45,45,95,95,33,33,102,45,45,95,95,33,33,110,117,108,108,34,32,116,121,112,101,61,34,115,116,114,105,110,103,34,32,47,62,13,10,32,32,32,32,32,32,60,47,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,60,47,117,115,101,114,84,97,115,107,62,13,10,32,32,32,32,60,101,120,99,108,117,115,105,118,101,71,97,116,101,119,97,121,32,105,100,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,54,34,62,13,10,32,32,32,32,32,32,60,111,117,116,103,111,105,110,103,62,70,108,111,119,95,48,112,56,53,57,53,52,60,47,111,117,116,103,111,105,110,103,62,13,10,32,32,32,32,32,32,60,111,117,116,103,111,105,110,103,62,70,108,111,119,95,48,106,105,55,113,99,118,60,47,111,117,116,103,111,105,110,103,62,13,10,32,32,32,32,60,47,101,120,99,108,117,115,105,118,101,71,97,116,101,119,97,121,62,13,10,32,32,32,32,60,101,110,100,69,118,101,110,116,32,105,100,61,34,101,110,100,101,118,101,110,116,49,34,32,110,97,109,101,61,34,69,110,100,34,62,13,10,32,32,32,32,32,32,60,105,110,99,111,109,105,110,103,62,70,108,111,119,95,48,112,56,53,57,53,52,60,47,105,110,99,111,109,105,110,103,62,13,10,32,32,32,32,32,32,60,105,110,99,111,109,105,110,103,62,70,108,111,119,95,48,106,105,55,113,99,118,60,47,105,110,99,111,109,105,110,103,62,13,10,32,32,32,32,32,32,60,105,110,99,111,109,105,110,103,62,70,108,111,119,95,48,113,51,98,98,106,108,60,47,105,110,99,111,109,105,110,103,62,13,10,32,32,32,32,60,47,101,110,100,69,118,101,110,116,62,13,10,32,32,32,32,60,115,101,113,117,101,110,99,101,70,108,111,119,32,105,100,61,34,102,108,111,119,50,34,32,115,111,117,114,99,101,82,101,102,61,34,115,116,97,114,116,101,118,101,110,116,49,34,32,116,97,114,103,101,116,82,101,102,61,34,100,101,112,116,76,101,97,100,101,114,86,101,114,105,102,121,34,32,47,62,13,10,32,32,32,32,60,115,101,113,117,101,110,99,101,70,108,111,119,32,105,100,61,34,102,108,111,119,51,34,32,115,111,117,114,99,101,82,101,102,61,34,100,101,112,116,76,101,97,100,101,114,86,101,114,105,102,121,34,32,116,97,114,103,101,116,82,101,102,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,53,34,32,47,62,13,10,32,32,32,32,60,115,101,113,117,101,110,99,101,70,108,111,119,32,105,100,61,34,102,108,111,119,53,34,32,110,97,109,101,61,34,-27,-112,-116,-26,-124,-113,34,32,115,111,117,114,99,101,82,101,102,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,53,34,32,116,97,114,103,101,116,82,101,102,61,34,104,114,86,101,114,105,102,121,34,62,13,10,32,32,32,32,32,32,60,99,111,110,100,105,116,105,111,110,69,120,112,114,101,115,115,105,111,110,32,120,115,105,58,116,121,112,101,61,34,116,70,111,114,109,97,108,69,120,112,114,101,115,115,105,111,110,34,62,36,123,70,111,114,109,80,114,111,112,101,114,116,121,95,51,113,105,112,105,115,50,61,61,48,125,60,47,99,111,110,100,105,116,105,111,110,69,120,112,114,101,115,115,105,111,110,62,13,10,32,32,32,32,60,47,115,101,113,117,101,110,99,101,70,108,111,119,62,13,10,32,32,32,32,60,115,101,113,117,101,110,99,101,70,108,111,119,32,105,100,61,34,102,108,111,119,54,34,32,115,111,117,114,99,101,82,101,102,61,34,104,114,86,101,114,105,102,121,34,32,116,97,114,103,101,116,82,101,102,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,54,34,32,47,62,13,10,32,32,32,32,60,115,101,113,117,101,110,99,101,70,108,111,119,32,105,100,61,34,70,108,111,119,95,48,112,56,53,57,53,52,34,32,115,111,117,114,99,101,82,101,102,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,54,34,32,116,97,114,103,101,116,82,101,102,61,34,101,110,100,101,118,101,110,116,49,34,62,13,10,32,32,32,32,32,32,60,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,101,120,101,99,117,116,105,111,110,76,105,115,116,101,110,101,114,32,99,108,97,115,115,61,34,99,111,109,46,114,117,111,121,105,46,108,101,97,118,101,46,105,110,115,116,101,110,101,114,46,76,101,97,118,101,69,110,100,83,116,97,116,101,76,105,115,116,101,110,101,114,34,32,101,118,101,110,116,61,34,116,97,107,101,34,62,13,10,32,32,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,102,105,101,108,100,32,110,97,109,101,61,34,115,116,97,116,101,34,62,13,10,32,32,32,32,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,115,116,114,105,110,103,62,49,60,47,97,99,116,105,118,105,116,105,58,115,116,114,105,110,103,62,13,10,32,32,32,32,32,32,32,32,32,32,60,47,97,99,116,105,118,105,116,105,58,102,105,101,108,100,62,13,10,32,32,32,32,32,32,32,32,60,47,97,99,116,105,118,105,116,105,58,101,120,101,99,117,116,105,111,110,76,105,115,116,101,110,101,114,62,13,10,32,32,32,32,32,32,60,47,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,32,32,60,99,111,110,100,105,116,105,111,110,69,120,112,114,101,115,115,105,111,110,32,120,115,105,58,116,121,112,101,61,34,116,70,111,114,109,97,108,69,120,112,114,101,115,115,105,111,110,34,62,36,123,70,111,114,109,80,114,111,112,101,114,116,121,95,50,51,117,57,53,106,98,61,61,48,125,60,47,99,111,110,100,105,116,105,111,110,69,120,112,114,101,115,115,105,111,110,62,13,10,32,32,32,32,60,47,115,101,113,117,101,110,99,101,70,108,111,119,62,13,10,32,32,32,32,60,115,101,113,117,101,110,99,101,70,108,111,119,32,105,100,61,34,70,108,111,119,95,48,106,105,55,113,99,118,34,32,115,111,117,114,99,101,82,101,102,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,54,34,32,116,97,114,103,101,116,82,101,102,61,34,101,110,100,101,118,101,110,116,49,34,62,13,10,32,32,32,32,32,32,60,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,101,120,101,99,117,116,105,111,110,76,105,115,116,101,110,101,114,32,99,108,97,115,115,61,34,99,111,109,46,114,117,111,121,105,46,108,101,97,118,101,46,105,110,115,116,101,110,101,114,46,76,101,97,118,101,69,110,100,83,116,97,116,101,76,105,115,116,101,110,101,114,34,32,101,118,101,110,116,61,34,116,97,107,101,34,62,13,10,32,32,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,102,105,101,108,100,32,110,97,109,101,61,34,115,116,97,116,101,34,62,13,10,32,32,32,32,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,115,116,114,105,110,103,62,50,60,47,97,99,116,105,118,105,116,105,58,115,116,114,105,110,103,62,13,10,32,32,32,32,32,32,32,32,32,32,60,47,97,99,116,105,118,105,116,105,58,102,105,101,108,100,62,13,10,32,32,32,32,32,32,32,32,60,47,97,99,116,105,118,105,116,105,58,101,120,101,99,117,116,105,111,110,76,105,115,116,101,110,101,114,62,13,10,32,32,32,32,32,32,60,47,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,60,47,115,101,113,117,101,110,99,101,70,108,111,119,62,13,10,32,32,32,32,60,115,101,113,117,101,110,99,101,70,108,111,119,32,105,100,61,34,70,108,111,119,95,48,113,51,98,98,106,108,34,32,115,111,117,114,99,101,82,101,102,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,53,34,32,116,97,114,103,101,116,82,101,102,61,34,101,110,100,101,118,101,110,116,49,34,62,13,10,32,32,32,32,32,32,60,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,101,120,101,99,117,116,105,111,110,76,105,115,116,101,110,101,114,32,99,108,97,115,115,61,34,99,111,109,46,114,117,111,121,105,46,108,101,97,118,101,46,105,110,115,116,101,110,101,114,46,76,101,97,118,101,69,110,100,83,116,97,116,101,76,105,115,116,101,110,101,114,34,32,101,118,101,110,116,61,34,116,97,107,101,34,62,13,10,32,32,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,102,105,101,108,100,32,110,97,109,101,61,34,115,116,97,116,101,34,62,13,10,32,32,32,32,32,32,32,32,32,32,32,32,60,97,99,116,105,118,105,116,105,58,115,116,114,105,110,103,62,50,60,47,97,99,116,105,118,105,116,105,58,115,116,114,105,110,103,62,13,10,32,32,32,32,32,32,32,32,32,32,60,47,97,99,116,105,118,105,116,105,58,102,105,101,108,100,62,13,10,32,32,32,32,32,32,32,32,60,47,97,99,116,105,118,105,116,105,58,101,120,101,99,117,116,105,111,110,76,105,115,116,101,110,101,114,62,13,10,32,32,32,32,32,32,60,47,101,120,116,101,110,115,105,111,110,69,108,101,109,101,110,116,115,62,13,10,32,32,32,32,60,47,115,101,113,117,101,110,99,101,70,108,111,119,62,13,10,32,32,60,47,112,114,111,99,101,115,115,62,13,10,32,32,60,98,112,109,110,100,105,58,66,80,77,78,68,105,97,103,114,97,109,32,105,100,61,34,66,80,77,78,68,105,97,103,114,97,109,95,108,101,97,118,101,34,62,13,10,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,80,108,97,110,101,32,105,100,61,34,66,80,77,78,80,108,97,110,101,95,108,101,97,118,101,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,108,101,97,118,101,34,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,32,105,100,61,34,70,108,111,119,95,48,113,51,98,98,106,108,95,100,105,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,70,108,111,119,95,48,113,51,98,98,106,108,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,50,54,48,34,32,121,61,34,56,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,50,54,48,34,32,121,61,34,49,52,48,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,53,56,50,34,32,121,61,34,49,52,48,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,32,105,100,61,34,70,108,111,119,95,48,106,105,55,113,99,118,95,100,105,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,70,108,111,119,95,48,106,105,55,113,99,118,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,53,48,53,34,32,121,61,34,56,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,53,48,53,34,32,121,61,34,49,52,48,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,53,56,50,34,32,121,61,34,49,52,48,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,32,105,100,61,34,70,108,111,119,95,48,112,56,53,57,53,52,95,100,105,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,70,108,111,119,95,48,112,56,53,57,53,52,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,53,50,53,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,54,48,48,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,54,48,48,34,32,121,61,34,49,50,50,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,32,105,100,61,34,66,80,77,78,69,100,103,101,95,102,108,111,119,54,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,102,108,111,119,54,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,52,53,51,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,52,56,53,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,32,105,100,61,34,66,80,77,78,69,100,103,101,95,102,108,111,119,53,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,102,108,111,119,53,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,50,56,48,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,51,52,56,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,76,97,98,101,108,62,13,10,32,32,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,51,48,48,34,32,121,61,34,52,54,34,32,119,105,100,116,104,61,34,50,50,34,32,104,101,105,103,104,116,61,34,49,49,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,76,97,98,101,108,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,32,105,100,61,34,66,80,77,78,69,100,103,101,95,102,108,111,119,51,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,102,108,111,119,51,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,49,56,53,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,50,52,48,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,32,105,100,61,34,66,80,77,78,69,100,103,101,95,102,108,111,119,50,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,102,108,111,119,50,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,51,53,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,105,58,119,97,121,112,111,105,110,116,32,120,61,34,56,48,34,32,121,61,34,54,51,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,69,100,103,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,32,105,100,61,34,66,80,77,78,83,104,97,112,101,95,115,116,97,114,116,101,118,101,110,116,49,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,115,116,97,114,116,101,118,101,110,116,49,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,48,34,32,121,61,34,52,54,34,32,119,105,100,116,104,61,34,51,53,34,32,104,101,105,103,104,116,61,34,51,53,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,76,97,98,101,108,62,13,10,32,32,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,53,34,32,121,61,34,56,49,34,32,119,105,100,116,104,61,34,50,53,34,32,104,101,105,103,104,116,61,34,49,52,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,76,97,98,101,108,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,32,105,100,61,34,66,80,77,78,83,104,97,112,101,95,100,101,112,116,76,101,97,100,101,114,86,101,114,105,102,121,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,100,101,112,116,76,101,97,100,101,114,86,101,114,105,102,121,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,56,48,34,32,121,61,34,51,54,34,32,119,105,100,116,104,61,34,49,48,53,34,32,104,101,105,103,104,116,61,34,53,53,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,32,105,100,61,34,66,80,77,78,83,104,97,112,101,95,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,53,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,53,34,32,105,115,77,97,114,107,101,114,86,105,115,105,98,108,101,61,34,116,114,117,101,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,50,52,48,34,32,121,61,34,52,51,34,32,119,105,100,116,104,61,34,52,48,34,32,104,101,105,103,104,116,61,34,52,48,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,32,105,100,61,34,66,80,77,78,83,104,97,112,101,95,104,114,86,101,114,105,102,121,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,104,114,86,101,114,105,102,121,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,51,52,56,34,32,121,61,34,51,54,34,32,119,105,100,116,104,61,34,49,48,53,34,32,104,101,105,103,104,116,61,34,53,53,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,32,105,100,61,34,66,80,77,78,83,104,97,112,101,95,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,54,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,101,120,99,108,117,115,105,118,101,103,97,116,101,119,97,121,54,34,32,105,115,77,97,114,107,101,114,86,105,115,105,98,108,101,61,34,116,114,117,101,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,52,56,53,34,32,121,61,34,52,51,34,32,119,105,100,116,104,61,34,52,48,34,32,104,101,105,103,104,116,61,34,52,48,34,32,47,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,62,13,10,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,32,105,100,61,34,66,80,77,78,83,104,97,112,101,95,101,110,100,101,118,101,110,116,49,34,32,98,112,109,110,69,108,101,109,101,110,116,61,34,101,110,100,101,118,101,110,116,49,34,62,13,10,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,53,56,50,34,32,121,61,34,49,50,50,34,32,119,105,100,116,104,61,34,51,53,34,32,104,101,105,103,104,116,61,34,51,53,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,98,112,109,110,100,105,58,66,80,77,78,76,97,98,101,108,62,13,10,32,32,32,32,32,32,32,32,32,32,60,111,109,103,100,99,58,66,111,117,110,100,115,32,120,61,34,53,57,48,34,32,121,61,34,49,53,55,34,32,119,105,100,116,104,61,34,50,48,34,32,104,101,105,103,104,116,61,34,49,52,34,32,47,62,13,10,32,32,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,76,97,98,101,108,62,13,10,32,32,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,83,104,97,112,101,62,13,10,32,32,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,80,108,97,110,101,62,13,10,32,32,60,47,98,112,109,110,100,105,58,66,80,77,78,68,105,97,103,114,97,109,62,13,10,60,47,100,101,102,105,110,105,116,105,111,110,115,62,13,10],&quot;deploymentId&quot;:&quot;f6fbfa74-2383-11ed-9ba4-0a0027000002&quot;,&quot;generated&quot;:false,&quot;id&quot;:&quot;f6fbfa75-2383-11ed-9ba4-0a0027000002&quot;,&quot;isInserted&quot;:true,&quot;isUpdated&quot;:false,&quot;isDeleted&quot;:false}},&quot;deploymentTime&quot;:&quot;2022-08-24 04:08:40&quot;,&quot;isNew&quot;:true,&quot;version&quot;:1,&quot;deployedArtifacts&quot;:{&quot;class org.activiti.engine.impl.persistence.entity.ProcessDefinitionEntityImpl&quot;:[{&quot;name&quot;:&quot;测试请假流程-普通表单2&quot;,&quot;description&quot;:&quot;请假流程演示&quot;,&quot;key&quot;:&quot;testleave2&quot;,&quot;version&quot;:1,&quot;category&quot;:&quot;http://www.kafeitu.me/activiti/leave&quot;,&quot;deploymentId&quot;:&quot;f6fbfa74-2383-11ed-9ba4-0a0027000002&quot;,&quot;resourceName&quot;:&quot;bpmn/testleave2.bpmn&quot;,&quot;tenantId&quot;:&quot;&quot;,&quot;isGraphicalNotationDefined&quot;:true,&quot;hasStartFormKey&quot;:false,&quot;suspensionState&quot;:1,&quot;isIdentityLinksInitialized&quot;:false,&quot;definitionIdentityLinkEntities&quot;:[],&quot;id&quot;:&quot;testleave2:1:f7135306-2383-11ed-9ba4-0a0027000002&quot;,&quot;revision&quot;:1,&quot;isInserted&quot;:true,&quot;isUpdated&quot;:false,&quot;isDeleted&quot;:false}]},&quot;id&quot;:&quot;f6fbfa74-2383-11ed-9ba4-0a0027000002&quot;,&quot;isInserted&quot;:true,&quot;isUpdated&quot;:false,&quot;isDeleted&quot;:false}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除流程部署信息 `act_ge_bytearray` `act_re_deployment` `act_re_procdef`
     * 当前的流程如果并没有完成，想要删除的话需要使用特殊方式，原理就是 级联删除
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteDeployment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> deploymentId<span class="token operator">=</span><span class="token string">&quot;51bcef02-2347-11ed-a7d2-0a0027000002&quot;</span><span class="token punctuation">;</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">deleteDeployment</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



    <span class="token comment">/**
     * act_re_procdef
     * com.itheima.test.ActivitiDemo#getDeployment()
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDeploymentResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// DEPLOYMENT_ID_</span>
        <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> <span class="token string">&quot;a6404063-2422-11ed-af37-0a0027000002&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// RESOURCE_NAME_</span>
        <span class="token class-name">String</span> resourceName <span class="token operator">=</span> <span class="token string">&quot;bpmn/ileave.bpmn&quot;</span><span class="token punctuation">;</span>

        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">,</span> resourceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> inputStream<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>inputStream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;new String(bytes):&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        inputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * com.itheima.test.ActivtiBusinessDemo#suspendAllProcessInstance()
     * act_re_procdef
     *  ID_
     *  SUSPENSION_STATE_
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">suspendOrActivateProcessDefinitionById</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> processDefinitionId <span class="token operator">=</span> <span class="token string">&quot;testleave1:1:67ed4864-2346-11ed-bd18-0a0027000002&quot;</span><span class="token punctuation">;</span>
        processDefinitionId<span class="token operator">=</span><span class="token string">&quot;ileave:1:a65b9095-2422-11ed-af37-0a0027000002&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 当流程定义被挂起时，已经发起的该流程定义的流程实例不受影响（如果选择级联挂起则流程实例也会被挂起）。</span>
        <span class="token comment">// 当流程定义被挂起时，无法发起新的该流程定义的流程实例。</span>
        <span class="token comment">// 直观变化：act_re_procdef 的 SUSPENSION_STATE_ 为 2</span>
        <span class="token comment">// org.activiti.engine.ActivitiException: Cannot set suspension state 'suspended' for ProcessDefinitionEntity[testleave1:1:67ed4864-2346-11ed-bd18-0a0027000002]': already in state 'suspended'.</span>
<span class="token comment">//        repositoryService.suspendProcessDefinitionById(processDefinitionId);</span>
        repositoryService<span class="token punctuation">.</span><span class="token function">activateProcessDefinitionById</span><span class="token punctuation">(</span>processDefinitionId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SecurityUtil</span> securityUtil<span class="token punctuation">;</span>
    <span class="token comment">/**
     * org.springframework.security.authentication.AuthenticationCredentialsNotFoundException: An Authentication object was not found in the SecurityContext
     * 启动流程实例
     * `act_hi_actinst`    流程实例执行历史信息
     * `act_hi_identitylink` 流程参与用户的历史信息
     * `act_hi_procinst`     流程实例的历史信息
     * `act_hi_taskinst`     流程任务的历史信息
     * `act_ru_execution`    流程执行信息
     * `act_ru_identitylink`  流程的正在参与用户信息
     * `act_ru_task`         流程当前任务信息
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span><span class="token string">&quot;guanxing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//act_ru_execution START_USER_ID_</span>
        <span class="token class-name">String</span> id <span class="token operator">=</span> <span class="token string">&quot;BusinessKey-ileave1-1&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> join <span class="token operator">=</span> <span class="token string">&quot;guanyu,zhaoyun&quot;</span><span class="token punctuation">;</span> <span class="token comment">//岗位为se 部门领导（审批） 候选用户</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> processRuntime<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token class-name">ProcessPayloadBuilder</span>
                <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withProcessDefinitionKey</span><span class="token punctuation">(</span><span class="token string">&quot;ileave1&quot;</span><span class="token punctuation">)</span> <span class="token comment">//ACT_RE_PROCDEF KEY_-&gt;ID_ =&gt;act_ru_execution PROC_DEF_ID_</span>
                <span class="token punctuation">.</span><span class="token function">withName</span><span class="token punctuation">(</span><span class="token string">&quot;ileave1的年假申请082501&quot;</span><span class="token punctuation">)</span>   <span class="token comment">//7.1.0.M4 act_ru_execution NAME_</span>
                <span class="token punctuation">.</span><span class="token function">withBusinessKey</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token comment">//act_ru_execution BUSINESS_KEY_</span>
                <span class="token punctuation">.</span><span class="token function">withVariable</span><span class="token punctuation">(</span><span class="token string">&quot;deptLeader&quot;</span><span class="token punctuation">,</span>join<span class="token punctuation">)</span>    <span class="token comment">//act_ru_variable (EXECUTION_ID_) NAME_ TEXT_ 候选用户</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//流程实例 ID ACT_RU_EXECUTION act_ru_execution ID_</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;ProcessInstance processInstance:&quot;</span><span class="token punctuation">,</span> processInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ProcessInstance processInstance: [org.activiti.api.runtime.model.impl.ProcessInstanceImpl]</span>
        <span class="token comment">//{&quot;id&quot;:&quot;e58a16d2-2388-11ed-acf4-0a0027000002&quot;,&quot;name&quot;:&quot;testleave2的年假申请082402&quot;,&quot;processDefinitionId&quot;:&quot;testleave2:1:f7135306-2383-11ed-9ba4-0a0027000002&quot;,&quot;processDefinitionKey&quot;:&quot;testleave2&quot;,&quot;initiator&quot;:&quot;guanxing&quot;,&quot;startDate&quot;:&quot;2022-08-24 04:43:59&quot;,&quot;businessKey&quot;:&quot;BusinessKey-testleave2_1&quot;,&quot;status&quot;:&quot;RUNNING&quot;,&quot;processDefinitionVersion&quot;:1}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查看进度-1
     * ACT_RU_EXECUTION act_ru_execution ID_
     * ACT_RE_PROCDEF DEPLOYMENT_ID_ RESOURCE_NAME_
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">viewProgress1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> instanceId <span class="token operator">=</span> <span class="token string">&quot;81ffdcf5-2353-11ed-aaec-0a0027000002&quot;</span><span class="token punctuation">;</span>
        instanceId<span class="token operator">=</span><span class="token string">&quot;71183d8d-2424-11ed-8b41-0a0027000002&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span>ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// java.lang.IllegalArgumentException: class org.activiti.engine.impl.persistence.entity.ExecutionEntityImpl declares multiple JSON fields named isDeleted</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;org.activiti.engine.runtime.ProcessInstance processInstance:&quot;</span><span class="token punctuation">,</span> processInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> deploymentId <span class="token operator">=</span> processInstance<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProcessDefinition</span> processDefinition <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">createProcessDefinitionQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deploymentId</span><span class="token punctuation">(</span>deploymentId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;DeploymentId:{}\tResourceName:{}&quot;</span><span class="token punctuation">,</span>
                processDefinition<span class="token punctuation">.</span><span class="token function">getDeploymentId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">//ACT_RE_PROCDEF DEPLOYMENT_ID_</span>
                processDefinition<span class="token punctuation">.</span><span class="token function">getResourceName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//ACT_RE_PROCDEF RESOURCE_NAME_</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;ProcessDefinition processDefinition:&quot;</span><span class="token punctuation">,</span> processDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ProcessDefinition processDefinition: [org.activiti.engine.impl.persistence.entity.ProcessDefinitionEntityImpl]</span>
        <span class="token comment">// {&quot;name&quot;:&quot;测试请假流程-普通表单2&quot;,&quot;description&quot;:&quot;请假流程演示&quot;,&quot;key&quot;:&quot;testleave2&quot;,&quot;version&quot;:1,&quot;category&quot;:&quot;http://www.kafeitu.me/activiti/leave&quot;,&quot;deploymentId&quot;:&quot;f6fbfa74-2383-11ed-9ba4-0a0027000002&quot;,&quot;resourceName&quot;:&quot;bpmn/testleave2.bpmn&quot;,&quot;tenantId&quot;:&quot;&quot;,&quot;isGraphicalNotationDefined&quot;:true,&quot;hasStartFormKey&quot;:false,&quot;suspensionState&quot;:1,&quot;isIdentityLinksInitialized&quot;:false,&quot;definitionIdentityLinkEntities&quot;:[],&quot;id&quot;:&quot;testleave2:1:f7135306-2383-11ed-9ba4-0a0027000002&quot;,&quot;revision&quot;:3,&quot;isInserted&quot;:false,&quot;isUpdated&quot;:false,&quot;isDeleted&quot;:false}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * public ActivitiHighLineDTO gethighLine(String instanceId) {
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">viewProgress2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> instanceId <span class="token operator">=</span> <span class="token string">&quot;81ffdcf5-2353-11ed-aaec-0a0027000002&quot;</span><span class="token punctuation">;</span>
        instanceId<span class="token operator">=</span><span class="token string">&quot;e58a16d2-2388-11ed-acf4-0a0027000002&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">HistoricProcessInstance</span> historicProcessInstance <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        JsonUtils.log(log, &quot;HistoricProcessInstance historicProcessInstance:&quot;, historicProcessInstance);</span>
<span class="token comment">//        HistoricProcessInstance historicProcessInstance: [org.activiti.engine.impl.persistence.entity.HistoricProcessInstanceEntityImpl]</span>
<span class="token comment">//        {&quot;businessKey&quot;:&quot;BusinessKey-testleave2_1&quot;,&quot;startUserId&quot;:&quot;guanxing&quot;,&quot;startActivityId&quot;:&quot;startevent1&quot;,&quot;tenantId&quot;:&quot;&quot;,&quot;name&quot;:&quot;testleave2的年假申请082402&quot;,&quot;processDefinitionKey&quot;:&quot;testleave2&quot;,&quot;processDefinitionName&quot;:&quot;测试请假流程-普通表单2&quot;,&quot;processDefinitionVersion&quot;:1,&quot;deploymentId&quot;:&quot;f6fbfa74-2383-11ed-9ba4-0a0027000002&quot;,&quot;processInstanceId&quot;:&quot;e58a16d2-2388-11ed-acf4-0a0027000002&quot;,&quot;processDefinitionId&quot;:&quot;testleave2:1:f7135306-2383-11ed-9ba4-0a0027000002&quot;,&quot;startTime&quot;:&quot;2022-08-24 04:43:59&quot;,&quot;id&quot;:&quot;e58a16d2-2388-11ed-acf4-0a0027000002&quot;,&quot;isInserted&quot;:false,&quot;isUpdated&quot;:false,&quot;isDeleted&quot;:false}</span>

        <span class="token comment">//获取bpmnModel对象</span>
        <span class="token class-name">BpmnModel</span> bpmnModel <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getBpmnModel</span><span class="token punctuation">(</span>historicProcessInstance<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        JsonUtils.log(log, &quot;BpmnModel bpmnModel.getDefinitionsAttributes():&quot;, bpmnModel.getDefinitionsAttributes());</span>
<span class="token comment">//        JsonUtils.log(log, &quot;BpmnModel bpmnModel:&quot;, bpmnModel);</span>
        <span class="token comment">// java.lang.StackOverflowError</span>

        <span class="token comment">//因为我们这里只定义了一个Process 所以获取集合中的第一个即可</span>
        <span class="token class-name">Process</span> process <span class="token operator">=</span> bpmnModel<span class="token punctuation">.</span><span class="token function">getProcesses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//java.lang.StackOverflowError</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;Process process:&quot;</span><span class="token punctuation">,</span> process<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取所有的FlowElement信息</span>
        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FlowElement</span><span class="token punctuation">&gt;</span></span> flowElements <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">getFlowElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//java.lang.StackOverflowError</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;Collection&lt;FlowElement&gt; flowElements:&quot;</span><span class="token punctuation">,</span> flowElements<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//获取流程实例 历史节点(全部)</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;List&lt;HistoricActivityInstance&gt; list:&quot;</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取流程实例 历史节点（已完成）</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">&gt;</span></span> listFinished <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">finished</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;List&lt;HistoricActivityInstance&gt; listFinished:&quot;</span><span class="token punctuation">,</span> listFinished<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取流程实例 历史节点（待办节点）</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricActivityInstance</span><span class="token punctuation">&gt;</span></span> listUnFinished <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricActivityInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unfinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;List&lt;HistoricActivityInstance&gt; listUnFinished:&quot;</span><span class="token punctuation">,</span> listUnFinished<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//当前用户已完成的任务</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HistoricTaskInstance</span><span class="token punctuation">&gt;</span></span> taskInstanceList <span class="token operator">=</span> historyService<span class="token punctuation">.</span><span class="token function">createHistoricTaskInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//                    .taskAssignee(SecurityUtils.getUsername())</span>
                <span class="token punctuation">.</span><span class="token function">finished</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>instanceId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;List&lt;HistoricTaskInstance&gt; taskInstanceList:&quot;</span><span class="token punctuation">,</span> taskInstanceList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 代办任务
     * act_ru_identitylink TASK_ID_
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">agencyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">&quot;guanyu&quot;</span><span class="token punctuation">;</span> <span class="token comment">//部门领导审批 候选用户</span>
<span class="token comment">//        username = &quot;zhaoyun&quot;; //部门领导审批 候选用户</span>
<span class="token comment">//        username = &quot;zhugeliang&quot;;    //人事审批 候选组</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> pageNum <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> pageTasks <span class="token operator">=</span> taskRuntime<span class="token punctuation">.</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token class-name">Pageable</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pageNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;pageTasks:&quot;</span><span class="token punctuation">,</span> pageTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// pageTasks: [org.activiti.runtime.api.query.impl.PageImpl]</span>
        <span class="token comment">//{&quot;content&quot;:[{&quot;id&quot;:&quot;8206e1dc-2353-11ed-aaec-0a0027000002&quot;,&quot;name&quot;:&quot;部门领导审批&quot;,&quot;status&quot;:&quot;CREATED&quot;,&quot;createdDate&quot;:&quot;2022-08-24 10:21:48&quot;,&quot;priority&quot;:50,&quot;processDefinitionId&quot;:&quot;testleave1:1:67ed4864-2346-11ed-bd18-0a0027000002&quot;,&quot;processInstanceId&quot;:&quot;81ffdcf5-2353-11ed-aaec-0a0027000002&quot;,&quot;formKey&quot;:&quot;deptLeaderVerify&quot;},{&quot;id&quot;:&quot;e592c969-2388-11ed-acf4-0a0027000002&quot;,&quot;name&quot;:&quot;部门领导审批&quot;,&quot;status&quot;:&quot;CREATED&quot;,&quot;createdDate&quot;:&quot;2022-08-24 04:43:59&quot;,&quot;priority&quot;:50,&quot;processDefinitionId&quot;:&quot;testleave2:1:f7135306-2383-11ed-9ba4-0a0027000002&quot;,&quot;processInstanceId&quot;:&quot;e58a16d2-2388-11ed-acf4-0a0027000002&quot;,&quot;formKey&quot;:&quot;deptLeaderVerify&quot;}],&quot;totalItems&quot;:2}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> tasks <span class="token operator">=</span> pageTasks<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> totalItems <span class="token operator">=</span> pageTasks<span class="token punctuation">.</span><span class="token function">getTotalItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>totalItems <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> processInstanceIdIds <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span>ProcessInstance</span><span class="token punctuation">&gt;</span></span> processInstanceList <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceIds</span><span class="token punctuation">(</span>processInstanceIdIds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ActTaskDTO</span><span class="token punctuation">&gt;</span></span> actTaskDTOS <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">ActTaskDTO</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> processInstanceList<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>pi <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pi<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;List&lt;ActTaskDTO&gt; actTaskDTOS:&quot;</span><span class="token punctuation">,</span> actTaskDTOS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//List&lt;ActTaskDTO&gt; actTaskDTOS: [com.itheima.test.dot.ActTaskDTO]</span>
            <span class="token comment">//[{&quot;id&quot;:&quot;8206e1dc-2353-11ed-aaec-0a0027000002&quot;,&quot;name&quot;:&quot;部门领导审批&quot;,&quot;status&quot;:&quot;CREATED&quot;,&quot;createdDate&quot;:&quot;2022-08-24 10:21:48&quot;,&quot;instanceName&quot;:&quot;TESTXX的年假申请0824&quot;,&quot;definitionKey&quot;:&quot;testleave1&quot;,&quot;businessKey&quot;:&quot;BusinessKey-TEST1&quot;},{&quot;id&quot;:&quot;e592c969-2388-11ed-acf4-0a0027000002&quot;,&quot;name&quot;:&quot;部门领导审批&quot;,&quot;status&quot;:&quot;CREATED&quot;,&quot;createdDate&quot;:&quot;2022-08-24 04:43:59&quot;,&quot;instanceName&quot;:&quot;testleave2的年假申请082402&quot;,&quot;definitionKey&quot;:&quot;testleave2&quot;,&quot;businessKey&quot;:&quot;BusinessKey-testleave2_1&quot;}]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 审核打开-1
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">auditOpen1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">&quot;guanyu&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 部门领导审批 候选用户</span>
<span class="token comment">//        username = &quot;zhugeliang&quot;;    //人事审批 候选组</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> taskId <span class="token operator">=</span> <span class="token string">&quot;30ca2354-2376-11ed-967f-0a0027000002&quot;</span><span class="token punctuation">;</span>
        taskId <span class="token operator">=</span> <span class="token string">&quot;039f009f-2432-11ed-91ff-0a0027000002&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskRuntime<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>taskId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;Task task:&quot;</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/*  ------------------------------------------------------------------------------
            FormProperty_0ueitp2--__!!类型--__!!名称--__!!是否参数--__!!默认值
            例子：
            FormProperty_0lovri0--__!!string--__!!姓名--__!!f--__!!同意!!__--驳回
            FormProperty_1iu6onu--__!!int--__!!年龄--__!!s

            默认值：无、字符常量、FormProperty_开头定义过的控件ID
            是否参数：f为不是参数，s是字符，t是时间(不需要int，因为这里int等价于string)
            注：类型是可以获取到的，但是为了统一配置原则，都配置到
            */</span>

        <span class="token comment">//注意!!!!!!!!:表单Key必须要任务编号一模一样，因为参数需要任务key，但是无法获取，只能获取表单key“task.getFormKey()”当做任务key</span>
        <span class="token class-name">BpmnModel</span> bpmnModel <span class="token operator">=</span> repositoryService<span class="token punctuation">.</span><span class="token function">getBpmnModel</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;BpmnModel bpmnModel:&quot;</span><span class="token punctuation">,</span> bpmnModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FlowElement</span> flowElement <span class="token operator">=</span> bpmnModel<span class="token punctuation">.</span><span class="token function">getFlowElement</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getFormKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UserTask</span> userTask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserTask</span><span class="token punctuation">)</span>flowElement<span class="token punctuation">;</span>
<span class="token comment">//        JsonUtils.log(log, &quot;UserTask userTask:&quot;, userTask);</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>userTask <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FormProperty</span><span class="token punctuation">&gt;</span></span> formProperties <span class="token operator">=</span> userTask<span class="token punctuation">.</span><span class="token function">getFormProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;List&lt;FormProperty&gt; formProperties:&quot;</span><span class="token punctuation">,</span> formProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> collect <span class="token operator">=</span> formProperties<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fp <span class="token operator">-&gt;</span> fp<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;List&lt;String&gt; collect:&quot;</span><span class="token punctuation">,</span> collect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 审核确认
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">auditConfirmation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">&quot;guanyu&quot;</span><span class="token punctuation">;</span> <span class="token comment">//部门领导审批 候选用户</span>
        username <span class="token operator">=</span> <span class="token string">&quot;zhugeliang&quot;</span><span class="token punctuation">;</span>    <span class="token comment">//人事审批 候选组</span>
        securityUtil<span class="token punctuation">.</span><span class="token function">logInAs</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> taskID <span class="token operator">=</span> <span class="token string">&quot;7120f024-2424-11ed-8b41-0a0027000002&quot;</span><span class="token punctuation">;</span>
        taskID <span class="token operator">=</span> <span class="token string">&quot;d4cb33ae-2425-11ed-83ef-0a0027000002&quot;</span><span class="token punctuation">;</span>    <span class="token comment">//人事审批 候选组</span>

        <span class="token class-name">Task</span> task <span class="token operator">=</span> taskRuntime<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>taskID<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;Task task:&quot;</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>activiti<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span></span>ProcessInstance</span> processInstance <span class="token operator">=</span> runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        log.info(&quot;\t\nprocessInstance:\t\n{}&quot;, JsonUtils.getJsonString(processInstance));</span>
        <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> <span class="token string">&quot;org.activiti.engine.runtime.ProcessInstance processInstance:&quot;</span><span class="token punctuation">,</span> processInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Boolean</span> hasVariables <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//没有任何参数</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> variables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        variables.put(&quot;FormProperty_3qipis2&quot;, 0);</span>
<span class="token comment">//        variables.put(&quot;FormProperty_0lffpcm&quot;, &quot;批注0825&quot;);</span>

        <span class="token comment">// FormProperty_23u95jb</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;FormProperty_23u95jb&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        variables<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;FormProperty_3t7tfkv&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;批注0825RS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//for结束</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//拾取任务</span>
            taskRuntime<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTaskId</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasVariables<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//带参数完成任务</span>
            taskRuntime<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTaskId</span><span class="token punctuation">(</span>taskID<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">withVariables</span><span class="token punctuation">(</span>variables<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            taskRuntime<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">TaskPayloadBuilder</span><span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withTaskId</span><span class="token punctuation">(</span>taskID<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.de0ffd6c.js" defer></script><script src="/assets/js/3.059a2ce3.js" defer></script><script src="/assets/js/15.94aa71a8.js" defer></script>
  </body>
</html>
