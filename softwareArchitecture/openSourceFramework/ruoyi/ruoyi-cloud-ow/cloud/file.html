<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式文件 | TosinJia</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <link rel="icon" href="/images/favicon.ico">
    <meta name="description" content="TosinJia">
    
    <link rel="preload" href="/assets/css/0.styles.d77f493a.css" as="style"><link rel="preload" href="/assets/js/app.de0ffd6c.js" as="script"><link rel="preload" href="/assets/js/3.059a2ce3.js" as="script"><link rel="preload" href="/assets/js/31.60e0f28d.js" as="script"><link rel="prefetch" href="/assets/js/10.471d2f7d.js"><link rel="prefetch" href="/assets/js/11.64c9bea0.js"><link rel="prefetch" href="/assets/js/12.8cd035ea.js"><link rel="prefetch" href="/assets/js/13.ac133c7d.js"><link rel="prefetch" href="/assets/js/14.55b76568.js"><link rel="prefetch" href="/assets/js/15.94aa71a8.js"><link rel="prefetch" href="/assets/js/16.6d62875d.js"><link rel="prefetch" href="/assets/js/17.d3dbf31d.js"><link rel="prefetch" href="/assets/js/18.5f3a7f7e.js"><link rel="prefetch" href="/assets/js/19.adf383b8.js"><link rel="prefetch" href="/assets/js/2.9d302d7a.js"><link rel="prefetch" href="/assets/js/20.1074faf8.js"><link rel="prefetch" href="/assets/js/21.05a74ab0.js"><link rel="prefetch" href="/assets/js/22.7f76ccfc.js"><link rel="prefetch" href="/assets/js/23.9304b5d5.js"><link rel="prefetch" href="/assets/js/24.86d2ac06.js"><link rel="prefetch" href="/assets/js/25.a13eba67.js"><link rel="prefetch" href="/assets/js/26.9baa244d.js"><link rel="prefetch" href="/assets/js/27.7a40c7b4.js"><link rel="prefetch" href="/assets/js/28.9e30bc88.js"><link rel="prefetch" href="/assets/js/29.5a968fce.js"><link rel="prefetch" href="/assets/js/30.8faabbe6.js"><link rel="prefetch" href="/assets/js/32.7bb1d9af.js"><link rel="prefetch" href="/assets/js/33.6f86b100.js"><link rel="prefetch" href="/assets/js/34.84067eaf.js"><link rel="prefetch" href="/assets/js/35.b2b8ac8d.js"><link rel="prefetch" href="/assets/js/36.7fc4dbe8.js"><link rel="prefetch" href="/assets/js/37.7849bc09.js"><link rel="prefetch" href="/assets/js/38.235de5e3.js"><link rel="prefetch" href="/assets/js/39.161f213e.js"><link rel="prefetch" href="/assets/js/4.335c6a02.js"><link rel="prefetch" href="/assets/js/40.f3b94ce2.js"><link rel="prefetch" href="/assets/js/41.fdc5ac1f.js"><link rel="prefetch" href="/assets/js/42.9d9ce856.js"><link rel="prefetch" href="/assets/js/43.883aa723.js"><link rel="prefetch" href="/assets/js/44.09215286.js"><link rel="prefetch" href="/assets/js/45.dae7f7c0.js"><link rel="prefetch" href="/assets/js/46.66c92fb8.js"><link rel="prefetch" href="/assets/js/47.575074f0.js"><link rel="prefetch" href="/assets/js/48.3e1ece3e.js"><link rel="prefetch" href="/assets/js/49.42212c07.js"><link rel="prefetch" href="/assets/js/5.2f47cbe8.js"><link rel="prefetch" href="/assets/js/50.47bec168.js"><link rel="prefetch" href="/assets/js/51.742ddc89.js"><link rel="prefetch" href="/assets/js/52.6876737a.js"><link rel="prefetch" href="/assets/js/53.5e1f3810.js"><link rel="prefetch" href="/assets/js/54.3dbad0f1.js"><link rel="prefetch" href="/assets/js/55.f233405f.js"><link rel="prefetch" href="/assets/js/56.d1566959.js"><link rel="prefetch" href="/assets/js/57.a58e03cf.js"><link rel="prefetch" href="/assets/js/6.e8a5dbcd.js"><link rel="prefetch" href="/assets/js/7.fe9d2c9f.js"><link rel="prefetch" href="/assets/js/8.0880906a.js"><link rel="prefetch" href="/assets/js/9.6e293cc6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d77f493a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">TosinJia</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件架构" class="dropdown-title"><span class="title">软件架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件架构" class="mobile-dropdown-title"><span class="title">软件架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/relatedTechnology.html" class="nav-link">
  相关技术
</a></li><li class="dropdown-item"><h4>
          开源框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/introduction.html" class="nav-link">
  简介
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/fontEnd/" class="nav-link">
  前端框架
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-vue/" class="nav-link">
  RuoYi-Vue
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud/" class="nav-link">
  RuoYi-Cloud
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作流" class="dropdown-title"><span class="title">工作流</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作流" class="mobile-dropdown-title"><span class="title">工作流</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/" class="nav-link">
  Activiti
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti基础.html" class="nav-link">
  Activiti基础
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti进阶.html" class="nav-link">
  Activiti进阶
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti整合.html" class="nav-link">
  Activiti整合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow down"></span></button> <button type="button" aria-label="教程" class="mobile-dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tutorials/linuxTutorial.html" class="nav-link">
  Linux教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/maven.html" class="nav-link">
  Maven教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/gitTutorial.html" class="nav-link">
  Git教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/vueTutorial.html" class="nav-link">
  Vue教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/thymeleaf.html" class="nav-link">
  Thymeleaf教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/docker.html" class="nav-link">
  Docker教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/virtualMachine.html" class="nav-link">
  虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/JMeter.html" class="nav-link">
  JMeter
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/PowerDesigner.html" class="nav-link">
  PowerDesigner
</a></li><li class="dropdown-subitem"><a href="/database/oracle.html" class="nav-link">
  Oracle
</a></li><li class="dropdown-subitem"><a href="/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搭建" class="dropdown-title"><span class="title">搭建</span> <span class="arrow down"></span></button> <button type="button" aria-label="搭建" class="mobile-dropdown-title"><span class="title">搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/build/" class="nav-link">
  站点搭建
</a></li><li class="dropdown-item"><!----> <a href="/build/thirdPartyMd.html" class="nav-link">
  三方Markdown
</a></li></ul></div></div><div class="nav-item"><a href="https://www.bing.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="软件架构" class="dropdown-title"><span class="title">软件架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="软件架构" class="mobile-dropdown-title"><span class="title">软件架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/relatedTechnology.html" class="nav-link">
  相关技术
</a></li><li class="dropdown-item"><h4>
          开源框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/introduction.html" class="nav-link">
  简介
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/fontEnd/" class="nav-link">
  前端框架
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-vue/" class="nav-link">
  RuoYi-Vue
</a></li><li class="dropdown-subitem"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud/" class="nav-link">
  RuoYi-Cloud
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作流" class="dropdown-title"><span class="title">工作流</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作流" class="mobile-dropdown-title"><span class="title">工作流</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/" class="nav-link">
  Activiti
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti基础.html" class="nav-link">
  Activiti基础
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti进阶.html" class="nav-link">
  Activiti进阶
</a></li><li class="dropdown-item"><!----> <a href="/softwareArchitecture/openSourceFramework/workflow/Activiti整合.html" class="nav-link">
  Activiti整合
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="教程" class="dropdown-title"><span class="title">教程</span> <span class="arrow down"></span></button> <button type="button" aria-label="教程" class="mobile-dropdown-title"><span class="title">教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tutorials/linuxTutorial.html" class="nav-link">
  Linux教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/maven.html" class="nav-link">
  Maven教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/gitTutorial.html" class="nav-link">
  Git教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/vueTutorial.html" class="nav-link">
  Vue教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/thymeleaf.html" class="nav-link">
  Thymeleaf教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/docker.html" class="nav-link">
  Docker教程
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/virtualMachine.html" class="nav-link">
  虚拟机
</a></li><li class="dropdown-item"><!----> <a href="/tutorials/JMeter.html" class="nav-link">
  JMeter
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          设计
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/database/PowerDesigner.html" class="nav-link">
  PowerDesigner
</a></li><li class="dropdown-subitem"><a href="/database/oracle.html" class="nav-link">
  Oracle
</a></li><li class="dropdown-subitem"><a href="/database/mysql.html" class="nav-link">
  MySQL
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搭建" class="dropdown-title"><span class="title">搭建</span> <span class="arrow down"></span></button> <button type="button" aria-label="搭建" class="mobile-dropdown-title"><span class="title">搭建</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/build/" class="nav-link">
  站点搭建
</a></li><li class="dropdown-item"><!----> <a href="/build/thirdPartyMd.html" class="nav-link">
  三方Markdown
</a></li></ul></div></div><div class="nav-item"><a href="https://www.bing.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  bing
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>分布式文件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#基本介绍" class="sidebar-link">基本介绍</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#本地存储" class="sidebar-link">本地存储</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#minio存储" class="sidebar-link">MinIO存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#下载方式" class="sidebar-link">下载方式</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#如何使用" class="sidebar-link">如何使用</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#访问策略" class="sidebar-link">访问策略</a></li></ul></li><li><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#fastdfs存储" class="sidebar-link">FastDfs存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#下载方式-2" class="sidebar-link">下载方式</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#配置nginx" class="sidebar-link">配置Nginx</a></li><li class="sidebar-sub-header"><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#如何使用-2" class="sidebar-link">如何使用</a></li></ul></li><li><a href="/softwareArchitecture/openSourceFramework/ruoyi/ruoyi-cloud-ow/cloud/file.html#切换存储方式" class="sidebar-link">切换存储方式</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="分布式文件"><a href="#分布式文件" class="header-anchor">#</a> 分布式文件</h1> <h2 id="基本介绍"><a href="#基本介绍" class="header-anchor">#</a> 基本介绍</h2> <ul><li>什么是分布式文件</li></ul> <p>分布式文件系统是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连。</p> <ul><li>为什么要使用分布式文件</li></ul> <p>分布式文件系统是面对互联网的需求而产生，互联网时代对海量数据如何存储？靠简单的增加硬盘的个数已经满足不了我们的要求，因为硬盘传输速度有限但是数据在急剧增长，另外我们还要要做好数据备份、数据安全等。</p> <p><code>ruoyi-file</code>目前支持三种存储方式，<code>本地存储</code>、<code>MinIO存储</code>、<code>FastDfs存储</code>，可以在<code>ruoyi-file-dev.yml</code>配置。</p> <h2 id="本地存储"><a href="#本地存储" class="header-anchor">#</a> 本地存储</h2> <p>1、文件配置</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># 本地文件上传    </span>
<span class="token key atrule">file</span><span class="token punctuation">:</span>
    <span class="token comment"># 访问地址</span>
    <span class="token key atrule">domain</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">9300</span>
	<span class="token comment"># 本地存放的路径地址</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>/ruoyi/uploadPath
	<span class="token comment"># 映射地址</span>
    <span class="token key atrule">prefix</span><span class="token punctuation">:</span> /statics
</code></pre></div><p>2、继承<code>WebMvcConfigurer</code>，重写<code>addResourceHandlers</code>，在<code>registry</code>里面配置访问路径和映射到的服务器本地路径。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ruoyi<span class="token punctuation">.</span>file<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResourceHandlerRegistry</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 通用映射配置
 * 
 * @author ruoyi
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResourcesConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * 上传文件存储在本地的根路径
     */</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${file.path}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> localFilePath<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 资源映射路径 前缀
     */</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${file.prefix}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> localFilePrefix<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/** 本地文件上传路径 */</span>
        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span>localFilePrefix <span class="token operator">+</span> <span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;file:&quot;</span> <span class="token operator">+</span> localFilePath <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3、启动<code>ruoyi-file</code>应用，访问<code>statics</code>会被映射到本地项目<code>D:/ruoyi/uploadPath</code>下的目录里面。</p> <p><img src="https://oscimg.oschina.net/oscnet/up-b1b7ed31eabe28b4ce815ab76569a771d05.png" alt="statics"></p> <h2 id="minio存储"><a href="#minio存储" class="header-anchor">#</a> MinIO存储</h2> <h3 id="下载方式"><a href="#下载方式" class="header-anchor">#</a> 下载方式</h3> <ul><li>Windows平台安装包下载</li></ul> <p>可以从<code>https://min.io/download#/windows</code>下载<code>minio.exe</code>可执行的文件。</p> <p>Windows下载后新建一个目录存放<code>minio</code>文件，例如<code>D:\minioData</code>，直接在<code>cmd</code>下运行<code>minio.exe server D:\minioData</code>。</p> <p>启动成功以后如下图，最后红色字提示修改<code>access Key</code>和<code>Secret Key</code></p> <p><img src="https://oscimg.oschina.net/oscnet/up-0f06828839a1214544aae11d4c38cfb5b8a.png" alt="minio"></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果觉得官网下载慢，可以使用我分享的网盘地址: https://pan.baidu.com/s/1E9J52g6uW_VFWY34fHL6zA 提取码: vneh</p></div> <ul><li>打开控制台</li></ul> <p><code>minio</code>提供了一个可视化的管理控制平台，安装好之后，在浏览器中输入(<a href="http://localhost:9000/" target="_blank" rel="noopener noreferrer">http://localhost:9000/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)就可以访问了，默认的用户名和密码都是<code>minioadmin</code></p> <p><img src="https://oscimg.oschina.net/oscnet/up-0c6c496704c7f30a569a07c520d0bbf40dd.png" alt="minio"></p> <h3 id="如何使用"><a href="#如何使用" class="header-anchor">#</a> 如何使用</h3> <p>配置文件</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># Minio配置</span>
<span class="token key atrule">minio</span><span class="token punctuation">:</span>
  <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">9000</span>
  <span class="token comment"># 账号</span>
  <span class="token key atrule">accessKey</span><span class="token punctuation">:</span> minioadmin
  <span class="token comment"># 密码</span>
  <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> minioadmin
  <span class="token comment"># MinIO桶名字</span>
  <span class="token key atrule">bucketName</span><span class="token punctuation">:</span> ruoyi
</code></pre></div><ul><li>创建桶</li></ul> <p>在后台管理界面选择<code>+号</code>创建你的<code>Create Bucket</code>，可以理解为一个文件夹用来存放图片。桶创建成功之后就可以上传图片了。</p> <p><img src="https://oscimg.oschina.net/oscnet/up-fc0a58dcb7bc7a2ec03736857febb50e20d.png" alt="minio"></p> <ul><li>上传图片</li></ul> <p>在后台管理界面选择<code>+号</code>上传你的<code>Upload file</code>，上传你自己的图片。在文件列表的右边就可以看到图片了。</p> <p><img src="https://oscimg.oschina.net/oscnet/up-106b75fff841430904e5125272b2d7f1bf6.png" alt="minio"></p> <h3 id="访问策略"><a href="#访问策略" class="header-anchor">#</a> 访问策略</h3> <p>设置<code>* ReadOnly</code>则所有用户通过文件路径即可访问，私有桶则不必设置访问策略。</p> <p><img src="https://oscimg.oschina.net/oscnet/up-4c2d1660428db87b223240736461ac034fc.png" alt="minio"></p> <p>启动<code>ruoyi-file</code>应用，在浏览器中打开(<a href="http://127.0.0.1:9000/ruoyi/ruoyi.png" target="_blank" rel="noopener noreferrer">http://127.0.0.1:9000/ruoyi/ruoyi.png<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)就可以访问图片了。</p> <h2 id="fastdfs存储"><a href="#fastdfs存储" class="header-anchor">#</a> FastDfs存储</h2> <p>文件存储、文件同步、文件上传、文件下载等，解决了文件大容量存储和高性能访问问题。</p> <h3 id="下载方式-2"><a href="#下载方式-2" class="header-anchor">#</a> 下载方式</h3> <p>创建目录<code>mkdir /home/fastdfs</code></p> <p>1)、下载安装libfastcommon</p> <p>1、下载libfastcommon v1.0.7</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/happyfish100/libfastcommon/archive/V1.0.7.tar.gz
</code></pre></div><p>2、解压libfastcommon v1.0.7</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tar</span> -xvf V1.0.7.tar.gz`
<span class="token builtin class-name">cd</span> libfastcommon-1.0.7
</code></pre></div><p>3、编译、安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./make.sh
./make.sh <span class="token function">install</span>
</code></pre></div><p>4、创建软链接</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ln</span> -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
<span class="token function">ln</span> -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so
<span class="token function">ln</span> -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so
<span class="token function">ln</span> -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so
</code></pre></div><p>2)、下载安装FastDFS</p> <p>1、下载FastDFS</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz
</code></pre></div><p>2、解压FastDFS</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tar</span> -xvf V5.05.tar.gz
<span class="token builtin class-name">cd</span> fastdfs-5.05
</code></pre></div><p>3、编译、安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./make.sh
./make.sh <span class="token function">install</span>
</code></pre></div><p>3)、配置 Tracker 服务</p> <p>上述安装成功后，在/etc/目录下会有一个fdfs的目录，进入它。会看到三个.sample后缀的文件，这是作者给我们的示例文件，
我们需要把其中的tracker.conf.sample文件改为tracker.conf配置文件并修改它：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cp</span> tracker.conf.sample tracker.conf
<span class="token function">vi</span> tracker.conf
</code></pre></div><p>编辑tracker.conf</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 配置文件是否不生效，false 为生效</span>
<span class="token assign-left variable">disabled</span><span class="token operator">=</span>false
<span class="token comment"># 提供服务的端口</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">22122</span>
<span class="token comment"># Tracker 数据和日志目录地址</span>
<span class="token assign-left variable">base_path</span><span class="token operator">=</span>//home/data/fastdfs
<span class="token comment"># HTTP 服务端口</span>
http.server_port<span class="token operator">=</span><span class="token number">80</span>
</code></pre></div><p>创建tracker基础数据目录，即base_path对应的目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /home/data/fastdfs
</code></pre></div><p>使用ln -s 建立软链接</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ln</span> -s /usr/bin/fdfs_trackerd /usr/local/bin
<span class="token function">ln</span> -s /usr/bin/stop.sh /usr/local/bin
<span class="token function">ln</span> -s /usr/bin/restart.sh /usr/local/bin
</code></pre></div><p>启动服务</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">service</span> fdfs_trackerd start
<span class="token function">service</span> fdfs_trackerd stop
<span class="token function">service</span> fdfs_trackerd restart
</code></pre></div><p>查看监听</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">netstat</span> -unltp<span class="token operator">|</span><span class="token function">grep</span> fdfs
</code></pre></div><p>如果看到22122端口正常被监听后，这时候说明Tracker服务启动成功啦！</p> <p><code>tracker server</code>目录及文件结构
<code>Tracker</code>服务启动成功后，会在<code>base_path</code>下创建<code>data</code>、<code>logs</code>两个目录。目录结构如下：</p> <div class="language- extra-class"><pre class="language-text"><code>${base_path}
  |__data
  |   |__storage_groups.dat：存储分组信息
  |   |__storage_servers.dat：存储服务器列表
  |__logs
  |   |__trackerd.log： tracker server 日志文件 
</code></pre></div><p>4)、配置 Storage 服务</p> <p>进入<code>/etc/fdfs</code>目录，复制<code>FastDFS</code>存储器样例配置文件<code>storage.conf.sample</code>，并重命名为<code>storage.conf</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># cd /etc/fdfs</span>
<span class="token comment"># cp storage.conf.sample storage.conf</span>
<span class="token comment"># vi storage.conf</span>
</code></pre></div><p>编辑storage.conf</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 配置文件是否不生效，false 为生效</span>
<span class="token assign-left variable">disabled</span><span class="token operator">=</span>false
<span class="token comment"># 指定此 storage server 所在 组(卷)</span>
<span class="token assign-left variable">group_name</span><span class="token operator">=</span>group1
<span class="token comment"># storage server 服务端口</span>
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">23000</span>
<span class="token comment"># 心跳间隔时间，单位为秒 (这里是指主动向 tracker server 发送心跳)</span>
<span class="token assign-left variable">heart_beat_interval</span><span class="token operator">=</span><span class="token number">30</span>
<span class="token comment"># Storage 数据和日志目录地址(根目录必须存在，子目录会自动生成)</span>
<span class="token assign-left variable">base_path</span><span class="token operator">=</span>/home/data/fastdfs/storage
<span class="token comment"># 存放文件时 storage server 支持多个路径。这里配置存放文件的基路径数目，通常只配一个目录。</span>
<span class="token assign-left variable">store_path_count</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 逐一配置 store_path_count 个路径，索引号基于 0。</span>
<span class="token comment"># 如果不配置 store_path0，那它就和 base_path 对应的路径一样。</span>
<span class="token assign-left variable">store_path0</span><span class="token operator">=</span>/home/data/fastdfs/storage
<span class="token comment"># FastDFS 存储文件时，采用了两级目录。这里配置存放文件的目录个数。 </span>
<span class="token comment"># 如果本参数只为 N（如： 256），那么 storage server 在初次运行时，会在 store_path 下自动创建 N * N 个存放文件的子目录。</span>
<span class="token assign-left variable">subdir_count_per_path</span><span class="token operator">=</span><span class="token number">256</span>
<span class="token comment"># tracker_server 的列表 ，会主动连接 tracker_server</span>
<span class="token comment"># 有多个 tracker server 时，每个 tracker server 写一行 公网访问需要配置公网IP</span>
<span class="token assign-left variable">tracker_server</span><span class="token operator">=</span><span class="token number">192.168</span>.1.190:22122
<span class="token comment"># 允许系统同步的时间段 (默认是全天) 。一般用于避免高峰同步产生一些问题而设定。</span>
<span class="token assign-left variable">sync_start_time</span><span class="token operator">=</span>00:00
<span class="token assign-left variable">sync_end_time</span><span class="token operator">=</span><span class="token number">23</span>:59
</code></pre></div><p>创建storaged基础数据目录，即base_path对应的目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /home/data/fastdfs/storage
</code></pre></div><p>使用ln -s 建立软链接</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ln</span> -s /usr/bin/fdfs_storaged /usr/local/bin
</code></pre></div><p>启动服务</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">service</span> fdfs_storaged start
<span class="token function">service</span> fdfs_storaged stop
<span class="token function">service</span> fdfs_storaged restart
</code></pre></div><p>查看监听</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">netstat</span> -unltp<span class="token operator">|</span><span class="token function">grep</span> fdfs
</code></pre></div><p>启动<code>Storage</code>前确保<code>Tracker</code>是启动的。初次启动成功，会在<code>/home/data/fastdfs/storage</code>目录下创建<code>data</code>、<code>logs</code>两个目录。
如果看到<code>23000端口</code>正常被监听后，这时候说明<code>Storage</code>服务启动成功啦！</p> <p>查看<code>Storage</code>和<code>Tracker</code>是否在通信</p> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf
</code></pre></div><h3 id="配置nginx"><a href="#配置nginx" class="header-anchor">#</a> 配置Nginx</h3> <p>1、下载安装Nginx和fastdfs-nginx-module
安装以下的开发库:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum <span class="token function">install</span> readline-devel pcre-devel openssl-devel -y
</code></pre></div><p>2、下载fastdfs-nginx-module-1.20.tar</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tar</span> -xvf fastdfs-nginx-module-1.20.tar
</code></pre></div><p>3、编辑fastdfs-nginx-module-1.20/src/config文件修改</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> fastdfs-nginx-module-1.20/src/config
<span class="token assign-left variable">ngx_module_incs</span><span class="token operator">=</span><span class="token string">&quot;/usr/include/fastdfs /usr/include/fastcommon/&quot;</span>
<span class="token assign-left variable">CORE_INCS</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$CORE_INCS</span> /usr/include/fastdfs /usr/include/fastcommon/&quot;</span>
</code></pre></div><p>4、配置nginx安装，加入fastdfs-nginx-module模块（需要先安装好nginx）</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./configure --add-module<span class="token operator">=</span><span class="token punctuation">..</span>/fastdfs-nginx-module-master/src/
</code></pre></div><p>5、编译、安装</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>6、查看Nginx的模块</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./nginx -v
</code></pre></div><p>7、复制fastdfs-nginx-module源码中的配置文件到/etc/fdfs目录，并修改</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /home/FastDFS/fastdfs-nginx-module-1.20/src
<span class="token function">cp</span> mod_fastdfs.conf /etc/fdfs/
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 连接超时时间</span>
<span class="token assign-left variable">connect_timeout</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># Tracker Server</span>
<span class="token assign-left variable">tracker_server</span><span class="token operator">=</span><span class="token number">192.168</span>.1.190:22122
<span class="token comment"># StorageServer 默认端口</span>
<span class="token assign-left variable">storage_server_port</span><span class="token operator">=</span><span class="token number">23000</span>
<span class="token comment"># 如果文件ID的uri中包含/group**，则要设置为true</span>
url_have_group_name <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment"># Storage 配置的store_path0路径，必须和storage.conf中的一致</span>
<span class="token assign-left variable">store_path0</span><span class="token operator">=</span>/home/data/fastdfs/storage
</code></pre></div><p>8、复制FastDFS的部分配置文件到/etc/fdfs目录</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /home/FastDFS/fastdfs-5.11/conf
<span class="token function">cp</span> http.conf /etc/fdfs/
<span class="token function">cp</span> mime.types /etc/fdfs/
</code></pre></div><p>9、配置nginx，修改nginx.conf：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>location ~/group<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span><span class="token punctuation">)</span>/M00 <span class="token punctuation">{</span>
    ngx_fastdfs_module<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>10、启动Nginx：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./nginx
ngx_http_fastdfs_set <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token number">11256</span>
</code></pre></div><h3 id="如何使用-2"><a href="#如何使用-2" class="header-anchor">#</a> 如何使用</h3> <p>1、配置文件</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># FastDFS配置</span>
<span class="token key atrule">fdfs</span><span class="token punctuation">:</span>
  <span class="token key atrule">domain</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//8.129.231.12
  <span class="token key atrule">soTimeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>
  <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">2000</span>
  <span class="token key atrule">trackerList</span><span class="token punctuation">:</span> 8.129.231.12<span class="token punctuation">:</span><span class="token number">22122</span>
</code></pre></div><p>启动<code>ruoyi-file</code>应用，调用<code>upload</code>上传接口后会返回一个地址，在浏览器中打开<code>http://8.129.231.12/group1/M00/00/00/xxxx.png</code>就可以访问图片了。</p> <h2 id="切换存储方式"><a href="#切换存储方式" class="header-anchor">#</a> 切换存储方式</h2> <p>目前默认采用的是本地存储，可以通过注解<code>@Primary</code>指定需要使用的文件接口。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Primary</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalSysFileServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ISysFileService</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>本地文件存储</strong>：<code>LocalSysFileServiceImpl.java</code></p> <p><strong>Minio 文件存储</strong>：<code>MinioSysFileServiceImpl.java</code></p> <p><strong>FastDFS文件存储</strong>：<code>FastDfsSysFileServiceImpl.java</code></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.de0ffd6c.js" defer></script><script src="/assets/js/3.059a2ce3.js" defer></script><script src="/assets/js/31.60e0f28d.js" defer></script>
  </body>
</html>
